# –†–æ–∑–¥—ñ–ª 10: Borrowing ‚Äî –ú—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏

---

## üìã –ê–Ω–æ—Ç–∞—Ü—ñ—è

–£ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –Ω–∞–≤—á–∏–ª–∏—Å—å –ø–æ–∑–∏—á–∞—Ç–∏ –¥–∞–Ω—ñ –¥–ª—è **—á–∏—Ç–∞–Ω–Ω—è** —á–µ—Ä–µ–∑ `&T`. –ê–ª–µ —â–æ, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∑–º—ñ–Ω–∏—Ç–∏** –ø–æ–∑–∏—á–µ–Ω—ñ –¥–∞–Ω—ñ? –£—è–≤—ñ—Ç—å –∞–≥–µ–Ω—Ç–∞, —â–æ –æ—Ç—Ä–∏–º—É—î –∫–æ–º–∞–Ω–¥—É –æ–Ω–æ–≤–∏—Ç–∏ —Å–≤–æ—é –ø–æ–∑–∏—Ü—ñ—é ‚Äî –π–æ–º—É –ø–æ—Ç—Ä—ñ–±–µ–Ω –Ω–µ –ª–∏—à–µ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö, –∞ –π –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —ó—Ö –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏.

–ú—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (`&mut T`) –≤–∏—Ä—ñ—à—É—é—Ç—å —Ü—é –∑–∞–¥–∞—á—É, –∞–ª–µ –∑ —Å—É–≤–æ—Ä–∏–º –æ–±–º–µ–∂–µ–Ω–Ω—è–º: **—É –∫–æ–∂–µ–Ω –º–æ–º–µ–Ω—Ç —á–∞—Å—É –º–æ–∂–µ —ñ—Å–Ω—É–≤–∞—Ç–∏ –ª–∏—à–µ –û–î–ù–ï –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è**. –¶–µ –ø—Ä–∞–≤–∏–ª–æ ‚Äî –∫–ª—é—á –¥–æ –±–µ–∑–ø–µ–∫–∏ Rust.

---

## üéØ –¶—ñ–ª—ñ –Ω–∞–≤—á–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ:

1. **–°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏** –º—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `&mut`
2. **–ü–æ—è—Å–Ω—é–≤–∞—Ç–∏** –ø—Ä–∞–≤–∏–ª–æ –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ —á–æ–º—É –≤–æ–Ω–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–µ
3. **–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞—Ç–∏** –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ –º—ñ–∂ `&T` —Ç–∞ `&mut T`
4. **–í–∏–ø—Ä–∞–≤–ª—è—Ç–∏** –ø–æ–º–∏–ª–∫–∏ borrow checker

---

## üìö –ö–ª—é—á–æ–≤—ñ —Ç–µ—Ä–º—ñ–Ω–∏

| –¢–µ—Ä–º—ñ–Ω | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|------------|
| **mutable reference** | –ü–æ—Å–∏–ª–∞–Ω–Ω—è –∑ –ø—Ä–∞–≤–æ–º –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (`&mut T`) |
| **exclusive access** | –ï–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø ‚Äî —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á |
| **data race** | –û–¥–Ω–æ—á–∞—Å–Ω–∏–π –¥–æ—Å—Ç—É–ø –∑ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é ‚Äî –ø–æ–º–∏–ª–∫–∞ |
| **borrow conflict** | –ö–æ–Ω—Ñ–ª—ñ–∫—Ç –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ —Ç–∏–ø–∞–º–∏ –ø–æ–∑–∏—á–∞–Ω—å |

---

## üí° –ú–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏–π –∫–µ–π—Å: –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å—Ç–∞–Ω—É –∞–≥–µ–Ω—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –Ø–∫ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ–∑–∏—á–µ–Ω—ñ –¥–∞–Ω—ñ?

–£—è–≤—ñ—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∞–≥–µ–Ω—Ç–æ–º. –ö–æ–º–∞–Ω–¥–Ω–∏–π —Ü–µ–Ω—Ç—Ä –Ω–∞–¥—Å–∏–ª–∞—î –∫–æ–º–∞–Ω–¥—É –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é. –ë–µ–∑ –º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å –¥–æ–≤–æ–¥–∏—Ç—å—Å—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –¥–∞–Ω—ñ —É —Ñ—É–Ω–∫—Ü—ñ—é —ñ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –Ω–∞–∑–∞–¥:

```rust
fn update_position(pos: (f64, f64)) -> (f64, f64) {
    (pos.0 + 10.0, pos.1 + 20.0)
}

fn main() {
    let mut position = (100.0, 200.0);
    position = update_position(position);  // –ü–µ—Ä–µ–¥–∞—î–º–æ —ñ –æ—Ç—Ä–∏–º—É—î–º–æ –Ω–∞–∑–∞–¥
    println!("{:?}", position);
}
```

–¶–µ –ø—Ä–∞—Ü—é—î, –∞–ª–µ –≥—Ä–æ–º—ñ–∑–¥–∫–æ ‚Äî –æ—Å–æ–±–ª–∏–≤–æ —è–∫—â–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö –≤–µ–ª–∏–∫–∞.

### –†—ñ—à–µ–Ω–Ω—è: –ú—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

```rust
fn update_position(pos: &mut (f64, f64)) {
    pos.0 += 10.0;
    pos.1 += 20.0;
}

fn main() {
    let mut position = (100.0, 200.0);
    update_position(&mut position);  // –ú–æ–¥–∏—Ñ—ñ–∫—É—î–º–æ –Ω–∞ –º—ñ—Å—Ü—ñ
    println!("{:?}", position);  // (110.0, 220.0)
}
```

–§—É–Ω–∫—Ü—ñ—è –∑–º—ñ–Ω—é—î –¥–∞–Ω—ñ –Ω–∞–ø—Ä—è–º—É, –±–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è. –ï–ª–µ–≥–∞–Ω—Ç–Ω–æ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ!

---

## 10.1 –°–ò–ù–¢–ê–ö–°–ò–° –ú–£–¢–ê–ë–ï–õ–¨–ù–ò–• –ü–û–°–ò–õ–ê–ù–¨

### 10.1.1 –î–≤—ñ —É–º–æ–≤–∏ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è &mut

–©–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, –ø–æ—Ç—Ä—ñ–±–Ω—ñ **–¥–≤—ñ —É–º–æ–≤–∏**:

1. **–û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞ –º–∞—î –±—É—Ç–∏ `mut`** ‚Äî —Ç—ñ–ª—å–∫–∏ –º—É—Ç–∞–±–µ–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω—é–≤–∞—Ç–∏
2. **–ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `&mut`** ‚Äî —è–≤–Ω–æ –≤–∫–∞–∑—É—î–º–æ, —â–æ —Ö–æ—á–µ–º–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ –±–∞–∑–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–Ω–∞—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –Ω—å–æ–≥–æ.

```rust
fn main() {
    // –£–ú–û–í–ê 1: –ó–º—ñ–Ω–Ω–∞ –º–∞—î –±—É—Ç–∏ mut
    let mut value = 42;
    
    // –£–ú–û–í–ê 2: –ü–æ—Å–∏–ª–∞–Ω–Ω—è —á–µ—Ä–µ–∑ &mut
    let reference: &mut i32 = &mut value;
    
    // –ú–æ–¥–∏—Ñ—ñ–∫—É—î–º–æ —á–µ—Ä–µ–∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
    // *reference ‚Äî —Ü–µ –¥–æ—Å—Ç—É–ø –¥–æ –∑–Ω–∞—á–µ–Ω–Ω—è "–∑–∞ –∞–¥—Ä–µ—Å–æ—é"
    *reference += 10;
    
    println!("Value: {}", value);  // 52
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. **–†—è–¥–æ–∫ 3:** –°—Ç–≤–æ—Ä—é—î–º–æ `mut` –∑–º—ñ–Ω–Ω—É `value` –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º 42. –ë–µ–∑ `mut` —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–µ–º–æ–∂–ª–∏–≤–µ.

2. **–†—è–¥–æ–∫ 6:** `&mut value` —Å—Ç–≤–æ—Ä—é—î –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è. –¢–∏–ø `reference` ‚Äî —Ü–µ `&mut i32`.

3. **–†—è–¥–æ–∫ 10:** `*reference` ‚Äî —Ü–µ –æ–ø–µ—Ä–∞—Ü—ñ—è **—Ä–æ–∑—ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è**. –í–æ–Ω–∞ –¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∑–Ω–∞—á–µ–Ω–Ω—è, –Ω–∞ —è–∫–µ –≤–∫–∞–∑—É—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è. `*reference += 10` –¥–æ–¥–∞—î 10 –¥–æ `value`.

4. **–†—è–¥–æ–∫ 12:** –í–∏–≤–æ–¥–∏–º–æ `value` ‚Äî —Ç–µ–ø–µ—Ä —Ü–µ 52.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```text
Value: 52
```

### 10.1.2 –û–ø–µ—Ä–∞—Ç–æ—Ä * –¥–ª—è –∑–∞–ø–∏—Å—É

**–¢–µ–æ—Ä—ñ—è:** –î–ª—è **—á–∏—Ç–∞–Ω–Ω—è** —á–µ—Ä–µ–∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è Rust —á–∞—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—ñ–º–µ–Ω–æ–≤—É—î. –ê–ª–µ –¥–ª—è **–∑–∞–ø–∏—Å—É** –æ–ø–µ—Ä–∞—Ç–æ—Ä `*` –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π ‚Äî —Ü–µ —è–≤–Ω–æ –ø–æ–∫–∞–∑—É—î, —â–æ –º–∏ –∑–º—ñ–Ω—é—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∞–¥—Ä–µ—Å–æ—é.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ —Ä—ñ–∑–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑–∞–ø–∏—Å—É —á–µ—Ä–µ–∑ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.

```rust
fn main() {
    let mut x = 5;
    let r = &mut x;
    
    // –ü–æ–≤–Ω–∞ –∑–∞–º—ñ–Ω–∞ –∑–Ω–∞—á–µ–Ω–Ω—è
    *r = 10;
    println!("–ü—ñ—Å–ª—è *r = 10: {}", *r);  // 10
    
    // –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
    *r += 5;
    println!("–ü—ñ—Å–ª—è *r += 5: {}", *r);  // 15
    
    *r *= 2;
    println!("–ü—ñ—Å–ª—è *r *= 2: {}", *r);  // 30
    
    // –§—ñ–Ω–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –∑–º—ñ–Ω–Ω—É
    println!("x = {}", x);  // 30
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. **`*r = 10`** ‚Äî –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ 10.
2. **`*r += 5`** ‚Äî –¥–æ–¥–∞—î 5 –¥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è (10 + 5 = 15).
3. **`*r *= 2`** ‚Äî –º–Ω–æ–∂–∏—Ç—å –Ω–∞ 2 (15 √ó 2 = 30).
4. –í –∫—ñ–Ω—Ü—ñ `x` –º—ñ—Å—Ç–∏—Ç—å 30 ‚Äî –≤—Å—ñ –∑–º—ñ–Ω–∏ —á–µ—Ä–µ–∑ `r` –≤–ø–ª–∏–Ω—É–ª–∏ –Ω–∞ `x`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```rust
–ü—ñ—Å–ª—è *r = 10: 10
–ü—ñ—Å–ª—è *r += 5: 15
–ü—ñ—Å–ª—è *r *= 2: 30
x = 30
```

### 10.1.3 –ú–µ—Ç–æ–¥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—ñ–º–µ–Ω–æ–≤—É—é—Ç—å

**–¢–µ–æ—Ä—ñ—è:** –•–æ—á–∞ –¥–ª—è –ø—Ä–∏—Å–≤–æ—î–Ω–Ω—è (`*r = ...`) –ø–æ—Ç—Ä—ñ–±–µ–Ω —è–≤–Ω–∏–π `*`, –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É –º–µ—Ç–æ–¥—ñ–≤ Rust —Ä–æ–∑—ñ–º–µ–Ω–æ–≤—É—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –¶–µ –∑—Ä—É—á–Ω—ñ—Å—Ç—å, —è–∫–∞ —Ä–æ–±–∏—Ç—å –∫–æ–¥ —á–∏—Å—Ç—ñ—à–∏–º.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ, —â–æ –º–µ—Ç–æ–¥–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –Ω–∞–ø—Ä—è–º—É –Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—ñ –±–µ–∑ `*`.

```rust
fn main() {
    let mut s = String::from("Hello");
    let r = &mut s;
    
    // –í–∏–∫–ª–∏–∫ –º–µ—Ç–æ–¥—ñ–≤ ‚Äî * –ù–ï –ø–æ—Ç—Ä—ñ–±–µ–Ω
    r.push_str(", World!");  // Rust –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–±–∏—Ç—å (*r).push_str(...)
    r.push('!');             // –¢–∞–∫ —Å–∞–º–æ
    
    // –î–ª—è —á–∏—Ç–∞–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏ —Ç–µ–∂ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω *
    println!("–î–æ–≤–∂–∏–Ω–∞: {}", r.len());  // 14
    
    println!("–†–µ–∑—É–ª—å—Ç–∞—Ç: {}", s);  // "Hello, World!!"
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. **`r.push_str(...)`** ‚Äî Rust "—Ä–æ–∑—É–º—ñ—î", —â–æ `r` ‚Äî —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î –º–µ—Ç–æ–¥ –Ω–∞ `*r`.
2. **`r.len()`** ‚Äî —Ç–∞–∫ —Å–∞–º–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑—ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è.
3. –¶–µ –ø—Ä–∞—Ü—é—î —ñ –¥–ª—è `&T`, —ñ –¥–ª—è `&mut T`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```text
–î–æ–≤–∂–∏–Ω–∞: 14
–†–µ–∑—É–ª—å—Ç–∞—Ç: Hello, World!!
```

---

## 10.2 –ü–†–ê–í–ò–õ–û –ï–ö–°–ö–õ–Æ–ó–ò–í–ù–û–°–¢–Ü

### 10.2.1 –ì–æ–ª–æ–≤–Ω–µ –ø—Ä–∞–≤–∏–ª–æ –º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å

–û—Å—å –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–µ –ø—Ä–∞–≤–∏–ª–æ, —è–∫–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–∞–º'—è—Ç–∞—Ç–∏:

> **–£ –∫–æ–∂–µ–Ω –º–æ–º–µ–Ω—Ç —á–∞—Å—É –º–æ–∂–µ —ñ—Å–Ω—É–≤–∞—Ç–∏ –ê–ë–û –æ–¥–Ω–µ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (`&mut T`), –ê–ë–û –±—É–¥—å-—è–∫–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö (`&T`) ‚Äî –∞–ª–µ –ù–Ü–ö–û–õ–ò –æ–±–∏–¥–≤–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.**

–¶–µ –ø—Ä–∞–≤–∏–ª–æ –∑–∞–ø–æ–±—ñ–≥–∞—î **data races** ‚Äî –æ–¥–Ω—ñ–π –∑ –Ω–∞–π–Ω–µ–±–µ–∑–ø–µ—á–Ω—ñ—à–∏—Ö –ø–æ–º–∏–ª–æ–∫ —É –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ.

### 10.2.2 –©–æ —Ç–∞–∫–µ data race —ñ —á–æ–º—É —Ü–µ –ø–æ–≥–∞–Ω–æ

**Data race** –≤–∏–Ω–∏–∫–∞—î, –∫–æ–ª–∏:
1. –î–≤–∞ –∞–±–æ –±—ñ–ª—å—à–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ —Ç–∏—Ö —Å–∞–º–∏—Ö –¥–∞–Ω–∏—Ö
2. –•–æ—á–∞ –± –æ–¥–∏–Ω –∑ –Ω–∏—Ö –∑–∞–ø–∏—Å—É—î
3. –ù–µ–º–∞—î —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

**–ü—Ä–∏–∫–ª–∞–¥ –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó (–Ω–µ Rust):**

```text
–ü–û–¢–Ü–ö 1                      –ü–û–¢–Ü–ö 2
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
—á–∏—Ç–∞—î vector.len() ‚Üí 3       
                             push() ‚Üí len —Ç–µ–ø–µ—Ä 4
                             –¥–∞–Ω—ñ –ø–µ—Ä–µ–º—ñ—Å—Ç–∏–ª–∏—Å—å —É –ø–∞–º'—è—Ç—ñ!
—á–∏—Ç–∞—î vector[2] ‚Üí ???        
    ‚Üë –ö–ê–¢–ê–°–¢–†–û–§–ê: –¥–∞–Ω—ñ –≤–∂–µ –Ω–µ —Ç–∞–º!
```

–í C++ —Ç–∞–∫–∏–π –∫–æ–¥ —Å–∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è. –ë–∞–≥ –≤–∏—è–≤–∏—Ç—å—Å—è (—è–∫—â–æ –ø–æ—â–∞—Å—Ç–∏—Ç—å) —Ç—ñ–ª—å–∫–∏ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ‚Äî –∞–±–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–ø–∞–¥–µ, –∞–±–æ –ø–æ–≤–µ—Ä–Ω–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –¥–∞–Ω—ñ, –∞–±–æ (–Ω–∞–π–≥—ñ—Ä—à–µ) —Å–ø—Ä–∞—Ü—é—î "–ø—Ä–∞–≤–∏–ª—å–Ω–æ" –≤ —Ç–µ—Å—Ç–∞—Ö, –∞ –∑–ª–∞–º–∞—î—Ç—å—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω—ñ.

**Rust –∑–∞–ø–æ–±—ñ–≥–∞—î —Ü—å–æ–º—É –Ω–∞ –µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó:**

### 10.2.3 –î—ñ–∞–≥—Ä–∞–º–∞ –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç—ñ

```text
–í–ê–†–Ü–ê–ù–¢ 1: –ë–∞–≥–∞—Ç–æ —á–∏—Ç–∞—á—ñ–≤ (OK)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 data                    ‚îÇ
‚îÇ                  ‚îÇ                      ‚îÇ
‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ      ‚ñº           ‚ñº           ‚ñº          ‚îÇ
‚îÇ   &data       &data       &data         ‚îÇ
‚îÇ  (—á–∏—Ç–∞—î)     (—á–∏—Ç–∞—î)     (—á–∏—Ç–∞—î)        ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚úÖ –ë–µ–∑–ø–µ—á–Ω–æ ‚Äî –Ω—ñ—Ö—Ç–æ –Ω–µ –∑–º—ñ–Ω—é—î          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–í–ê–†–Ü–ê–ù–¢ 2: –û–¥–∏–Ω –ø–∏—Å—å–º–µ–Ω–Ω–∏–∫ (OK)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 data                    ‚îÇ
‚îÇ                  ‚îÇ                      ‚îÇ
‚îÇ                  ‚ñº                      ‚îÇ
‚îÇ              &mut data                  ‚îÇ
‚îÇ        (—á–∏—Ç–∞—î –Ü –∑–º—ñ–Ω—é—î)                 ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚úÖ –ë–µ–∑–ø–µ—á–Ω–æ ‚Äî –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–í–ê–†–Ü–ê–ù–¢ 3: –ß–∏—Ç–∞—á + –ø–∏—Å—å–º–µ–Ω–Ω–∏–∫ (–ó–ê–ë–û–†–û–ù–ï–ù–û)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 data                    ‚îÇ
‚îÇ                  ‚îÇ                      ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ         ‚ñº               ‚ñº               ‚îÇ
‚îÇ      &data          &mut data           ‚îÇ
‚îÇ     (—á–∏—Ç–∞—î)   (–º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏!)           ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  ‚ùå –ù–µ–±–µ–∑–ø–µ—á–Ω–æ ‚Äî —á–∏—Ç–∞—á –º–æ–∂–µ –ø–æ–±–∞—á–∏—Ç–∏    ‚îÇ
‚îÇ     –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ –¥–∞–Ω—ñ!                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 10.2.4 –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É: &mut + &

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ, —â–æ Rust –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –º–∞—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ —Ç–∞ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç—ñ —Å–∞–º—ñ –¥–∞–Ω—ñ.

```rust
fn main() {
    let mut s = String::from("hello");
    
    let r1 = &s;        // –Ü–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è ‚Äî OK
    let r2 = &mut s;    // –ú—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è ‚Äî –ü–û–ú–ò–õ–ö–ê!
    
    println!("{}", r1);  // –°–ø—Ä–æ–±–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ r1
}
```

**–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–∞:**

```text
error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
 --> src/main.rs:5:14
  |
4 |     let r1 = &s;
  |              -- immutable borrow occurs here
5 |     let r2 = &mut s;
  |              ^^^^^^ mutable borrow occurs here
7 |     println!("{}", r1);
  |                    -- immutable borrow later used here
```

**–Ø–∫ —á–∏—Ç–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É:**

1. **–†—è–¥–æ–∫ 4:** –°—Ç–≤–æ—Ä–∏–ª–∏ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è `r1` –Ω–∞ `s`.
2. **–†—è–¥–æ–∫ 5:** –ù–∞–º–∞–≥–∞—î–º–æ—Å—å —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è `r2` ‚Äî –ó–ê–ë–û–†–û–ù–ï–ù–û, –±–æ `r1` —â–µ "–∂–∏–≤–µ".
3. **–†—è–¥–æ–∫ 7:** –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –±–∞—á–∏—Ç—å, —â–æ `r1` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—ñ–∑–Ω—ñ—à–µ ‚Äî —Ç–æ–º—É –≤—ñ–Ω –≤—Å–µ —â–µ –∞–∫—Ç–∏–≤–Ω–∏–π.

**–ß–æ–º—É —Ü–µ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ:** –Ø–∫–±–∏ `r2` –º–æ–≥–ª–æ –∑–º—ñ–Ω–∏—Ç–∏ `s`, —Ç–æ `r1` –º–æ–≥–ª–æ –± –ø–æ–±–∞—á–∏—Ç–∏ –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω—ñ –¥–∞–Ω—ñ.

### 10.2.5 –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É: &mut + &mut

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ, —â–æ –Ω–µ –º–æ–∂–Ω–∞ –º–∞—Ç–∏ –¥–≤–∞ –º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ.

```rust
fn main() {
    let mut s = String::from("hello");
    
    let r1 = &mut s;  // –ü–µ—Ä—à–µ –º—É—Ç–∞–±–µ–ª—å–Ω–µ
    let r2 = &mut s;  // –î—Ä—É–≥–µ –º—É—Ç–∞–±–µ–ª—å–Ω–µ ‚Äî –ü–û–ú–ò–õ–ö–ê!
    
    println!("{} {}", r1, r2);
}
```

**–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–∞:**

```text
error[E0499]: cannot borrow `s` as mutable more than once at a time
 --> src/main.rs:5:14
  |
4 |     let r1 = &mut s;
  |              ------ first mutable borrow occurs here
5 |     let r2 = &mut s;
  |              ^^^^^^ second mutable borrow occurs here
7 |     println!("{} {}", r1, r2);
  |                       -- first borrow later used here
```

**–ß–æ–º—É —Ü–µ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ:** –Ø–∫–±–∏ –æ–±–∏–¥–≤–∞ `r1` —ñ `r2` –º–æ–≥–ª–∏ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ `s`, –≤–æ–Ω–∏ –º–æ–≥–ª–∏ –± –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É–≤–∞—Ç–∏ ‚Äî –æ–¥–∏–Ω –∑–º—ñ–Ω—é—î, —ñ–Ω—à–∏–π —á–∏—Ç–∞—î –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ –¥–∞–Ω—ñ.

---

## 10.3 NLL: –†–û–ó–£–ú–ù–ò–ô –ê–ù–ê–õ–Ü–ó –í–ò–ö–û–†–ò–°–¢–ê–ù–ù–Ø

### 10.3.1 –©–æ —Ç–∞–∫–µ Non-Lexical Lifetimes

**–¢–µ–æ—Ä—ñ—è:** –£ —Å—Ç–∞—Ä–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö Rust (–¥–æ 2018) –ø–æ—Å–∏–ª–∞–Ω–Ω—è "–∂–∏–ª–æ" –¥–æ –∫—ñ–Ω—Ü—è —Å–≤–æ–≥–æ scope ‚Äî –¥–æ –∑–∞–∫—Ä–∏–≤–∞—é—á–æ—ó –¥—É–∂–∫–∏ `}`. –¶–µ –±—É–ª–æ –∑–∞–Ω–∞–¥—Ç–æ —Å—É–≤–æ—Ä–æ. –°—É—á–∞—Å–Ω–∏–π Rust –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **NLL (Non-Lexical Lifetimes)** ‚Äî –≤—ñ–Ω –∞–Ω–∞–ª—ñ–∑—É—î, –¥–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è **—Ñ–∞–∫—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è**, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–µ –≤–æ–Ω–æ –æ–≥–æ–ª–æ—à–µ–Ω–µ.

### 10.3.2 –Ø–∫ NLL –¥–æ–ø–æ–º–∞–≥–∞—î

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ, —â–æ Rust –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è **–ø—ñ—Å–ª—è** –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö.

```rust
fn main() {
    let mut s = String::from("hello");
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
    let r1 = &s;
    let r2 = &s;
    
    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —ó—Ö ‚Äî —Ü–µ –û–°–¢–ê–ù–ù–Ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è r1 —Ç–∞ r2
    println!("r1: {}, r2: {}", r1, r2);
    
    // NLL –±–∞—á–∏—Ç—å, —â–æ r1 —Ç–∞ r2 –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ
    // –¢–æ–º—É –º–æ–∂–µ–º–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
    let r3 = &mut s;
    r3.push_str(" world");
    
    println!("r3: {}", r3);  // "hello world"
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. **–†—è–¥–∫–∏ 4-5:** –°—Ç–≤–æ—Ä—é—î–º–æ –¥–≤–∞ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω–Ω—è `r1` —ñ `r2`.

2. **–†—è–¥–æ–∫ 8:** –í–∏–≤–æ–¥–∏–º–æ `r1` —ñ `r2` ‚Äî —Ü–µ —ó—Ö **–æ—Å—Ç–∞–Ω–Ω—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**.

3. **–†—è–¥–æ–∫ 12:** –ü—ñ—Å–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è NLL "–∑–∞–≤–µ—Ä—à—É—î" –∂–∏—Ç—Ç—è `r1` —ñ `r2`. –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ `r3: &mut s`.

4. **–†—è–¥–æ–∫ 13:** –ú–æ–¥–∏—Ñ—ñ–∫—É—î–º–æ —á–µ—Ä–µ–∑ `r3` ‚Äî –≤—Å–µ –ø—Ä–∞—Ü—é—î!

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```text
r1: hello, r2: hello
r3: hello world
```

### 10.3.3 –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: —Å—Ç–∞—Ä–∏–π Rust vs NLL

**–°—Ç–∞—Ä–∏–π Rust (–¥–æ 2018):**

```rust
fn old_style() {
    let mut s = String::from("hello");
    
    let r1 = &s;
    println!("{}", r1);  // –í–∏–∫–æ—Ä–∏—Å—Ç–∞–ª–∏ r1
    
    // –ü–û–ú–ò–õ–ö–ê! r1 "–∂–∏–≤–µ" –¥–æ –∫—ñ–Ω—Ü—è scope, —Ö–æ—á–∞ –≤–∂–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω
    let r2 = &mut s;  
    r2.push_str(" world");
}  // r1 —Ñ–æ—Ä–º–∞–ª—å–Ω–æ "–≤–º–∏—Ä–∞—î" —Ç—É—Ç
```

**–°—É—á–∞—Å–Ω–∏–π Rust (–∑ NLL):**

```rust
fn new_style() {
    let mut s = String::from("hello");
    
    let r1 = &s;
    println!("{}", r1);  // –û—Å—Ç–∞–Ω–Ω—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è r1 ‚Äî –≤—ñ–Ω "–≤–º–∏—Ä–∞—î" —Ç—É—Ç
    
    // OK! NLL –±–∞—á–∏—Ç—å, —â–æ r1 –±—ñ–ª—å—à–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è
    let r2 = &mut s;  
    r2.push_str(" world");
    
    println!("{}", s);  // "hello world"
}
```

---

## 10.4 –ú–£–¢–ê–ë–ï–õ–¨–ù–Ü –ü–û–°–ò–õ–ê–ù–ù–Ø –£ –§–£–ù–ö–¶–Ü–Ø–•

### 10.4.1 –§—É–Ω–∫—Ü—ñ—è, —â–æ –º–æ–¥–∏—Ñ—ñ–∫—É—î –¥–∞–Ω—ñ –Ω–∞ –º—ñ—Å—Ü—ñ

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ù–∞–π—á–∞—Å—Ç—ñ—à–∏–π –≤–∏–ø–∞–¥–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `&mut` ‚Äî —Ñ—É–Ω–∫—Ü—ñ—ó, —â–æ –∑–º—ñ–Ω—é—é—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ñ –¥–∞–Ω—ñ. –ü–æ–∫–∞–∂–µ–º–æ, —è–∫ –Ω–∞–ø–∏—Å–∞—Ç–∏ —Ç–∞–∫—É —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –∞–≥–µ–Ω—Ç–∞.

```rust
/// –ü–µ—Ä–µ–º—ñ—â—É—î –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –∑–∞–¥–∞–Ω—É –≤—ñ–¥—Å—Ç–∞–Ω—å –ø–æ –æ—Å—è—Ö X —Ç–∞ Y.
/// –ü—Ä–∏–π–º–∞—î –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è ‚Äî –º–æ–¥–∏—Ñ—ñ–∫—É—î –ø–æ–∑–∏—Ü—ñ—é –Ω–∞ –º—ñ—Å—Ü—ñ.
fn move_agent(position: &mut (f64, f64), dx: f64, dy: f64) {
    position.0 += dx;  // –ó–º—ñ–Ω–∞ X
    position.1 += dy;  // –ó–º—ñ–Ω–∞ Y
}

fn main() {
    // –ü–æ–∑–∏—Ü—ñ—è –∞–≥–µ–Ω—Ç–∞ ‚Äî –º—É—Ç–∞–±–µ–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞
    let mut agent_pos = (100.0, 200.0);
    
    println!("–î–æ: {:?}", agent_pos);
    
    // –ü–µ—Ä–µ–¥–∞—î–º–æ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
    move_agent(&mut agent_pos, 50.0, -30.0);
    
    println!("–ü—ñ—Å–ª—è: {:?}", agent_pos);
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. **–°–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ—É–Ω–∫—Ü—ñ—ó:** `position: &mut (f64, f64)` ‚Äî —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–∏–π–º–∞—î –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ—Ä—Ç–µ–∂. –í–æ–Ω–∞ –º–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ.

2. **–¢—ñ–ª–æ —Ñ—É–Ω–∫—Ü—ñ—ó:** `position.0 += dx` ‚Äî Rust –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—ñ–º–µ–Ω–æ–≤—É—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–æ–ª—ñ–≤ –∫–æ—Ä—Ç–µ–∂—É.

3. **–í–∏–∫–ª–∏–∫:** `move_agent(&mut agent_pos, ...)` ‚Äî —Å—Ç–≤–æ—Ä—é—î–º–æ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —ñ –ø–µ—Ä–µ–¥–∞—î–º–æ –π–æ–≥–æ.

4. **–ü—ñ—Å–ª—è –≤–∏–∫–ª–∏–∫—É:** `agent_pos` –∑–º—ñ–Ω–∏–≤—Å—è ‚Äî —Ñ—É–Ω–∫—Ü—ñ—è –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞–ª–∞ –¥–∞–Ω—ñ –Ω–∞ –º—ñ—Å—Ü—ñ.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```rust
–î–æ: (100.0, 200.0)
–ü—ñ—Å–ª—è: (150.0, 170.0)
```

### 10.4.2 –§—É–Ω–∫—Ü—ñ—è, —â–æ –º–æ–¥–∏—Ñ—ñ–∫—É—î String

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—é String —á–µ—Ä–µ–∑ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è ‚Äî –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –Ω–∞ –ø–æ—á–∞—Ç–æ–∫.

```rust
/// –î–æ–¥–∞—î timestamp –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.
fn add_timestamp(message: &mut String) {
    // insert_str –≤—Å—Ç–∞–≤–ª—è—î —Ç–µ–∫—Å—Ç –Ω–∞ –ø–æ–∑–∏—Ü—ñ—é 0 (–ø–æ—á–∞—Ç–æ–∫)
    message.insert_str(0, "[2024-01-15 10:30] ");
}

fn main() {
    let mut log_entry = String::from("Agent started patrol");
    
    println!("–î–æ: {}", log_entry);
    
    add_timestamp(&mut log_entry);
    
    println!("–ü—ñ—Å–ª—è: {}", log_entry);
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. **`message: &mut String`** ‚Äî —Ñ—É–Ω–∫—Ü—ñ—è –º–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ä—è–¥–æ–∫.
2. **`insert_str(0, ...)`** ‚Äî –≤—Å—Ç–∞–≤–ª—è—î —Ç–µ–∫—Å—Ç –Ω–∞ –ø–æ–∑–∏—Ü—ñ—é 0 (–ø–æ—á–∞—Ç–æ–∫ —Ä—è–¥–∫–∞).
3. –ü—ñ—Å–ª—è –≤–∏–∫–ª–∏–∫—É `log_entry` –º—ñ—Å—Ç–∏—Ç—å –º–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```text
–î–æ: Agent started patrol
–ü—ñ—Å–ª—è: [2024-01-15 10:30] Agent started patrol
```

### 10.4.3 –§—É–Ω–∫—Ü—ñ—è, —â–æ –º–æ–¥–∏—Ñ—ñ–∫—É—î –≤–µ–∫—Ç–æ—Ä

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –≤–µ–∫—Ç–æ—Ä–∞ "–Ω–∞ –º—ñ—Å—Ü—ñ" ‚Äî –≤–∏–¥–∞–ª–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, —â–æ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —É–º–æ–≤—ñ.

```rust
/// –í–∏–¥–∞–ª—è—î –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤ –∑ –≤–µ–∫—Ç–æ—Ä–∞.
/// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î retain ‚Äî –∑–∞–ª–∏—à–∞—î —Ç—ñ–ª—å–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏, –¥–ª—è —è–∫–∏—Ö –∑–∞–º–∏–∫–∞–Ω–Ω—è –ø–æ–≤–µ—Ä—Ç–∞—î true.
fn remove_inactive(agents: &mut Vec<(String, bool)>) {
    // retain –∑–∞–ª–∏—à–∞—î —Ç—ñ–ª—å–∫–∏ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤
    agents.retain(|(_, active)| *active);
}

fn main() {
    let mut agents = vec![
        (String::from("SCOUT-001"), true),
        (String::from("SCOUT-002"), false),  // –ù–µ–∞–∫—Ç–∏–≤–Ω–∏–π
        (String::from("COMBAT-001"), true),
        (String::from("COMBAT-002"), false), // –ù–µ–∞–∫—Ç–∏–≤–Ω–∏–π
    ];
    
    println!("–î–æ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó: {} –∞–≥–µ–Ω—Ç—ñ–≤", agents.len());
    
    remove_inactive(&mut agents);
    
    println!("–ü—ñ—Å–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó: {} –∞–≥–µ–Ω—Ç—ñ–≤", agents.len());
    
    println!("–ê–∫—Ç–∏–≤–Ω—ñ –∞–≥–µ–Ω—Ç–∏:");
    for (id, _) in &agents {
        println!("  - {}", id);
    }
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. **`retain`** ‚Äî –º–µ—Ç–æ–¥ Vec, —â–æ –∑–∞–ª–∏—à–∞—î —Ç—ñ–ª—å–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏, –¥–ª—è —è–∫–∏—Ö –∑–∞–º–∏–∫–∞–Ω–Ω—è –ø–æ–≤–µ—Ä—Ç–∞—î `true`.
2. **`|(_, active)| *active`** ‚Äî –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑—É—î–º–æ –∫–æ—Ä—Ç–µ–∂, –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è `active`.
3. –ü—ñ—Å–ª—è –≤–∏–∫–ª–∏–∫—É `agents` –º—ñ—Å—Ç–∏—Ç—å —Ç—ñ–ª—å–∫–∏ –∞–∫—Ç–∏–≤–Ω–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```text
–î–æ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó: 4 –∞–≥–µ–Ω—Ç—ñ–≤
–ü—ñ—Å–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó: 2 –∞–≥–µ–Ω—Ç—ñ–≤
–ê–∫—Ç–∏–≤–Ω—ñ –∞–≥–µ–Ω—Ç–∏:
  - SCOUT-001
  - COMBAT-001
```

---

## 10.5 –¢–ò–ü–û–í–Ü –ö–û–ù–§–õ–Ü–ö–¢–ò –¢–ê –á–• –í–ò–†–Ü–®–ï–ù–ù–Ø

### 10.5.1 –ö–æ–Ω—Ñ–ª—ñ–∫—Ç: –ß–∏—Ç–∞–Ω–Ω—è —Ç–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è –≤ —Ü–∏–∫–ª—ñ

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –¢–∏–ø–æ–≤–∞ –ø–æ–º–∏–ª–∫–∞ ‚Äî —Å–ø—Ä–æ–±–∞ –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é –ø—ñ–¥ —á–∞—Å —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –ø–æ –Ω—ñ–π. –ü–æ–∫–∞–∂–µ–º–æ –ø—Ä–æ–±–ª–µ–º—É —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è.

```rust
fn main() {
    let mut numbers = vec![1, 2, 3, 4, 5];
    
    // ‚ùå –ü–û–ú–ò–õ–ö–ê: —ñ—Ç–µ—Ä—É—î–º–æ (–ø–æ–∑–∏—á–∞—î–º–æ —è–∫ &) —ñ –º–æ–¥–∏—Ñ—ñ–∫—É—î–º–æ (–ø–æ—Ç—Ä—ñ–±–µ–Ω &mut)
    // for n in &numbers {
    //     if *n > 3 {
    //         numbers.push(*n * 10);  // –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø—ñ–¥ —á–∞—Å —ñ—Ç–µ—Ä–∞—Ü—ñ—ó!
    //     }
    // }
    
    // ‚úÖ –†–Ü–®–ï–ù–ù–Ø: –°–ø–æ—á–∞—Ç–∫—É –∑—ñ–±—Ä–∞—Ç–∏ –¥–∞–Ω—ñ, –ø–æ—Ç—ñ–º –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏
    let to_add: Vec<i32> = numbers.iter()
        .filter(|&&n| n > 3)        // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ > 3
        .map(|&n| n * 10)           // –ú–Ω–æ–∂–∏–º–æ –Ω–∞ 10
        .collect();                  // –ó–±–∏—Ä–∞—î–º–æ —É –Ω–æ–≤–∏–π –≤–µ–∫—Ç–æ—Ä
    
    // –¢–µ–ø–µ—Ä —ñ—Ç–µ—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî –º–æ–∂–Ω–∞ –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏
    numbers.extend(to_add);
    
    println!("{:?}", numbers);  // [1, 2, 3, 4, 5, 40, 50]
}
```

**–ß–æ–º—É –≤–∏–Ω–∏–∫–∞—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç:**

- `for n in &numbers` ‚Äî —ñ—Ç–µ—Ä–∞—Ç–æ—Ä –ø–æ–∑–∏—á–∞—î `numbers` —è–∫ `&Vec<i32>` (—ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ)
- `numbers.push(...)` ‚Äî –ø–æ—Ç—Ä–µ–±—É—î `&mut Vec<i32>` (–º—É—Ç–∞–±–µ–ª—å–Ω–æ)
- –û–¥–Ω–æ—á–∞—Å–Ω–æ `&` —ñ `&mut` –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ!

**–†—ñ—à–µ–Ω–Ω—è:** –†–æ–∑–¥—ñ–ª–∏—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é –Ω–∞ –¥–≤—ñ —Ñ–∞–∑–∏:
1. –§–∞–∑–∞ —á–∏—Ç–∞–Ω–Ω—è: –∑–±–∏—Ä–∞—î–º–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–∞–Ω—ñ
2. –§–∞–∑–∞ –∑–∞–ø–∏—Å—É: –º–æ–¥–∏—Ñ—ñ–∫—É—î–º–æ –∫–æ–ª–µ–∫—Ü—ñ—é

### 10.5.2 –ö–æ–Ω—Ñ–ª—ñ–∫—Ç: –î–≤–∞ –º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ä—ñ–∑–Ω—ñ —á–∞—Å—Ç–∏–Ω–∏

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –Ü–Ω–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –º–∞—Å–∏–≤—É. –ü–æ–∫–∞–∂–µ–º–æ, —è–∫ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ —á–µ—Ä–µ–∑ `split_at_mut`.

```rust
fn main() {
    let mut data = [1, 2, 3, 4, 5];
    
    // ‚ùå –ü–û–ú–ò–õ–ö–ê: –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –Ω–µ –∑–Ω–∞—î, —â–æ —Ü–µ —Ä—ñ–∑–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
    // let a = &mut data[0];
    // let b = &mut data[1];  // –ü–û–ú–ò–õ–ö–ê: –¥–≤–∞ &mut –Ω–∞ data
    
    // ‚úÖ –†–Ü–®–ï–ù–ù–Ø: split_at_mut —Ä–æ–∑–¥—ñ–ª—è—î –º–∞—Å–∏–≤ –Ω–∞ –¥–≤—ñ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ —á–∞—Å—Ç–∏–Ω–∏
    let (left, right) = data.split_at_mut(2);
    // left = [1, 2], right = [3, 4, 5]
    
    let a = &mut left[0];   // –¶–µ data[0]
    let b = &mut right[0];  // –¶–µ data[2]
    
    *a = 100;
    *b = 300;
    
    println!("{:?}", data);  // [100, 2, 300, 4, 5]
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î `split_at_mut`:**

1. –†–æ–∑–¥—ñ–ª—è—î —Å–ª–∞–π—Å –Ω–∞ –¥–≤—ñ **–Ω–µ–∑–∞–ª–µ–∂–Ω—ñ** –º—É—Ç–∞–±–µ–ª—å–Ω—ñ —á–∞—Å—Ç–∏–Ω–∏.
2. `split_at_mut(2)` ‚Äî –¥—ñ–ª–∏—Ç—å –Ω–∞ `[0..2]` —ñ `[2..]`.
3. –û—Å–∫—ñ–ª—å–∫–∏ —á–∞—Å—Ç–∏–Ω–∏ –Ω–µ –ø–µ—Ä–µ—Ç–∏–Ω–∞—é—Ç—å—Å—è, –º–æ–∂–Ω–∞ –º–∞—Ç–∏ `&mut` –Ω–∞ –æ–±–∏–¥–≤—ñ.

### 10.5.3 –ü–∞—Ç—Ç–µ—Ä–Ω: Swap ‚Äî –æ–±–º—ñ–Ω –∑–Ω–∞—á–µ–Ω—å

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ, —è–∫ –±–µ–∑–ø–µ—á–Ω–æ –æ–±–º—ñ–Ω—è—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–≤–æ—Ö –∑–º—ñ–Ω–Ω–∏—Ö.

```rust
fn main() {
    let mut a = String::from("Hello");
    let mut b = String::from("World");
    
    println!("–î–æ: a = '{}', b = '{}'", a, b);
    
    // std::mem::swap –æ–±–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è
    std::mem::swap(&mut a, &mut b);
    
    println!("–ü—ñ—Å–ª—è: a = '{}', b = '{}'", a, b);
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î `std::mem::swap`:**

1. –ü—Ä–∏–π–º–∞—î –¥–≤–∞ –º—É—Ç–∞–±–µ–ª—å–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω–Ω—è.
2. –û–±–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ —Ü–∏–º–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏.
3. –¶–µ –±–µ–∑–ø–µ—á–Ω–æ, –±–æ `a` —ñ `b` ‚Äî —Ä—ñ–∑–Ω—ñ –∑–º—ñ–Ω–Ω—ñ.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```rust
–î–æ: a = 'Hello', b = 'World'
–ü—ñ—Å–ª—è: a = 'World', b = 'Hello'
```

### 10.5.4 –ü–∞—Ç—Ç–µ—Ä–Ω: Replace ‚Äî –∑–∞–º—ñ–Ω–∏—Ç–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å—Ç–∞—Ä–µ

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –Ü–Ω–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ —Å—Ç–∞—Ä–µ. –ü–æ–∫–∞–∂–µ–º–æ `std::mem::replace`.

```rust
fn main() {
    let mut status = String::from("Idle");
    
    // replace –∑–∞–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ä–µ
    let old_status = std::mem::replace(&mut status, String::from("Active"));
    
    println!("–ë—É–≤: {}", old_status);   // Idle
    println!("–°—Ç–∞–≤: {}", status);      // Active
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î `std::mem::replace`:**

1. –ü—Ä–∏–π–º–∞—î –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è —Ç–∞ –Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è.
2. –ó–∞–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ –Ω–æ–≤–µ.
3. –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è.

---

## 10.6 –ü–†–ê–ö–¢–ò–ß–ù–ò–ô –ü–†–ò–ö–õ–ê–î: –ö–ï–†–£–í–ê–ù–ù–Ø –ê–ì–ï–ù–¢–û–ú

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –û–±'—î–¥–Ω–∞—î–º–æ –≤—Å–µ –≤–∏–≤—á–µ–Ω–µ ‚Äî —Å–∏—Å—Ç–µ–º–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∞–≥–µ–Ω—Ç–æ–º –∑ –∫–æ–º–∞–Ω–¥–∞–º–∏ —Ä—É—Ö—É, –ø–æ–≤–æ—Ä–æ—Ç—É —Ç–∞ –∑–º—ñ–Ω–∏ –±–∞—Ç–∞—Ä–µ—ó. –í—Å—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –º–æ–¥–∏—Ñ—ñ–∫—É—é—Ç—å —Å—Ç–∞–Ω —á–µ—Ä–µ–∑ –º—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.

```rust
fn main() {
    println!("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    println!("‚ïë    –°–ò–°–¢–ï–ú–ê –ö–ï–†–£–í–ê–ù–ù–Ø –ê–ì–ï–ù–¢–û–ú               ‚ïë");
    println!("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\n");
    
    // –°—Ç–∞–Ω –∞–≥–µ–Ω—Ç–∞ ‚Äî –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ –º—É—Ç–∞–±–µ–ª—å–Ω—ñ
    let mut position = (100.0_f64, 200.0_f64, 50.0_f64);  // (x, y, z)
    let mut battery = 85_u8;
    let mut heading = 90.0_f32;  // –≥—Ä–∞–¥—É—Å–∏
    
    println!("üìç –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω:");
    print_state(&position, battery, heading);
    
    println!("\nüéÆ –í–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥:\n");
    
    // –ö–æ–º–∞–Ω–¥–∞ 1: –†—É—Ö –≤–ø–µ—Ä–µ–¥ —ñ –≤–ø—Ä–∞–≤–æ
    println!("  –ö–æ–º–∞–Ω–¥–∞: MOVE +50, +30, 0");
    execute_move(&mut position, 50.0, 30.0, 0.0);
    drain_battery(&mut battery, 5);
    print_state(&position, battery, heading);
    
    // –ö–æ–º–∞–Ω–¥–∞ 2: –ü–æ–≤–æ—Ä–æ—Ç –Ω–∞ 45¬∞
    println!("\n  –ö–æ–º–∞–Ω–¥–∞: TURN +45¬∞");
    execute_turn(&mut heading, 45.0);
    drain_battery(&mut battery, 2);
    print_state(&position, battery, heading);
    
    // –ö–æ–º–∞–Ω–¥–∞ 3: –ü—ñ–¥–π–æ–º –Ω–∞ 20–º
    println!("\n  –ö–æ–º–∞–Ω–¥–∞: ASCEND +20m");
    execute_move(&mut position, 0.0, 0.0, 20.0);
    drain_battery(&mut battery, 10);
    print_state(&position, battery, heading);
    
    println!("\n‚úÖ –í—Å—ñ –∫–æ–º–∞–Ω–¥–∏ –≤–∏–∫–æ–Ω–∞–Ω–æ");
}

/// –ü–µ—Ä–µ–º—ñ—â—É—î –∞–≥–µ–Ω—Ç–∞ –Ω–∞ (dx, dy, dz).
fn execute_move(pos: &mut (f64, f64, f64), dx: f64, dy: f64, dz: f64) {
    pos.0 += dx;
    pos.1 += dy;
    pos.2 += dz;
}

/// –ü–æ–≤–µ—Ä—Ç–∞—î –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –∑–∞–¥–∞–Ω–∏–π –∫—É—Ç.
fn execute_turn(heading: &mut f32, angle: f32) {
    *heading = (*heading + angle) % 360.0;
}

/// –ó–º–µ–Ω—à—É—î –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ—ó (–Ω–µ –Ω–∏–∂—á–µ 0).
fn drain_battery(battery: &mut u8, amount: u8) {
    *battery = battery.saturating_sub(amount);
}

/// –í–∏–≤–æ–¥–∏—Ç—å –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω (–ø—Ä–∏–π–º–∞—î —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è).
fn print_state(pos: &(f64, f64, f64), battery: u8, heading: f32) {
    println!("    üìç –ü–æ–∑–∏—Ü—ñ—è: ({:.1}, {:.1}, {:.1})", pos.0, pos.1, pos.2);
    println!("    üß≠ –ö—É—Ä—Å: {:.0}¬∞", heading);
    println!("    üîã –ë–∞—Ç–∞—Ä–µ—è: {}%", battery);
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. **–°—Ç–∞–Ω –∞–≥–µ–Ω—Ç–∞** ‚Äî —Ç—Ä–∏ –º—É—Ç–∞–±–µ–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ: –ø–æ–∑–∏—Ü—ñ—è, –±–∞—Ç–∞—Ä–µ—è, –∫—É—Ä—Å.

2. **–ö–æ–º–∞–Ω–¥–∏** –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—ó, —â–æ –ø—Ä–∏–π–º–∞—é—Ç—å `&mut`:
   - `execute_move` ‚Äî –∑–º—ñ–Ω—é—î –ø–æ–∑–∏—Ü—ñ—é
   - `execute_turn` ‚Äî –∑–º—ñ–Ω—é—î –∫—É—Ä—Å
   - `drain_battery` ‚Äî –∑–º–µ–Ω—à—É—î –±–∞—Ç–∞—Ä–µ—é

3. **print_state** –ø—Ä–∏–π–º–∞—î `&` (—ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è) ‚Äî –≤–æ–Ω–∞ —Ç—ñ–ª—å–∫–∏ —á–∏—Ç–∞—î.

4. –ü—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏ —Å—Ç–∞–Ω –∑–º—ñ–Ω—é—î—Ç—å—Å—è "–Ω–∞ –º—ñ—Å—Ü—ñ".

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```text
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë    –°–ò–°–¢–ï–ú–ê –ö–ï–†–£–í–ê–ù–ù–Ø –ê–ì–ï–ù–¢–û–ú               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìç –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω:
    üìç –ü–æ–∑–∏—Ü—ñ—è: (100.0, 200.0, 50.0)
    üß≠ –ö—É—Ä—Å: 90¬∞
    üîã –ë–∞—Ç–∞—Ä–µ—è: 85%

üéÆ –í–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥:

  –ö–æ–º–∞–Ω–¥–∞: MOVE +50, +30, 0
    üìç –ü–æ–∑–∏—Ü—ñ—è: (150.0, 230.0, 50.0)
    üß≠ –ö—É—Ä—Å: 90¬∞
    üîã –ë–∞—Ç–∞—Ä–µ—è: 80%

  –ö–æ–º–∞–Ω–¥–∞: TURN +45¬∞
    üìç –ü–æ–∑–∏—Ü—ñ—è: (150.0, 230.0, 50.0)
    üß≠ –ö—É—Ä—Å: 135¬∞
    üîã –ë–∞—Ç–∞—Ä–µ—è: 78%

  –ö–æ–º–∞–Ω–¥–∞: ASCEND +20m
    üìç –ü–æ–∑–∏—Ü—ñ—è: (150.0, 230.0, 70.0)
    üß≠ –ö—É—Ä—Å: 135¬∞
    üîã –ë–∞—Ç–∞—Ä–µ—è: 68%

‚úÖ –í—Å—ñ –∫–æ–º–∞–Ω–¥–∏ –≤–∏–∫–æ–Ω–∞–Ω–æ
```

---

## 10.7 –õ–ê–ë–û–†–ê–¢–û–†–ù–ê –†–û–ë–û–¢–ê

### –ó–∞–≤–¥–∞–Ω–Ω—è

–°—Ç–≤–æ—Ä—ñ—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫–æ–º –≥—Ä–∞–≤—Ü—è (–∞–±–æ –∞–≥–µ–Ω—Ç–∞) –∑ —Ç–∞–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏:

1. `add_points(score: &mut u32, points: u32)` ‚Äî –¥–æ–¥–∞—î –æ—á–∫–∏
2. `subtract_points(score: &mut u32, points: u32)` ‚Äî –≤—ñ–¥–Ω—ñ–º–∞—î –æ—á–∫–∏ (–Ω–µ –Ω–∏–∂—á–µ 0)
3. `multiply_bonus(score: &mut u32, multiplier: u32)` ‚Äî –º–Ω–æ–∂–∏—Ç—å –Ω–∞ –±–æ–Ω—É—Å
4. `reset_score(score: &mut u32)` ‚Äî —Å–∫–∏–¥–∞—î –¥–æ 0

–ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É–π—Ç–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π.

### –ö—Ä–∏—Ç–µ—Ä—ñ—ó –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è

| –ö—Ä–∏—Ç–µ—Ä—ñ–π | –ë–∞–ª–∏ |
|----------|------|
| –í—Å—ñ 4 —Ñ—É–Ω–∫—Ü—ñ—ó —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ | 4 |
| –ü—Ä–∞–≤–∏–ª—å–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è &mut | 2 |
| saturating_sub –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É | 2 |
| –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è —Ä–æ–±–æ—Ç–∏ | 2 |
| **–ú–∞–∫—Å–∏–º—É–º** | **10** |

---

## üìù –†–ï–ó–Æ–ú–ï

### –ü—Ä–∞–≤–∏–ª–æ –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç—ñ

> **–ê–ë–û** –æ–¥–Ω–µ `&mut T`, **–ê–ë–û** –±–∞–≥–∞—Ç–æ `&T` ‚Äî –∞–ª–µ **–ù–Ü–ö–û–õ–ò** –æ–±–∏–¥–≤–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å

| –û–ø–µ—Ä–∞—Ü—ñ—è | –°–∏–Ω—Ç–∞–∫—Å–∏—Å |
|----------|-----------|
| –°—Ç–≤–æ—Ä–∏—Ç–∏ &mut | `let r = &mut value;` |
| –ó–∞–ø–∏—Å–∞—Ç–∏ —á–µ—Ä–µ–∑ &mut | `*r = new_value;` |
| –ü–∞—Ä–∞–º–µ—Ç—Ä —Ñ—É–Ω–∫—Ü—ñ—ó | `fn f(x: &mut T)` |
| –í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó | `f(&mut value)` |

### –ö–ª—é—á–æ–≤—ñ —ñ–Ω—Å–∞–π—Ç–∏

- **&mut** –¥–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –ø–æ–∑–∏—á–µ–Ω—ñ –¥–∞–Ω—ñ
- **–ï–∫—Å–∫–ª—é–∑–∏–≤–Ω—ñ—Å—Ç—å** –∑–∞–ø–æ–±—ñ–≥–∞—î data races –Ω–∞ –µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó
- **NLL** —Ä–æ–±–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –º–µ–Ω—à —Å—É–≤–æ—Ä–∏–º–∏, –Ω—ñ–∂ –∑–¥–∞—é—Ç—å—Å—è
- **split_at_mut** –¥–æ–∑–≤–æ–ª—è—î –¥–≤–∞ &mut –Ω–∞ —Ä—ñ–∑–Ω—ñ —á–∞—Å—Ç–∏–Ω–∏

---

## üîó –ó–í'–Ø–ó–û–ö –ó –ù–ê–°–¢–£–ü–ù–ò–ú –†–û–ó–î–Ü–õ–û–ú

–í–∏ –æ—Å–≤–æ—ó–ª–∏ borrowing ‚Äî —ñ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω—ñ, —ñ –º—É—Ç–∞–±–µ–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è. –ê–ª–µ –ø–æ–∫–∏ —â–æ –º–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏ –∑ –æ–∫—Ä–µ–º–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏. –£ **–†–æ–∑–¥—ñ–ª—ñ 11: Struct** –≤–∏ –Ω–∞–≤—á–∏—Ç–µ—Å—å –≥—Ä—É–ø—É–≤–∞—Ç–∏ –ø–æ–≤'—è–∑–∞–Ω—ñ –¥–∞–Ω—ñ —É —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ ‚Äî —ñ –∑–∞—Å—Ç–æ—Å—É—î—Ç–µ borrowing –¥–æ –Ω–∏—Ö.

---

> **–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä–æ–∑–¥—ñ–ª:** [–†–æ–∑–¥—ñ–ª 11: Struct ‚Äî –ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –∞–≥–µ–Ω—Ç–∞](./11_Struct.md)
