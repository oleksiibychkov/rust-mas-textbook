# –ß–ê–°–¢–ò–ù–ê III: SMART POINTERS –¢–ê –°–ü–Ü–õ–¨–ù–ê –ü–ê–ú'–Ø–¢–¨

## –í—Å—Ç—É–ø –¥–æ –ß–∞—Å—Ç–∏–Ω–∏ III

–£ –ß–∞—Å—Ç–∏–Ω—ñ II –∞–≥–µ–Ω—Ç —Å—Ç–∞–≤ **—Ä–æ–±–∞—Å—Ç–Ω–∏–º** ‚Äî –æ–±—Ä–æ–±–ª—è—î –ø–æ–º–∏–ª–∫–∏, –ª–æ–≥—É—î –¥—ñ—ó, —Å–µ—Ä—ñ–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ. –ê–ª–µ –≤—ñ–Ω –≤—Å–µ —â–µ **–æ–¥–∏–Ω**. –°–ø—Ä–∞–≤–∂–Ω—ñ–π —Ä—ñ–π –ø–æ—Ç—Ä–µ–±—É—î **–∫—ñ–ª—å–∫–æ—Ö –∞–≥–µ–Ω—Ç—ñ–≤**, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å **–ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ** —Ç–∞ **–¥—ñ–ª—è—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**.

–¶–µ –ø–æ—Ä–æ–¥–∂—É—î —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è:
- –Ø–∫ –∫—ñ–ª—å–∫–∞ –∞–≥–µ–Ω—Ç—ñ–≤ –º–æ–∂—É—Ç—å —á–∏—Ç–∞—Ç–∏ **–æ–¥–Ω—É –∫–∞—Ä—Ç—É**?
- –•—Ç–æ "–≤–æ–ª–æ–¥—ñ—î" **—Å–ø—ñ–ª—å–Ω–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏**?
- –Ø–∫ —É–Ω–∏–∫–Ω—É—Ç–∏ **–∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤** –ø—Ä–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—ñ?

Rust –≤–∏—Ä—ñ—à—É—î —Ü—ñ –ø—Ä–æ–±–ª–µ–º–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É **smart pointers** —Ç–∞ **–ø—Ä–∏–º—ñ—Ç–∏–≤—ñ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó**. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —ñ–Ω—à–∏—Ö –º–æ–≤, –¥–µ —Ü—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏—è–≤–ª—è—é—Ç—å—Å—è –≤ runtime —á–µ—Ä–µ–∑ data races —Ç–∞ segmentation faults, Rust –ª–æ–≤–∏—Ç—å —ó—Ö **–Ω–∞ –µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó**.

**–ï–≤–æ–ª—é—Ü—ñ—è –∞–≥–µ–Ω—Ç–∞ –≤ –ß–∞—Å—Ç–∏–Ω—ñ III:**
```text
–û–¥–∏–Ω –∞–≥–µ–Ω—Ç ‚Üí –ö—ñ–ª—å–∫–∞ –∞–≥–µ–Ω—Ç—ñ–≤ ‚Üí –°–ø—ñ–ª—å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏ ‚Üí –ü–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è ‚Üí –†—ñ–π
```

| –†–æ–∑–¥—ñ–ª | –¢–µ–º–∞ | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|------|-------------|
| 28 | `Box<T>` | –†–æ–∑–º—ñ—â–µ–Ω–Ω—è –Ω–∞ heap |
| 29 | `Rc<T>` | –°–ø—ñ–ª—å–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è (–æ–¥–Ω–æ–ø–æ—Ç–æ–∫–æ–≤–µ) |
| 30 | `RefCell<T>` | Interior mutability |
| 31 | `Cell<T>` | –õ–µ–≥—à–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ RefCell |
| 32 | Lifetimes | –Ø–≤–Ω—ñ —á–∞—Å–∏ –∂–∏—Ç—Ç—è |
| 33 | Threads | –ë–∞–∑–æ–≤–∞ –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤—ñ—Å—Ç—å |
| 34 | `Arc` + `Mutex` | Thread-safe —Å–ø—ñ–ª—å–Ω–∏–π —Å—Ç–∞–Ω |
| 35 | Channels | Message passing |
| 36 | –ü—Ä–∞–∫—Ç–∏–∫—É–º v3.0 | –õ–æ–∫–∞–ª—å–Ω–∏–π —Ä—ñ–π –∞–≥–µ–Ω—Ç—ñ–≤ |

---

# –†–æ–∑–¥—ñ–ª 28: Box ‚Äî —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –Ω–∞ Heap

## –í—Å—Ç—É–ø: —á–æ–º—É —Å—Ç–µ–∫—É –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ

–î–æ —Ü—å–æ–≥–æ –º–æ–º–µ–Ω—Ç—É –±—ñ–ª—å—à—ñ—Å—Ç—å –≤–∞—à–∏—Ö –¥–∞–Ω–∏—Ö –∂–∏–ª–∞ –Ω–∞ **—Å—Ç–µ–∫—É** ‚Äî —à–≤–∏–¥–∫–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, –∞–ª–µ –∑ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏. –°—Ç–µ–∫ –º–∞—î —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π —Ä–æ–∑–º—ñ—Ä (–∑–∞–∑–≤–∏—á–∞–π 1-8 –ú–ë), —ñ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä **–º–∞—î –∑–Ω–∞—Ç–∏** —Ä–æ–∑–º—ñ—Ä –∫–æ–∂–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó.

–©–æ —Ä–æ–±–∏—Ç–∏, –∫–æ–ª–∏:
- –†–æ–∑–º—ñ—Ä –¥–∞–Ω–∏—Ö –Ω–µ–≤—ñ–¥–æ–º–∏–π –∑–∞–∑–¥–∞–ª–µ–≥—ñ–¥—å?
- –î–∞–Ω—ñ –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫—ñ –¥–ª—è —Å—Ç–µ–∫—É?
- –ü–æ—Ç—Ä—ñ–±–Ω–∞ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¥–µ—Ä–µ–≤–æ, —Å–ø–∏—Å–æ–∫)?

–í—ñ–¥–ø–æ–≤—ñ–¥—å ‚Äî **heap** (–∫—É–ø–∞), –∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –Ω–∏–º ‚Äî **`Box<T>`**.

`Box<T>` ‚Äî –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π **smart pointer** (—Ä–æ–∑—É–º–Ω–∏–π –≤–∫–∞–∑—ñ–≤–Ω–∏–∫). –í—ñ–Ω —Ä–æ–∑–º—ñ—â—É—î –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ heap —ñ –∑–±–µ—Ä—ñ–≥–∞—î **–≤–∫–∞–∑—ñ–≤–Ω–∏–∫** –Ω–∞ –Ω—å–æ–≥–æ. –ö–æ–ª–∏ `Box` –≤–∏—Ö–æ–¥–∏—Ç—å –∑—ñ scope ‚Äî –ø–∞–º'—è—Ç—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è. –ë–µ–∑ –∑–±–∏—Ä–∞—á–∞ —Å–º—ñ—Ç—Ç—è, –±–µ–∑ –≤–∏—Ç–æ–∫—ñ–≤ –ø–∞–º'—è—Ç—ñ.

---

## 28.1 Stack vs Heap ‚Äî –¥–≤–∞ —Ç–∏–ø–∏ –ø–∞–º'—è—Ç—ñ

### –Ø–∫ –ø—Ä–∞—Ü—é—î —Å—Ç–µ–∫

**–°—Ç–µ–∫** ‚Äî –æ–±–ª–∞—Å—Ç—å –ø–∞–º'—è—Ç—ñ –∑ –¥—É–∂–µ —à–≤–∏–¥–∫–∏–º –¥–æ—Å—Ç—É–ø–æ–º, —è–∫–∞ –ø—Ä–∞—Ü—é—î –∑–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º LIFO (Last In, First Out ‚Äî –æ—Å—Ç–∞–Ω–Ω—ñ–º –ø—Ä–∏–π—à–æ–≤, –ø–µ—Ä—à–∏–º –≤–∏–π—à–æ–≤).

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å—Ç–µ–∫—É:**
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –≤–∏–¥—ñ–ª–µ–Ω–Ω—è/–∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è ‚Äî –ø—Ä–æ—Å—Ç–æ –∑—Å—É–≤ –æ–¥–Ω–æ–≥–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∞
- **–†–æ–∑–º—ñ—Ä**: –æ–±–º–µ–∂–µ–Ω–∏–π (1-8 –ú–ë), –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—è = stack overflow
- **–ß–∞—Å –∂–∏—Ç—Ç—è**: –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ scope —Ñ—É–Ω–∫—Ü—ñ—ó
- **–í–∏–º–æ–≥–∞**: –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –º–∞—î –∑–Ω–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä –Ω–∞ –µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –¥–∞–Ω—ñ —Ä–æ–∑–º—ñ—â—É—é—Ç—å—Å—è –Ω–∞ —Å—Ç–µ–∫—É.

```rust
fn stack_example() {
    let x = 42i32;        // 4 –±–∞–π—Ç–∏ –Ω–∞ —Å—Ç–µ–∫—É
    let y = 3.14f64;      // 8 –±–∞–π—Ç –Ω–∞ —Å—Ç–µ–∫—É
    let arr = [1, 2, 3];  // 12 –±–∞–π—Ç –Ω–∞ —Å—Ç–µ–∫—É (3 √ó 4)
    let point = (10, 20); // 8 –±–∞–π—Ç –Ω–∞ —Å—Ç–µ–∫—É (2 √ó 4)
    
    println!("x = {}, y = {}", x, y);
    
    // –ö–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—è –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è ‚Äî –≤—Å—ñ –¥–∞–Ω—ñ –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û –∑–≤—ñ–ª—å–Ω—è—é—Ç—å—Å—è
    // –ü—Ä–æ—Å—Ç–æ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ —Å—Ç–µ–∫—É –∑—Å—É–≤–∞—î—Ç—å—Å—è –Ω–∞–∑–∞–¥
}
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1. –ü—Ä–∏ –≤—Ö–æ–¥—ñ —É —Ñ—É–Ω–∫—Ü—ñ—é –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ —Å—Ç–µ–∫—É –∑—Å—É–≤–∞—î—Ç—å—Å—è –≤–Ω–∏–∑
2. –î–ª—è –∫–æ–∂–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó —Ä–µ–∑–µ—Ä–≤—É—î—Ç—å—Å—è –º—ñ—Å—Ü–µ –∑–∞ —ó—ó —Ä–æ–∑–º—ñ—Ä–æ–º
3. –ü—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –∑—Å—É–≤–∞—î—Ç—å—Å—è –Ω–∞–∑–∞–¥
4. –ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –º–∏—Ç—Ç—î–≤–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–¥–∏–Ω –∑—Å—É–≤

### –Ø–∫ –ø—Ä–∞—Ü—é—î heap

**Heap** (–∫—É–ø–∞) ‚Äî –¥–∏–Ω–∞–º—ñ—á–Ω–∞ –ø–∞–º'—è—Ç—å –∑ –¥–æ–≤—ñ–ª—å–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º.

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ heap:**
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ (–ø–æ—à—É–∫ –≤—ñ–ª—å–Ω–æ–≥–æ –±–ª–æ–∫—É)
- **–†–æ–∑–º—ñ—Ä**: –æ–±–º–µ–∂–µ–Ω–∏–π —Ç—ñ–ª—å–∫–∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ—é –ø–∞–º'—è—Ç—Ç—é
- **–ß–∞—Å –∂–∏—Ç—Ç—è**: –∫–æ–Ω—Ç—Ä–æ–ª—é—î—Ç—å—Å—è –ø—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç–æ–º (–≤ Rust ‚Äî —á–µ—Ä–µ–∑ ownership)
- **–ì–Ω—É—á–∫—ñ—Å—Ç—å**: —Ä–æ–∑–º—ñ—Ä –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–≤—ñ–¥–æ–º–∏–π –Ω–∞ –µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –Ω–∞ heap —á–µ—Ä–µ–∑ Box.

```rust
fn heap_example() {
    // Box::new() —Ä–æ–∑–º—ñ—â—É—î –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ heap
    let boxed = Box::new(42);
    
    // –©–æ –¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è:
    // –ù–∞ —Å—Ç–µ–∫—É: –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ boxed (8 –±–∞–π—Ç –Ω–∞ 64-bit —Å–∏—Å—Ç–µ–º—ñ)
    // –ù–∞ heap: –∑–Ω–∞—á–µ–Ω–Ω—è 42 (4 –±–∞–π—Ç–∏)
    
    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —è–∫ –∑–≤–∏—á–∞–π–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è
    println!("Value: {}", boxed);  // 42
    println!("Doubled: {}", *boxed * 2);  // 84
    
    // –ö–æ–ª–∏ boxed –≤–∏—Ö–æ–¥–∏—Ç—å –∑—ñ scope:
    // 1. –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è Drop –¥–ª—è Box
    // 2. –ü–∞–º'—è—Ç—å –Ω–∞ heap –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è
    // 3. –í–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ —Å—Ç–µ–∫—É –∑–Ω–∏–∫–∞—î
}
```

### –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –ø–∞–º'—è—Ç—ñ

```text
–°–¢–ï–ö (Stack)                    –ö–£–ü–ê (Heap)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ boxed: 0x7f... ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ 42              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ y: 3.14         ‚îÇ             
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ x: 42           ‚îÇ             ‚îÇ "hello world"   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ arr: [1, 2, 3]  ‚îÇ                    ‚ñ≤
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ string_ptr ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫(String data)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–°—Ç–µ–∫ —Ä–æ—Å—Ç–µ –≤–Ω–∏–∑ ‚Üì               Heap —Ä–æ—Å—Ç–µ –¥–æ–≤—ñ–ª—å–Ω–æ
–§—ñ–∫—Å–æ–≤–∞–Ω–∏–π —Ä–æ–∑–º—ñ—Ä               –î–∏–Ω–∞–º—ñ—á–Ω–∏–π —Ä–æ–∑–º—ñ—Ä
```

### –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è Stack —Ç–∞ Heap

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Stack | Heap |
|----------------|-------|------|
| **–®–≤–∏–¥–∫—ñ—Å—Ç—å –≤–∏–¥—ñ–ª–µ–Ω–Ω—è** | –î—É–∂–µ —à–≤–∏–¥–∫–æ (–æ–¥–∏–Ω –∑—Å—É–≤) | –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ (–ø–æ—à—É–∫ –±–ª–æ–∫—É) |
| **–®–≤–∏–¥–∫—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø—É** | –®–≤–∏–¥–∫–æ (–∫–µ—à CPU) | –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ (–º–æ–∂–ª–∏–≤—ñ cache miss) |
| **–†–æ–∑–º—ñ—Ä** | –û–±–º–µ–∂–µ–Ω–∏–π (1-8 –ú–ë) | –û–±–º–µ–∂–µ–Ω–∏–π RAM |
| **–ß–∞—Å –∂–∏—Ç—Ç—è** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π (scope) | –ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∏–π (ownership) |
| **–†–æ–∑–º—ñ—Ä –¥–∞–Ω–∏—Ö** | –ú–∞—î –±—É—Ç–∏ –≤—ñ–¥–æ–º–∏–π | –ú–æ–∂–µ –±—É—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π |

---

## 28.2 Box ‚Äî –±–∞–∑–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Box

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É–≤–∞—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Box —Ç–∞ —Ä–æ–±–æ—Ç—É –∑ –Ω–∏–º.

```rust
fn main() {
    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Box ‚Äî –∑–Ω–∞—á–µ–Ω–Ω—è –ø–µ—Ä–µ–º—ñ—â—É—î—Ç—å—Å—è –Ω–∞ heap
    let boxed_int = Box::new(5);
    let boxed_string = Box::new(String::from("hello"));
    let boxed_vec = Box::new(vec![1, 2, 3]);
    
    // Box –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ "—Ä–æ–∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è" –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ
    // –¶–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è Deref coercion
    println!("Int: {}", boxed_int);            // 5
    println!("String: {}", boxed_string);      // hello
    println!("Vec length: {}", boxed_vec.len()); // 3
    
    // –ú–µ—Ç–æ–¥–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ —Ç–∏–ø—É –¥–æ—Å—Ç—É–ø–Ω—ñ –Ω–∞–ø—Ä—è–º—É
    println!("Uppercase: {}", boxed_string.to_uppercase());
    
    // –Ø–≤–Ω–µ —Ä–æ–∑—ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ *
    let value: i32 = *boxed_int;
    println!("Unboxed: {}", value);  // 5
}
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1. `Box::new(5)` –≤–∏–¥—ñ–ª—è—î 4 –±–∞–π—Ç–∏ –Ω–∞ heap, –∑–∞–ø–∏—Å—É—î —Ç—É–¥–∏ 5
2. –ü–æ–≤–µ—Ä—Ç–∞—î `Box<i32>` ‚Äî 8-–±–∞–π—Ç–Ω–∏–π –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ —Å—Ç–µ–∫—É
3. –ü—Ä–∏ `println!`, Box –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—ñ–º–µ–Ω–æ–≤—É—î—Ç—å—Å—è (Deref trait)
4. `*boxed_int` —è–≤–Ω–æ –æ—Ç—Ä–∏–º—É—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑ heap
5. –ü—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ main() ‚Äî heap –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è

### Ownership —ñ Box

Box **–≤–æ–ª–æ–¥—ñ—î** —Å–≤–æ—ó–º –≤–º—ñ—Å—Ç–æ–º. –ü—Ä–∞–≤–∏–ª–∞ ownership –ø—Ä–∞—Ü—é—é—Ç—å —è–∫ –∑–∞–≤–∂–¥–∏.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏, —â–æ Box —Å–ª—ñ–¥—É—î –ø—Ä–∞–≤–∏–ª–∞–º ownership.

```rust
fn main() {
    let b1 = Box::new(42);
    
    // Move ‚Äî b1 –ø–µ—Ä–µ–¥–∞—î ownership –¥–æ b2
    let b2 = b1;
    
    // println!("{}", b1);  // ‚ùå –ü–æ–º–∏–ª–∫–∞: value moved
    println!("{}", b2);     // ‚úÖ OK ‚Äî b2 —Ç–µ–ø–µ—Ä –≤–ª–∞—Å–Ω–∏–∫
    
    // Clone —Å—Ç–≤–æ—Ä—é—î –ù–ï–ó–ê–õ–ï–ñ–ù–£ –∫–æ–ø—ñ—é –Ω–∞ heap
    let b3 = Box::new(100);
    let b4 = b3.clone();  // –ù–æ–≤–∏–π Box –∑ –∫–æ–ø—ñ—î—é –∑–Ω–∞—á–µ–Ω–Ω—è
    
    // –û–±–∏–¥–≤–∞ –≤–∞–ª—ñ–¥–Ω—ñ ‚Äî —Ü–µ —Ä—ñ–∑–Ω—ñ Box –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –∞–¥—Ä–µ—Å–∞—Ö heap
    println!("b3 = {}, b4 = {}", b3, b4);  // 100, 100
    
    // –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è –æ–¥–Ω–æ–≥–æ –Ω–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ —ñ–Ω—à–∏–π
    // (–¥–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω mut)
}
```

### Box —É —Ñ—É–Ω–∫—Ü—ñ—è—Ö

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–µ—Ä–µ–¥–∞—á—É Box —É —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ —Ñ—É–Ω–∫—Ü—ñ–π.

```rust
// –ü—Ä–∏–π–º–∞—î ownership ‚Äî Box –∑–≤—ñ–ª—å–Ω–∏—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
fn consume_box(b: Box<i32>) {
    println!("Consumed: {}", b);
    // b –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è —Ç—É—Ç –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ —Ñ—É–Ω–∫—Ü—ñ—ó
}

// –ü—Ä–∏–π–º–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è ‚Äî ownership –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —É caller
fn borrow_box(b: &Box<i32>) {
    println!("Borrowed: {}", b);
    // Box –ù–ï –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è ‚Äî –º–∏ –ª–∏—à–µ –ø–æ–∑–∏—á–∏–ª–∏
}

// –ü–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π Box ‚Äî caller –æ—Ç—Ä–∏–º—É—î ownership
fn create_box(value: i32) -> Box<i32> {
    Box::new(value)
    // –ù–ï –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è ‚Äî ownership –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è caller'—É
}

fn main() {
    let b = Box::new(42);
    
    borrow_box(&b);   // –ü–æ–∑–∏—á–∞—î–º–æ ‚Äî b –≤—Å–µ —â–µ –Ω–∞—à
    println!("Still have: {}", b);  // ‚úÖ OK
    
    consume_box(b);   // –ü–µ—Ä–µ–¥–∞—î–º–æ ownership
    // println!("{}", b);  // ‚ùå –ü–æ–º–∏–ª–∫–∞: b moved
    
    let new_box = create_box(100);  // –û—Ç—Ä–∏–º—É—î–º–æ –Ω–æ–≤–∏–π Box
    println!("Created: {}", new_box);
}
```

---

## 28.3 –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Box

### –†–µ–∫—É—Ä—Å–∏–≤–Ω—ñ —Ç–∏–ø–∏ ‚Äî –≥–æ–ª–æ–≤–Ω–∏–π use case

–ù–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∞ –ø—Ä–∏—á–∏–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Box ‚Äî **—Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ñ —Ç–∏–ø–∏**, —Ç–æ–±—Ç–æ —Ç–∏–ø–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å —Å–µ–±–µ.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –Ω–µ –º–æ–∂–µ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ —Ç–∏–ø—É:

```rust
// ‚ùå –ù–µ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è!
enum List {
    Empty,
    Node(i32, List),  // List –º—ñ—Å—Ç–∏—Ç—å List, —è–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å List...
}
// –ü–æ–º–∏–ª–∫–∞: "recursive type `List` has infinite size"
```

–ß–æ–º—É? –£—è–≤—ñ—Ç—å, —â–æ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ–±—á–∏—Å–ª–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä:
- `List` = —Ä–æ–∑–º—ñ—Ä `Node` = 4 –±–∞–π—Ç–∏ (i32) + —Ä–æ–∑–º—ñ—Ä `List`
- –ê–ª–µ `List` = 4 + —Ä–æ–∑–º—ñ—Ä `List` = 4 + 4 + —Ä–æ–∑–º—ñ—Ä `List` = ...
- **–ù–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∞ —Ä–µ–∫—É—Ä—Å—ñ—è!**

**–†—ñ—à–µ–Ω–Ω—è:** Box –º–∞—î **—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π** —Ä–æ–∑–º—ñ—Ä (8 –±–∞–π—Ç ‚Äî —Ä–æ–∑–º—ñ—Ä –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–∞):

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–≤'—è–∑–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Box.

```rust
// ‚úÖ –ö–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è ‚Äî Box –º–∞—î —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π —Ä–æ–∑–º—ñ—Ä
enum List<T> {
    Empty,
    Node(T, Box<List<T>>),  // 8 –±–∞–π—Ç –∑–∞–º—ñ—Å—Ç—å –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ—Å—Ç—ñ
}

use List::{Empty, Node};

fn main() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ —Å–ø–∏—Å–æ–∫: 1 -> 2 -> 3 -> Empty
    let list = Node(1, 
        Box::new(Node(2, 
            Box::new(Node(3, 
                Box::new(Empty))))));
    
    // –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤–∏–≤–æ–¥—É
    fn print_list<T: std::fmt::Display>(list: &List<T>) {
        match list {
            Empty => println!("End"),
            Node(value, next) => {
                print!("{} -> ", value);
                print_list(next);
            }
        }
    }
    
    print_list(&list);  // 1 -> 2 -> 3 -> End
}
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1. `Node(1, Box::new(...))` ‚Äî 1 –Ω–∞ —Å—Ç–µ–∫—É, —Ä–µ—à—Ç–∞ —Å–ø–∏—Å–∫—É –Ω–∞ heap
2. –ö–æ–∂–µ–Ω `Box` –º—ñ—Å—Ç–∏—Ç—å –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤—É–∑–æ–ª
3. –†–æ–∑–º—ñ—Ä `Node` = —Ä–æ–∑–º—ñ—Ä `T` + 8 –±–∞–π—Ç (–≤–∫–∞–∑—ñ–≤–Ω–∏–∫) ‚Äî **—Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–π**

### –ë—ñ–Ω–∞—Ä–Ω—ñ –¥–µ—Ä–µ–≤–∞

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–µ –¥–µ—Ä–µ–≤–æ –¥–ª—è –∞–≥–µ–Ω—Ç–∞.

```rust
/// –í—É–∑–æ–ª –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞
struct TreeNode<T> {
    value: T,
    left: Option<Box<TreeNode<T>>>,   // –õ—ñ–≤–∞ –≥—ñ–ª–∫–∞ (–º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—è)
    right: Option<Box<TreeNode<T>>>,  // –ü—Ä–∞–≤–∞ –≥—ñ–ª–∫–∞ (–º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—è)
}

impl<T> TreeNode<T> {
    /// –°—Ç–≤–æ—Ä—é—î –ª–∏—Å—Ç–æ–∫ (–≤—É–∑–æ–ª –±–µ–∑ –¥—ñ—Ç–µ–π)
    fn leaf(value: T) -> Self {
        TreeNode {
            value,
            left: None,
            right: None,
        }
    }
    
    /// –°—Ç–≤–æ—Ä—é—î –≤—É–∑–æ–ª –∑ –¥—ñ—Ç—å–º–∏
    fn with_children(value: T, left: TreeNode<T>, right: TreeNode<T>) -> Self {
        TreeNode {
            value,
            left: Some(Box::new(left)),
            right: Some(Box::new(right)),
        }
    }
}

fn main() {
    // –ë—É–¥—É—î–º–æ –¥–µ—Ä–µ–≤–æ:
    //       5
    //      / \
    //     3   7
    //    / \
    //   1   4
    
    let tree = TreeNode::with_children(
        5,
        TreeNode::with_children(
            3,
            TreeNode::leaf(1),
            TreeNode::leaf(4),
        ),
        TreeNode::leaf(7),
    );
    
    println!("Root: {}", tree.value);  // 5
    
    // –î–æ—Å—Ç—É–ø –¥–æ –ª—ñ–≤–æ–≥–æ –ø—ñ–¥–¥–µ—Ä–µ–≤–∞
    if let Some(left) = &tree.left {
        println!("Left child: {}", left.value);  // 3
    }
}
```

### –í–µ–ª–∏–∫—ñ –¥–∞–Ω—ñ

–ö–æ–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∞ –¥–ª—è —Å—Ç–µ–∫—É (–º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ stack overflow):

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤–µ–ª–∏–∫–∏–π –±—É—Ñ–µ—Ä –Ω–∞ heap.

```rust
// ‚ùå –ü–æ–≥–∞–Ω–∞ —ñ–¥–µ—è ‚Äî 1 –ú–ë –Ω–∞ —Å—Ç–µ–∫—É!
// struct LargeBuffer {
//     data: [u8; 1_000_000],
// }

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –≤–µ–ª–∏–∫—ñ –¥–∞–Ω—ñ –Ω–∞ heap
struct LargeBuffer {
    data: Box<[u8; 1_000_000]>,
}

impl LargeBuffer {
    fn new() -> Self {
        // –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Å–∏–≤ –Ω–∞ heap
        Self {
            data: Box::new([0u8; 1_000_000]),
        }
    }
    
    fn size(&self) -> usize {
        self.data.len()
    }
}

fn main() {
    let buffer = LargeBuffer::new();
    println!("Buffer size: {} bytes", buffer.size());  // 1000000
    
    // –ù–∞ —Å—Ç–µ–∫—É –ª–∏—à–µ ~8 –±–∞–π—Ç (–≤–∫–∞–∑—ñ–≤–Ω–∏–∫)
    // –ù–∞ heap ‚Äî 1 –ú–ë –¥–∞–Ω–∏—Ö
}
```

### Trait Objects ‚Äî –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º

Box –¥–æ–∑–≤–æ–ª—è—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ **—Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏** –≤ –æ–¥–Ω—ñ–π –∫–æ–ª–µ–∫—Ü—ñ—ó, —è–∫—â–æ –≤–æ–Ω–∏ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å —Å–ø—ñ–ª—å–Ω–∏–π trait.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é —Ä—ñ–∑–Ω–∏—Ö —Å–µ–Ω—Å–æ—Ä—ñ–≤.

```rust
/// Trait –¥–ª—è –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ —Å–µ–Ω—Å–æ—Ä—ñ–≤
trait Sensor {
    fn read(&self) -> f64;
    fn name(&self) -> &str;
}

// –†—ñ–∑–Ω—ñ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–µ–Ω—Å–æ—Ä—ñ–≤
struct TemperatureSensor { celsius: f64 }
struct PressureSensor { pascals: f64 }
struct HumiditySensor { percent: f64 }

impl Sensor for TemperatureSensor {
    fn read(&self) -> f64 { self.celsius }
    fn name(&self) -> &str { "Temperature" }
}

impl Sensor for PressureSensor {
    fn read(&self) -> f64 { self.pascals }
    fn name(&self) -> &str { "Pressure" }
}

impl Sensor for HumiditySensor {
    fn read(&self) -> f64 { self.percent }
    fn name(&self) -> &str { "Humidity" }
}

fn main() {
    // Box<dyn Trait> –¥–æ–∑–≤–æ–ª—è—î –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –†–Ü–ó–ù–Ü —Ç–∏–ø–∏ –≤ –æ–¥–Ω–æ–º—É Vec
    let sensors: Vec<Box<dyn Sensor>> = vec![
        Box::new(TemperatureSensor { celsius: 23.5 }),
        Box::new(PressureSensor { pascals: 101325.0 }),
        Box::new(HumiditySensor { percent: 65.0 }),
    ];
    
    println!("Sensor readings:");
    for sensor in &sensors {
        println!("  {}: {:.2}", sensor.name(), sensor.read());
    }
}
```

**–í–∏–≤—ñ–¥:**
```text
Sensor readings:
  Temperature: 23.50
  Pressure: 101325.00
  Humidity: 65.00
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1. `dyn Sensor` ‚Äî "–±—É–¥—å-—è–∫–∏–π —Ç–∏–ø, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î Sensor"
2. `Box<dyn Sensor>` ‚Äî –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ —Ç–∞–∫–∏–π —Ç–∏–ø + vtable (—Ç–∞–±–ª–∏—Ü—è –º–µ—Ç–æ–¥—ñ–≤)
3. –†–æ–∑–º—ñ—Ä `Box<dyn Sensor>` = 16 –±–∞–π—Ç (–≤–∫–∞–∑—ñ–≤–Ω–∏–∫ + –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ vtable)
4. –ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É `sensor.read()` ‚Äî runtime lookup —É vtable

---

## 28.4 Deref —ñ Drop ‚Äî –º–∞–≥—ñ—è smart pointers

### Deref ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑—ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è

`Box<T>` —Ä–µ–∞–ª—ñ–∑—É—î trait `Deref`, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ **—è–∫ –∑–≤–∏—á–∞–π–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è**.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ Deref coercion.

```rust
fn main() {
    let boxed = Box::new(String::from("hello"));
    
    // 1. –Ø–≤–Ω–µ —Ä–æ–∑—ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è
    let s1: &String = &*boxed;
    
    // 2. Deref coercion ‚Äî —Ç–µ —Å–∞–º–µ, –∞–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
    let s2: &String = &boxed;
    
    // 3. –õ–∞–Ω—Ü—é–∂–æ–∫ coercion: Box<String> ‚Üí &String ‚Üí &str
    let s3: &str = &boxed;
    
    // 4. –ú–µ—Ç–æ–¥–∏ String –¥–æ—Å—Ç—É–ø–Ω—ñ –Ω–∞–ø—Ä—è–º—É
    println!("Length: {}", boxed.len());        // 5
    println!("Uppercase: {}", boxed.to_uppercase()); // HELLO
    
    // 5. –§—É–Ω–∫—Ü—ñ—è –ø—Ä–∏–π–º–∞—î &str ‚Äî Box<String> –ø—ñ–¥—Ö–æ–¥–∏—Ç—å!
    fn print_greeting(s: &str) {
        println!("Hello, {}!", s);
    }
    print_greeting(&boxed);  // Hello, hello!
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î Deref coercion:**

```text
Box<String> --deref--> &String --deref--> &str
     ‚îÇ                    ‚îÇ                ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–≤–ª—è—î –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Ä–æ–∑—ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è
```

### Drop ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è

–ö–æ–ª–∏ Box –≤–∏—Ö–æ–¥–∏—Ç—å –∑—ñ scope, –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è trait `Drop`, —ñ –ø–∞–º'—è—Ç—å –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –≤–∏–∫–ª–∏–∫—É Drop.

```rust
struct Resource {
    name: String,
}

impl Drop for Resource {
    fn drop(&mut self) {
        println!("üóëÔ∏è Dropping: {}", self.name);
    }
}

fn main() {
    println!("Creating resources...");
    
    let a = Box::new(Resource { name: "Alpha".to_string() });
    let b = Box::new(Resource { name: "Beta".to_string() });
    let c = Box::new(Resource { name: "Gamma".to_string() });
    
    println!("Using resources...");
    println!("  a = {}", a.name);
    println!("  b = {}", b.name);
    println!("  c = {}", c.name);
    
    println!("End of scope ‚Äî Drop –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–æ:");
}
```

**–í–∏–≤—ñ–¥:**
```text
Creating resources...
Using resources...
  a = Alpha
  b = Beta
  c = Gamma
End of scope ‚Äî Drop –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–æ:
üóëÔ∏è Dropping: Gamma    ‚Üê –æ—Å—Ç–∞–Ω–Ω—ñ–π —Å—Ç–≤–æ—Ä–µ–Ω–∏–π ‚Äî –ø–µ—Ä—à–∏–π –∑–≤—ñ–ª—å–Ω–µ–Ω–∏–π
üóëÔ∏è Dropping: Beta
üóëÔ∏è Dropping: Alpha
```

**–ü–æ—Ä—è–¥–æ–∫ Drop:** LIFO ‚Äî –æ—Å—Ç–∞–Ω–Ω—ñ–π —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è –ø–µ—Ä—à–∏–º.

### –Ø–≤–Ω–∏–π drop

–ú–æ–∂–Ω–∞ –∑–≤—ñ–ª—å–Ω–∏—Ç–∏ Box **–¥–æ** –≤–∏—Ö–æ–¥—É –∑—ñ scope:

```rust
fn main() {
    let resource = Box::new(Resource { name: "Important".to_string() });
    
    println!("Before explicit drop");
    
    drop(resource);  // –Ø–≤–Ω–æ –∑–≤—ñ–ª—å–Ω—è—î–º–æ –ó–ê–†–ê–ó
    
    println!("After explicit drop");
    
    // resource –±—ñ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞
    // println!("{}", resource.name);  // ‚ùå –ü–æ–º–∏–ª–∫–∞: value moved
}
```

---

## 28.5 –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥: –î–µ—Ä–µ–≤–æ —Ä—ñ—à–µ–Ω—å –∞–≥–µ–Ω—Ç–∞

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–µ—Ä–µ–≤–æ —Ä—ñ—à–µ–Ω—å –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –ë–ü–õ–ê. –ê–≥–µ–Ω—Ç –æ—Ü—ñ–Ω—é—î —Å–∏—Ç—É–∞—Ü—ñ—é —Ç–∞ –ø—Ä–∏–π–º–∞—î —Ä—ñ—à–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —É–º–æ–≤.

```rust
/// –î—ñ—è, —è–∫—É –º–æ–∂–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∞–≥–µ–Ω—Ç
#[derive(Clone, Debug)]
enum Action {
    Patrol,       // –ü–∞—Ç—Ä—É–ª—é–≤–∞—Ç–∏ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—é
    Attack,       // –ê—Ç–∞–∫—É–≤–∞—Ç–∏ —Ü—ñ–ª—å
    Retreat,      // –í—ñ–¥—Å—Ç—É–ø–∞—Ç–∏
    Recharge,     // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞ –∑–∞—Ä—è–¥–∫—É
    Scan,         // –°–∫–∞–Ω—É–≤–∞—Ç–∏ –æ–±–ª–∞—Å—Ç—å
}

/// –°—Ç–∞–Ω –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ä—ñ—à–µ–Ω—å
struct AgentContext {
    battery_level: u8,      // 0-100%
    enemy_detected: bool,
    health: u8,             // 0-100%
    distance_to_base: f64,
}

/// –í—É–∑–æ–ª –¥–µ—Ä–µ–≤–∞ —Ä—ñ—à–µ–Ω—å
enum Decision {
    /// –ö—ñ–Ω—Ü–µ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è ‚Äî –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥—ñ—é
    Leaf(Action),
    
    /// –£–º–æ–≤–Ω–∏–π –≤—É–∑–æ–ª ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —É–º–æ–≤—É
    Branch {
        condition_name: String,
        condition: Box<dyn Fn(&AgentContext) -> bool>,
        if_true: Box<Decision>,
        if_false: Box<Decision>,
    },
}

impl Decision {
    /// –°—Ç–≤–æ—Ä—é—î –ª–∏—Å—Ç–æ–∫ ‚Äî –∫—ñ–Ω—Ü–µ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è
    fn action(action: Action) -> Self {
        Decision::Leaf(action)
    }
    
    /// –°—Ç–≤–æ—Ä—é—î —É–º–æ–≤–Ω–∏–π –≤—É–∑–æ–ª
    fn branch<F>(name: &str, condition: F, if_true: Decision, if_false: Decision) -> Self
    where
        F: Fn(&AgentContext) -> bool + 'static,
    {
        Decision::Branch {
            condition_name: name.to_string(),
            condition: Box::new(condition),
            if_true: Box::new(if_true),
            if_false: Box::new(if_false),
        }
    }
    
    /// –û—Ü—ñ–Ω—é—î –¥–µ—Ä–µ–≤–æ —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –¥—ñ—é
    fn evaluate(&self, context: &AgentContext) -> Action {
        match self {
            Decision::Leaf(action) => {
                println!("  ‚Üí –†—ñ—à–µ–Ω–Ω—è: {:?}", action);
                action.clone()
            }
            Decision::Branch { condition_name, condition, if_true, if_false } => {
                let result = condition(context);
                println!("  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ '{}': {}", condition_name, result);
                
                if result {
                    if_true.evaluate(context)
                } else {
                    if_false.evaluate(context)
                }
            }
        }
    }
}

/// –ë—É–¥—É—î –¥–µ—Ä–µ–≤–æ —Ä—ñ—à–µ–Ω—å –¥–ª—è –±–æ–π–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
fn build_combat_decision_tree() -> Decision {
    Decision::branch(
        "battery < 20%",
        |ctx| ctx.battery_level < 20,
        // –ù–∏–∑—å–∫–∏–π –∑–∞—Ä—è–¥ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å
        Decision::action(Action::Recharge),
        // –î–æ—Å—Ç–∞—Ç–Ω—å–æ –∑–∞—Ä—è–¥—É ‚Äî –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ
        Decision::branch(
            "enemy_detected",
            |ctx| ctx.enemy_detected,
            // –í–æ—Ä–æ–≥ –≤–∏—è–≤–ª–µ–Ω–∏–π
            Decision::branch(
                "health > 50%",
                |ctx| ctx.health > 50,
                // –ó–¥–æ—Ä–æ–≤'—è –¥–æ—Å—Ç–∞—Ç–Ω—î ‚Äî –∞—Ç–∞–∫—É—î–º–æ
                Decision::action(Action::Attack),
                // –ó–¥–æ—Ä–æ–≤'—è –Ω–∏–∑—å–∫–µ ‚Äî –≤—ñ–¥—Å—Ç—É–ø–∞—î–º–æ
                Decision::action(Action::Retreat),
            ),
            // –í–æ—Ä–æ–≥–∞ –Ω–µ–º–∞—î ‚Äî –ø–∞—Ç—Ä—É–ª—é—î–º–æ
            Decision::branch(
                "distance_to_base > 100",
                |ctx| ctx.distance_to_base > 100.0,
                // –î–∞–ª–µ–∫–æ –≤—ñ–¥ –±–∞–∑–∏ ‚Äî —Å–∫–∞–Ω—É—î–º–æ
                Decision::action(Action::Scan),
                // –ë–ª–∏–∑—å–∫–æ ‚Äî –ø–∞—Ç—Ä—É–ª—é—î–º–æ
                Decision::action(Action::Patrol),
            ),
        ),
    )
}

fn main() {
    let decision_tree = build_combat_decision_tree();
    
    // –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ó–¥–æ—Ä–æ–≤–∏–π –∞–≥–µ–Ω—Ç –±–∞—á–∏—Ç—å –≤–æ—Ä–æ–≥–∞
    println!("\nüìä –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –í–æ—Ä–æ–≥ –≤–∏—è–≤–ª–µ–Ω–∏–π, –∑–¥–æ—Ä–æ–≤'—è –≤ –Ω–æ—Ä–º—ñ");
    let context1 = AgentContext {
        battery_level: 80,
        enemy_detected: true,
        health: 75,
        distance_to_base: 150.0,
    };
    let action1 = decision_tree.evaluate(&context1);
    println!("–†–µ–∑—É–ª—å—Ç–∞—Ç: {:?}\n", action1);
    
    // –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ù–∏–∑—å–∫–∏–π –∑–∞—Ä—è–¥
    println!("üìä –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ù–∏–∑—å–∫–∏–π –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ—ó");
    let context2 = AgentContext {
        battery_level: 15,
        enemy_detected: true,
        health: 90,
        distance_to_base: 50.0,
    };
    let action2 = decision_tree.evaluate(&context2);
    println!("–†–µ–∑—É–ª—å—Ç–∞—Ç: {:?}\n", action2);
    
    // –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ü–∞—Ç—Ä—É–ª—é–≤–∞–Ω–Ω—è
    println!("üìä –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –°–ø–æ–∫—ñ–π–Ω–∞ –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∞");
    let context3 = AgentContext {
        battery_level: 60,
        enemy_detected: false,
        health: 100,
        distance_to_base: 30.0,
    };
    let action3 = decision_tree.evaluate(&context3);
    println!("–†–µ–∑—É–ª—å—Ç–∞—Ç: {:?}", action3);
}
```

**–í–∏–≤—ñ–¥:**
```text
üìä –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –í–æ—Ä–æ–≥ –≤–∏—è–≤–ª–µ–Ω–∏–π, –∑–¥–æ—Ä–æ–≤'—è –≤ –Ω–æ—Ä–º—ñ
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 'battery < 20%': false
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 'enemy_detected': true
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 'health > 50%': true
  ‚Üí –†—ñ—à–µ–Ω–Ω—è: Attack
–†–µ–∑—É–ª—å—Ç–∞—Ç: Attack

üìä –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ù–∏–∑—å–∫–∏–π –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ—ó
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 'battery < 20%': true
  ‚Üí –†—ñ—à–µ–Ω–Ω—è: Recharge
–†–µ–∑—É–ª—å—Ç–∞—Ç: Recharge

üìä –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –°–ø–æ–∫—ñ–π–Ω–∞ –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∞
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 'battery < 20%': false
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 'enemy_detected': false
  –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ 'distance_to_base > 100': false
  ‚Üí –†—ñ—à–µ–Ω–Ω—è: Patrol
–†–µ–∑—É–ª—å—Ç–∞—Ç: Patrol
```

---

## 28.6 –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞

**–ú–µ—Ç–∞:** –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ Box –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä —Ç–∞ trait objects.

### –ß–∞—Å—Ç–∏–Ω–∞ 1: –ó–≤'—è–∑–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ (3 –±–∞–ª–∏)

```rust
enum PositionHistory {
    Empty,
    Entry { position: Position, prev: Box<PositionHistory> },
}

impl PositionHistory {
    fn new() -> Self { ... }
    fn push(self, pos: Position) -> Self { ... }
    fn len(&self) -> usize { ... }
    fn to_vec(&self) -> Vec<Position> { ... }
}
```

### –ß–∞—Å—Ç–∏–Ω–∞ 2: –î–µ—Ä–µ–≤–æ —Å—Ç–∞–Ω—ñ–≤ –º—ñ—Å—ñ—ó (4 –±–∞–ª–∏)

```rust
struct MissionState {
    name: String,
    action: Box<dyn Fn() -> bool>,  // –î—ñ—è —Å—Ç–∞–Ω—É
    on_success: Option<Box<MissionState>>,
    on_failure: Option<Box<MissionState>>,
}
```

### –ß–∞—Å—Ç–∏–Ω–∞ 3: –ö–æ–ª–µ–∫—Ü—ñ—è –∫–æ–º–∞–Ω–¥ (3 –±–∞–ª–∏)

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ `Vec<Box<dyn Command>>` –¥–ª—è —á–µ—Ä–≥–∏ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –∫–æ–º–∞–Ω–¥.

---

## –ü—ñ–¥—Å—É–º–æ–∫

`Box<T>` ‚Äî –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π smart pointer, —â–æ —Ä–æ–∑–º—ñ—â—É—î –¥–∞–Ω—ñ –Ω–∞ heap:

| –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è | –û–ø–∏—Å |
|--------------|------|
| **–†–µ–∫—É—Ä—Å–∏–≤–Ω—ñ —Ç–∏–ø–∏** | –°–ø–∏—Å–∫–∏, –¥–µ—Ä–µ–≤–∞ ‚Äî Box –ø–µ—Ä–µ—Ä–∏–≤–∞—î –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—É —Ä–µ–∫—É—Ä—Å—ñ—é —Ä–æ–∑–º—ñ—Ä—É |
| **–í–µ–ª–∏–∫—ñ –¥–∞–Ω—ñ** | –£–Ω–∏–∫–∞—î–º–æ stack overflow |
| **Trait objects** | `Box<dyn Trait>` –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º—É |
| **–ü–µ—Ä–µ–¥–∞—á–∞ ownership** | –ë–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö |

**–ö–ª—é—á–æ–≤—ñ –ø—Ä–∞–≤–∏–ª–∞:**
- Box **–≤–æ–ª–æ–¥—ñ—î** –≤–º—ñ—Å—Ç–æ–º (–æ–¥–∏–Ω –≤–ª–∞—Å–Ω–∏–∫)
- Drop –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑—ñ scope
- Deref –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Box **—è–∫ –∑–≤–∏—á–∞–π–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è**

---

## –ó–≤'—è–∑–æ–∫ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —Ä–æ–∑–¥—ñ–ª–æ–º

Box –¥–∞—î **–æ–¥–Ω–æ–≥–æ** –≤–ª–∞—Å–Ω–∏–∫–∞. –ê–ª–µ —â–æ, —è–∫—â–æ –∫—ñ–ª—å–∫–∞ —á–∞—Å—Ç–∏–Ω –ø—Ä–æ–≥—Ä–∞–º–∏ –º–∞—é—Ç—å –ø–æ—Å–∏–ª–∞—Ç–∏—Å—å –Ω–∞ **—Ç—ñ —Å–∞–º—ñ –¥–∞–Ω—ñ**? –•—Ç–æ —ó—Ö –∑–≤—ñ–ª—å–Ω–∏—Ç—å ‚Äî –ø–µ—Ä—à–∏–π —á–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π?

–£ **–†–æ–∑–¥—ñ–ª—ñ 29: Rc ‚Äî —Å–ø—ñ–ª—å–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è** –≤–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å:
- –Ø–∫ –∫—ñ–ª—å–∫–∞ –≤–ª–∞—Å–Ω–∏–∫—ñ–≤ –º–æ–∂—É—Ç—å –¥—ñ–ª–∏—Ç–∏ –æ–¥–Ω—ñ –¥–∞–Ω—ñ
- –©–æ —Ç–∞–∫–µ **reference counting** (–ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ—Å–∏–ª–∞–Ω—å)
- –ö–æ–ª–∏ –¥–∞–Ω—ñ –∑–≤—ñ–ª—å–Ω—è—é—Ç—å—Å—è –ø—Ä–∏ —Å–ø—ñ–ª—å–Ω–æ–º—É –≤–æ–ª–æ–¥—ñ–Ω–Ω—ñ
- –Ø–∫ —É–Ω–∏–∫–Ω—É—Ç–∏ —Ü–∏–∫–ª—ñ—á–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å —á–µ—Ä–µ–∑ `Weak<T>`
