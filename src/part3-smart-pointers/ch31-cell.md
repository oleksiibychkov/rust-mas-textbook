# –†–æ–∑–¥—ñ–ª 31: Cell\<T\> —Ç–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ RefCell

## –ê–Ω–æ—Ç–∞—Ü—ñ—è

–£ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –ø–æ–∑–Ω–∞–π–æ–º–∏–ª–∏—Å—å –∑ RefCell ‚Äî –ø–æ—Ç—É–∂–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ. RefCell –¥–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–∑–∏—á–∞–Ω–Ω—è –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏. –û–¥–Ω–∞–∫ —Ü—è –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –º–∞—î —Å–≤–æ—é —Ü—ñ–Ω—É: RefCell –∑–±–µ—Ä—ñ–≥–∞—î –ª—ñ—á–∏–ª—å–Ω–∏–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –ø–æ–∑–∏—á–∞–Ω—å, –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ –ø–∞–Ω—ñ–∫—É –ø—Ä–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ, —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –æ–±–≥–æ—Ä—Ç–∫–∏ Ref —Ç–∞ RefMut –∑–∞–º—ñ—Å—Ç—å –∑–≤–∏—á–∞–π–Ω–∏—Ö –ø–æ—Å–∏–ª–∞–Ω—å.

–î–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤ ‚Äî –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤ –∫—Ä–æ–∫—ñ–≤, –ø—Ä–∞–ø–æ—Ä—Ü—ñ–≤ —Å—Ç–∞–Ω—É, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ–∑–∏—Ü—ñ—ó ‚Äî —Ü—ñ –Ω–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ —î –Ω–∞–¥–º—ñ—Ä–Ω–∏–º–∏. –°–∞–º–µ —Ç—É—Ç –Ω–∞ —Å—Ü–µ–Ω—É –≤–∏—Ö–æ–¥–∏—Ç—å Cell\<T\> ‚Äî –ª–µ–≥—à–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞, —â–æ –ø—Ä–∞—Ü—é—î –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ —ñ–Ω–∞–∫—à–µ. –ó–∞–º—ñ—Å—Ç—å –ø–æ–∑–∏—á–∞–Ω–Ω—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è, Cell –∫–æ–ø—ñ—é—î –π–æ–≥–æ: –º–µ—Ç–æ–¥ `get()` –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–ø—ñ—é, –∞ `set()` –∑–∞–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–≤–Ω—ñ—Å—Ç—é. –û—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –æ—Ç—Ä–∏–º—É—î—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –¥–∞–Ω—ñ, –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ –ø–æ–∑–∏—á–∞–Ω–Ω—è –±—É—Ç–∏ –Ω–µ –º–æ–∂–µ, –∞ –æ—Ç–∂–µ ‚Äî –∂–æ–¥–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —ñ –∂–æ–¥–Ω–∏—Ö –ø–∞–Ω—ñ–∫–∏.

–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ —Ç–∞–∫–æ–∂ –ø–æ–∑–Ω–∞–π–æ–º–∏—Ç–µ—Å—å –∑ OnceCell —Ç–∞ LazyCell ‚Äî —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—ó —Ç–∞ –ª—ñ–Ω–∏–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –¶—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–æ–ø–æ–≤–Ω—é—é—Ç—å Cell —ñ RefCell, –ø–æ–∫—Ä–∏–≤–∞—é—á–∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ –≤—Å—ñ –ø–æ—Ç—Ä–µ–±–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –≤ –æ–¥–Ω–æ–ø–æ—Ç–æ–∫–æ–≤–æ–º—É –∫–æ–¥—ñ.

---

## –¶—ñ–ª—ñ –Ω–∞–≤—á–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ:

1. –ü–æ—è—Å–Ω–∏—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤—É —Ä—ñ–∑–Ω–∏—Ü—é –º—ñ–∂ Cell —Ç–∞ RefCell
2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Cell –¥–ª—è —Ç–∏–ø—ñ–≤, —â–æ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å Copy
3. –ó–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ get, set, replace, take —Ç–∞ update
4. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ OnceCell –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
5. –ó–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ LazyCell –¥–ª—è –ª—ñ–Ω–∏–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –¥–æ—Å—Ç—É–ø—ñ
6. –û–±–∏—Ä–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó
7. –†–æ–∑—É–º—ñ—Ç–∏ –∫–æ–º–ø—Ä–æ–º—ñ—Å–∏ —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É

---

## –ö–ª—é—á–æ–≤—ñ —Ç–µ—Ä–º—ñ–Ω–∏

| –¢–µ—Ä–º—ñ–Ω | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|------------|
| Cell\<T\> | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ, —â–æ –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å, –∞ –Ω–µ —á–µ—Ä–µ–∑ –ø–æ–∑–∏—á–∞–Ω–Ω—è. –í–∏–º–∞–≥–∞—î, —â–æ–± —Ç–∏–ø T —Ä–µ–∞–ª—ñ–∑–æ–≤—É–≤–∞–≤ —Ç—Ä–µ–π—Ç Copy |
| Copy | –ú–∞—Ä–∫–µ—Ä–Ω–∏–π —Ç—Ä–µ–π—Ç, —â–æ –¥–æ–∑–≤–æ–ª—è—î —Ç–∏–ø—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–ø—ñ—é–≤–∞—Ç–∏—Å—è –ø—Ä–∏ –ø—Ä–∏—Å–≤–æ—î–Ω–Ω—ñ. –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏—Ö —Ç–∏–ø—ñ–≤ (—á–∏—Å–ª–∞, bool, char) —Ç–∞ —ó—Ö –∫–æ–º–±—ñ–Ω–∞—Ü—ñ–π |
| OnceCell\<T\> | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä, —â–æ –º–æ–∂–µ –±—É—Ç–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑. –ü—ñ—Å–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ |
| LazyCell\<T\> | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ª—ñ–Ω–∏–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: –∑–Ω–∞—á–µ–Ω–Ω—è –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –¥–æ—Å—Ç—É–ø—ñ |
| get() | –ú–µ—Ç–æ–¥ Cell, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–ø—ñ—é –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è |
| set() | –ú–µ—Ç–æ–¥ Cell, —â–æ –∑–∞–º—ñ–Ω—é—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –Ω–æ–≤–µ |
| get_or_init() | –ú–µ—Ç–æ–¥ OnceCell, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –∞–±–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –π–æ–≥–æ, —è–∫—â–æ –∫–æ–º—ñ—Ä–∫–∞ –ø–æ—Ä–æ–∂–Ω—è |

---

## –ú–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏–π –∫–µ–π—Å: –Ω–∞–¥–º—ñ—Ä–Ω—ñ—Å—Ç—å RefCell –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –¥–∞–Ω–∏—Ö

–£—è–≤—ñ—Ç—å —Ç–∏–ø–æ–≤—É —Å–∏—Ç—É–∞—Ü—ñ—é –≤ —Å–∏—Å—Ç–µ–º—ñ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∞–≥–µ–Ω—Ç–æ–º –ë–ü–õ–ê. –ê–≥–µ–Ω—Ç –º–∞—î –∫—ñ–ª—å–∫–∞ –ø—Ä–æ—Å—Ç–∏—Ö —á–∏—Å–ª–æ–≤–∏—Ö –ø–æ–ª—ñ–≤: —Ä—ñ–≤–µ–Ω—å –∑–∞—Ä—è–¥—É –±–∞—Ç–∞—Ä–µ—ó (u8), –ª—ñ—á–∏–ª—å–Ω–∏–∫ –∫—Ä–æ–∫—ñ–≤ (u32), –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (bool). –ü—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º—ñ—Å—ñ—ó —Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Å—Ç—ñ–π–Ω–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è, –∞–ª–µ —Å–∞–º –∞–≥–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —É —Ñ—É–Ω–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è `&self`.

–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–¥—ñ–ª –Ω–∞–≤—á–∏–≤ –≤–∞—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ RefCell –¥–ª—è —Ç–∞–∫–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤:

```rust
use std::cell::RefCell;

struct Counter {
    value: RefCell<u32>,
}

impl Counter {
    fn increment(&self) {
        // –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É u32:
        // 1. –í–∏–∫–ª–∏–∫ borrow_mut() ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –ø–æ–∑–∏—á–∞–Ω—å
        // 2. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è RefMut –æ–±–≥–æ—Ä—Ç–∫–∏
        // 3. –†–æ–∑—ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è
        // 4. –ó–Ω–∏—â–µ–Ω–Ω—è RefMut ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞
        *self.value.borrow_mut() += 1;
    }
}
```

–¶–µ–π –∫–æ–¥ –ø—Ä–∞—Ü—é—î, –∞–ª–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É —á–∏—Å–ª–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–∞–Ω–∞–¥—Ç–æ –±–∞–≥–∞—Ç–æ —Ä–æ–±–æ—Ç–∏. RefCell –∑–±–µ—Ä—ñ–≥–∞—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –ª—ñ—á–∏–ª—å–Ω–∏–∫ –ø–æ–∑–∏—á–∞–Ω—å, –ø–µ—Ä–µ–≤—ñ—Ä—è—î –π–æ–≥–æ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É borrow_mut(), —Å—Ç–≤–æ—Ä—é—î –æ–±–≥–æ—Ä—Ç–∫—É RefMut, –∞ –ø–æ—Ç—ñ–º –æ–Ω–æ–≤–ª—é—î –ª—ñ—á–∏–ª—å–Ω–∏–∫ –ø—Ä–∏ —ó—ó –∑–Ω–∏—â–µ–Ω–Ω—ñ. –Ø–∫—â–æ —Ç—Ä–∞–ø–∏—Ç—å—Å—è –∫–æ–Ω—Ñ–ª—ñ–∫—Ç (—Å–ø—Ä–æ–±–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ–∑–∏—á–∞–Ω–Ω—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º—É —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–º—É), –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–ø–∞–¥–µ –∑ –ø–∞–Ω—ñ–∫–æ—é.

Cell –ø—Ä–æ–ø–æ–Ω—É—î –µ–ª–µ–≥–∞–Ω—Ç–Ω—ñ—à–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è Copy —Ç–∏–ø—ñ–≤:

```rust
use std::cell::Cell;

struct Counter {
    value: Cell<u32>,
}

impl Counter {
    fn increment(&self) {
        // –î–ª—è —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É u32:
        // 1. get() ‚Äî –ø—Ä–æ—Å—Ç–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è 4 –±–∞–π—Ç—ñ–≤
        // 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è 1
        // 3. set() ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—Å 4 –±–∞–π—Ç—ñ–≤
        self.value.set(self.value.get() + 1);
    }
}
```

–ñ–æ–¥–Ω–∏—Ö –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤, –∂–æ–¥–Ω–∏—Ö –æ–±–≥–æ—Ä—Ç–æ–∫, –∂–æ–¥–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫, –∂–æ–¥–Ω–∏—Ö –ø–∞–Ω—ñ–∫–∏. –ü—Ä–æ—Å—Ç–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –±–∞–π—Ç—ñ–≤ —Ç—É–¥–∏-—Å—é–¥–∏. –î–ª—è –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏—Ö —Ç–∏–ø—ñ–≤ —Ü–µ —Å–∞–º–µ —Ç–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

---

## 31.1 –ü—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏ Cell

### 31.1.1 –§—ñ–ª–æ—Å–æ—Ñ—ñ—è Cell: –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å –ø–æ–∑–∏—á–∞–Ω–Ω—è

–©–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —á–æ–º—É Cell –±–µ–∑–ø–µ—á–Ω–∏–π –±–µ–∑ runtime-–ø–µ—Ä–µ–≤—ñ—Ä–æ–∫, –ø–æ—Ç—Ä—ñ–±–Ω–æ —É—Å–≤—ñ–¥–æ–º–∏—Ç–∏ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É —Ä—ñ–∑–Ω–∏—Ü—é –º—ñ–∂ Cell —Ç–∞ RefCell —É –ø—ñ–¥—Ö–æ–¥—ñ –¥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö.

RefCell –Ω–∞–¥–∞—î –ø–æ–∑–∏—á–∞–Ω–Ω—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è. –ö–æ–ª–∏ –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ `borrow()`, –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –¥–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ RefCell. –¶–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –º–∞—î —á–∞—Å –∂–∏—Ç—Ç—è, –ø—Ä–æ—Ç—è–≥–æ–º —è–∫–æ–≥–æ –¥–∞–Ω—ñ –Ω–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ (–¥–ª—è —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—á–∞–Ω–Ω—è) –∞–±–æ –Ω–∞–≤—ñ—Ç—å —á–∏—Ç–∞—Ç–∏ (–¥–ª—è –º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ). –û—Å–∫—ñ–ª—å–∫–∏ Rust –Ω–µ –º–æ–∂–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü—ñ –ø—Ä–∞–≤–∏–ª–∞ –ø—ñ–¥ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó (–∞–¥–∂–µ RefCell –Ω–∞–≤–º–∏—Å–Ω–æ "–æ–±–º–∞–Ω—é—î" —Å–∏—Å—Ç–µ–º—É —Ç–∏–ø—ñ–≤), –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

Cell –≤–∑–∞–≥–∞–ª—ñ –Ω–µ –Ω–∞–¥–∞—î –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è. –ù–∞—Ç–æ–º—ñ—Å—Ç—å:
- `get()` ‚Äî –∫–æ–ø—ñ—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑ Cell –Ω–∞–∑–æ–≤–Ω—ñ
- `set()` ‚Äî –∫–æ–ø—ñ—é—î –Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—É Cell

–û—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –æ—Ç—Ä–∏–º—É—î—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –¥–∞–Ω—ñ, –Ω–µ —ñ—Å–Ω—É—î —Å–∏—Ç—É–∞—Ü—ñ—ó, –∫–æ–ª–∏ —Ö—Ç–æ—Å—å "—Ç—Ä–∏–º–∞—î" —Ü—ñ –¥–∞–Ω—ñ. –ù–µ–º–∞—î –ø–æ–∑–∏—á–∞–Ω—å ‚Äî –Ω–µ–º–∞—î —á–æ–≥–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ ‚Äî –Ω–µ–º–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –ø–∞–Ω—ñ–∫–∏.

–°—Ö–µ–º–∞—Ç–∏—á–Ω–æ —Ü–µ –º–æ–∂–Ω–∞ –∑–æ–±—Ä–∞–∑–∏—Ç–∏ —Ç–∞–∫:

```text
RefCell<T>:
    borrow()     ‚Üí &T      (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è)
    borrow_mut() ‚Üí &mut T  (–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è)
    ‚Üì
    –ü–æ—Ç—Ä—ñ–±–Ω–∞ runtime-–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –Ω–µ–º–∞—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É?

Cell<T>:
    get()  ‚Üí T        (–∫–æ–ø—ñ—è –∑–Ω–∞—á–µ–Ω–Ω—è)
    set(v) ‚Üí ()       (–∑–∞–º—ñ–Ω–∞ –∑–Ω–∞—á–µ–Ω–Ω—è)
    ‚Üì
    –ù–µ–º–∞—î –ø–æ—Å–∏–ª–∞–Ω—å ‚Äî –Ω–µ–º–∞—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ ‚Äî –Ω–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫
```

### 31.1.2 –û–±–º–µ–∂–µ–Ω–Ω—è: —Ç—ñ–ª—å–∫–∏ —Ç–∏–ø–∏ –∑ Copy

–û—Å–∫—ñ–ª—å–∫–∏ Cell –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è, –≤—ñ–Ω –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∑ —Ç–∏–ø–∞–º–∏, —â–æ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å —Ç—Ä–µ–π—Ç Copy. –¶–µ —Ç–∏–ø–∏, –¥–ª—è —è–∫–∏—Ö –ø–æ–±—ñ—Ç–æ–≤–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —î –±–µ–∑–ø–µ—á–Ω–∏–º —ñ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ –∫–æ—Ä–µ–∫—Ç–Ω–∏–º:

- –ü—Ä–∏–º—ñ—Ç–∏–≤–Ω—ñ —Ç–∏–ø–∏: i8, i16, i32, i64, i128, isize, u8, u16, u32, u64, u128, usize, f32, f64, bool, char
- –ö–æ—Ä—Ç–µ–∂—ñ Copy —Ç–∏–ø—ñ–≤: (i32, i32), (bool, u8, char)
- –ú–∞—Å–∏–≤–∏ Copy —Ç–∏–ø—ñ–≤ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É: [i32; 4], [bool; 10]
- –í–ª–∞—Å–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏, –≤—Å—ñ –ø–æ–ª—è —è–∫–∏—Ö Copy (–∑ –∞—Ç—Ä–∏–±—É—Ç–æ–º `#[derive(Copy, Clone)]`)

–ù–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ Copy (—ñ —Ç–æ–º—É –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å –∑ Cell):
- String ‚Äî –º—ñ—Å—Ç–∏—Ç—å –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ heap-–ø–∞–º'—è—Ç—å
- Vec<T> ‚Äî –º—ñ—Å—Ç–∏—Ç—å –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ heap-–ø–∞–º'—è—Ç—å
- Box<T> ‚Äî –≤–ª–∞—Å–Ω–µ —î –≤–∫–∞–∑—ñ–≤–Ω–∏–∫–æ–º –Ω–∞ heap-–ø–∞–º'—è—Ç—å
- –ë—É–¥—å-—è–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑ –ø–æ–ª–µ–º –Ω–µ-Copy —Ç–∏–ø—É

–ù–∞—Å—Ç—É–ø–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫—ñ —Ç–∏–ø–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ Cell, –∞ —è–∫—ñ ‚Äî –Ω—ñ.

```rust
use std::cell::Cell;

fn main() {
    //  –ü—Ä–∏–º—ñ—Ç–∏–≤–Ω—ñ —Ç–∏–ø–∏ ‚Äî —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å Copy
    let num: Cell<i32> = Cell::new(42);
    let flag: Cell<bool> = Cell::new(true);
    let letter: Cell<char> = Cell::new('A');
    let ratio: Cell<f64> = Cell::new(3.14);
    
    println!("num = {}", num.get());       // 42
    println!("flag = {}", flag.get());     // true
    println!("letter = {}", letter.get()); // A
    println!("ratio = {}", ratio.get());   // 3.14
    
    // —Ç–∞–∫, –ö–æ—Ä—Ç–µ–∂—ñ Copy —Ç–∏–ø—ñ–≤ ‚Äî —Ç–µ–∂ Copy
    let point: Cell<(i32, i32)> = Cell::new((10, 20));
    let coords: Cell<(f64, f64, f64)> = Cell::new((1.0, 2.0, 3.0));
    
    println!("point = {:?}", point.get()); // (10, 20)
    
    // —Ç–∞–∫, Option<Copy> ‚Äî —Ç–µ–∂ Copy
    let maybe_num: Cell<Option<i32>> = Cell::new(Some(100));
    println!("maybe_num = {:?}", maybe_num.get()); // Some(100)
    
    // –Ω—ñ, String –Ω–µ Copy ‚Äî –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫ –Ω–µ —Å–∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è:
    // let text: Cell<String> = Cell::new(String::from("hello"));
    // –ü–æ–º–∏–ª–∫–∞: the trait `Copy` is not implemented for `String`
    
    // –Ω—ñ, Vec –Ω–µ Copy ‚Äî –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫ –Ω–µ —Å–∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è:
    // let numbers: Cell<Vec<i32>> = Cell::new(vec![1, 2, 3]);
    // –ü–æ–º–∏–ª–∫–∞: the trait `Copy` is not implemented for `Vec<i32>`
}
```

–†–æ–∑–≥–ª—è–Ω–µ–º–æ, —á–æ–º—É —Ü—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è —ñ—Å–Ω—É—é—Ç—å. –£—è–≤—ñ—Ç—å, —â–æ Cell –¥–æ–∑–≤–æ–ª–∏–≤ –±–∏ String:

```rust
// –ì—ñ–ø–æ—Ç–µ—Ç–∏—á–Ω–∏–π (–Ω–µ–º–æ–∂–ª–∏–≤–∏–π) –∫–æ–¥:
let cell: Cell<String> = Cell::new(String::from("hello"));
let s1 = cell.get();  // "–ö–æ–ø—ñ—è" String?
let s2 = cell.get();  // –©–µ –æ–¥–Ω–∞ "–∫–æ–ø—ñ—è"?
// –û–±–∏–¥–≤—ñ "–∫–æ–ø—ñ—ó" –≤–∫–∞–∑—É–≤–∞–ª–∏ –± –Ω–∞ —Ç—É —Å–∞–º—É –ø–∞–º'—è—Ç—å!
// –ü—Ä–∏ –∑–Ω–∏—â–µ–Ω–Ω—ñ s1 –ø–∞–º'—è—Ç—å –∑–≤—ñ–ª—å–Ω–∏—Ç—å—Å—è, —ñ s2 —Å—Ç–∞–Ω–µ –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–º.
```

–°–∞–º–µ —Ç–æ–º—É Cell –æ–±–º–µ–∂–µ–Ω–∏–π Copy —Ç–∏–ø–∞–º–∏ ‚Äî –¥–ª—è –Ω–∏—Ö –ø–æ–±—ñ—Ç–æ–≤–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑–∞–≤–∂–¥–∏ –±–µ–∑–ø–µ—á–Ω–µ.

### 31.1.3 –ë–∞–∑–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Cell

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –æ—Å–Ω–æ–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ Cell –Ω–∞ –ø—Ä–æ—Å—Ç–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ. –¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Cell, —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å –∑–Ω–∞—á–µ–Ω—å.

```rust
use std::cell::Cell;

fn main() {
    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Cell –∑ –ø–æ—á–∞—Ç–∫–æ–≤–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º
    let cell = Cell::new(42);
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // get() ‚Äî –æ—Ç—Ä–∏–º–∞—Ç–∏ –ö–û–ü–Ü–Æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let value = cell.get();
    println!("–ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è: {}", value);  // 42
    
    // –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É: value ‚Äî —Ü–µ –∫–æ–ø—ñ—è, –Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.
    // –ó–º—ñ–Ω–∞ value –Ω–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ cell:
    let mut value = cell.get();
    value = 999;
    println!("–ó–º—ñ–Ω–µ–Ω–∞ –∫–æ–ø—ñ—è: {}", value);       // 999
    println!("Cell –∑–∞–ª–∏—à–∏–≤—Å—è: {}", cell.get()); // 42 ‚Äî –Ω–µ –∑–º—ñ–Ω–∏–≤—Å—è!
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // set() ‚Äî –∑–∞–º—ñ–Ω–∏—Ç–∏ –≤–Ω—É—Ç—Ä—ñ—à–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –Ω–æ–≤–µ
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    cell.set(100);
    println!("–ü—ñ—Å–ª—è set(100): {}", cell.get()); // 100
    
    // set() –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —á–µ—Ä–µ–∑ &self (—ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è)
    // –¶–µ —ñ —î "–≤–Ω—É—Ç—Ä—ñ—à–Ω—è –º—É—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å"
    let cell_ref = &cell;
    cell_ref.set(200);  // –ü—Ä–∞—Ü—é—î!
    println!("–ß–µ—Ä–µ–∑ &cell: {}", cell.get());    // 200
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –¢–∏–ø–æ–≤–∏–π –ø–∞—Ç–µ—Ä–Ω: —á–∏—Ç–∞–Ω–Ω—è, –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è, –∑–∞–ø–∏—Å
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    cell.set(cell.get() + 1);  // –Ü–Ω–∫—Ä–µ–º–µ–Ω—Ç
    println!("–ü—ñ—Å–ª—è —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É: {}", cell.get()); // 201
    
    cell.set(cell.get() * 2);  // –ü–æ–¥–≤–æ—î–Ω–Ω—è
    println!("–ü—ñ—Å–ª—è –ø–æ–¥–≤–æ—î–Ω–Ω—è: {}", cell.get());  // 402
}
```

–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É—î–º–æ —Ü—é –ø—Ä–æ–≥—Ä–∞–º—É:

1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è: `Cell::new(42)` —Å—Ç–≤–æ—Ä—é—î Cell —ñ–∑ –ø–æ—á–∞—Ç–∫–æ–≤–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º 42.

2. –ß–∏—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ get(): –ú–µ—Ç–æ–¥ –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–ø—ñ—é –∑–Ω–∞—á–µ–Ω–Ω—è. –í–∞–∂–ª–∏–≤–æ —Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ —Ü–µ —Å–∞–º–µ –∫–æ–ø—ñ—è ‚Äî –∑–º—ñ–Ω–Ω–∞ `value` –Ω–µ –ø–æ–≤'—è–∑–∞–Ω–∞ –∑ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–º —Å—Ç–∞–Ω–æ–º Cell.

3. –ó–∞–ø–∏—Å —á–µ—Ä–µ–∑ set(): –ú–µ—Ç–æ–¥ –ø—Ä–∏–π–º–∞—î –Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –∑–∞–º—ñ–Ω—é—î –Ω–∏–º —Å—Ç–∞—Ä–µ. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ set() –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –Ω–∞ `&self` (—ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è), –∞–ª–µ –≤—Å–µ –æ–¥–Ω–æ –∑–º—ñ–Ω—é—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞–Ω ‚Äî —Ü–µ —ñ —î —Å—É—Ç—å –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ.

4. –ü–∞—Ç–µ—Ä–Ω "—á–∏—Ç–∞–Ω–Ω—è-–º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è-–∑–∞–ø–∏—Å": –î–ª—è –∑–º—ñ–Ω–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –π–æ–≥–æ (`get()`), –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏, —ñ –∑–∞–ø–∏—Å–∞—Ç–∏ –Ω–∞–∑–∞–¥ (`set()`). –¶–µ —Ç—Ä–æ—Ö–∏ –±–∞–≥–∞—Ç–æ—Å–ª—ñ–≤–Ω—ñ—à–µ, –Ω—ñ–∂ `*x += 1`, –∞–ª–µ –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.

---

## 31.2 –ú–µ—Ç–æ–¥–∏ Cell

### 31.2.1 –ü–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä –º–µ—Ç–æ–¥—ñ–≤

Cell –Ω–∞–¥–∞—î –∫—ñ–ª—å–∫–∞ –∫–æ—Ä–∏—Å–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –æ–∫—Ä—ñ–º –±–∞–∑–æ–≤–∏—Ö get —Ç–∞ set. –†–æ–∑–≥–ª—è–Ω–µ–º–æ —ó—Ö —É—Å—ñ –Ω–∞ –æ–¥–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ.

```rust
use std::cell::Cell;

fn main() {
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    println!("                    –ú–ï–¢–û–î–ò CELL                                 ");
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // get() —Ç–∞ set() ‚Äî –±–∞–∑–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("1. get() —Ç–∞ set()");
    let cell = Cell::new(10);
    println!("   –ü–æ—á–∞—Ç–∫–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è: {}", cell.get());
    cell.set(20);
    println!("   –ü—ñ—Å–ª—è set(20): {}", cell.get());
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // replace() ‚Äî –∑–∞–º—ñ–Ω–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Å—Ç–∞—Ä–µ
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("\n2. replace() ‚Äî –∑–∞–º—ñ–Ω–∞ –∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º —Å—Ç–∞—Ä–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è");
    let cell = Cell::new(100);
    let old_value = cell.replace(200);
    println!("   –°—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è: {}", old_value);  // 100
    println!("   –ù–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è: {}", cell.get());   // 200
    
    // replace() –∫–æ—Ä–∏—Å–Ω–∏–π, –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ —ñ –∑–∞–º—ñ–Ω–∏—Ç–∏, —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Å—Ç–∞—Ä–µ
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // take() ‚Äî –∑–∞–±—Ä–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è, –∑–∞–ª–∏—à–∏—Ç–∏ Default
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("\n3. take() ‚Äî –∑–∞–±—Ä–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è (–≤–∏–º–∞–≥–∞—î T: Default)");
    let cell = Cell::new(42);
    let taken = cell.take();  // –ó–∞–±–∏—Ä–∞—î 42, –∑–∞–ª–∏—à–∞—î 0 (Default –¥–ª—è i32)
    println!("   –ó–∞–±—Ä–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è: {}", taken);    // 42
    println!("   –ó–∞–ª–∏—à–æ–∫ —É Cell: {}", cell.get()); // 0
    
    // take() –∑—Ä—É—á–Ω–∏–π –¥–ª—è "—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è" –∑–Ω–∞—á–µ–Ω–Ω—è –∑ Cell
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // swap() ‚Äî –æ–±–º—ñ–Ω –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –º—ñ–∂ –¥–≤–æ–º–∞ Cell
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("\n4. swap() ‚Äî –æ–±–º—ñ–Ω –º—ñ–∂ –¥–≤–æ–º–∞ Cell");
    let cell_a = Cell::new(1);
    let cell_b = Cell::new(2);
    println!("   –î–æ swap: a={}, b={}", cell_a.get(), cell_b.get());
    
    cell_a.swap(&cell_b);
    println!("   –ü—ñ—Å–ª—è swap: a={}, b={}", cell_a.get(), cell_b.get());
    // a=2, b=1
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // update() ‚Äî –∑–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ –∑–Ω–∞—á–µ–Ω–Ω—è
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("\n5. update() ‚Äî –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü—ñ—é");
    let cell = Cell::new(5);
    
    // update() –æ—Ç—Ä–∏–º—É—î —Ñ—É–Ω–∫—Ü—ñ—é T -> T
    cell.update(|x| x * 2);
    println!("   –ü—ñ—Å–ª—è update(|x| x * 2): {}", cell.get()); // 10
    
    cell.update(|x| x + 3);
    println!("   –ü—ñ—Å–ª—è update(|x| x + 3): {}", cell.get()); // 13
    
    // –ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —É–º–æ–≤–∏
    cell.update(|x| if x > 10 { x - 5 } else { x + 5 });
    println!("   –ü—ñ—Å–ª—è —É–º–æ–≤–Ω–æ–≥–æ update: {}", cell.get()); // 8
}
```

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –∫–æ–∂–µ–Ω –º–µ—Ç–æ–¥ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ:

1. get() —Ç–∞ set() ‚Äî –±–∞–∑–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å—É. get() –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–ø—ñ—é, set() –∑–∞–≤–∂–¥–∏ –∑–∞–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–≤–Ω—ñ—Å—Ç—é.

2. replace(new_value) ‚Äî –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è get() —Ç–∞ set() –≤ –æ–¥–Ω—ñ–π –∞—Ç–æ–º–∞—Ä–Ω—ñ–π –æ–ø–µ—Ä–∞—Ü—ñ—ó. –ó–∞–º—ñ–Ω—é—î –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –Ω–æ–≤–µ —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ä–µ. –ö–æ—Ä–∏—Å–Ω–æ, –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è, —ñ –∑–∞–ø–∏—Å–∞—Ç–∏ –Ω–æ–≤–µ.

3. take() ‚Äî –∑–∞–±–∏—Ä–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑ Cell, –∑–∞–ª–∏—à–∞—é—á–∏ –Ω–∞ –π–æ–≥–æ –º—ñ—Å—Ü—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (Default). –ü—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ç–∏–ø—ñ–≤, —â–æ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å Default. –î–ª—è —á–∏—Å–µ–ª —Ü–µ 0, –¥–ª—è bool ‚Äî false.

4. swap(&other_cell) ‚Äî –æ–±–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è –º—ñ–∂ –¥–≤–æ–º–∞ Cell —Ç–æ–≥–æ —Å–∞–º–æ–≥–æ —Ç–∏–ø—É. –ñ–æ–¥–µ–Ω –∑ Cell –Ω–µ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è "–ø–æ—Ä–æ–∂–Ω—ñ–º".

5. update(f) ‚Äî –ø—Ä–∏–π–º–∞—î –∑–∞–º–∏–∫–∞–Ω–Ω—è (closure), —â–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –∑–Ω–∞—á–µ–Ω–Ω—è. –ï–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–Ω–æ `cell.set(f(cell.get()))`, –∞–ª–µ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ —á–∏—Å—Ç—ñ—à–µ ‚Äî –ø–æ–∫–∞–∑—É—î –Ω–∞–º—ñ—Ä –º–æ–¥–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è "–Ω–∞ –º—ñ—Å—Ü—ñ".

### 31.2.2 –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑ RefCell

–í–∞–∂–ª–∏–≤–æ —Ä–æ–∑—É–º—ñ—Ç–∏, –∫–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Cell, –∞ –∫–æ–ª–∏ RefCell. –ù–∞—Å—Ç—É–ø–Ω–∞ —Ç–∞–±–ª–∏—Ü—è —É–∑–∞–≥–∞–ª—å–Ω—é—î –∫–ª—é—á–æ–≤—ñ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ:

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Cell\<T\> | RefCell\<T\> |
|----------------|-----------|--------------|
| –û–±–º–µ–∂–µ–Ω–Ω—è —Ç–∏–ø—É | T: Copy | –ë—É–¥—å-—è–∫–∏–π T |
| –°–ø–æ—Å—ñ–± –¥–æ—Å—Ç—É–ø—É | –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è (get/set) | –ü–æ–∑–∏—á–∞–Ω–Ω—è (borrow/borrow_mut) |
| –ù–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ (–ø—Ä–æ—Å—Ç–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è) | –õ—ñ—á–∏–ª—å–Ω–∏–∫ –ø–æ–∑–∏—á–∞–Ω—å |
| –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–∞–Ω—ñ–∫–∏ | –ù–µ–º–æ–∂–ª–∏–≤–∞ | –ü—Ä–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ –ø–æ–∑–∏—á–∞–Ω—å |
| –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è | –ù–µ–º–æ–∂–ª–∏–≤–æ | –¢–∞–∫ (Ref, RefMut) |
| –¢–∏–ø–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è | –õ—ñ—á–∏–ª—å–Ω–∏–∫–∏, –ø—Ä–∞–ø–æ—Ä—Ü—ñ, –ø—Ä–æ—Å—Ç—ñ —Å—Ç–∞–Ω–∏ | –ö–æ–ª–µ–∫—Ü—ñ—ó, —Å–∫–ª–∞–¥–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ |

---

## 31.3 –ü—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è Cell –¥–ª—è –∞–≥–µ–Ω—Ç–∞

### 31.3.1 –õ—ñ—á–∏–ª—å–Ω–∏–∫–∏ —Ç–∞ –ø—Ä–∞–ø–æ—Ä—Ü—ñ —Å—Ç–∞–Ω—É

–†–æ–∑–≥–ª—è–Ω–µ–º–æ —Ç–∏–ø–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞–≥–µ–Ω—Ç–∞ –ë–ü–õ–ê, –¥–µ Cell –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–æ—Å—Ç–∏—Ö –ø–æ–ª—ñ–≤, —â–æ —á–∞—Å—Ç–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è. –¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫ Cell –¥–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Å—Ç–∞–Ω –∞–≥–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.

```rust
use std::cell::Cell;

/// –ê–≥–µ–Ω—Ç –ë–ü–õ–ê –∑ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–º –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Cell
/// –¥–ª—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤, —â–æ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å Copy
struct Agent {
    // –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä ‚Äî String, –Ω–µ Copy, —Ç–æ–º—É –∑–≤–∏—á–∞–π–Ω–µ –ø–æ–ª–µ
    id: String,
    
    // –õ—ñ—á–∏–ª—å–Ω–∏–∫–∏ ‚Äî —ñ–¥–µ–∞–ª—å–Ω—ñ –∫–∞–Ω–¥–∏–¥–∞—Ç–∏ –¥–ª—è Cell
    steps_taken: Cell<u32>,
    scans_performed: Cell<u32>,
    messages_sent: Cell<u32>,
    
    // –ü—Ä–∞–ø–æ—Ä—Ü—ñ —Å—Ç–∞–Ω—É ‚Äî —Ç–µ–∂ Cell
    is_active: Cell<bool>,
    needs_charging: Cell<bool>,
    is_returning_to_base: Cell<bool>,
    
    // –ß–∏—Å–ª–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
    battery_level: Cell<u8>,
    current_altitude: Cell<f64>,
    heading: Cell<f64>,  // –ù–∞–ø—Ä—è–º–æ–∫ —É –≥—Ä–∞–¥—É—Å–∞—Ö
}

impl Agent {
    /// –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∑ –ø–æ—á–∞—Ç–∫–æ–≤–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏
    fn new(id: &str) -> Self {
        Self {
            id: id.to_string(),
            steps_taken: Cell::new(0),
            scans_performed: Cell::new(0),
            messages_sent: Cell::new(0),
            is_active: Cell::new(true),
            needs_charging: Cell::new(false),
            is_returning_to_base: Cell::new(false),
            battery_level: Cell::new(100),
            current_altitude: Cell::new(0.0),
            heading: Cell::new(0.0),
        }
    }
    
    /// –í–∏–∫–æ–Ω—É—î –æ–¥–∏–Ω –∫—Ä–æ–∫ —Ä—É—Ö—É
    /// –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É: –º–µ—Ç–æ–¥ –ø—Ä–∏–π–º–∞—î &self, –Ω–µ &mut self
    fn step(&self) {
        // –ó–±—ñ–ª—å—à—É—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ –∫—Ä–æ–∫—ñ–≤
        self.steps_taken.set(self.steps_taken.get() + 1);
        
        // –í–∏—Ç—Ä–∞—á–∞—î–º–æ –±–∞—Ç–∞—Ä–µ—é
        self.consume_battery(1);
    }
    
    /// –í–∏–∫–æ–Ω—É—î —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –º—ñ—Å—Ü–µ–≤–æ—Å—Ç—ñ
    fn scan(&self) {
        self.scans_performed.set(self.scans_performed.get() + 1);
        
        // –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è –≤–∏—Ç—Ä–∞—á–∞—î –±—ñ–ª—å—à–µ –µ–Ω–µ—Ä–≥—ñ—ó
        self.consume_battery(5);
    }
    
    /// –ù–∞–¥—Å–∏–ª–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    fn send_message(&self) {
        self.messages_sent.set(self.messages_sent.get() + 1);
        self.consume_battery(2);
    }
    
    /// –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –±–∞—Ç–∞—Ä–µ—ó
    fn consume_battery(&self, amount: u8) {
        // saturating_sub –∑–∞–ø–æ–±—ñ–≥–∞—î –ø–µ—Ä–µ–ø–æ–≤–Ω–µ–Ω–Ω—é (–Ω–µ —Å—Ç–∞–Ω–µ –≤—ñ–¥'—î–º–Ω–∏–º)
        let new_level = self.battery_level.get().saturating_sub(amount);
        self.battery_level.set(new_level);
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–ø–æ—Ä—Ü—ñ –ø—Ä–∏ –Ω–∏–∑—å–∫–æ–º—É –∑–∞—Ä—è–¥—ñ
        if new_level < 20 {
            self.needs_charging.set(true);
        }
        
        if new_level < 10 {
            self.is_returning_to_base.set(true);
        }
    }
    
    /// –ü—ñ–¥–Ω—ñ–º–∞—î –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –∑–∞–¥–∞–Ω—É –≤–∏—Å–æ—Ç—É
    fn ascend_to(&self, altitude: f64) {
        self.current_altitude.set(altitude);
        // –ü—ñ–¥–π–æ–º –≤–∏—Ç—Ä–∞—á–∞—î –µ–Ω–µ—Ä–≥—ñ—é
        self.consume_battery(3);
    }
    
    /// –ó–º—ñ–Ω—é—î –Ω–∞–ø—Ä—è–º–æ–∫ —Ä—É—Ö—É
    fn set_heading(&self, degrees: f64) {
        // –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –¥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É 0-360
        let normalized = degrees.rem_euclid(360.0);
        self.heading.set(normalized);
    }
    
    /// –î–µ–∞–∫—Ç–∏–≤—É—î –∞–≥–µ–Ω—Ç–∞
    fn deactivate(&self) {
        self.is_active.set(false);
    }
    
    /// –ü–æ–≤–µ—Ä—Ç–∞—î —Ç–µ–∫—Å—Ç–æ–≤–∏–π –∑–≤—ñ—Ç –ø—Ä–æ —Å—Ç–∞–Ω –∞–≥–µ–Ω—Ç–∞
    fn status_report(&self) -> String {
        format!(
            "–ê–≥–µ–Ω—Ç {}: –±–∞—Ç–∞—Ä–µ—è={}%, –∫—Ä–æ–∫—ñ–≤={}, —Å–∫–∞–Ω—ñ–≤={}, –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å={}, \
             –∞–∫—Ç–∏–≤–Ω–∏–π={}, –ø–æ—Ç—Ä–µ–±—É—î –∑–∞—Ä—è–¥–∫–∏={}, –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è={}",
            self.id,
            self.battery_level.get(),
            self.steps_taken.get(),
            self.scans_performed.get(),
            self.messages_sent.get(),
            self.is_active.get(),
            self.needs_charging.get(),
            self.is_returning_to_base.get()
        )
    }
}

fn main() {
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    println!("           –ê–ì–ï–ù–¢ –ó CELL –î–õ–Ø –í–ù–£–¢–†–Ü–®–ù–¨–û–á –ú–£–¢–ê–ë–ï–õ–¨–ù–û–°–¢–Ü          ");
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    let agent = Agent::new("SCOUT-001");
    
    println!("–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω:");
    println!("{}\n", agent.status_report());
    
    // –°–∏–º—É–ª—é—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∞–≥–µ–Ω—Ç–∞
    println!("–í–∏–∫–æ–Ω—É—î–º–æ –æ–ø–µ—Ä–∞—Ü—ñ—ó...");
    
    agent.ascend_to(100.0);
    println!("   –ü—ñ–¥–Ω—è–≤—Å—è –Ω–∞ –≤–∏—Å–æ—Ç—É 100–º");
    
    for _ in 0..10 {
        agent.step();
    }
    println!("   –ó—Ä–æ–±–∏–≤ 10 –∫—Ä–æ–∫—ñ–≤");
    
    agent.scan();
    agent.scan();
    println!("   –í–∏–∫–æ–Ω–∞–≤ 2 —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è");
    
    agent.send_message();
    println!("  –ù–∞–¥—ñ—Å–ª–∞–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è");
    
    agent.set_heading(45.0);
    println!("  –ó–º—ñ–Ω–∏–≤ –Ω–∞–ø—Ä—è–º–æ–∫ –Ω–∞ 45¬∞");
    
    println!("\n–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:");
    println!("{}", agent.status_report());
    
    // –ü—Ä–æ–¥–æ–≤–∂—É—î–º–æ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ –±–∞—Ç–∞—Ä–µ—é
    println!("\n–í–∏—Ç—Ä–∞—á–∞—î–º–æ –±–∞—Ç–∞—Ä–µ—é...");
    for _ in 0..50 {
        agent.step();
    }
    
    println!("\n–§—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω:");
    println!("{}", agent.status_report());
}
```

–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É—î–º–æ –∫–ª—é—á–æ–≤—ñ –∞—Å–ø–µ–∫—Ç–∏ —Ü—ñ—î—ó –ø—Ä–æ–≥—Ä–∞–º–∏:

1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Agent –º–∞—î –∑–º—ñ—à–∞–Ω—ñ –ø–æ–ª—è: `id` ‚Äî –∑–≤–∏—á–∞–π–Ω–∏–π String, –∞ –≤—Å—ñ —á–∏—Å–ª–æ–≤—ñ —Ç–∞ –±—É–ª–µ–≤—ñ –ø–æ–ª—è –æ–±–≥–æ—Ä–Ω—É—Ç—ñ –≤ Cell. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —ó—Ö —á–µ—Ä–µ–∑ `&self`.

2. –ú–µ—Ç–æ–¥–∏ –ø—Ä–∏–π–º–∞—é—Ç—å `&self`, –∞ –Ω–µ `&mut self`. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∞–≥–µ–Ω—Ç –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —É —Ñ—É–Ω–∫—Ü—ñ—ó —á–µ—Ä–µ–∑ —ñ–º–º—É—Ç–∞–±–µ–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, —ñ –≤—Å–µ –æ–¥–Ω–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –π–æ–≥–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞–Ω.

3. –ü–∞—Ç–µ—Ä–Ω get-modify-set: –¥–ª—è —ñ–Ω–∫—Ä–µ–º–µ–Ω—Ç—É –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –ø–∏—à–µ–º–æ `self.steps_taken.set(self.steps_taken.get() + 1)`. –¶–µ —Ç—Ä–æ—Ö–∏ –¥–æ–≤—à–µ, –Ω—ñ–∂ `self.steps_taken += 1`, –∞–ª–µ –ø—Ä–∞—Ü—é—î –±–µ–∑ –º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.

4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø—Ä–∞–ø–æ—Ä—Ü—ñ: –º–µ—Ç–æ–¥ `consume_battery` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î –ø—Ä–∞–ø–æ—Ä—Ü—ñ `needs_charging` —Ç–∞ `is_returning_to_base` –ø—Ä–∏ –Ω–∏–∑—å–∫–æ–º—É –∑–∞—Ä—è–¥—ñ. –¶–µ –ø—Ä–∏–∫–ª–∞–¥ —ñ–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—ó –ª–æ–≥—ñ–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏.

### 31.3.2 –ö–µ—à—É–≤–∞–Ω–Ω—è –æ–±—á–∏—Å–ª–µ–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å

Cell –¥–æ–±—Ä–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –æ–±—á–∏—Å–ª–µ–Ω—å, –æ—Å–æ–±–ª–∏–≤–æ –∫–æ–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ø—Ä–æ—Å—Ç–µ –∑–Ω–∞—á–µ–Ω–Ω—è. –ù–∞—Å—Ç—É–ø–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –∫–µ—à—É–≤–∞–Ω–Ω—è –≤—ñ–¥—Å—Ç–∞–Ω—ñ –º—ñ–∂ –¥–≤–æ–º–∞ —Ç–æ—á–∫–∞–º–∏.

```rust
use std::cell::Cell;

/// –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤—ñ–¥—Å—Ç–∞–Ω—ñ –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
/// –Ø–∫—â–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø–∏—Ç—É—é—Ç—å –≤—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ —Ç–∏–º–∏ —Å–∞–º–∏–º–∏ —Ç–æ—á–∫–∞–º–∏,
/// –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–∞–∫–µ—à–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–µ–∑ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É
struct DistanceCalculator {
    // –ö–µ—à—É—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è
    last_from: Cell<(i32, i32)>,
    last_to: Cell<(i32, i32)>,
    cached_distance: Cell<Option<f64>>,
    
    // –õ—ñ—á–∏–ª—å–Ω–∏–∫ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–µ—à—É
    cache_hits: Cell<u32>,
    cache_misses: Cell<u32>,
}

impl DistanceCalculator {
    fn new() -> Self {
        Self {
            last_from: Cell::new((0, 0)),
            last_to: Cell::new((0, 0)),
            cached_distance: Cell::new(None),
            cache_hits: Cell::new(0),
            cache_misses: Cell::new(0),
        }
    }
    
    /// –û–±—á–∏—Å–ª—é—î –≤—ñ–¥—Å—Ç–∞–Ω—å –º—ñ–∂ –¥–≤–æ–º–∞ —Ç–æ—á–∫–∞–º–∏
    /// –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∫–µ—à, —è–∫—â–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –Ω–µ –∑–º—ñ–Ω–∏–ª–∏—Å—å
    fn distance(&self, from: (i32, i32), to: (i32, i32)) -> f64 {
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —Å–ø—ñ–≤–ø–∞–¥–∞—é—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑ –∑–∞–∫–µ—à–æ–≤–∞–Ω–∏–º–∏
        if from == self.last_from.get() && to == self.last_to.get() {
            // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Å–ø—ñ–≤–ø–∞–ª–∏ ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            if let Some(cached) = self.cached_distance.get() {
                // Cache hit!
                self.cache_hits.set(self.cache_hits.get() + 1);
                return cached;
            }
        }
        
        // Cache miss ‚Äî –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—á–∏—Å–ª—é–≤–∞—Ç–∏
        self.cache_misses.set(self.cache_misses.get() + 1);
        
        // –û–±—á–∏—Å–ª—é—î–º–æ –≤—ñ–¥—Å—Ç–∞–Ω—å –∑–∞ —Ñ–æ—Ä–º—É–ª–æ—é –ï–≤–∫–ª—ñ–¥–∞
        let dx = (to.0 - from.0) as f64;
        let dy = (to.1 - from.1) as f64;
        let distance = (dx * dx + dy * dy).sqrt();
        
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —É –∫–µ—à
        self.last_from.set(from);
        self.last_to.set(to);
        self.cached_distance.set(Some(distance));
        
        distance
    }
    
    /// –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–µ—à—É
    fn cache_stats(&self) -> String {
        let hits = self.cache_hits.get();
        let misses = self.cache_misses.get();
        let total = hits + misses;
        let hit_rate = if total > 0 {
            (hits as f64 / total as f64) * 100.0
        } else {
            0.0
        };
        
        format!(
            "–í–ª—É—á–µ–Ω—å: {}, –ü—Ä–æ–º–∞—Ö—ñ–≤: {}, –í—ñ–¥—Å–æ—Ç–æ–∫ –≤–ª—É—á–µ–Ω—å: {:.1}%",
            hits, misses, hit_rate
        )
    }
}

fn main() {
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    println!("              –ö–ï–®–£–í–ê–ù–ù–Ø –û–ë–ß–ò–°–õ–ï–ù–¨ –ó CELL                       ");
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    let calc = DistanceCalculator::new();
    
    // –ü–µ—Ä—à–µ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è ‚Äî cache miss
    let d1 = calc.distance((0, 0), (3, 4));
    println!("–í—ñ–¥—Å—Ç–∞–Ω—å (0,0) ‚Üí (3,4): {}", d1);  // 5.0
    println!("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {}\n", calc.cache_stats());
    
    // –ü–æ–≤—Ç–æ—Ä–Ω–∏–π –∑–∞–ø–∏—Ç —Ç–∏—Ö —Å–∞–º–∏—Ö —Ç–æ—á–æ–∫ ‚Äî cache hit
    let d2 = calc.distance((0, 0), (3, 4));
    println!("–ó–Ω–æ–≤—É (0,0) ‚Üí (3,4): {}", d2);    // 5.0 (–∑ –∫–µ—à—É)
    println!("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {}\n", calc.cache_stats());
    
    // –©–µ —Ä–∞–∑ ‚Äî –∑–Ω–æ–≤—É cache hit
    let d3 = calc.distance((0, 0), (3, 4));
    println!("–©–µ —Ä–∞–∑ (0,0) ‚Üí (3,4): {}", d3);   // 5.0 (–∑ –∫–µ—à—É)
    println!("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {}\n", calc.cache_stats());
    
    // –ù–æ–≤—ñ —Ç–æ—á–∫–∏ ‚Äî cache miss
    let d4 = calc.distance((1, 1), (4, 5));
    println!("–ù–æ–≤—ñ —Ç–æ—á–∫–∏ (1,1) ‚Üí (4,5): {}", d4);  // 5.0
    println!("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {}\n", calc.cache_stats());
    
    // –°–∏–º—É–ª—è—Ü—ñ—è –±–∞–≥–∞—Ç—å–æ—Ö –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö —Ç–æ—á–æ–∫
    println!("–°–∏–º—É–ª—è—Ü—ñ—è 100 –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö —Ç–æ—á–æ–∫:");
    for _ in 0..100 {
        calc.distance((1, 1), (4, 5));
    }
    println!("–§—ñ–Ω–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {}", calc.cache_stats());
}
```

–£ —Ü—ñ–π –ø—Ä–æ–≥—Ä–∞–º—ñ Cell –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è:

1. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è (`last_from`, `last_to`) –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É.

2. –ó–∞–∫–µ—à–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (`cached_distance`) ‚Äî —Ü–µ `Cell<Option<f64>>`. Option –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Ä—ñ–∑–Ω–∏—Ç–∏ "—â–µ –Ω–µ –æ–±—á–∏—Å–ª—é–≤–∞–ª–∏" –≤—ñ–¥ "–æ–±—á–∏—Å–ª–∏–ª–∏ —ñ –æ—Ç—Ä–∏–º–∞–ª–∏ 0".

3. –õ—ñ—á–∏–ª—å–Ω–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (`cache_hits`, `cache_misses`) –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—Ç—å –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫–µ—à—É–≤–∞–Ω–Ω—è.

–í–µ—Å—å —Ü–µ–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ `&self`, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–µ–∑ –º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è.

---

## 31.4 OnceCell: –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è

### 31.4.1 –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è OnceCell

OnceCell ‚Äî —Ü–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —â–æ –º–æ–∂–µ –±—É—Ç–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑. –ü—ñ—Å–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–µ–∑–º—ñ–Ω–Ω–∏–º. –¶–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è:

- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π, —â–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
- –ö–µ—à–æ–≤–∞–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å, —â–æ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–º—ñ–Ω—é—é—Ç—å—Å—è
- –õ—ñ–Ω–∏–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ä–µ—Å—É—Ä—Å–æ–º—ñ—Å—Ç–∫–∏—Ö –æ–±'—î–∫—Ç—ñ–≤

–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ Cell, OnceCell –ø—Ä–∞—Ü—é—î –∑ –±—É–¥—å-—è–∫–∏–º–∏ —Ç–∏–ø–∞–º–∏ (–Ω–µ —Ç—ñ–ª—å–∫–∏ Copy), –æ—Å–∫—ñ–ª—å–∫–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ –∫–æ–ø—ñ—é—î—Ç—å—Å—è ‚Äî –≤–æ–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ —ñ –ø–æ—Ç—ñ–º –≤–∏–¥–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.

–ù–∞—Å—Ç—É–ø–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –±–∞–∑–æ–≤—É —Ä–æ–±–æ—Ç—É OnceCell.

```rust
use std::cell::OnceCell;

fn main() {
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    println!("                    ONCECELL ‚Äî –ë–ê–ó–û–í–ï –í–ò–ö–û–†–ò–°–¢–ê–ù–ù–Ø             ");
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π OnceCell
    let cell: OnceCell<String> = OnceCell::new();
    
    // –°–ø–æ—á–∞—Ç–∫—É –∫–æ–º—ñ—Ä–∫–∞ –ø–æ—Ä–æ–∂–Ω—è
    println!("1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ä–æ–∂–Ω—å–æ—ó –∫–æ–º—ñ—Ä–∫–∏:");
    println!("   cell.get() = {:?}", cell.get());  // None
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // –ü–µ—Ä—à–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ‚Äî —É—Å–ø—ñ—Ö
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("\n2. –ü–µ—Ä—à–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è:");
    let result = cell.set(String::from("–ü—Ä–∏–≤—ñ—Ç, —Å–≤—ñ—Ç–µ!"));
    match result {
        Ok(()) => println!("   –¢–∞–∫, –£—Å–ø—ñ—à–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ"),
        Err(val) => println!("   –ù—ñ, –ü–æ–º–∏–ª–∫–∞: –∑–Ω–∞—á–µ–Ω–Ω—è {} –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–æ", val),
    }
    println!("   cell.get() = {:?}", cell.get());  // Some("–ü—Ä–∏–≤—ñ—Ç, —Å–≤—ñ—Ç–µ!")
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // –î—Ä—É–≥–∞ —Å–ø—Ä–æ–±–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó ‚Äî –Ω–µ–≤–¥–∞—á–∞
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("\n3. –°–ø—Ä–æ–±–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó:");
    let result = cell.set(String::from("–Ü–Ω—à–µ –∑–Ω–∞—á–µ–Ω–Ω—è"));
    match result {
        Ok(()) => println!("   –¢–∞–∫, –£—Å–ø—ñ—à–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ"),
        Err(val) => println!("   –ù—ñ, –ü–æ–º–∏–ª–∫–∞: –∑–Ω–∞—á–µ–Ω–Ω—è '{}' –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ", val),
    }
    
    // –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ –∑–º—ñ–Ω–∏–ª–æ—Å—å
    println!("   cell.get() = {:?}", cell.get());  // –í—Å–µ —â–µ "–ü—Ä–∏–≤—ñ—Ç, —Å–≤—ñ—Ç–µ!"
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // –ë–µ–∑–ø–µ—á–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∑–Ω–∞—á–µ–Ω–Ω—è
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("\n4. –î–æ—Å—Ç—É–ø –¥–æ –∑–Ω–∞—á–µ–Ω–Ω—è:");
    
    // get() –ø–æ–≤–µ—Ä—Ç–∞—î Option<&T>
    if let Some(value) = cell.get() {
        println!("   –ó–Ω–∞—á–µ–Ω–Ω—è: {}", value);
    }
    
    // get().unwrap() ‚Äî —è–∫—â–æ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
    // (–Ω–µ–±–µ–∑–ø–µ—á–Ω–æ –¥–ª—è –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ OnceCell)
}
```

### 31.4.2 –õ—ñ–Ω–∏–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑ get_or_init

–ù–∞–π—á–∞—Å—Ç—ñ—à–µ OnceCell –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑ –º–µ—Ç–æ–¥–æ–º `get_or_init()`, —è–∫–∏–π –∞–±–æ –ø–æ–≤–µ—Ä—Ç–∞—î —ñ—Å–Ω—É—é—á–µ –∑–Ω–∞—á–µ–Ω–Ω—è, –∞–±–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –∫–æ–º—ñ—Ä–∫—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–µ—Ä–µ–¥–∞–Ω–æ–≥–æ –∑–∞–º–∏–∫–∞–Ω–Ω—è.

```rust
use std::cell::OnceCell;

fn main() {
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    println!("               GET_OR_INIT ‚Äî –õ–Ü–ù–ò–í–ê –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø              ");
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    let cell: OnceCell<String> = OnceCell::new();
    
    println!("OnceCell —Å—Ç–≤–æ—Ä–µ–Ω–æ, –∞–ª–µ —â–µ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ.\n");
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // –ü–µ—Ä—à–∏–π –≤–∏–∫–ª–∏–∫ get_or_init ‚Äî —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("–ü–µ—Ä—à–∏–π –≤–∏–∫–ª–∏–∫ get_or_init:");
    let value = cell.get_or_init(|| {
        println!("   –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...");
        println!("   (—Ç—É—Ç –º–æ–≥–ª–æ –± –±—É—Ç–∏ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É, –∑–∞–ø–∏—Ç –¥–æ –ë–î —Ç–æ—â–æ)");
        String::from("–û–±—á–∏—Å–ª–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è")
    });
    println!("   –†–µ–∑—É–ª—å—Ç–∞—Ç: '{}'\n", value);
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // –î—Ä—É–≥–∏–π –≤–∏–∫–ª–∏–∫ ‚Äî —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ù–ï –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("–î—Ä—É–≥–∏–π –≤–∏–∫–ª–∏–∫ get_or_init:");
    let value = cell.get_or_init(|| {
        println!("   –¶–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ù–Ü–ö–û–õ–ò –Ω–µ –∑'—è–≤–∏—Ç—å—Å—è!");
        String::from("–¶–µ –∑–Ω–∞—á–µ–Ω–Ω—è –ù–Ü–ö–û–õ–ò –Ω–µ –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ")
    });
    println!("   –†–µ–∑—É–ª—å—Ç–∞—Ç: '{}'\n", value);
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // –¢—Ä–µ—Ç—ñ–π, —á–µ—Ç–≤–µ—Ä—Ç–∏–π... ‚Äî –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è —Ç–µ —Å–∞–º–µ –∑–Ω–∞—á–µ–Ω–Ω—è
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("–ü–æ–¥–∞–ª—å—à—ñ –≤–∏–∫–ª–∏–∫–∏:");
    for i in 3..=5 {
        let value = cell.get_or_init(|| {
            unreachable!("–¶–µ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è")
        });
        println!("   –í–∏–∫–ª–∏–∫ {}: '{}'", i, value);
    }
}
```

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –∫–ª—é—á–æ–≤—É –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å: –∑–∞–º–∏–∫–∞–Ω–Ω—è (closure), –ø–µ—Ä–µ–¥–∞–Ω–µ –≤ `get_or_init()`, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–ª–∏–∫—É. –ü—Ä–∏ –≤—Å—ñ—Ö –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –≤–∏–∫–ª–∏–∫–∞—Ö –≤–æ–Ω–æ —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è, —ñ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –∑–∞–∫–µ—à–æ–≤–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è.

### 31.4.3 OnceCell –¥–ª—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∞–≥–µ–Ω—Ç–∞

–¢–∏–ø–æ–≤–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è OnceCell ‚Äî –ª—ñ–Ω–∏–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ —ñ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ.

```rust
use std::cell::OnceCell;

/// –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∞–≥–µ–Ω—Ç–∞ ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑
#[derive(Debug)]
struct AgentConfig {
    max_speed: f64,           // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å, –º/—Å
    scan_radius: f64,         // —Ä–∞–¥—ñ—É—Å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è, –º
    battery_threshold: u8,    // –ø–æ—Ä—ñ–≥ –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è, %
    communication_range: f64, // –¥–∞–ª—å–Ω—ñ—Å—Ç—å –∑–≤'—è–∑–∫—É, –º
}

impl AgentConfig {
    /// –°–∏–º—É–ª—è—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
    /// –£ —Ä–µ–∞–ª—å–Ω—ñ–π —Å–∏—Å—Ç–µ–º—ñ —Ç—É—Ç –±—É–ª–æ –± —á–∏—Ç–∞–Ω–Ω—è –∑ —Ñ–∞–π–ª—É –∞–±–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
    fn load(agent_id: &str) -> Self {
        println!("   üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –¥–ª—è {}...", agent_id);
        println!("   üìÇ (—Å–∏–º—É–ª—è—Ü—ñ—è –∑–∞—Ç—Ä–∏–º–∫–∏ —á–∏—Ç–∞–Ω–Ω—è –∑ —Ñ–∞–π–ª—É)");
        
        // –Ü–º—ñ—Ç—É—î–º–æ —Ä—ñ–∑–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –∞–≥–µ–Ω—Ç—ñ–≤
        if agent_id.starts_with("SCOUT") {
            Self {
                max_speed: 15.0,
                scan_radius: 100.0,
                battery_threshold: 15,
                communication_range: 500.0,
            }
        } else if agent_id.starts_with("COMBAT") {
            Self {
                max_speed: 25.0,
                scan_radius: 50.0,
                battery_threshold: 20,
                communication_range: 300.0,
            }
        } else {
            Self {
                max_speed: 10.0,
                scan_radius: 75.0,
                battery_threshold: 25,
                communication_range: 400.0,
            }
        }
    }
}

/// –ê–≥–µ–Ω—Ç –∑ –ª—ñ–Ω–∏–≤–∏–º –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
struct Agent {
    id: String,
    config: OnceCell<AgentConfig>,
}

impl Agent {
    fn new(id: &str) -> Self {
        println!(" –°—Ç–≤–æ—Ä—é—î–º–æ –∞–≥–µ–Ω—Ç–∞ {}...", id);
        Self {
            id: id.to_string(),
            config: OnceCell::new(),
        }
    }
    
    /// –ü–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
    /// –ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–ª–∏–∫—É ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î, –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î –∑ –∫–µ—à—É
    fn config(&self) -> &AgentConfig {
        self.config.get_or_init(|| {
            AgentConfig::load(&self.id)
        })
    }
    
    /// –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
    fn max_speed(&self) -> f64 {
        self.config().max_speed
    }
    
    fn can_communicate_at(&self, distance: f64) -> bool {
        distance <= self.config().communication_range
    }
    
    fn should_return(&self, battery_level: u8) -> bool {
        battery_level <= self.config().battery_threshold
    }
}

fn main() {
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    println!("           ONCECELL –î–õ–Ø –õ–Ü–ù–ò–í–û–ì–û –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–á     ");
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ –∞–≥–µ–Ω—Ç–∞ ‚Äî –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —â–µ –ù–ï –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
    let scout = Agent::new("SCOUT-001");
    println!("   –ê–≥–µ–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —â–µ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞.\n");
    
    // –ü–µ—Ä—à–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    println!(" –ü–µ—Ä—à–∏–π –∑–∞–ø–∏—Ç max_speed:");
    let speed = scout.max_speed();
    println!("   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å: {} –º/—Å\n", speed);
    
    // –ù–∞—Å—Ç—É–ø–Ω—ñ –¥–æ—Å—Ç—É–ø–∏ ‚Äî –±–µ–∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    println!(" –ù–∞—Å—Ç—É–ø–Ω—ñ –∑–∞–ø–∏—Ç–∏ (–±–µ–∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è):");
    println!("   –†–∞–¥—ñ—É—Å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è: {} –º", scout.config().scan_radius);
    println!("   –î–∞–ª—å–Ω—ñ—Å—Ç—å –∑–≤'—è–∑–∫—É: {} –º", scout.config().communication_range);
    println!("   –ü–æ—Ä—ñ–≥ –±–∞—Ç–∞—Ä–µ—ó: {}%", scout.config().battery_threshold);
    
    // –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤, —â–æ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
    println!("\n –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏:");
    println!("   –ß–∏ –º–æ–∂–µ –∑–≤'—è–∑–∞—Ç–∏—Å—è –Ω–∞ 400–º? {}", scout.can_communicate_at(400.0));
    println!("   –ß–∏ –º–∞—î –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –ø—Ä–∏ 10%? {}", scout.should_return(10));
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–Ω—à–∏–π —Ç–∏–ø –∞–≥–µ–Ω—Ç–∞
    println!("\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    let combat = Agent::new("COMBAT-001");
    println!("\n –ó–∞–ø–∏—Ç—É—î–º–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –±–æ–π–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞:");
    println!("   –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å: {} –º/—Å", combat.max_speed());
    println!("   –†–∞–¥—ñ—É—Å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è: {} –º", combat.config().scan_radius);
}
```

–ü–µ—Ä–µ–≤–∞–≥–∏ —Ç–∞–∫–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:

1. –õ—ñ–Ω–∏–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è: –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –≤–æ–Ω–∞ –¥—ñ–π—Å–Ω–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞. –Ø–∫—â–æ –∞–≥–µ–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–∏–π, –∞–ª–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–∞–ø–∏—Ç—É–≤–∞–ª–∞—Å—å ‚Äî –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–µ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è.

2. –ö–µ—à—É–≤–∞–Ω–Ω—è: –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —ñ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç.

3. –ü—Ä–æ—Å—Ç–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –º–µ—Ç–æ–¥ `config()` –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é, –ø—Ä–∏—Ö–æ–≤—É—é—á–∏ –¥–µ—Ç–∞–ª—ñ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.

4. –ë–µ–∑–ø–µ–∫–∞: OnceCell –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞ —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –º–µ—Ç–æ–¥ `config()` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—å.

---

## 31.5 LazyCell: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ª—ñ–Ω–∏–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è

### 31.5.1 –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è LazyCell

LazyCell ‚Äî —Ü–µ —â–µ –ø—Ä–æ—Å—Ç—ñ—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –ª—ñ–Ω–∏–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ OnceCell, –¥–µ —Ñ—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É `get_or_init()`, —É LazyCell —Ñ—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ —ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –¥–æ—Å—Ç—É–ø—ñ.

```rust
use std::cell::LazyCell;

fn main() {
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    println!("                    LAZYCELL ‚Äî –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ê –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø       ");
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    // –§—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ LazyCell
    // –í–æ–Ω–∞ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –¥–æ—Å—Ç—É–ø—ñ
    let lazy: LazyCell<String> = LazyCell::new(|| {
        println!("   –í–∏–∫–æ–Ω—É—î—Ç—å—Å—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è LazyCell...");
        println!("   –¶–µ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑!");
        String::from("–õ—ñ–Ω–∏–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è")
    });
    
    println!("LazyCell —Å—Ç–≤–æ—Ä–µ–Ω–æ.");
    println!("–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —â–µ –ù–ï –≤—ñ–¥–±—É–ª–∞—Å—å!\n");
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // –ü–µ—Ä—à–∏–π –¥–æ—Å—Ç—É–ø ‚Äî –≤–∏–∫–ª–∏–∫–∞—î —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("–ü–µ—Ä—à–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∑–Ω–∞—á–µ–Ω–Ω—è:");
    // Deref –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é
    println!("   –ó–Ω–∞—á–µ–Ω–Ω—è: '{}'\n", *lazy);
    
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // –ù–∞—Å—Ç—É–ø–Ω—ñ –¥–æ—Å—Ç—É–ø–∏ ‚Äî –±–µ–∑ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    println!("–ù–∞—Å—Ç—É–ø–Ω—ñ –¥–æ—Å—Ç—É–ø–∏ (–±–µ–∑ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó):");
    println!("   –ó–Ω–∞—á–µ–Ω–Ω—è: '{}'", *lazy);
    println!("   –ó–Ω–∞—á–µ–Ω–Ω—è: '{}'", *lazy);
    println!("   –î–æ–≤–∂–∏–Ω–∞: {} —Å–∏–º–≤–æ–ª—ñ–≤", lazy.len());
}
```

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –∫–ª—é—á–æ–≤—É –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å:
- OnceCell: `cell.get_or_init(|| ...)`‚Äî —Ñ—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É
- LazyCell: `*lazy` ‚Äî –ø—Ä–æ—Å—Ç–æ —Ä–æ–∑—ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è, —Ñ—É–Ω–∫—Ü—ñ—è –≤–∂–µ "–≤–±—É–¥–æ–≤–∞–Ω–∞"

### 31.5.2 –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è OnceCell —Ç–∞ LazyCell

| –ê—Å–ø–µ–∫—Ç | OnceCell | LazyCell |
|--------|----------|----------|
| –ö–æ–ª–∏ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —Ñ—É–Ω–∫—Ü—ñ—è | –ü—Ä–∏ –≤–∏–∫–ª–∏–∫—É get_or_init | –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ |
| –Ø–∫ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –¥–æ—Å—Ç—É–ø | –í–∏–∫–ª–∏–∫ –º–µ—Ç–æ–¥—É get() –∞–±–æ get_or_init() | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π Deref (*lazy) |
| –ì–Ω—É—á–∫—ñ—Å—Ç—å | –í–∏—â–∞ ‚Äî —Ä—ñ–∑–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤ | –ù–∏–∂—á–∞ ‚Äî –æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ |
| –ó—Ä—É—á–Ω—ñ—Å—Ç—å | –ü–æ—Ç—Ä—ñ–±–µ–Ω —è–≤–Ω–∏–π –≤–∏–∫–ª–∏–∫ –º–µ—Ç–æ–¥—É | –ü—Ä–æ–∑–æ—Ä–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è |
| –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ | get_or_try_init –¥–ª—è Result | –ù–µ–º–æ–∂–ª–∏–≤–∞ (—Ç—ñ–ª—å–∫–∏ –ø–∞–Ω—ñ–∫–∞) |
| –ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É | –ú–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–æ–≤–Ω—ñ—à–Ω—ñ –∑–º—ñ–Ω–Ω—ñ | –û–±–º–µ–∂–µ–Ω–∞ (–∑–∞–º–∏–∫–∞–Ω–Ω—è —Ñ—ñ–∫—Å—É—î—Ç—å—Å—è) |

### 31.5.3 –ö–æ–ª–∏ –æ–±–∏—Ä–∞—Ç–∏ OnceCell, –∞ –∫–æ–ª–∏ LazyCell

–û–±–∏—Ä–∞–π—Ç–µ OnceCell, –∫–æ–ª–∏:
- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–∂–µ –ø—Ä–æ–≤–∞–ª–∏—Ç–∏—Å—å (–ø–æ—Ç—Ä—ñ–±–µ–Ω Result)
- –§—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, –≤—ñ–¥–æ–º–∏—Ö –ø—ñ–∑–Ω—ñ—à–µ
- –ü–æ—Ç—Ä—ñ–±–Ω–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
- –ü–æ—Ç—Ä—ñ–±–µ–Ω —è–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –º–æ–º–µ–Ω—Ç–æ–º —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

–û–±–∏—Ä–∞–π—Ç–µ LazyCell, –∫–æ–ª–∏:
- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–∞
- –§—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- –•–æ—á–µ—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- –ó–Ω–∞—á–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫ –∑–≤–∏—á–∞–π–Ω–∞ –∑–º—ñ–Ω–Ω–∞

---

## 31.6 –í–∏–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É: –¥–µ—Ä–µ–≤–æ –ø—Ä–∏–π–Ω—è—Ç—Ç—è —Ä—ñ—à–µ–Ω—å

### 31.6.1 –ê–ª–≥–æ—Ä–∏—Ç–º –≤–∏–±–æ—Ä—É

–ü—Ä–∏ –≤–∏–±–æ—Ä—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –¥–ª—è –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–µ –¥–µ—Ä–µ–≤–æ —Ä—ñ—à–µ–Ω—å:

```text
–ß–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ —ñ –ø–æ—Ç—ñ–º –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è?
‚îÇ
‚îú‚îÄ –¢–ê–ö ‚Üí –ß–∏ –≤—ñ–¥–æ–º–∞ —Ñ—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ?
‚îÇ        ‚îÇ
‚îÇ        ‚îú‚îÄ –¢–ê–ö ‚Üí LazyCell<T>
‚îÇ        ‚îÇ
‚îÇ        ‚îî‚îÄ –ù–Ü (–∞–±–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫) ‚Üí OnceCell<T>
‚îÇ
‚îî‚îÄ –ù–Ü (–∑–Ω–∞—á–µ–Ω–Ω—è –∑–º—ñ–Ω—é—î—Ç—å—Å—è –±–∞–≥–∞—Ç–æ—Ä–∞–∑–æ–≤–æ) ‚Üí
         ‚îÇ
         –ß–∏ —Ç–∏–ø T —Ä–µ–∞–ª—ñ–∑—É—î Copy?
         ‚îÇ
         ‚îú‚îÄ –¢–ê–ö ‚Üí Cell<T>
         ‚îÇ        (–Ω–∞–π–µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)
         ‚îÇ
         ‚îî‚îÄ –ù–Ü ‚Üí RefCell<T>
                 (–¥–ª—è String, Vec, —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä)
```

### 31.6.2 –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Cell\<T\> | RefCell\<T\> | OnceCell\<T\> | LazyCell\<T\> |
|----------------|-----------|--------------|---------------|---------------|
| –í–∏–º–æ–≥–∞ –¥–æ T | Copy | ‚Äî | ‚Äî | ‚Äî |
| –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤ | –ë–∞–≥–∞—Ç–æ | –ë–∞–≥–∞—Ç–æ | –û–¥–∏–Ω | –û–¥–∏–Ω |
| –ü–∞–Ω—ñ–∫–∞ –º–æ–∂–ª–∏–≤–∞ | –ù—ñ | –¢–∞–∫ | –ù—ñ | –ù—ñ |
| –ù–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ | –°–µ—Ä–µ–¥–Ω—ñ | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ |
| –ü–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è | –ù—ñ | –¢–∞–∫ | –¢–∞–∫ | –¢–∞–∫ |
| –¢–∏–ø–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è | –õ—ñ—á–∏–ª—å–Ω–∏–∫–∏, –ø—Ä–∞–ø–æ—Ä—Ü—ñ | –ö–æ–ª–µ–∫—Ü—ñ—ó, —Å–∫–ª–∞–¥–Ω—ñ —Ç–∏–ø–∏ | –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ |

### 31.6.3 –ü—Ä–∞–∫—Ç–∏—á–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –∞–≥–µ–Ω—Ç–∞

–ù–∞—Å—Ç—É–ø–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∞–≥–µ–Ω—Ç–∞:

```rust
use std::cell::{Cell, RefCell, OnceCell};

/// –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–∞ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –≤–∏–±–æ—Ä–æ–º
/// —Ç–∏–ø—ñ–≤ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ–ª—è
struct OptimalAgent {
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // –ó–≤–∏—á–∞–π–Ω—ñ –ø–æ–ª—è (–Ω–µ –∑–º—ñ–Ω—é—é—Ç—å—Å—è –∞–±–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ &mut self)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    id: String,  // –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // Cell ‚Äî –¥–ª—è Copy —Ç–∏–ø—ñ–≤, —â–æ —á–∞—Å—Ç–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    battery: Cell<u8>,           // –ü—Ä–∏–º—ñ—Ç–∏–≤, –∑–º—ñ–Ω—é—î—Ç—å—Å—è —á–∞—Å—Ç–æ
    step_count: Cell<u32>,       // –õ—ñ—á–∏–ª—å–Ω–∏–∫
    scan_count: Cell<u32>,       // –õ—ñ—á–∏–ª—å–Ω–∏–∫
    is_active: Cell<bool>,       // –ü—Ä–∞–ø–æ—Ä–µ—Ü—å
    position: Cell<(f64, f64)>,  // –ö–æ—Ä—Ç–µ–∂ Copy —Ç–∏–ø—ñ–≤
    heading: Cell<f64>,          // –ù–∞–ø—Ä—è–º–æ–∫
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // RefCell ‚Äî –¥–ª—è –Ω–µ-Copy —Ç–∏–ø—ñ–≤, —â–æ –∑–º—ñ–Ω—é—é—Ç—å—Å—è
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    path: RefCell<Vec<(f64, f64)>>,  // –í–µ–∫—Ç–æ—Ä ‚Äî –Ω–µ Copy, –∑–º—ñ–Ω—é—î—Ç—å—Å—è
    log: RefCell<Vec<String>>,       // –ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π
    current_task: RefCell<Option<String>>,  // –ü–æ—Ç–æ—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // OnceCell ‚Äî –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    config: OnceCell<AgentConfig>,      // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ä–∞–∑
    cached_id_hash: OnceCell<u64>,      // –•–µ—à ID –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è —Ä–∞–∑
    calibration_data: OnceCell<CalibrationData>,  // –ö–∞–ª—ñ–±—Ä—É–≤–∞–Ω–Ω—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–µ
}

#[derive(Debug)]
struct AgentConfig {
    max_speed: f64,
    scan_radius: f64,
}

#[derive(Debug)]
struct CalibrationData {
    sensor_offset: f64,
    compass_deviation: f64,
}

impl OptimalAgent {
    fn new(id: &str) -> Self {
        Self {
            id: id.to_string(),
            
            // Cell ‚Äî –ø—Ä–æ—Å—Ç—ñ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
            battery: Cell::new(100),
            step_count: Cell::new(0),
            scan_count: Cell::new(0),
            is_active: Cell::new(true),
            position: Cell::new((0.0, 0.0)),
            heading: Cell::new(0.0),
            
            // RefCell ‚Äî –ø–æ—Ä–æ–∂–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó
            path: RefCell::new(Vec::new()),
            log: RefCell::new(Vec::new()),
            current_task: RefCell::new(None),
            
            // OnceCell ‚Äî —â–µ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ
            config: OnceCell::new(),
            cached_id_hash: OnceCell::new(),
            calibration_data: OnceCell::new(),
        }
    }
    
    // –ú–µ—Ç–æ–¥–∏ –∑ Cell ‚Äî –ø—Ä–æ—Å—Ç—ñ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ
    fn step(&self) {
        self.step_count.set(self.step_count.get() + 1);
        let (x, y) = self.position.get();
        let heading_rad = self.heading.get().to_radians();
        self.position.set((
            x + heading_rad.cos(),
            y + heading_rad.sin(),
        ));
        self.battery.set(self.battery.get().saturating_sub(1));
    }
    
    // –ú–µ—Ç–æ–¥–∏ –∑ RefCell ‚Äî –¥–ª—è –∫–æ–ª–µ–∫—Ü—ñ–π
    fn add_waypoint(&self, point: (f64, f64)) {
        self.path.borrow_mut().push(point);
    }
    
    fn log_event(&self, event: &str) {
        self.log.borrow_mut().push(event.to_string());
    }
    
    // –ú–µ—Ç–æ–¥–∏ –∑ OnceCell ‚Äî –ª—ñ–Ω–∏–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    fn config(&self) -> &AgentConfig {
        self.config.get_or_init(|| {
            AgentConfig {
                max_speed: 10.0,
                scan_radius: 50.0,
            }
        })
    }
    
    fn id_hash(&self) -> u64 {
        *self.cached_id_hash.get_or_init(|| {
            // –ü—Ä–æ—Å—Ç–∞ —Ö–µ—à-—Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó
            self.id.bytes().fold(0u64, |acc, b| {
                acc.wrapping_mul(31).wrapping_add(b as u64)
            })
        })
    }
}

fn main() {
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê");
    println!("           –û–ü–¢–ò–ú–ê–õ–¨–ù–ò–ô –í–ò–ë–Ü–† –Ü–ù–°–¢–†–£–ú–ï–ù–¢–Ü–í                      ");
    println!("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n");
    
    let agent = OptimalAgent::new("SCOUT-001");
    
    // Cell ‚Äî —à–≤–∏–¥–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
    println!("Cell –æ–ø–µ—Ä–∞—Ü—ñ—ó:");
    agent.step();
    agent.step();
    println!("  –ö—Ä–æ–∫—ñ–≤: {}", agent.step_count.get());
    println!("  –ü–æ–∑–∏—Ü—ñ—è: {:?}", agent.position.get());
    println!("  –ë–∞—Ç–∞—Ä–µ—è: {}%\n", agent.battery.get());
    
    // RefCell ‚Äî —Ä–æ–±–æ—Ç–∞ –∑ –∫–æ–ª–µ–∫—Ü—ñ—è–º–∏
    println!("RefCell –æ–ø–µ—Ä–∞—Ü—ñ—ó:");
    agent.add_waypoint((10.0, 20.0));
    agent.add_waypoint((30.0, 40.0));
    agent.log_event("–ó–∞–ø—É—Å–∫ –º—ñ—Å—ñ—ó");
    agent.log_event("–î–æ—Å—è–≥–Ω—É—Ç–æ —Ç–æ—á–∫—É 1");
    println!("  –®–ª—è—Ö: {:?}", agent.path.borrow());
    println!("  –õ–æ–≥: {:?}\n", agent.log.borrow());
    
    // OnceCell ‚Äî –ª—ñ–Ω–∏–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    println!("OnceCell –æ–ø–µ—Ä–∞—Ü—ñ—ó:");
    println!("  –•–µ—à ID: {}", agent.id_hash());
    println!("  –ö–æ–Ω—Ñ—ñ–≥: {:?}", agent.config());
}
```

---

## 31.7 –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞

### –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–ù–∞–≤—á–∏—Ç–∏—Å—å –æ–±–∏—Ä–∞—Ç–∏ —Ç–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ç–∏–ø –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–∞–Ω–∏—Ö.

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∞–≥–µ–Ω—Ç–∞ (4 –±–∞–ª–∏)

–ü–µ—Ä–µ—Ä–æ–±—ñ—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∑–∞–º—ñ–Ω–∏–≤—à–∏ RefCell –Ω–∞ Cell —Ç–∞–º, –¥–µ —Ü–µ –º–æ–∂–ª–∏–≤–æ —ñ –¥–æ—Ü—ñ–ª—å–Ω–æ:

```rust
use std::cell::RefCell;

// –ü–æ—Ç–æ—á–Ω–∞ (–Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞) –≤–µ—Ä—Å—ñ—è
struct Agent {
    battery: RefCell<u8>,
    position: RefCell<(f64, f64)>,
    heading: RefCell<f64>,
    is_active: RefCell<bool>,
    step_count: RefCell<u32>,
    log: RefCell<Vec<String>>,
    name: RefCell<String>,
}

// –ó–∞–≤–¥–∞–Ω–Ω—è: —Å—Ç–≤–æ—Ä—ñ—Ç—å –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—É –≤–µ—Ä—Å—ñ—é OptimizedAgent
// –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –≤–∏–±–æ—Ä–æ–º Cell/RefCell –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø–æ–ª—è
```

–ö—Ä–∏—Ç–µ—Ä—ñ—ó:
- –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä Cell –¥–ª—è Copy —Ç–∏–ø—ñ–≤ (2 –±–∞–ª–∏)
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è RefCell –¥–ª—è –Ω–µ-Copy —Ç–∏–ø—ñ–≤ (1 –±–∞–ª)
- –†–æ–±–æ—á—ñ –º–µ—Ç–æ–¥–∏ –¥–ª—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ (1 –±–∞–ª)

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –õ—ñ–Ω–∏–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ (3 –±–∞–ª–∏)

–†–µ–∞–ª—ñ–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –∑ –ª—ñ–Ω–∏–≤–∏–º –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ OnceCell:

```rust
use std::cell::OnceCell;

struct SystemConfig {
    database_url: String,
    max_connections: u32,
    timeout_seconds: u32,
}

struct System {
    name: String,
    config: OnceCell<SystemConfig>,
}

impl System {
    fn new(name: &str) -> Self;
    
    /// –õ—ñ–Ω–∏–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
    fn config(&self) -> &SystemConfig;
    
    /// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞
    fn is_configured(&self) -> bool;
}
```

–ö—Ä–∏—Ç–µ—Ä—ñ—ó:
- –ö–æ—Ä–µ–∫—Ç–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è OnceCell (1 –±–∞–ª)
- –ú–µ—Ç–æ–¥ config() –∑ get_or_init (1 –±–∞–ª)
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ª—ñ–Ω–∏–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó (1 –±–∞–ª)

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ (3 –±–∞–ª–∏)

–ù–∞–ø–∏—à—ñ—Ç—å –ø—Ä–æ–≥—Ä–∞–º—É, —â–æ –ø–æ—Ä—ñ–≤–Ω—é—î —à–≤–∏–¥–∫—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ–π:
- Cell\<u32\> increment
- RefCell\<u32\> increment
- –ó–≤–∏—á–∞–π–Ω–∏–π &mut u32 increment

–í–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–∂–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é 1 000 000 —Ä–∞–∑—ñ–≤ —ñ –≤–∏–º—ñ—Ä—è–π—Ç–µ —á–∞—Å.

–ö—Ä–∏—Ç–µ—Ä—ñ—ó:
- –ö–æ—Ä–µ–∫—Ç–Ω—ñ –≤–∏–º—ñ—Ä–∏ —á–∞—Å—É (1 –±–∞–ª)
- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ç—Ä—å–æ—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤ (1 –±–∞–ª)
- –ê–Ω–∞–ª—ñ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ (1 –±–∞–ª)

---

## 31.8 –¢–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ —ó—Ö –≤–∏—Ä—ñ—à–µ–Ω–Ω—è

### –ü–æ–º–∏–ª–∫–∞: "the trait `Copy` is not implemented"

–°–∏—Ç—É–∞—Ü—ñ—è:
```rust
use std::cell::Cell;

let cell: Cell<String> = Cell::new(String::from("hello"));
// –ü–æ–º–∏–ª–∫–∞: the trait `Copy` is not implemented for `String`
```

–ü—Ä–∏—á–∏–Ω–∞: Cell –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –∑ Copy —Ç–∏–ø–∞–º–∏. String –Ω–µ —î Copy.

–†—ñ—à–µ–Ω–Ω—è: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ RefCell –¥–ª—è –Ω–µ-Copy —Ç–∏–ø—ñ–≤:
```rust
use std::cell::RefCell;

let cell: RefCell<String> = RefCell::new(String::from("hello"));
```

### –ü–∏—Ç–∞–Ω–Ω—è: –ö–æ–ª–∏ OnceCell, –∫–æ–ª–∏ LazyCell?

OnceCell ‚Äî –∫–æ–ª–∏:
- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–∂–µ –ø—Ä–æ–≤–∞–ª–∏—Ç–∏—Å—å
- –§—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
- –ü–æ—Ç—Ä—ñ–±–Ω–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ —ñ–Ω—à–æ–º—É

LazyCell ‚Äî –∫–æ–ª–∏:
- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–∞
- –§—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤—ñ–¥–æ–º–∞ –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ
- –•–æ—á–µ—Ç–µ –ø—Ä–æ—Å—Ç–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –±–µ–∑ —è–≤–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤ –º–µ—Ç–æ–¥—ñ–≤

### –ü–æ–º–∏–ª–∫–∞: –ó–∞–±—É–ª–∏, —â–æ get() –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–ø—ñ—é

–°–∏—Ç—É–∞—Ü—ñ—è:
```rust
use std::cell::Cell;

let cell = Cell::new((0, 0));
let mut pos = cell.get();
pos.0 += 1;  // –ó–º—ñ–Ω—é—î–º–æ –ö–û–ü–Ü–Æ, –Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ Cell!
// cell –≤—Å–µ —â–µ –º—ñ—Å—Ç–∏—Ç—å (0, 0)
```

–†—ñ—à–µ–Ω–Ω—è: –ü—ñ—Å–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑–∞–ø–∏—à—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–∑–∞–¥:
```rust
let mut pos = cell.get();
pos.0 += 1;
cell.set(pos);  // –ó–∞–ø–∏—Å—É—î–º–æ –∑–º—ñ–Ω–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–∑–∞–¥
```

---

## –¢–µ—Å—Ç–∏ –¥–ª—è —Å–∞–º–æ–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏

1. –ß–æ–º—É Cell –Ω–µ –º–æ–∂–µ —Å–ø—Ä–∏—á–∏–Ω–∏—Ç–∏ –ø–∞–Ω—ñ–∫—É –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è?

<details>
<summary>–í—ñ–¥–ø–æ–≤—ñ–¥—å</summary>

Cell –Ω–µ –≤–∏–¥–∞—î –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî –º–µ—Ç–æ–¥ get() –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–ø—ñ—é, –∞ set() –ø—Ä–æ—Å—Ç–æ –∑–∞–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è. –û—Å–∫—ñ–ª—å–∫–∏ –Ω–µ–º–∞—î –ø–æ–∑–∏—á–∞–Ω—å, –Ω–µ —ñ—Å–Ω—É—î —Å–∏—Ç—É–∞—Ü—ñ—ó –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É –ø–æ–∑–∏—á–∞–Ω—å, —è–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–ª–æ –± –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏. –ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ ‚Äî –Ω–µ–º–∞—î –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –ø–∞–Ω—ñ–∫–∏.
</details>

2. –ß–æ–º—É Cell –≤–∏–º–∞–≥–∞—î Copy, –∞ RefCell ‚Äî –Ω—ñ?

<details>
<summary>–í—ñ–¥–ø–æ–≤—ñ–¥—å</summary>

Cell –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑–Ω–∞—á–µ–Ω—å: get() –ø–æ–≤–µ—Ä—Ç–∞—î –∫–æ–ø—ñ—é, –∞ –Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è. –Ø–∫–±–∏ Cell –¥–æ–∑–≤–æ–ª–∏–≤ –Ω–µ-Copy —Ç–∏–ø–∏, get() –Ω–µ –∑–º—ñ–≥ –±–∏ –±–µ–∑–ø–µ—á–Ω–æ "–≤–∏—Ç—è–≥–Ω—É—Ç–∏" –∑–Ω–∞—á–µ–Ω–Ω—è –±–µ–∑ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è. RefCell –ø—Ä–∞—Ü—é—î —ñ–Ω–∞–∫—à–µ ‚Äî –≤—ñ–Ω –≤–∏–¥–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ –¥–∞–Ω—ñ, —Ç–æ–º—É –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –±—É–¥—å-—è–∫–∏–º–∏ —Ç–∏–ø–∞–º–∏.
</details>

3. –ö–æ–ª–∏ –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ OnceCell –∑–∞–º—ñ—Å—Ç—å LazyCell?

<details>
<summary>–í—ñ–¥–ø–æ–≤—ñ–¥—å</summary>

OnceCell –∫—Ä–∞—â–µ, –∫–æ–ª–∏: (1) —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–∂–µ –ø—Ä–æ–≤–∞–ª–∏—Ç–∏—Å—å —ñ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ (get_or_try_init); (2) —Ñ—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤, –≤—ñ–¥–æ–º–∏—Ö –ø—ñ–∑–Ω—ñ—à–µ; (3) –ø–æ—Ç—Ä—ñ–±–Ω–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó; (4) –ø–æ—Ç—Ä—ñ–±–µ–Ω —è–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –º–æ–º–µ–Ω—Ç–æ–º —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.
</details>

---

## –†–µ–∑—é–º–µ

### –©–æ –≤–∏ –≤–∏–≤—á–∏–ª–∏

1. Cell\<T\> ‚Äî –ª–µ–≥–∫–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –¥–ª—è Copy —Ç–∏–ø—ñ–≤, —â–æ –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å –ø–æ–∑–∏—á–∞–Ω–Ω—è

2. –ú–µ—Ç–æ–¥–∏ Cell ‚Äî get(), set(), replace(), take(), swap(), update() –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

3. OnceCell\<T\> ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑ –º–µ—Ç–æ–¥–æ–º get_or_init()

4. LazyCell\<T\> ‚Äî –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∞ –ª—ñ–Ω–∏–≤–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º Deref

5. –í–∏–±—ñ—Ä —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É ‚Äî –¥–µ—Ä–µ–≤–æ —Ä—ñ—à–µ–Ω—å –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–∏–±–æ—Ä—É –º—ñ–∂ Cell, RefCell, OnceCell, LazyCell

### –ö–ª—é—á–æ–≤—ñ –ø—Ä–∞–≤–∏–ª–∞

-  Cell –¥–ª—è Copy —Ç–∏–ø—ñ–≤ (–ª—ñ—á–∏–ª—å–Ω–∏–∫–∏, –ø—Ä–∞–ø–æ—Ä—Ü—ñ, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏)
-  RefCell –¥–ª—è –Ω–µ-Copy —Ç–∏–ø—ñ–≤ (String, Vec, —Å–∫–ª–∞–¥–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏)
-  OnceCell –¥–ª—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º
-  LazyCell –¥–ª—è –ø—Ä–æ—Å—Ç–æ—ó –ª—ñ–Ω–∏–≤–æ—ó —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
-  –û–±–∏—Ä–∞–π—Ç–µ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —â–æ –≤–∏—Ä—ñ—à—É—î –∑–∞–¥–∞—á—É

---

## –ó–≤'—è–∑–æ–∫ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —Ä–æ–∑–¥—ñ–ª–æ–º

–í–∏ –æ–ø–∞–Ω—É–≤–∞–ª–∏ –≤—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ smart pointers –¥–ª—è –æ–¥–Ω–æ–ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –∫–æ–¥—É: Box, Rc, RefCell, Cell, OnceCell. –ê–ª–µ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ —Ç–∞ smart pointers —á–∞—Å –≤—ñ–¥ —á–∞—Å—É –∑'—è–≤–ª—è—é—Ç—å—Å—è –∑–∞–≥–∞–¥–∫–æ–≤—ñ `'a` —É —Å–∏–≥–Ω–∞—Ç—É—Ä–∞—Ö —Ñ—É–Ω–∫—Ü—ñ–π. –Ü–Ω–æ–¥—ñ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –≤–∏–º–∞–≥–∞—î —ó—Ö –≤–∫–∞–∑—É–≤–∞—Ç–∏ —è–≤–Ω–æ, —ñ–Ω–æ–¥—ñ –≤–∏–≤–æ–¥–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

–£ –†–æ–∑–¥—ñ–ª—ñ 32: –ß–∞—Å–∏ –∂–∏—Ç—Ç—è (Lifetimes) –≤–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å:
- –©–æ —Ç–∞–∫–µ lifetime annotations —Ç–∞ –Ω–∞–≤—ñ—â–æ –≤–æ–Ω–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ
- –ü—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–≤–µ–¥–µ–Ω–Ω—è —á–∞—Å—ñ–≤ –∂–∏—Ç—Ç—è (lifetime elision)
- –Ø–∫ –ø–∏—Å–∞—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è
- –©–æ –æ–∑–Ω–∞—á–∞—î `'static` —Ç–∞ –∫–æ–ª–∏ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

---

