# –†–æ–∑–¥—ñ–ª 40: Streams ‚Äî Async —ñ—Ç–µ—Ä–∞—Ç–æ—Ä–∏

---

## üìã –ê–Ω–æ—Ç–∞—Ü—ñ—è

–£ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É Rust –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ **Iterator**: —Ü–∏–∫–ª `for item in collection` –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø–æ –µ–ª–µ–º–µ–Ω—Ç–∞—Ö –æ–¥–∏–Ω –∑–∞ –æ–¥–Ω–∏–º. –Ü—Ç–µ—Ä–∞—Ç–æ—Ä ‚Äî —Ü–µ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è, —â–æ –ø—Ä–∏—Ö–æ–≤—É—î –¥–µ—Ç–∞–ª—ñ —Ç–æ–≥–æ, –∑–≤—ñ–¥–∫–∏ –±–µ—Ä—É—Ç—å—Å—è –¥–∞–Ω—ñ. –ß–∏ —Ü–µ –º–∞—Å–∏–≤, —á–∏ —Ñ–∞–π–ª, —á–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ–±—á–∏—Å–ª–µ–Ω—å ‚Äî —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–¥–Ω–∞–∫–æ–≤–∏–π: `next()` –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–∞—Å—Ç—É–ø–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç –∞–±–æ `None`.

–ê–ª–µ —â–æ —Ä–æ–±–∏—Ç–∏, –∫–æ–ª–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞–¥—Ö–æ–¥—è—Ç—å **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**? –ú–µ—Ä–µ–∂–µ–≤—ñ –ø–∞–∫–µ—Ç–∏ –∑'—è–≤–ª—è—é—Ç—å—Å—è, –∫–æ–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–∞–Ω–∞–ª—ñ ‚Äî –∫–æ–ª–∏ —ó—Ö –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å. –ü–æ–∫–∞–∑–∞–Ω–Ω—è —Å–µ–Ω—Å–æ—Ä—ñ–≤ ‚Äî –∫–æ–ª–∏ —Å–µ–Ω—Å–æ—Ä –∑–∞–≤–µ—Ä—à—É—î –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è. –¶—ñ –¥–∞–Ω—ñ –Ω–µ —ñ—Å–Ω—É—é—Ç—å "–≤—Å—ñ –æ–¥—Ä–∞–∑—É" ‚Äî –≤–æ–Ω–∏ **–∑'—è–≤–ª—è—é—Ç—å—Å—è –∑ —á–∞—Å–æ–º**.

**Stream** ‚Äî —Ü–µ async –≤–µ—Ä—Å—ñ—è Iterator. –¢–∞–∫ —Å–∞–º–æ, —è–∫ Future ‚Äî —Ü–µ async –≤–µ—Ä—Å—ñ—è —Ñ—É–Ω–∫—Ü—ñ—ó, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è, Stream ‚Äî —Ü–µ async –≤–µ—Ä—Å—ñ—è Iterator, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∑–Ω–∞—á–µ–Ω—å. –ó–∞–º—ñ—Å—Ç—å –±–ª–æ–∫—É—é—á–æ–≥–æ `next() -> Option<T>` –º–∞—î–º–æ `poll_next() -> Poll<Option<T>>`, –¥–µ `Poll::Pending` –æ–∑–Ω–∞—á–∞—î "–µ–ª–µ–º–µ–Ω—Ç–∞ —â–µ –Ω–µ–º–∞—î, –∞–ª–µ –±—É–¥–µ".

–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –≥–ª–∏–±–æ–∫–æ –∑—Ä–æ–∑—É–º—ñ—î—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—é Stream, –Ω–∞–≤—á–∏—Ç–µ—Å—å —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ streams –∑ —Ä—ñ–∑–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª, —Å–ø–æ–∂–∏–≤–∞—Ç–∏ —ó—Ö —á–µ—Ä–µ–∑ —ñ–¥—ñ–æ–º–∞—Ç–∏—á–Ω—ñ –ø–∞—Ç–µ—Ä–Ω–∏, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–∞–º–∏ —Ç–∞ –æ–±'—î–¥–Ω—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –ø–æ—Ç–æ–∫—ñ–≤ –≤ –æ–¥–∏–Ω. –¶–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–æ—Ç–æ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö ‚Äî –≤—ñ–¥ —Å–µ–Ω—Å–æ—Ä—ñ–≤ –ë–ü–õ–ê –¥–æ –º–µ—Ä–µ–∂–µ–≤–∏—Ö –∑'—î–¥–Ω–∞–Ω—å.

---

## üéØ –¶—ñ–ª—ñ –Ω–∞–≤—á–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ:

1. **–ü–æ—è—Å–Ω–∏—Ç–∏** –∫–æ–Ω—Ü–µ–ø—Ü—ñ—é Stream —Ç–∞ —ó—ó –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—ñ–¥ Iterator
2. **–°–ø–æ–∂–∏–≤–∞—Ç–∏** streams —á–µ—Ä–µ–∑ –ø–∞—Ç–µ—Ä–Ω `while let` —Ç–∞ –º–µ—Ç–æ–¥–∏ StreamExt
3. **–°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏** streams –∑ –∫–∞–Ω–∞–ª—ñ–≤, —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤, —ñ—Ç–µ—Ä–∞—Ç–æ—Ä—ñ–≤ —Ç–∞ –≤–ª–∞—Å–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª
4. **–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏** streams —á–µ—Ä–µ–∑ –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–∏: map, filter, take, then
5. **–û–±'—î–¥–Ω—É–≤–∞—Ç–∏** –∫—ñ–ª—å–∫–∞ streams –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –±–∞–≥–∞—Ç—å–æ—Ö –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö
6. **–ó–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏** –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—é —Ç–∞ –ø–∞–∫–µ—Ç–Ω—É –æ–±—Ä–æ–±–∫—É –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

---

## üìö –ö–ª—é—á–æ–≤—ñ —Ç–µ—Ä–º—ñ–Ω–∏

| –¢–µ—Ä–º—ñ–Ω | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|------------|
| **Stream** | Async –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∑–Ω–∞—á–µ–Ω—å, —â–æ –Ω–∞–¥—Ö–æ–¥—è—Ç—å –∑ —á–∞—Å–æ–º; async –≤–µ—Ä—Å—ñ—è Iterator |
| **StreamExt** | Extension trait, —â–æ –¥–æ–¥–∞—î –∑—Ä—É—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–æ Stream (next, map, filter —Ç–æ—â–æ) |
| **poll_next** | –ë–∞–∑–æ–≤–∏–π –º–µ—Ç–æ–¥ Stream trait; –ø–æ–≤–µ—Ä—Ç–∞—î Poll<Option<Item>> |
| **fuse** | –ú–µ—Ç–æ–¥, —â–æ –≥–∞—Ä–∞–Ω—Ç—É—î: –ø—ñ—Å–ª—è –ø–µ—Ä—à–æ–≥–æ None stream –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏–º–µ None |
| **merge** | –û–±'—î–¥–Ω–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö streams –≤ –æ–¥–∏–Ω –∑ —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è–º –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ |
| **chain** | –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è streams: —Å–ø–æ—á–∞—Ç–∫—É –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø–µ—Ä—à–æ–≥–æ, –ø–æ—Ç—ñ–º –¥—Ä—É–≥–æ–≥–æ |
| **chunks** | –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ stream —É –≤–µ–∫—Ç–æ—Ä–∏ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É |
| **throttle** | –û–±–º–µ–∂–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ –≤–∏–¥–∞—á—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ stream |

---

## üí° –ú–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏–π –∫–µ–π—Å: –û–±—Ä–æ–±–∫–∞ –¥–∞–Ω–∏—Ö –≤—ñ–¥ —Å–µ–Ω—Å–æ—Ä—ñ–≤ –ë–ü–õ–ê

–£—è–≤—ñ–º–æ –∞–≤—Ç–æ–Ω–æ–º–Ω–∏–π –ë–ü–õ–ê –∑ –∫—ñ–ª—å–∫–æ–º–∞ —Å–µ–Ω—Å–æ—Ä–∞–º–∏. –ö–æ–∂–µ–Ω –≥–µ–Ω–µ—Ä—É—î –¥–∞–Ω—ñ –∑ —Ä—ñ–∑–Ω–æ—é —á–∞—Å—Ç–æ—Ç–æ—é —Ç–∞ –≤ —Ä—ñ–∑–Ω—ñ –º–æ–º–µ–Ω—Ç–∏ —á–∞—Å—É:

```text
         –ß–∞—Å ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫

GPS:           ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   (1 —Ä–∞–∑/—Å–µ–∫)
               ‚îÇ         ‚îÇ         ‚îÇ         ‚îÇ
               
–ê–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä:  ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ   (10 —Ä–∞–∑—ñ–≤/—Å–µ–∫)
               ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ
               
–ö–∞–º–µ—Ä–∞:        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   (0.5 —Ä–∞–∑/—Å–µ–∫)
                        ‚îÇ                   ‚îÇ
                        
–ë–∞—Ä–æ–º–µ—Ç—Ä:      ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   (0.3 —Ä–∞–∑/—Å–µ–∫)
                  ‚îÇ           ‚îÇ               ‚îÇ
```

–Ø–∫ –∞–≥–µ–Ω—Ç –º–∞—î –æ–±—Ä–æ–±–ª—è—Ç–∏ —Ü—ñ –ø–æ—Ç–æ–∫–∏? –ö—ñ–ª—å–∫–∞ –ø—ñ–¥—Ö–æ–¥—ñ–≤:

**–ü—ñ–¥—Ö—ñ–¥ 1: –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è (–ø–æ–≥–∞–Ω–∏–π)**
```rust
loop {
    let gps = read_gps().await;      // –ß–µ–∫–∞—î–º–æ GPS
    let accel = read_accel().await;  // –ü–æ—Ç—ñ–º –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä
    let camera = read_camera().await; // –ü–æ—Ç—ñ–º –∫–∞–º–µ—Ä—É
    // –ü—Ä–æ–±–ª–µ–º–∞: –ø–æ–∫–∏ —á–µ–∫–∞—î–º–æ –∫–∞–º–µ—Ä—É (2 —Å–µ–∫—É–Ω–¥–∏), 
    // –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ 20 –ø–æ–∫–∞–∑–∞–Ω—å –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞!
}
```

**–ü—ñ–¥—Ö—ñ–¥ 2: Streams –∑ merge (–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π)**
```rust
let combined = merge(gps_stream, accel_stream, camera_stream);

while let Some(reading) = combined.next().await {
    match reading {
        SensorData::Gps(pos) => update_position(pos),
        SensorData::Accel(acc) => update_orientation(acc),
        SensorData::Camera(img) => process_image(img),
    }
}
// –û–±—Ä–æ–±–ª—è—î–º–æ –¥–∞–Ω—ñ –≤ –ø–æ—Ä—è–¥–∫—É —ó—Ö –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è!
```

Stream –¥–æ–∑–≤–æ–ª—è—î **—Ä–µ–∞–≥—É–≤–∞—Ç–∏ –Ω–∞ –¥–∞–Ω—ñ, –∫–æ–ª–∏ –≤–æ–Ω–∏ –∑'—è–≤–ª—è—é—Ç—å—Å—è**, –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫—ñ–≤ —ñ –±–µ–∑ –∑–∞–π–≤–æ–≥–æ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è.

---

## 40.1 ITERATOR VS STREAM: –§–£–ù–î–ê–ú–ï–ù–¢–ê–õ–¨–ù–ê –†–Ü–ó–ù–ò–¶–Ø

### 40.1.1 Iterator: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π, –±–ª–æ–∫—É—é—á–∏–π

–ù–∞–≥–∞–¥–∞—î–º–æ, —è–∫ –ø—Ä–∞—Ü—é—î Iterator:

```rust
pub trait Iterator {
    type Item;
    
    fn next(&mut self) -> Option<Self::Item>;
}
```

–ö–æ–ª–∏ –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ `next()`, –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –æ–¥–Ω–µ –∑ –¥–≤–æ—Ö:
1. –ï–ª–µ–º–µ–Ω—Ç **—î** ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è `Some(item)` –Ω–µ–≥–∞–π–Ω–æ
2. –ï–ª–µ–º–µ–Ω—Ç—ñ–≤ **–±—ñ–ª—å—à–µ –Ω–µ–º–∞—î** ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è `None`

–ö–ª—é—á–æ–≤–∏–π –º–æ–º–µ–Ω—Ç: –≤–∏–∫–ª–∏–∫ `next()` **–±–ª–æ–∫—É—î** –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, –ø–æ–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –±—É–¥–µ –æ—Ç—Ä–∏–º–∞–Ω–æ. –î–ª—è –∫–æ–ª–µ–∫—Ü—ñ—ó –≤ –ø–∞–º'—è—Ç—ñ —Ü–µ –º–∏—Ç—Ç—î–≤–æ. –î–ª—è —Ñ–∞–π–ª—É ‚Äî —á–∞—Å —á–∏—Ç–∞–Ω–Ω—è –∑ –¥–∏—Å–∫—É. –î–ª—è –º–µ—Ä–µ–∂—ñ... Iterator –ø—Ä–æ—Å—Ç–æ –Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –º–µ—Ä–µ–∂—ñ.

**–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è Iterator:**

```text
                  –ü–æ—Ç—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
                        ‚îÇ
    next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Some(item1)  (–º–∏—Ç—Ç—î–≤–æ)
                        ‚îÇ
    next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Some(item2)  (–º–∏—Ç—Ç—î–≤–æ)
                        ‚îÇ
    next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Some(item3)  (–º–∏—Ç—Ç—î–≤–æ)
                        ‚îÇ
    next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ None         (–º–∏—Ç—Ç—î–≤–æ)
                        ‚îÇ
                        ‚ñº
              –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü–∏–∫–ª—É
              
    –í–µ—Å—å —á–∞—Å ‚Äî –æ–¥–∏–Ω –ø–æ—Ç—ñ–∫, –±–µ–∑ –ø–∞—É–∑
```

### 40.1.2 Stream: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π, –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∏–π

Stream –º–∞—î —Å—Ö–æ–∂—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∞–ª–µ –∑ –∫—Ä–∏—Ç–∏—á–Ω–æ—é –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—é:

```rust
pub trait Stream {
    type Item;
    
    fn poll_next(
        self: Pin<&mut Self>,
        cx: &mut Context<'_>
    ) -> Poll<Option<Self::Item>>;
}
```

–¢–µ–ø–µ—Ä `poll_next()` –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–µ `Option`, –∞ `Poll<Option>`:
- `Poll::Ready(Some(item))` ‚Äî –µ–ª–µ–º–µ–Ω—Ç –≥–æ—Ç–æ–≤–∏–π, –æ—Å—å –≤—ñ–Ω
- `Poll::Ready(None)` ‚Äî stream –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –±—ñ–ª—å—à–µ –Ω–µ –±—É–¥–µ
- **`Poll::Pending`** ‚Äî –µ–ª–µ–º–µ–Ω—Ç–∞ —â–µ –Ω–µ–º–∞—î, –∞–ª–µ –±—É–¥–µ; –ø–æ—Å—Ç—É–ø–∞—é—Å—å!

–°–∞–º–µ `Pending` —Ä–æ–±–∏—Ç—å Stream async: –∑–∞–¥–∞—á–∞ –º–æ–∂–µ "–ø–æ—Å—Ç—É–ø–∏—Ç–∏—Å—å", –¥–æ–∑–≤–æ–ª—è—é—á–∏ —ñ–Ω—à–∏–º –ø—Ä–∞—Ü—é–≤–∞—Ç–∏, —ñ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å, –∫–æ–ª–∏ –¥–∞–Ω—ñ –≥–æ—Ç–æ–≤—ñ.

**–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è Stream:**

```text
                  –ü–æ—Ç—ñ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
                        ‚îÇ
    poll_next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Ready(Some(item1))
                        ‚îÇ
    poll_next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Pending ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ                       ‚îÇ –Ü–Ω—à—ñ –∑–∞–¥–∞—á—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è
                        ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò –î–∞–Ω—ñ –ø—Ä–∏–π—à–ª–∏!
                        ‚îÇ
    poll_next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Ready(Some(item2))
                        ‚îÇ
    poll_next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Pending ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ                       ‚îÇ –Ü–Ω—à—ñ –∑–∞–¥–∞—á—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è
                        ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò 
                        ‚îÇ
    poll_next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Ready(Some(item3))
                        ‚îÇ
    poll_next() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Ready(None)
                        ‚îÇ
                        ‚ñº
              –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü–∏–∫–ª—É
```

### 40.1.3 –ê–Ω–∞–ª–æ–≥—ñ—è: —á–µ—Ä–≥–∞ –≤ –º–∞–≥–∞–∑–∏–Ω—ñ

**Iterator ‚Äî —è–∫ –∑–≤–∏—á–∞–π–Ω–∞ —á–µ—Ä–≥–∞.** –í–∏ —Å—Ç–∞—î—Ç–µ –≤ —á–µ—Ä–≥—É —ñ —Å—Ç–æ—ó—Ç–µ, –ø–æ–∫–∏ –Ω–µ –¥—ñ–π–¥–µ –≤–∞—à —á–∞—Å. –ù—ñ—á–æ–≥–æ —ñ–Ω—à–æ–≥–æ —Ä–æ–±–∏—Ç–∏ –Ω–µ –º–æ–∂–µ—Ç–µ ‚Äî –ø—Ä–æ—Å—Ç–æ —á–µ–∫–∞—î—Ç–µ. –ö–æ–ª–∏ –≤–∞—à–∞ —á–µ—Ä–≥–∞ ‚Äî –æ—Ç—Ä–∏–º—É—î—Ç–µ —Ç–æ–≤–∞—Ä. –Ø–∫—â–æ —Ç–æ–≤–∞—Ä –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è ‚Äî –π–¥–µ—Ç–µ.

**Stream ‚Äî —è–∫ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ —á–µ—Ä–≥–∞ –∑ –Ω–æ–º–µ—Ä–∫–æ–º.** –í–∏ –±–µ—Ä–µ—Ç–µ –Ω–æ–º–µ—Ä–æ–∫ —ñ –π–¥–µ—Ç–µ –ø–∏—Ç–∏ –∫–∞–≤—É, —á–∏—Ç–∞—Ç–∏ –∫–Ω–∏–≥—É, —Ä–æ–∑–º–æ–≤–ª—è—Ç–∏ –∑ –¥—Ä—É–∑—è–º–∏. –ö–æ–ª–∏ –≤–∞—à –Ω–æ–º–µ—Ä –∑'—è–≤–ª—è—î—Ç—å—Å—è –Ω–∞ —Ç–∞–±–ª–æ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î—Ç–µ—Å—å —ñ –æ—Ç—Ä–∏–º—É—î—Ç–µ —Ç–æ–≤–∞—Ä. –ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ.

–í –æ–±–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ —Ç–æ–π —Å–∞–º–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Ç–æ–≤–∞—Ä), –∞–ª–µ **–º–æ–¥–µ–ª—å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è** –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ —Ä—ñ–∑–Ω–∞.

### 40.1.4 –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Iterator | Stream |
|----------------|----------|--------|
| –ú–µ—Ç–æ–¥ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è | `next()` | `poll_next()` |
| –¢–∏–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É | `Option<T>` | `Poll<Option<T>>` |
| –ë–ª–æ–∫—É—î –ø–æ—Ç—ñ–∫? | –¢–∞–∫ | –ù—ñ |
| –ú–æ–∂–µ "–ø–æ—Å—Ç—É–ø–∏—Ç–∏—Å—å"? | –ù—ñ | –¢–∞–∫ |
| –ü–æ—Ç—Ä–µ–±—É—î runtime? | –ù—ñ | –¢–∞–∫ (Tokio, async-std) |
| –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –ö–æ–ª–µ–∫—Ü—ñ—ó –≤ –ø–∞–º'—è—Ç—ñ | –ü–æ—Ç–æ–∫–æ–≤—ñ –¥–∞–Ω—ñ, I/O |

---

## 40.2 STREAM TRAIT –¢–ê STREAMEXT

### 40.2.1 –ë–∞–∑–æ–≤–∏–π Stream trait

Stream trait –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π —É –∫—Ä–µ–π—Ç—ñ `futures`, —ñ Tokio –π–æ–≥–æ —Ä–µ–µ–∫—Å–ø–æ—Ä—Ç—É—î:

```rust
use std::pin::Pin;
use std::task::{Context, Poll};

pub trait Stream {
    /// –¢–∏–ø –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, —â–æ –≤–∏–¥–∞—î stream
    type Item;
    
    /// –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç
    fn poll_next(
        self: Pin<&mut Self>,
        cx: &mut Context<'_>
    ) -> Poll<Option<Self::Item>>;
    
    /// –ü—ñ–¥–∫–∞–∑–∫–∞ –ø—Ä–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
    fn size_hint(&self) -> (usize, Option<usize>) {
        (0, None)  // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º: –Ω–µ–≤—ñ–¥–æ–º–æ
    }
}
```

–ü—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–∞–ø—Ä—è–º—É –∑ `poll_next()` –Ω–µ–∑—Ä—É—á–Ω–æ ‚Äî —Ü–µ –Ω–∏–∑—å–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π API, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó streams, –∞ –Ω–µ –¥–ª—è —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è. –ü–æ—Ç—Ä—ñ–±–µ–Ω `Pin`, `Context`, –æ–±—Ä–æ–±–∫–∞ `Poll`... –¢–æ–º—É —ñ—Å–Ω—É—î **StreamExt**.

### 40.2.2 StreamExt: –∑—Ä—É—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–ª—è —â–æ–¥–µ–Ω–Ω–æ—ó —Ä–æ–±–æ—Ç–∏

`StreamExt` ‚Äî —Ü–µ extension trait, —â–æ –¥–æ–¥–∞—î –≤–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤—ñ –º–µ—Ç–æ–¥–∏ –¥–æ –±—É–¥—å-—è–∫–æ–≥–æ —Ç–∏–ø—É, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î Stream:

```rust
use tokio_stream::StreamExt;

// –ó–∞–º—ñ—Å—Ç—å —Å–∫–ª–∞–¥–Ω–æ–≥–æ poll_next() –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø—Ä–æ—Å—Ç–æ:
while let Some(item) = stream.next().await {
    process(item);
}
```

**–û—Å–Ω–æ–≤–Ω—ñ –º–µ—Ç–æ–¥–∏ StreamExt:**

| –ú–µ—Ç–æ–¥ | –°–∏–≥–Ω–∞—Ç—É—Ä–∞ | –û–ø–∏—Å |
|-------|-----------|------|
| `next()` | `async fn next(&mut self) -> Option<Item>` | –û—Ç—Ä–∏–º–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç |
| `map(f)` | `fn map<F, T>(self, f: F) -> Map<Self, F>` | –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç |
| `filter(p)` | `fn filter<P>(self, p: P) -> Filter<Self, P>` | –ó–∞–ª–∏—à–∏—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑–∞ –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–º |
| `filter_map(f)` | `fn filter_map<F, T>(self, f: F) -> FilterMap<Self, F>` | –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—î—é |
| `take(n)` | `fn take(self, n: usize) -> Take<Self>` | –í–∑—è—Ç–∏ –ø–µ—Ä—à—ñ n –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ |
| `skip(n)` | `fn skip(self, n: usize) -> Skip<Self>` | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –ø–µ—Ä—à—ñ n –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ |
| `collect()` | `async fn collect<C>(self) -> C` | –ó—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ —É –∫–æ–ª–µ–∫—Ü—ñ—é |
| `fold(init, f)` | `async fn fold<B, F>(self, init: B, f: F) -> B` | –ê–≥—Ä–µ–≥—É–≤–∞—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ |
| `for_each(f)` | `async fn for_each<F>(self, f: F)` | –í–∏–∫–æ–Ω–∞—Ç–∏ –¥—ñ—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ |
| `merge(other)` | `fn merge<U>(self, other: U) -> Merge<Self, U>` | –û–±'—î–¥–Ω–∞—Ç–∏ –∑ —ñ–Ω—à–∏–º stream |

### 40.2.3 –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑—ñ Streams

–î–ª—è –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑—ñ streams –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –∫—Ä–µ–π—Ç–∏:

```toml
[dependencies]
tokio = { version = "1", features = ["full"] }
tokio-stream = "0.1"     # Stream utilities –¥–ª—è Tokio (ReceiverStream, —Ç–æ—â–æ)
futures = "0.3"          # –ë–∞–∑–æ–≤—ñ Stream/StreamExt traits
async-stream = "0.3"     # –ú–∞–∫—Ä–æ—Å stream! –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è streams
```

**–©–æ –Ω–∞–¥–∞—î –∫–æ–∂–µ–Ω –∫—Ä–µ–π—Ç:**

| –ö—Ä–µ–π—Ç | –©–æ –Ω–∞–¥–∞—î |
|-------|----------|
| `tokio-stream` | `ReceiverStream`, `IntervalStream`, wrappers –¥–ª—è Tokio —Ç–∏–ø—ñ–≤ |
| `futures` | `StreamExt`, –±–∞–∑–æ–≤—ñ –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–∏, `stream::iter()` |
| `async-stream` | –ú–∞–∫—Ä–æ—Å `stream!` –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è streams —á–µ—Ä–µ–∑ yield |

---

## 40.3 –°–ü–û–ñ–ò–í–ê–ù–ù–Ø STREAMS: –û–¢–†–ò–ú–ê–ù–ù–Ø –ï–õ–ï–ú–ï–ù–¢–Ü–í

### 40.3.1 –ü–∞—Ç–µ—Ä–Ω while let ‚Äî —ñ–¥—ñ–æ–º–∞—Ç–∏—á–Ω–∏–π —Å–ø–æ—Å—ñ–±

–ù–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏–π —Å–ø–æ—Å—ñ–± –æ–±—Ä–æ–±–∫–∏ stream ‚Äî —Ü–∏–∫–ª `while let`:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É—î–º–æ –±–∞–∑–æ–≤–∏–π –ø–∞—Ç–µ—Ä–Ω —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è stream, –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∏–π –¥–æ —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –ø–æ Iterator.

```rust
use tokio_stream::StreamExt;
use tokio::sync::mpsc;
use tokio_stream::wrappers::ReceiverStream;

#[tokio::main]
async fn main() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ –∫–∞–Ω–∞–ª —Ç–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ Receiver –Ω–∞ Stream
    let (tx, rx) = mpsc::channel::<String>(10);
    let mut stream = ReceiverStream::new(rx);
    
    // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –æ–∫—Ä–µ–º—ñ–π –∑–∞–¥–∞—á—ñ
    tokio::spawn(async move {
        for i in 1..=5 {
            tx.send(format!("–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è #{}", i)).await.unwrap();
            tokio::time::sleep(tokio::time::Duration::from_millis(100)).await;
        }
        // tx drop'–∞—î—Ç—å—Å—è, –∫–∞–Ω–∞–ª –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è
    });
    
    // –°–ø–æ–∂–∏–≤–∞—î–º–æ stream —á–µ—Ä–µ–∑ while let
    while let Some(message) = stream.next().await {
        println!("–û—Ç—Ä–∏–º–∞–Ω–æ: {}", message);
    }
    
    // –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è, –∫–æ–ª–∏ stream –ø–æ–≤–µ—Ä—Ç–∞—î None
    // (–∫–æ–ª–∏ –∫–∞–Ω–∞–ª –∑–∞–∫—Ä–∏—Ç–æ —ñ –≤—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ)
    println!("Stream –∑–∞–≤–µ—Ä—à–µ–Ω–æ");
}
```

**–†–æ–∑–≥–ª—è–Ω–µ–º–æ, —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º:**

1. `stream.next()` –ø–æ–≤–µ—Ä—Ç–∞—î Future
2. `.await` –∑–∞–ø—É—Å–∫–∞—î —Ü–µ–π Future
3. –Ø–∫—â–æ –µ–ª–µ–º–µ–Ω—Ç —î ‚Äî Future –≤–∏—Ä—ñ—à—É—î—Ç—å—Å—è –≤ `Some(item)`
4. –Ø–∫—â–æ –µ–ª–µ–º–µ–Ω—Ç–∞ —â–µ –Ω–µ–º–∞—î ‚Äî Future –ø–æ–≤–µ—Ä—Ç–∞—î `Pending`, –∑–∞–¥–∞—á–∞ –ø–æ—Å—Ç—É–ø–∞—î—Ç—å—Å—è
5. –ö–æ–ª–∏ –µ–ª–µ–º–µ–Ω—Ç –∑'—è–≤–ª—è—î—Ç—å—Å—è ‚Äî Future –ø—Ä–æ–∫–∏–¥–∞—î—Ç—å—Å—è —ñ –ø–æ–≤–µ—Ä—Ç–∞—î `Some(item)`
6. –ö–æ–ª–∏ stream –∑–∞–≤–µ—Ä—à–µ–Ω–æ ‚Äî Future –ø–æ–≤–µ—Ä—Ç–∞—î `None`
7. `while let Some(...)` –∑–∞–≤–µ—Ä—à—É—î —Ü–∏–∫–ª –ø—Ä–∏ `None`

–¶–µ–π –ø–∞—Ç–µ—Ä–Ω —ñ–¥–µ–Ω—Ç–∏—á–Ω–∏–π `while let Some(item) = iterator.next()` –¥–ª—è Iterator, –∞–ª–µ –∑ `.await` ‚Äî —Å–∞–º–µ —Ü–µ —Ä–æ–±–∏—Ç—å –π–æ–≥–æ async.

### 40.3.2 –ß–æ–º—É for loop –Ω–µ –ø—Ä–∞—Ü—é—î?

–ü—Ä–∏—Ä–æ–¥–Ω–æ –±—É–ª–æ –± –Ω–∞–ø–∏—Å–∞—Ç–∏:

```rust
// ‚ùå –ù–ï –ö–û–ú–ü–Ü–õ–Æ–Ñ–¢–¨–°–Ø!
for item in stream {
    println!("{}", item);
}
```

–ê–ª–µ —Ü–µ –Ω–µ –ø—Ä–∞—Ü—é—î. –ü—Ä–∏—á–∏–Ω–∞: `for` loop –≤ Rust –ø—Ä–∞—Ü—é—î –∑ `IntoIterator`, –∞ –Ω–µ –∑ `Stream`. –í–æ–Ω–∏ –º–∞—é—Ç—å —Ä—ñ–∑–Ω—ñ traits.

–¢–µ–æ—Ä–µ—Ç–∏—á–Ω–æ –º–æ–∂–Ω–∞ –±—É–ª–æ –± –¥–æ–¥–∞—Ç–∏ `async for` —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

```rust
// –ú–æ–∂–ª–∏–≤–∏–π –º–∞–π–±—É—Ç–Ω—ñ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (RFC –æ–±–≥–æ–≤–æ—Ä—é—î—Ç—å—Å—è)
async for item in stream {
    println!("{}", item);
}
```

–ê–ª–µ —Å—Ç–∞–Ω–æ–º –Ω–∞ 2024 —Ä—ñ–∫ —Ü—å–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É –≤ —Å—Ç–∞–±—ñ–ª—å–Ω–æ–º—É Rust –Ω–µ–º–∞—î. –¢–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `while let`.

### 40.3.3 –ó–±—ñ—Ä —É—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –∫–æ–ª–µ–∫—Ü—ñ—é

–Ø–∫ —ñ Iterator, Stream –º–æ–∂–Ω–∞ "–∑—ñ–±—Ä–∞—Ç–∏" —É –∫–æ–ª–µ–∫—Ü—ñ—é —á–µ—Ä–µ–∑ `collect()`:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ, —è–∫ –∑—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ stream —É Vec.

```rust
use tokio_stream::StreamExt;
use futures::stream;

#[tokio::main]
async fn main() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ stream –∑ —ñ—Ç–µ—Ä–∞—Ç–æ—Ä–∞ (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó)
    let numbers_stream = stream::iter(vec![1, 2, 3, 4, 5]);
    
    // –ó–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ —É Vec
    // –í–ê–ñ–õ–ò–í–û: collect() ‚Äî async, –ø–æ—Ç—Ä–µ–±—É—î .await
    let collected: Vec<i32> = numbers_stream.collect().await;
    
    println!("–ó—ñ–±—Ä–∞–Ω–æ: {:?}", collected);
    // –í–∏–≤–µ–¥–µ: –ó—ñ–±—Ä–∞–Ω–æ: [1, 2, 3, 4, 5]
}
```

**–í–∞–∂–ª–∏–≤–µ –∑–∞—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ collect():**

`collect()` —á–µ–∫–∞—î **–≤—Å—ñ—Ö** –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ stream. –î–ª—è –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ–≥–æ stream ‚Äî –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–≤–∏—Å–Ω–µ –Ω–∞–∑–∞–≤–∂–¥–∏. –î–ª—è –¥—É–∂–µ –≤–µ–ª–∏–∫–æ–≥–æ stream ‚Äî –º–æ–∂–µ –≤–∏—á–µ—Ä–ø–∞—Ç–∏—Å—å –ø–∞–º'—è—Ç—å.

```rust
// ‚ö†Ô∏è –ù–ï–ë–ï–ó–ü–ï–ß–ù–û: –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π stream!
let infinite_stream = stream::repeat(1);
let all: Vec<i32> = infinite_stream.collect().await; // –ó–ê–í–ò–°–ù–ï!
```

### 40.3.4 –û–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —á–µ—Ä–µ–∑ take()

–î–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–º–∏ streams –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `take()`:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É—î–º–æ –±–µ–∑–ø–µ—á–Ω—É –æ–±—Ä–æ–±–∫—É –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ–≥–æ stream.

```rust
use tokio_stream::StreamExt;
use futures::stream;

#[tokio::main]
async fn main() {
    // –ù–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π stream —á–∏—Å–µ–ª: 0, 1, 2, 3, ...
    let infinite = stream::iter(0..);
    
    // take(10) –æ–±–º–µ–∂—É—î –¥–æ –ø–µ—Ä—à–∏—Ö 10 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    let limited = infinite.take(10);
    
    // –¢–µ–ø–µ—Ä –±–µ–∑–ø–µ—á–Ω–æ –∑–±–∏—Ä–∞—Ç–∏
    let first_ten: Vec<i32> = limited.collect().await;
    
    println!("–ü–µ—Ä—à—ñ 10: {:?}", first_ten);
    // –í–∏–≤–µ–¥–µ: –ü–µ—Ä—à—ñ 10: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
}
```

`take(n)` —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π stream, —â–æ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è n –µ–ª–µ–º–µ–Ω—Ç—ñ–≤. –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π stream –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–º ‚Äî `take()` –≥–∞—Ä–∞–Ω—Ç—É—î –∫—ñ–Ω—Ü–µ–≤—ñ—Å—Ç—å.

---

## 40.4 –°–¢–í–û–†–ï–ù–ù–Ø STREAMS: –ó–í–Ü–î–ö–ò –ë–ï–†–£–¢–¨–°–Ø –ï–õ–ï–ú–ï–ù–¢–ò

### 40.4.1 Stream –∑ async –∫–∞–Ω–∞–ª—É (ReceiverStream)

–ù–∞–π–ø—Ä–∏—Ä–æ–¥–Ω—ñ—à–∏–π —Å–ø–æ—Å—ñ–± —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è stream ‚Äî –∑ async –∫–∞–Ω–∞–ª—É. `tokio::sync::mpsc::Receiver` –º–æ–∂–Ω–∞ –æ–±–≥–æ—Ä–Ω—É—Ç–∏ –≤ `ReceiverStream`:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∂–µ–º–æ —Ç–∏–ø–æ–≤–∏–π –ø–∞—Ç–µ—Ä–Ω, –¥–µ producer –Ω–∞–¥—Å–∏–ª–∞—î –¥–∞–Ω—ñ, –∞ consumer –æ–±—Ä–æ–±–ª—è—î —ó—Ö —è–∫ stream.

```rust
use tokio::sync::mpsc;
use tokio_stream::wrappers::ReceiverStream;
use tokio_stream::StreamExt;
use tokio::time::{sleep, Duration};

#[derive(Debug)]
struct SensorReading {
    sensor_id: u32,
    value: f64,
    timestamp: u64,
}

#[tokio::main]
async fn main() {
    // –ö–∞–Ω–∞–ª –¥–ª—è –ø–æ–∫–∞–∑–∞–Ω—å —Å–µ–Ω—Å–æ—Ä—ñ–≤
    let (tx, rx) = mpsc::channel::<SensorReading>(100);
    
    // –û–±–≥–æ—Ä—Ç–∞—î–º–æ Receiver —É Stream
    let sensor_stream = ReceiverStream::new(rx);
    
    // Producer: —Å–∏–º—É–ª—é—î —Å–µ–Ω—Å–æ—Ä, —â–æ –≥–µ–Ω–µ—Ä—É—î –ø–æ–∫–∞–∑–∞–Ω–Ω—è
    let producer = tokio::spawn(async move {
        for i in 1..=10 {
            let reading = SensorReading {
                sensor_id: 1,
                value: 20.0 + (i as f64) * 0.5,  // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
                timestamp: i as u64 * 100,
            };
            
            println!("[–°–µ–Ω—Å–æ—Ä] –ì–µ–Ω–µ—Ä—É—é –ø–æ–∫–∞–∑–∞–Ω–Ω—è #{}", i);
            tx.send(reading).await.expect("Receiver –∑–∞–∫—Ä–∏—Ç–æ");
            
            // –Ü–Ω—Ç–µ—Ä–≤–∞–ª –º—ñ–∂ –ø–æ–∫–∞–∑–∞–Ω–Ω—è–º–∏
            sleep(Duration::from_millis(200)).await;
        }
        println!("[–°–µ–Ω—Å–æ—Ä] –ó–∞–≤–µ—Ä—à—É—é —Ä–æ–±–æ—Ç—É");
        // tx –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ drop'–∞—î—Ç—å—Å—è, –∫–∞–Ω–∞–ª –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è
    });
    
    // Consumer: –æ–±—Ä–æ–±–ª—è—î stream –ø–æ–∫–∞–∑–∞–Ω—å
    let consumer = tokio::spawn(async move {
        // pin –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è –¥–µ—è–∫–∏—Ö stream –æ–ø–µ—Ä–∞—Ü—ñ–π
        tokio::pin!(sensor_stream);
        
        while let Some(reading) = sensor_stream.next().await {
            println!("[–û–±—Ä–æ–±–∫–∞] {:?}", reading);
        }
        
        println!("[–û–±—Ä–æ–±–∫–∞] Stream –∑–∞–≤–µ—Ä—à–µ–Ω–æ");
    });
    
    // –ß–µ–∫–∞—î–º–æ –æ–±–æ—Ö
    let _ = tokio::join!(producer, consumer);
}
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤ —Ü—ñ–π –ø—Ä–æ–≥—Ä–∞–º—ñ:**

1. –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è mpsc –∫–∞–Ω–∞–ª –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ `SensorReading`
2. `Receiver` –æ–±–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è –≤ `ReceiverStream` ‚Äî —Ç–µ–ø–µ—Ä —Ü–µ Stream
3. Producer (—Å–∏–º—É–ª—è—Ü—ñ—è —Å–µ–Ω—Å–æ—Ä–∞) –Ω–∞–¥—Å–∏–ª–∞—î –ø–æ–∫–∞–∑–∞–Ω–Ω—è —á–µ—Ä–µ–∑ `tx.send()`
4. Consumer —á–∏—Ç–∞—î —á–µ—Ä–µ–∑ `stream.next().await`
5. –ö–æ–ª–∏ producer –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è, `tx` drop'–∞—î—Ç—å—Å—è
6. –ö–∞–Ω–∞–ª –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è, `stream.next()` –ø–æ–≤–µ—Ä—Ç–∞—î `None`
7. Consumer –≤–∏—Ö–æ–¥–∏—Ç—å –∑ —Ü–∏–∫–ª—É

### 40.4.2 Stream –∑ Iterator (stream::iter)

–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π Iterator –º–æ–∂–Ω–∞ –º–∏—Ç—Ç—î–≤–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–∞ Stream:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ stream –∑—ñ —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∞–±–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó.

```rust
use futures::stream;
use tokio_stream::StreamExt;

#[tokio::main]
async fn main() {
    // –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ Vec –Ω–∞ Stream
    let commands = vec!["SCAN", "MOVE", "REPORT", "SHUTDOWN"];
    let command_stream = stream::iter(commands);
    
    // –¢–µ–ø–µ—Ä –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Stream API
    tokio::pin!(command_stream);
    
    while let Some(cmd) = command_stream.next().await {
        println!("–ö–æ–º–∞–Ω–¥–∞: {}", cmd);
    }
}
```

**–í–∞–∂–ª–∏–≤–∏–π –Ω—é–∞–Ω—Å:** –ï–ª–µ–º–µ–Ω—Ç–∏ `stream::iter` –¥–æ—Å—Ç—É–ø–Ω—ñ **–æ–¥—Ä–∞–∑—É** ‚Äî –Ω–µ–º–∞—î —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è. –¶–µ –Ω–µ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π async stream, –∞ —Å–∫–æ—Ä—ñ—à–µ –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Iterator –∑ Stream API. –ö–æ—Ä–∏—Å–Ω–æ –¥–ª—è:
- –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–æ–¥—É, —â–æ –ø—Ä–∞—Ü—é—î –∑—ñ streams
- –û–±'—î–¥–Ω–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∑ async streams
- –ü—Ä–æ—Ç–æ—Ç–∏–ø—É–≤–∞–Ω–Ω—è

### 40.4.3 Stream –∑ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É (IntervalStream)

–ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∏–π stream –≥–µ–Ω–µ—Ä—É—î –µ–ª–µ–º–µ–Ω—Ç–∏ —á–µ—Ä–µ–∑ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ–º—ñ–∂–∫–∏ —á–∞—Å—É:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ stream –¥–ª—è –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π (heartbeat, polling).

```rust
use tokio::time::{interval, Duration, Instant};
use tokio_stream::wrappers::IntervalStream;
use tokio_stream::StreamExt;

#[tokio::main]
async fn main() {
    // –Ü–Ω—Ç–µ—Ä–≤–∞–ª –∫–æ–∂–Ω—ñ 500–º—Å
    let interval = interval(Duration::from_millis(500));
    let mut tick_stream = IntervalStream::new(interval);
    
    let start = Instant::now();
    
    // –û–±—Ä–æ–±–ª—è—î–º–æ –ø–µ—Ä—à—ñ 5 —Ç—ñ–∫—ñ–≤
    for i in 1..=5 {
        // next() —á–µ–∫–∞—î –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ç—ñ–∫—É
        let tick_instant = tick_stream.next().await;
        
        let elapsed = start.elapsed().as_millis();
        println!("–¢—ñ–∫ #{} –æ {}–º—Å", i, elapsed);
    }
    
    println!("–ó–∞–≤–µ—Ä—à–µ–Ω–æ");
}
```

**–í–∏–≤—ñ–¥ –ø—Ä–æ–≥—Ä–∞–º–∏:**

```text
–¢—ñ–∫ #1 –æ 0–º—Å       <- –ü–µ—Ä—à–∏–π —Ç—ñ–∫ –Ω–µ–≥–∞–π–Ω–∏–π!
–¢—ñ–∫ #2 –æ 500–º—Å
–¢—ñ–∫ #3 –æ 1000–º—Å
–¢—ñ–∫ #4 –æ 1500–º—Å
–¢—ñ–∫ #5 –æ 2000–º—Å
–ó–∞–≤–µ—Ä—à–µ–Ω–æ
```

**–û—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å:** –ü–µ—Ä—à–∏–π —Ç—ñ–∫ `IntervalStream` –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è **–Ω–µ–≥–∞–π–Ω–æ** (—è–∫ —ñ `tokio::time::interval`). –¶–µ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ `sleep`, –¥–µ –ø–µ—Ä—à–∞ –∑–∞—Ç—Ä–∏–º–∫–∞ —î.

### 40.4.4 –í–ª–∞—Å–Ω–∏–π Stream —á–µ—Ä–µ–∑ async_stream::stream!

–î–ª—è —Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –∫—Ä–µ–π—Ç `async-stream` –Ω–∞–¥–∞—î –º–∞–∫—Ä–æ—Å `stream!`:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ stream, —â–æ –≥–µ–Ω–µ—Ä—É—î –µ–ª–µ–º–µ–Ω—Ç–∏ –∑ async –ª–æ–≥—ñ–∫–æ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ.

```rust
use async_stream::stream;
use tokio_stream::StreamExt;
use tokio::time::{sleep, Duration};

#[tokio::main]
async fn main() {
    // stream! –¥–æ–∑–≤–æ–ª—è—î yield –∑–Ω–∞—á–µ–Ω–Ω—è –∑ async –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
    let custom_stream = stream! {
        println!("[Stream] –ü–æ—á–∞—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó");
        
        for i in 1..=5 {
            // –ú–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ await –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ!
            sleep(Duration::from_millis(200)).await;
            
            println!("[Stream] –ì–µ–Ω–µ—Ä—É—é –∑–Ω–∞—á–µ–Ω–Ω—è {}", i);
            
            // yield ‚Äî –≤–∏–¥–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è —É stream
            yield i * 10;
        }
        
        println!("[Stream] –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó");
    };
    
    // –°–ø–æ–∂–∏–≤–∞—î–º–æ stream
    tokio::pin!(custom_stream);
    
    while let Some(value) = custom_stream.next().await {
        println!("[Consumer] –û—Ç—Ä–∏–º–∞–Ω–æ: {}", value);
    }
    
    println!("–ì–æ—Ç–æ–≤–æ!");
}
```

**–í–∏–≤—ñ–¥ –ø—Ä–æ–≥—Ä–∞–º–∏:**

```text
[Stream] –ü–æ—á–∞—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
[Stream] –ì–µ–Ω–µ—Ä—É—é –∑–Ω–∞—á–µ–Ω–Ω—è 1
[Consumer] –û—Ç—Ä–∏–º–∞–Ω–æ: 10
[Stream] –ì–µ–Ω–µ—Ä—É—é –∑–Ω–∞—á–µ–Ω–Ω—è 2
[Consumer] –û—Ç—Ä–∏–º–∞–Ω–æ: 20
[Stream] –ì–µ–Ω–µ—Ä—É—é –∑–Ω–∞—á–µ–Ω–Ω—è 3
[Consumer] –û—Ç—Ä–∏–º–∞–Ω–æ: 30
[Stream] –ì–µ–Ω–µ—Ä—É—é –∑–Ω–∞—á–µ–Ω–Ω—è 4
[Consumer] –û—Ç—Ä–∏–º–∞–Ω–æ: 40
[Stream] –ì–µ–Ω–µ—Ä—É—é –∑–Ω–∞—á–µ–Ω–Ω—è 5
[Consumer] –û—Ç—Ä–∏–º–∞–Ω–æ: 50
[Stream] –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
–ì–æ—Ç–æ–≤–æ!
```

**–ú–∞–≥—ñ—è stream! –º–∞–∫—Ä–æ—Å—É:**

1. –í—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `.await` ‚Äî —Ü–µ async –∫–æ–Ω—Ç–µ–∫—Å—Ç
2. `yield value` –≤–∏–¥–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤ stream
3. –í–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–∏–∑—É–ø–∏–Ω—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è `yield` –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ `poll_next()`
4. –ö–æ–ª–∏ –±–ª–æ–∫ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è ‚Äî stream –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è (–ø–æ–≤–µ—Ä—Ç–∞—î None)

---

## 40.5 –¢–†–ê–ù–°–§–û–†–ú–ê–¶–Ü–Ø STREAMS: –ö–û–ú–ë–Ü–ù–ê–¢–û–†–ò

### 40.5.1 map(): —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤

`map()` –∑–∞—Å—Ç–æ—Å–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞, —Å—Ç–≤–æ—Ä—é—é—á–∏ –Ω–æ–≤–∏–π stream:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–µ—Ä–µ—Ç–≤–æ—Ä–∏–º–æ stream —á–∏—Å–µ–ª –Ω–∞ stream —ó—Ö –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤.

```rust
use futures::stream;
use tokio_stream::StreamExt;

#[tokio::main]
async fn main() {
    let numbers = stream::iter(vec![1, 2, 3, 4, 5]);
    
    // map() —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç
    let squares = numbers.map(|n| {
        println!("  –û–±—á–∏—Å–ª—é—é –∫–≤–∞–¥—Ä–∞—Ç {}", n);
        n * n
    });
    
    // –°–ø–æ–∂–∏–≤–∞—î–º–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–∏–π stream
    tokio::pin!(squares);
    
    while let Some(sq) = squares.next().await {
        println!("–†–µ–∑—É–ª—å—Ç–∞—Ç: {}", sq);
    }
}
```

**–í–∏–≤—ñ–¥:**

```text
  –û–±—á–∏—Å–ª—é—é –∫–≤–∞–¥—Ä–∞—Ç 1
–†–µ–∑—É–ª—å—Ç–∞—Ç: 1
  –û–±—á–∏—Å–ª—é—é –∫–≤–∞–¥—Ä–∞—Ç 2
–†–µ–∑—É–ª—å—Ç–∞—Ç: 4
  –û–±—á–∏—Å–ª—é—é –∫–≤–∞–¥—Ä–∞—Ç 3
–†–µ–∑—É–ª—å—Ç–∞—Ç: 9
  –û–±—á–∏—Å–ª—é—é –∫–≤–∞–¥—Ä–∞—Ç 4
–†–µ–∑—É–ª—å—Ç–∞—Ç: 16
  –û–±—á–∏—Å–ª—é—é –∫–≤–∞–¥—Ä–∞—Ç 5
–†–µ–∑—É–ª—å—Ç–∞—Ç: 25
```

**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É:** –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è **–ª—ñ–Ω–∏–≤–æ** ‚Äî —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –µ–ª–µ–º–µ–Ω—Ç –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `next()`.

### 40.5.2 then(): async —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤

`map()` –ø—Ä–∏–π–º–∞—î —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é. –î–ª—è async —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `then()`:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –î–ª—è –∫–æ–∂–Ω–æ–≥–æ ID –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–º–æ –¥–∞–Ω—ñ (—Å–∏–º—É–ª—è—Ü—ñ—è async –æ–ø–µ—Ä–∞—Ü—ñ—ó).

```rust
use futures::stream;
use tokio_stream::StreamExt;
use tokio::time::{sleep, Duration};

async fn fetch_data(id: u32) -> String {
    // –°–∏–º—É–ª—è—Ü—ñ—è async –æ–ø–µ—Ä–∞—Ü—ñ—ó (–º–µ—Ä–µ–∂–µ–≤–∏–π –∑–∞–ø–∏—Ç)
    sleep(Duration::from_millis(100)).await;
    format!("Data for ID {}", id)
}

#[tokio::main]
async fn main() {
    let ids = stream::iter(vec![1, 2, 3, 4, 5]);
    
    // then() –ø—Ä–∏–π–º–∞—î async —Ñ—É–Ω–∫—Ü—ñ—é
    let data_stream = ids.then(|id| async move {
        println!("  –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –¥–∞–Ω—ñ –¥–ª—è ID {}", id);
        fetch_data(id).await
    });
    
    tokio::pin!(data_stream);
    
    while let Some(data) = data_stream.next().await {
        println!("–û—Ç—Ä–∏–º–∞–Ω–æ: {}", data);
    }
}
```

**–†—ñ–∑–Ω–∏—Ü—è map() vs then():**

| –ú–µ—Ç–æ–¥ | –§—É–Ω–∫—Ü—ñ—è | –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è |
|-------|---------|--------------|
| `map(f)` | `FnMut(Item) -> T` | –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è |
| `then(f)` | `FnMut(Item) -> Future<Output=T>` | Async –æ–ø–µ—Ä–∞—Ü—ñ—ó |

### 40.5.3 filter(): –≤–∏–±—ñ—Ä–∫–∞ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤

`filter()` –ø—Ä–æ–ø—É—Å–∫–∞—î —Ç—ñ–ª—å–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏, —â–æ –∑–∞–¥–æ–≤–æ–ª—å–Ω—è—é—Ç—å –ø—Ä–µ–¥–∏–∫–∞—Ç:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –í—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É—î–º–æ stream, –∑–∞–ª–∏—à–∏–≤—à–∏ —Ç—ñ–ª—å–∫–∏ –ø–∞—Ä–Ω—ñ —á–∏—Å–ª–∞.

```rust
use futures::stream;
use tokio_stream::StreamExt;

#[tokio::main]
async fn main() {
    let numbers = stream::iter(1..=10);
    
    // filter() –∑–∞–ª–∏—à–∞—î –µ–ª–µ–º–µ–Ω—Ç–∏, –¥–µ –ø—Ä–µ–¥–∏–∫–∞—Ç –ø–æ–≤–µ—Ä—Ç–∞—î true
    let even_numbers = numbers.filter(|n| {
        let is_even = n % 2 == 0;
        println!("  –ü–µ—Ä–µ–≤—ñ—Ä—è—é {}: –ø–∞—Ä–Ω–µ = {}", n, is_even);
        is_even
    });
    
    tokio::pin!(even_numbers);
    
    println!("–ü–∞—Ä–Ω—ñ —á–∏—Å–ª–∞:");
    while let Some(n) = even_numbers.next().await {
        println!("  {}", n);
    }
}
```

**–í–∏–≤—ñ–¥:**

```rust
  –ü–µ—Ä–µ–≤—ñ—Ä—è—é 1: –ø–∞—Ä–Ω–µ = false
  –ü–µ—Ä–µ–≤—ñ—Ä—è—é 2: –ø–∞—Ä–Ω–µ = true
–ü–∞—Ä–Ω—ñ —á–∏—Å–ª–∞:
  2
  –ü–µ—Ä–µ–≤—ñ—Ä—è—é 3: –ø–∞—Ä–Ω–µ = false
  –ü–µ—Ä–µ–≤—ñ—Ä—è—é 4: –ø–∞—Ä–Ω–µ = true
  4
...
```

### 40.5.4 filter_map(): –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó

`filter_map()` ‚Äî –ø–æ—Ç—É–∂–Ω–∏–π –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä, —â–æ –æ–¥–Ω–æ—á–∞—Å–Ω–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä—É—î:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–∞—Ä—Å–∏–º–æ stream —Ä—è–¥–∫—ñ–≤ —É —á–∏—Å–ª–∞, —ñ–≥–Ω–æ—Ä—É—é—á–∏ –Ω–µ–≤–∞–ª—ñ–¥–Ω—ñ.

```rust
use futures::stream;
use tokio_stream::StreamExt;

#[tokio::main]
async fn main() {
    let strings = stream::iter(vec!["10", "abc", "20", "xyz", "30"]);
    
    // filter_map –ø–æ–≤–µ—Ä—Ç–∞—î Option:
    // Some(value) ‚Äî –µ–ª–µ–º–µ–Ω—Ç –≤–∫–ª—é—á–∞—î—Ç—å—Å—è
    // None ‚Äî –µ–ª–µ–º–µ–Ω—Ç –ø—Ä–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è
    let valid_numbers = strings.filter_map(|s| async move {
        match s.parse::<i32>() {
            Ok(n) => {
                println!("  '{}' -> {}", s, n);
                Some(n)
            }
            Err(_) => {
                println!("  '{}' -> –ø—Ä–æ–ø—É—â–µ–Ω–æ (–Ω–µ —á–∏—Å–ª–æ)", s);
                None
            }
        }
    });
    
    tokio::pin!(valid_numbers);
    
    let sum: i32 = valid_numbers.fold(0, |acc, n| async move { acc + n }).await;
    println!("–°—É–º–∞ –≤–∞–ª—ñ–¥–Ω–∏—Ö —á–∏—Å–µ–ª: {}", sum);
}
```

**–í–∏–≤—ñ–¥:**

```rust
  '10' -> 10
  'abc' -> –ø—Ä–æ–ø—É—â–µ–Ω–æ (–Ω–µ —á–∏—Å–ª–æ)
  '20' -> 20
  'xyz' -> –ø—Ä–æ–ø—É—â–µ–Ω–æ (–Ω–µ —á–∏—Å–ª–æ)
  '30' -> 30
–°—É–º–∞ –≤–∞–ª—ñ–¥–Ω–∏—Ö —á–∏—Å–µ–ª: 60
```

### 40.5.5 take() —Ç–∞ skip(): –æ–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü—Ä–æ–ø—É—Å—Ç–∏–º–æ –ø–µ—Ä—à—ñ 3 –µ–ª–µ–º–µ–Ω—Ç–∏ —Ç–∞ –≤—ñ–∑—å–º–µ–º–æ –Ω–∞—Å—Ç—É–ø–Ω—ñ 5.

```rust
use futures::stream;
use tokio_stream::StreamExt;

#[tokio::main]
async fn main() {
    let numbers = stream::iter(1..=20);
    
    // skip(3) –ø—Ä–æ–ø—É—Å–∫–∞—î –ø–µ—Ä—à—ñ 3
    // take(5) –±–µ—Ä–µ –Ω–∞—Å—Ç—É–ø–Ω—ñ 5
    let subset = numbers.skip(3).take(5);
    
    tokio::pin!(subset);
    
    let result: Vec<i32> = subset.collect().await;
    println!("–†–µ–∑—É–ª—å—Ç–∞—Ç: {:?}", result);
    // –í–∏–≤–µ–¥–µ: [4, 5, 6, 7, 8]
}
```

---

## 40.6 –û–ë'–Ñ–î–ù–ê–ù–ù–Ø STREAMS: –ö–Ü–õ–¨–ö–ê –î–ñ–ï–†–ï–õ

### 40.6.1 –ü—Ä–æ–±–ª–µ–º–∞ –∫—ñ–ª—å–∫–æ—Ö –¥–∂–µ—Ä–µ–ª –¥–∞–Ω–∏—Ö

–ü–æ–≤–µ—Ä–Ω—ñ–º–æ—Å—å –¥–æ –º–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–æ–≥–æ –∫–µ–π—Å—É: –ë–ü–õ–ê –∑ –∫—ñ–ª—å–∫–æ–º–∞ —Å–µ–Ω—Å–æ—Ä–∞–º–∏. –ö–æ–∂–µ–Ω —Å–µ–Ω—Å–æ—Ä ‚Äî –æ–∫—Ä–µ–º–∏–π stream. –Ø–∫ —ó—Ö –æ–±—Ä–æ–±–ª—è—Ç–∏?

**–ü—ñ–¥—Ö—ñ–¥ 1: –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–æ (–ø–æ–≥–∞–Ω–∏–π)**
```rust
// ‚ùå –ü–û–ì–ê–ù–û: –æ–±—Ä–æ–±–ª—è—î–º–æ —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω stream
while let Some(gps) = gps_stream.next().await {
    process_gps(gps);
}
// –î–æ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –¥—ñ–π–¥–µ–º–æ, —è–∫—â–æ GPS –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π
```

**–ü—ñ–¥—Ö—ñ–¥ 2: –û–∫—Ä–µ–º—ñ –∑–∞–¥–∞—á—ñ (–ø—Ä–∏–π–Ω—è—Ç–Ω–∏–π)**
```rust
// –ö–æ–∂–µ–Ω stream —É —Å–≤–æ—ó–π –∑–∞–¥–∞—á—ñ
tokio::spawn(async move {
    while let Some(gps) = gps_stream.next().await {
        process_gps(gps);
    }
});

tokio::spawn(async move {
    while let Some(accel) = accel_stream.next().await {
        process_accel(accel);
    }
});
```

**–ü—ñ–¥—Ö—ñ–¥ 3: merge() (–Ω–∞–π–∫—Ä–∞—â–∏–π –¥–ª—è –±–∞–≥–∞—Ç—å–æ—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤)**
```rust
// –û–±'—î–¥–Ω—É—î–º–æ –≤ –æ–¥–∏–Ω stream
let merged = gps_stream.merge(accel_stream);

while let Some(reading) = merged.next().await {
    match reading {
        Either::Left(gps) => process_gps(gps),
        Either::Right(accel) => process_accel(accel),
    }
}
```

### 40.6.2 merge(): —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤

`merge()` –æ–±'—î–¥–Ω—É—î –¥–≤–∞ streams, –≤–∏–¥–∞—é—á–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ **–≤ –ø–æ—Ä—è–¥–∫—É —ó—Ö –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ**:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –û–±'—î–¥–Ω–∞—î–º–æ –¥–≤–∞ –ø–æ—Ç–æ–∫–∏ —Å–µ–Ω—Å–æ—Ä—ñ–≤ –∑ —Ä—ñ–∑–Ω–æ—é —á–∞—Å—Ç–æ—Ç–æ—é.

```rust
use tokio_stream::StreamExt;
use tokio::time::{interval, Duration};
use tokio_stream::wrappers::IntervalStream;
use async_stream::stream;

#[derive(Debug)]
enum SensorData {
    Gps { lat: f64, lon: f64 },
    Accel { x: f64, y: f64, z: f64 },
}

#[tokio::main]
async fn main() {
    // GPS: –∫–æ–∂–Ω—ñ 500–º—Å
    let gps_stream = stream! {
        let mut interval = interval(Duration::from_millis(500));
        for i in 1..=4 {
            interval.tick().await;
            yield SensorData::Gps { 
                lat: 50.0 + i as f64 * 0.001, 
                lon: 30.0 + i as f64 * 0.001 
            };
        }
    };
    
    // –ê–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä: –∫–æ–∂–Ω—ñ 200–º—Å
    let accel_stream = stream! {
        let mut interval = interval(Duration::from_millis(200));
        for i in 1..=6 {
            interval.tick().await;
            yield SensorData::Accel { 
                x: i as f64 * 0.1, 
                y: i as f64 * 0.2, 
                z: 9.8 
            };
        }
    };
    
    // –û–±'—î–¥–Ω—É—î–º–æ —á–µ—Ä–µ–∑ merge
    let merged = gps_stream.merge(accel_stream);
    tokio::pin!(merged);
    
    let start = std::time::Instant::now();
    
    while let Some(data) = merged.next().await {
        let elapsed = start.elapsed().as_millis();
        println!("[{:4}–º—Å] {:?}", elapsed, data);
    }
}
```

**–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–≤–æ–¥—É:**

```rust
[   0–º—Å] Accel { x: 0.1, y: 0.2, z: 9.8 }     <- –ü–µ—Ä—à–∏–π —Ç—ñ–∫ –Ω–µ–≥–∞–π–Ω–∏–π
[   0–º—Å] Gps { lat: 50.001, lon: 30.001 }
[ 200–º—Å] Accel { x: 0.2, y: 0.4, z: 9.8 }
[ 400–º—Å] Accel { x: 0.3, y: 0.6, z: 9.8 }
[ 500–º—Å] Gps { lat: 50.002, lon: 30.002 }
[ 600–º—Å] Accel { x: 0.4, y: 0.8, z: 9.8 }
[ 800–º—Å] Accel { x: 0.5, y: 1.0, z: 9.8 }
[1000–º—Å] Gps { lat: 50.003, lon: 30.003 }
         Accel { x: 0.6, y: 1.2, z: 9.8 }
[1500–º—Å] Gps { lat: 50.004, lon: 30.004 }
```

**–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è merge:**

```text
GPS Stream:        ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè
                   0        500      1000      1500 –º—Å

Accel Stream:      ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè
                   0  200 400 600 800 1000 –º—Å

Merged:            ‚óè‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚óè‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè‚óè‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè
                   ‚Üë‚Üë  ‚Üë   ‚Üë ‚Üë ‚Üë   ‚Üë‚Üë  ‚Üë         ‚Üë
                   GA  A   A GA   GA  A         G

–ü–æ—Ä—è–¥–æ–∫ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è —Ç–∏–º, —è–∫–∏–π stream –≥–æ—Ç–æ–≤–∏–π –ø–µ—Ä—à–∏–º
```

### 40.6.3 chain(): –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è

–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ `merge()`, `chain()` –≤–∏–¥–∞—î **—Å–ø–æ—á–∞—Ç–∫—É –≤—Å—ñ** –µ–ª–µ–º–µ–Ω—Ç–∏ –ø–µ—Ä—à–æ–≥–æ stream, **–ø–æ—Ç—ñ–º –≤—Å—ñ** –µ–ª–µ–º–µ–Ω—Ç–∏ –¥—Ä—É–≥–æ–≥–æ:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –û–±'—î–¥–Ω–∞—î–º–æ historical –¥–∞–Ω—ñ –∑ live stream.

```rust
use futures::stream;
use tokio_stream::StreamExt;

#[tokio::main]
async fn main() {
    // –Ü—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ (–≤–∂–µ —î)
    let historical = stream::iter(vec![
        "–ê—Ä—Ö—ñ–≤–Ω–∏–π –∑–∞–ø–∏—Å 1",
        "–ê—Ä—Ö—ñ–≤–Ω–∏–π –∑–∞–ø–∏—Å 2",
        "–ê—Ä—Ö—ñ–≤–Ω–∏–π –∑–∞–ø–∏—Å 3",
    ]);
    
    // Live –¥–∞–Ω—ñ (–Ω–∞–¥—Ö–æ–¥—è—Ç—å —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ)
    let live = stream::iter(vec![
        "Live –∑–∞–ø–∏—Å 1",
        "Live –∑–∞–ø–∏—Å 2",
    ]);
    
    // chain: —Å–ø–æ—á–∞—Ç–∫—É historical, –ø–æ—Ç—ñ–º live
    let combined = historical.chain(live);
    
    tokio::pin!(combined);
    
    while let Some(record) = combined.next().await {
        println!("{}", record);
    }
}
```

**–í–∏–≤—ñ–¥:**

```text
–ê—Ä—Ö—ñ–≤–Ω–∏–π –∑–∞–ø–∏—Å 1
–ê—Ä—Ö—ñ–≤–Ω–∏–π –∑–∞–ø–∏—Å 2
–ê—Ä—Ö—ñ–≤–Ω–∏–π –∑–∞–ø–∏—Å 3
Live –∑–∞–ø–∏—Å 1
Live –∑–∞–ø–∏—Å 2
```

**–ö–æ–ª–∏ —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**

| –ú–µ—Ç–æ–¥ | –ü–æ—Ä—è–¥–æ–∫ | –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è |
|-------|---------|--------------|
| `merge()` | –ó–∞ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—é | –ö—ñ–ª—å–∫–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª |
| `chain()` | –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π | –ê—Ä—Ö—ñ–≤ + live, fallback |

---

## 40.7 –ë–£–§–ï–†–ò–ó–ê–¶–Ü–Ø –¢–ê –ü–ê–ö–ï–¢–ù–ê –û–ë–†–û–ë–ö–ê

### 40.7.1 –ù–∞–≤—ñ—â–æ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—è?

–û–±—Ä–æ–±–∫–∞ –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –æ–∫—Ä–µ–º–æ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—é:
- –ú–µ—Ä–µ–∂–µ–≤—ñ –∑–∞–ø–∏—Ç–∏: –∫—Ä–∞—â–µ batch insert, –Ω—ñ–∂ 1000 –æ–∫—Ä–µ–º–∏—Ö INSERT
- –§–∞–π–ª–æ–≤–∏–π I/O: –∫—Ä–∞—â–µ –∑–∞–ø–∏—Å–∞—Ç–∏ –±–ª–æ–∫, –Ω—ñ–∂ –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ
- –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞: –∞–≥—Ä–µ–≥–∞—Ü—ñ—è –ø–æ—Ç—Ä–µ–±—É—î –≥—Ä—É–ø–∏ –¥–∞–Ω–∏—Ö

### 40.7.2 chunks(): –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤

`chunks()` –∑–±–∏—Ä–∞—î –µ–ª–µ–º–µ–Ω—Ç–∏ —É –≤–µ–∫—Ç–æ—Ä–∏ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ó–≥—Ä—É–ø—É—î–º–æ –ø–æ–∫–∞–∑–∞–Ω–Ω—è —Å–µ–Ω—Å–æ—Ä–∞ –¥–ª—è batch-–æ–±—Ä–æ–±–∫–∏.

```rust
use futures::stream;
use tokio_stream::StreamExt;

#[tokio::main]
async fn main() {
    let readings = stream::iter(1..=25);
    
    // chunks(10) –≥—Ä—É–ø—É—î –ø–æ 10 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
    let batched = readings.chunks(10);
    
    tokio::pin!(batched);
    
    let mut batch_num = 0;
    while let Some(batch) = batched.next().await {
        batch_num += 1;
        println!("Batch #{}: {:?}", batch_num, batch);
        
        // –¢—É—Ç –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ batch insert –≤ –±–∞–∑—É
        // –∞–±–æ –∞–≥—Ä–µ–≥—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    }
}
```

**–í–∏–≤—ñ–¥:**

```text
Batch #1: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
Batch #2: [11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
Batch #3: [21, 22, 23, 24, 25]    <- –û—Å—Ç–∞–Ω–Ω—ñ–π batch –º–æ–∂–µ –±—É—Ç–∏ –º–µ–Ω—à–∏–º
```

### 40.7.3 chunks_timeout(): —á–∞—Å + —Ä–æ–∑–º—ñ—Ä

`chunks_timeout()` –≥—Ä—É–ø—É—î –µ–ª–µ–º–µ–Ω—Ç–∏, –∞–ª–µ –Ω–µ —á–µ–∫–∞—î –≤—ñ—á–Ω–æ ‚Äî —î timeout:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ó–±–∏—Ä–∞—î–º–æ batch –º–∞–∫—Å–∏–º—É–º 10 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –ê–ë–û –∫–æ–∂–Ω—ñ 500–º—Å (—â–æ —Ä–∞–Ω—ñ—à–µ).

```rust
use tokio_stream::StreamExt;
use tokio::time::Duration;
use async_stream::stream;

#[tokio::main]
async fn main() {
    // Stream –∑ –Ω–µ—Ä—ñ–≤–Ω–æ–º—ñ—Ä–Ω–æ—é —à–≤–∏–¥–∫—ñ—Å—Ç—é
    let sensor_stream = stream! {
        for i in 1..=15 {
            // –ü–µ—Ä—à—ñ 5 ‚Äî —à–≤–∏–¥–∫–æ
            if i <= 5 {
                tokio::time::sleep(Duration::from_millis(50)).await;
            } else {
                // –†–µ—à—Ç–∞ ‚Äî –ø–æ–≤—ñ–ª—å–Ω–æ
                tokio::time::sleep(Duration::from_millis(200)).await;
            }
            yield i;
        }
    };
    
    // chunks_timeout: max 10 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –ê–ë–û 500–º—Å timeout
    let batched = sensor_stream.chunks_timeout(10, Duration::from_millis(500));
    
    tokio::pin!(batched);
    
    let start = std::time::Instant::now();
    
    while let Some(batch) = batched.next().await {
        let elapsed = start.elapsed().as_millis();
        println!("[{:4}–º—Å] Batch: {:?}", elapsed, batch);
    }
}
```

**–ú–æ–∂–ª–∏–≤–∏–π –≤–∏–≤—ñ–¥:**

```text
[ 250–º—Å] Batch: [1, 2, 3, 4, 5]     <- 5 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑–∞ 250–º—Å, –ø–æ—Ç—ñ–º timeout
[ 750–º—Å] Batch: [6, 7]              <- –¢—ñ–ª—å–∫–∏ 2 –∑–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ 500–º—Å
[1250–º—Å] Batch: [8, 9]
...
```

---

## 40.8 STREAMS –î–õ–Ø –ê–ì–ï–ù–¢–Ü–í: –ü–†–ê–ö–¢–ò–ß–ù–Ü –ü–ê–¢–ï–†–ù–ò

### 40.8.1 –û–±—Ä–æ–±–∫–∞ –∫–æ–º–∞–Ω–¥ —è–∫ Stream

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ê–≥–µ–Ω—Ç –æ—Ç—Ä–∏–º—É—î –∫–æ–º–∞–Ω–¥–∏ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª —ñ –æ–±—Ä–æ–±–ª—è—î —ó—Ö —è–∫ stream.

```rust
use tokio::sync::mpsc;
use tokio_stream::wrappers::ReceiverStream;
use tokio_stream::StreamExt;

#[derive(Debug)]
enum AgentCommand {
    MoveTo { x: f64, y: f64 },
    Scan,
    Report,
    Shutdown,
}

struct Agent {
    id: u32,
    position: (f64, f64),
}

impl Agent {
    async fn run(mut self, command_rx: mpsc::Receiver<AgentCommand>) {
        let mut command_stream = ReceiverStream::new(command_rx);
        
        println!("[Agent {}] –ó–∞–ø—É—â–µ–Ω–æ", self.id);
        
        while let Some(cmd) = command_stream.next().await {
            println!("[Agent {}] –ö–æ–º–∞–Ω–¥–∞: {:?}", self.id, cmd);
            
            match cmd {
                AgentCommand::MoveTo { x, y } => {
                    self.position = (x, y);
                    println!("[Agent {}] –ù–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è: {:?}", self.id, self.position);
                }
                AgentCommand::Scan => {
                    println!("[Agent {}] –°–∫–∞–Ω—É—é –Ω–∞–≤–∫–æ–ª–æ {:?}", self.id, self.position);
                }
                AgentCommand::Report => {
                    println!("[Agent {}] –ó–≤—ñ—Ç: –ø–æ–∑–∏—Ü—ñ—è {:?}", self.id, self.position);
                }
                AgentCommand::Shutdown => {
                    println!("[Agent {}] –ó–∞–≤–µ—Ä—à—É—é —Ä–æ–±–æ—Ç—É", self.id);
                    break;
                }
            }
        }
        
        println!("[Agent {}] –ó—É–ø–∏–Ω–µ–Ω–æ", self.id);
    }
}

#[tokio::main]
async fn main() {
    let (cmd_tx, cmd_rx) = mpsc::channel::<AgentCommand>(10);
    
    let agent = Agent { id: 1, position: (0.0, 0.0) };
    
    // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–≥–µ–Ω—Ç–∞
    let agent_handle = tokio::spawn(agent.run(cmd_rx));
    
    // –ù–∞–¥—Å–∏–ª–∞—î–º–æ –∫–æ–º–∞–Ω–¥–∏
    cmd_tx.send(AgentCommand::Scan).await.unwrap();
    cmd_tx.send(AgentCommand::MoveTo { x: 10.0, y: 20.0 }).await.unwrap();
    cmd_tx.send(AgentCommand::Scan).await.unwrap();
    cmd_tx.send(AgentCommand::Report).await.unwrap();
    cmd_tx.send(AgentCommand::Shutdown).await.unwrap();
    
    agent_handle.await.unwrap();
}
```

### 40.8.2 Sensor fusion: –æ–±'—î–¥–Ω–∞–Ω–Ω—è —Å–µ–Ω—Å–æ—Ä—ñ–≤

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –û–±'—î–¥–Ω—É—î–º–æ –¥–∞–Ω—ñ –≤—ñ–¥ GPS —Ç–∞ –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞ –¥–ª—è –∫—Ä–∞—â–æ—ó –æ—Ü—ñ–Ω–∫–∏ –ø–æ–∑–∏—Ü—ñ—ó.

```rust
use tokio_stream::StreamExt;
use async_stream::stream;
use tokio::time::{interval, Duration};

#[derive(Debug, Clone)]
enum SensorReading {
    Gps { lat: f64, lon: f64 },
    Accel { ax: f64, ay: f64 },
}

#[tokio::main]
async fn main() {
    // GPS stream (1 Hz)
    let gps_stream = stream! {
        let mut tick = interval(Duration::from_secs(1));
        let mut lat = 50.0;
        loop {
            tick.tick().await;
            lat += 0.0001;
            yield SensorReading::Gps { lat, lon: 30.0 };
        }
    };
    
    // Accel stream (10 Hz)
    let accel_stream = stream! {
        let mut tick = interval(Duration::from_millis(100));
        loop {
            tick.tick().await;
            yield SensorReading::Accel { 
                ax: rand::random::<f64>() - 0.5, 
                ay: rand::random::<f64>() - 0.5 
            };
        }
    };
    
    // –û–±'—î–¥–Ω—É—î–º–æ —Ç–∞ –æ–±–º–µ–∂—É—î–º–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó
    let fused = gps_stream.merge(accel_stream).take(20);
    
    tokio::pin!(fused);
    
    while let Some(reading) = fused.next().await {
        match reading {
            SensorReading::Gps { lat, lon } => {
                println!("üìç GPS: ({:.4}, {:.4})", lat, lon);
            }
            SensorReading::Accel { ax, ay } => {
                println!("   Accel: ({:+.2}, {:+.2})", ax, ay);
            }
        }
    }
}
```

---

## 40.9 –õ–ê–ë–û–†–ê–¢–û–†–ù–ê –†–û–ë–û–¢–ê

### –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–ó–∞–∫—Ä—ñ–ø–∏—Ç–∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ —Ä–æ–±–æ—Ç–∏ –∑—ñ Streams –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–æ—Ç–æ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ë–∞–∑–æ–≤–∞ –æ–±—Ä–æ–±–∫–∞ stream (3 –±–∞–ª–∏)

–°—Ç–≤–æ—Ä—ñ—Ç—å stream —á–∏—Å–µ–ª –≤—ñ–¥ 1 –¥–æ 100. –ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ:
1. `filter` ‚Äî –∑–∞–ª–∏—à–∏—Ç–∏ —á–∏—Å–ª–∞, –∫—Ä–∞—Ç–Ω—ñ 3
2. `map` ‚Äî –ø—ñ–¥–Ω–µ—Å—Ç–∏ –¥–æ –∫–≤–∞–¥—Ä–∞—Ç—É
3. `take` ‚Äî –≤–∑—è—Ç–∏ –ø–µ—Ä—à—ñ 5

–í–∏–≤–µ–¥—ñ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–∞ –æ–±—á–∏—Å–ª—ñ—Ç—å —ó—Ö —Å—É–º—É —á–µ—Ä–µ–∑ `fold`.

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –û–±'—î–¥–Ω–∞–Ω–Ω—è –ø–æ—Ç–æ–∫—ñ–≤ (4 –±–∞–ª–∏)

–°–∏–º—É–ª—é–π—Ç–µ –¥–≤–∞ —Å–µ–Ω—Å–æ—Ä–∏:
- "–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞": –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 300–º—Å (5 –∑–Ω–∞—á–µ–Ω—å)
- "–í–æ–ª–æ–≥—ñ—Å—Ç—å": –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 500–º—Å (3 –∑–Ω–∞—á–µ–Ω–Ω—è)

–û–±'—î–¥–Ω–∞–π—Ç–µ —á–µ—Ä–µ–∑ `merge` —ñ –≤–∏–≤–µ–¥—ñ—Ç—å –∑ timestamps.

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: –ü–∞–∫–µ—Ç–Ω–∞ –æ–±—Ä–æ–±–∫–∞ (3 –±–∞–ª–∏)

–°—Ç–≤–æ—Ä—ñ—Ç—å stream –∑ 50 "–ø–æ–¥—ñ–π". –ó–≥—Ä—É–ø—É–π—Ç–µ –ø–æ 10 —á–µ—Ä–µ–∑ `chunks`. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ batch:
- –í–∏–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä batch
- –û–±—á–∏—Å–ª—ñ—Ç—å —Å–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è
- –í–∏–≤–µ–¥—ñ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## 40.10 –¢–ò–ü–û–í–Ü –ü–û–ú–ò–õ–ö–ò –¢–ê TROUBLESHOOTING

### 40.10.1 –ü–æ–º–∏–ª–∫–∞: "the trait Unpin is not implemented"

**–°–∏–º–ø—Ç–æ–º:**
```text
error[E0277]: `impl Stream` cannot be unpinned
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–≥–∞—Ç–æ stream –∫–æ–º–±—ñ–Ω–∞—Ç–æ—Ä—ñ–≤ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å, —â–æ–± stream –±—É–≤ `Unpin`.

**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `tokio::pin!` –∞–±–æ `Box::pin`:
```rust
let stream = some_stream();
tokio::pin!(stream);  // –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

// –ê–±–æ
let mut stream = Box::pin(some_stream());
```

### 40.10.2 –ü–æ–º–∏–ª–∫–∞: –ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–≤–∏—Å–∞—î –Ω–∞ collect()

**–°–∏–º–ø—Ç–æ–º:** –ü—Ä–æ–≥—Ä–∞–º–∞ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è.

**–ü—Ä–∏—á–∏–Ω–∞:** `collect()` –Ω–∞ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ–º—É stream —á–µ–∫–∞—î –≤—ñ—á–Ω–æ.

**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `take(n)` –ø–µ—Ä–µ–¥ `collect()`:
```rust
let finite = infinite_stream.take(100);
let data: Vec<_> = finite.collect().await;
```

### 40.10.3 –ü–æ–º–∏–ª–∫–∞: Stream –µ–ª–µ–º–µ–Ω—Ç–∏ –≤ –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É

**–°–∏–º–ø—Ç–æ–º:** –ü—Ä–∏ `merge()` –µ–ª–µ–º–µ–Ω—Ç–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç—å —É "–≤–∏–ø–∞–¥–∫–æ–≤–æ–º—É" –ø–æ—Ä—è–¥–∫—É.

**–ü—Ä–∏—á–∏–Ω–∞:** –¶–µ –Ω–µ –ø–æ–º–∏–ª–∫–∞ ‚Äî `merge()` –≤–∏–¥–∞—î –µ–ª–µ–º–µ–Ω—Ç–∏ –∑–∞ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—é, –Ω–µ –∑–∞ –ø–æ—Ä—è–¥–∫–æ–º —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è streams.

**–†—ñ—à–µ–Ω–Ω—è:** –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `chain()` –∞–±–æ —Å–æ—Ä—Ç—É–π—Ç–µ –ø—ñ—Å–ª—è –∑–±–æ—Ä—É.

---

## 40.11 –†–ï–ó–Æ–ú–ï

### –ö–ª—é—á–æ–≤—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó

**Stream** ‚Äî async –≤–µ—Ä—Å—ñ—è Iterator. –ï–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞–¥—Ö–æ–¥—è—Ç—å –∑ —á–∞—Å–æ–º, –æ–±—Ä–æ–±–∫–∞ –Ω–µ –±–ª–æ–∫—É—î –ø–æ—Ç—ñ–∫.

**StreamExt** ‚Äî extension trait –∑ –º–µ—Ç–æ–¥–∞–º–∏ `next()`, `map()`, `filter()`, `merge()` —Ç–æ—â–æ.

**–°—Ç–≤–æ—Ä–µ–Ω–Ω—è streams:**
- `ReceiverStream` ‚Äî –∑ async –∫–∞–Ω–∞–ª—É
- `stream::iter()` ‚Äî –∑—ñ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ Iterator
- `IntervalStream` ‚Äî –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–∏–π stream
- `async_stream::stream!` ‚Äî –≤–ª–∞—Å–Ω–∏–π stream –∑ async –ª–æ–≥—ñ–∫–æ—é

**–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è:**
- `map()` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è
- `then()` ‚Äî async —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è
- `filter()` ‚Äî —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è
- `take()` / `skip()` ‚Äî –æ–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ

**–û–±'—î–¥–Ω–∞–Ω–Ω—è:**
- `merge()` ‚Äî —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è –∑–∞ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—é
- `chain()` ‚Äî –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –∑'—î–¥–Ω–∞–Ω–Ω—è

**–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—è:**
- `chunks(n)` ‚Äî –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ n –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
- `chunks_timeout(n, d)` ‚Äî –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –∑ timeout

### –ü–∞—Ç–µ—Ä–Ω–∏ –¥–ª—è –∑–∞–ø–∞–º'—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è

| –ü–∞—Ç–µ—Ä–Ω | –ö–æ–¥ |
|--------|-----|
| –°–ø–æ–∂–∏–≤–∞–Ω–Ω—è | `while let Some(x) = stream.next().await` |
| –û–±–º–µ–∂–µ–Ω–Ω—è | `stream.take(n)` |
| –ö—ñ–ª—å–∫–∞ –¥–∂–µ—Ä–µ–ª | `stream1.merge(stream2)` |
| Batch –æ–±—Ä–æ–±–∫–∞ | `stream.chunks(10)` |
| Pin stream | `tokio::pin!(stream)` |

---

## üîó –ó–í'–Ø–ó–û–ö –ó –ù–ê–°–¢–£–ü–ù–ò–ú –†–û–ó–î–Ü–õ–û–ú

Streams ‚Äî –ø–æ—Ç—É–∂–Ω–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö. –ê–ª–µ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ –≤–∏—â–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è: —Ö—Ç–æ –∫–µ—Ä—É—î streams? –Ø–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞—Ç–∏ –≤–∑–∞—î–º–æ–¥—ñ—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤? –Ø–∫ —ñ–∑–æ–ª—é–≤–∞—Ç–∏ —Å—Ç–∞–Ω?

**Actor Model** ‚Äî –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –ø–∞—Ç–µ—Ä–Ω, –¥–µ –∫–æ–∂–µ–Ω "–∞–∫—Ç–æ—Ä" ‚Äî —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è –∑ –ø–æ—à—Ç–æ–≤–æ—é —Å–∫—Ä–∏–Ω—å–∫–æ—é. –ê–∫—Ç–æ—Ä –æ—Ç—Ä–∏–º—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–ø–æ —Å—É—Ç—ñ ‚Äî stream!), –æ–±—Ä–æ–±–ª—è—î —ó—Ö –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ, –º–æ–∂–µ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —ñ–Ω—à–∏–º –∞–∫—Ç–æ—Ä–∞–º. –¶–µ –ø—Ä–∏—Ä–æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –¥–ª—è –∞–≥–µ–Ω—Ç—ñ–≤!

–£ **–†–æ–∑–¥—ñ–ª—ñ 41: Actor Model ‚Äî –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ñ –æ—Å–Ω–æ–≤–∏** –≤–∏:
- –ó—Ä–æ–∑—É–º—ñ—î—Ç–µ —Ñ—ñ–ª–æ—Å–æ—Ñ—ñ—é Actor Model —Ç–∞ —ó—ó —ñ—Å—Ç–æ—Ä—ñ—é
- –î—ñ–∑–Ω–∞—î—Ç–µ—Å—å, —á–æ–º—É "–∞–≥–µ–Ω—Ç ‚âà –∞–∫—Ç–æ—Ä" ‚Äî –ø—Ä–∏—Ä–æ–¥–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å
- –ü–æ–±–∞—á–∏—Ç–µ –ø–µ—Ä–µ–≤–∞–≥–∏ —ñ–∑–æ–ª—è—Ü—ñ—ó —Å—Ç–∞–Ω—É —á–µ—Ä–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- –ü—ñ–¥–≥–æ—Ç—É—î—Ç–µ—Å—å –¥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∞–∫—Ç–æ—Ä—ñ–≤ –Ω–∞ Tokio

---

> **–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä–æ–∑–¥—ñ–ª:** [–†–æ–∑–¥—ñ–ª 41: Actor Model ‚Äî –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ñ –æ—Å–Ω–æ–≤–∏](./41_Actor_Model_Concepts.md)
