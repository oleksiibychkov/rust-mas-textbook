# –†–æ–∑–¥—ñ–ª 38: Tokio ‚Äî Async Runtime

---

## üìã –ê–Ω–æ—Ç–∞—Ü—ñ—è

–£ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –∑—Ä–æ–∑—É–º—ñ–ª–∏ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è: —â–æ —Ç–∞–∫–µ Future, —á–æ–º—É –≤—ñ–Ω –ª—ñ–Ω–∏–≤–∏–π, —è–∫ –ø—Ä–∞—Ü—é—î async/await. –ê–ª–µ –º–∏ –Ω–µ –ø–∏—Å–∞–ª–∏ –∂–æ–¥–Ω–æ–≥–æ –ø—Ä–∞—Ü—é—é—á–æ–≥–æ –∫–æ–¥—É ‚Äî –±–µ–∑ runtime Future –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –ª–∏—à–µ "—Ä–µ—Ü–µ–ø—Ç–æ–º", —â–æ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –±—É–¥–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–∞–Ω–∏–π.

**Tokio** ‚Äî —Ü–µ –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π async runtime –¥–ª—è Rust. –Ø–∫—â–æ async/await ‚Äî —Ü–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥—É, —Ç–æ Tokio ‚Äî —Ü–µ –¥–≤–∏–≥—É–Ω, —â–æ —Ü–µ–π –∫–æ–¥ –≤–∏–∫–æ–Ω—É—î. Tokio –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å Discord (–º—ñ–ª—å–π–æ–Ω–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤), Cloudflare (–º—ñ–ª—å—è—Ä–¥–∏ –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –¥–µ–Ω—å), AWS (Lambda runtime), Dropbox, —Ç–∞ —Ç–∏—Å—è—á—ñ —ñ–Ω—à–∏—Ö –∫–æ–º–ø–∞–Ω—ñ–π.

–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –ø–µ—Ä–µ–π–¥–µ—Ç–µ –≤—ñ–¥ —Ç–µ–æ—Ä—ñ—ó –¥–æ –ø—Ä–∞–∫—Ç–∏–∫–∏. –í–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å, —è–∫ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Tokio —É –ø—Ä–æ—î–∫—Ç—ñ, —â–æ —Ä–æ–±–∏—Ç—å –º–∞–≥—ñ—á–Ω–∏–π –º–∞–∫—Ä–æ—Å `#[tokio::main]`, —è–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ async –∑–∞–¥–∞—á—ñ, —ñ —á–æ–º—É `tokio::time::sleep` –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ `std::thread::sleep`. –ù–∞ –≤–∏—Ö–æ–¥—ñ –≤–∏ –º–∞—Ç–∏–º–µ—Ç–µ —Ä–æ–±–æ—á–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è Tokio —Ç–∞ –∑–º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏.

–û—Å–æ–±–ª–∏–≤–∞ —É–≤–∞–≥–∞ –ø—Ä–∏–¥—ñ–ª—è—î—Ç—å—Å—è **–ø–æ—è—Å–Ω–µ–Ω–Ω—é –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É –∫–æ–¥—É**: —â–æ –≤—ñ–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ, —è–∫ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º. –í–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø—ñ—é—î—Ç–µ –∫–æ–¥ ‚Äî –≤–∏ –∑—Ä–æ–∑—É–º—ñ—î—Ç–µ –π–æ–≥–æ.

---

## üéØ –¶—ñ–ª—ñ –Ω–∞–≤—á–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ:

1. **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏** Tokio —É Rust –ø—Ä–æ—î–∫—Ç—ñ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ features
2. **–ü–æ—è—Å–Ω–∏—Ç–∏** –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É Tokio: executor, reactor, timer
3. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏** –º–∞–∫—Ä–æ—Å `#[tokio::main]` —Ç–∞ —Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ –≤—ñ–Ω —Ä–æ–±–∏—Ç—å
4. **–°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏** –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ async –∑–∞–¥–∞—á—ñ —á–µ—Ä–µ–∑ `spawn` —Ç–∞ `join!`
5. **–†–æ–∑—Ä—ñ–∑–Ω—è—Ç–∏** –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–µ —Ç–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è async –∫–æ–¥—É
6. **–ó–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏** async —Ç–∞–π–º–µ—Ä–∏, timeout —Ç–∞ interval
7. **–£–Ω–∏–∫–∞—Ç–∏** —Ç–∏–ø–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫: –±–ª–æ–∫—É–≤–∞–Ω–Ω—è worker –ø–æ—Ç–æ–∫—ñ–≤, –∑–∞–±—É—Ç–∏–π .await

---

## üìö –ö–ª—é—á–æ–≤—ñ —Ç–µ—Ä–º—ñ–Ω–∏

| –¢–µ—Ä–º—ñ–Ω | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|------------|
| **Tokio** | –ù–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π async runtime –¥–ª—è Rust, —â–æ –Ω–∞–¥–∞—î executor, reactor, —Ç–∞–π–º–µ—Ä–∏ —Ç–∞ async I/O |
| **Executor** | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç runtime, —â–æ –≤–∏–∫–æ–Ω—É—î Future (–≤–∏–∫–ª–∏–∫–∞—î poll()) —Ç–∞ –∫–µ—Ä—É—î –∑–∞–¥–∞—á–∞–º–∏ |
| **Reactor** | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç, —â–æ –≤—ñ–¥—Å—Ç–µ–∂—É—î I/O –ø–æ–¥—ñ—ó —Ç–∞ –±—É–¥–∏—Ç—å –∑–∞–¥–∞—á—ñ, –∫–æ–ª–∏ –¥–∞–Ω—ñ –≥–æ—Ç–æ–≤—ñ |
| **Worker thread** | –ü–æ—Ç—ñ–∫ –û–°, —É —è–∫–æ–º—É executor –≤–∏–∫–æ–Ω—É—î async –∑–∞–¥–∞—á—ñ |
| **Task** | –û–¥–∏–Ω–∏—Ü—è async —Ä–æ–±–æ—Ç–∏, —Å—Ç–≤–æ—Ä–µ–Ω–∞ —á–µ—Ä–µ–∑ `tokio::spawn` |
| **JoinHandle** | "–ö–≤–∏—Ç–æ–∫" –¥–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É spawn'–Ω—É—Ç–æ—ó –∑–∞–¥–∞—á—ñ |
| **spawn** | –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø—É—Å–∫—É –Ω–æ–≤–æ—ó –Ω–µ–∑–∞–ª–µ–∂–Ω–æ—ó async –∑–∞–¥–∞—á—ñ |
| **join!** | –ú–∞–∫—Ä–æ—Å –¥–ª—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Ö Future –≤ –æ–¥–Ω—ñ–π –∑–∞–¥–∞—á—ñ |
| **select!** | –ú–∞–∫—Ä–æ—Å –¥–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–µ—Ä—à–æ–≥–æ –∑ –∫—ñ–ª—å–∫–æ—Ö Future ("–≥–æ–Ω–∫–∞") |

---

## üí° –ú–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏–π –∫–µ–π—Å: Discord ‚Äî –º—ñ–ª—å–π–æ–Ω–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ Rust

Discord –æ–±—Ä–æ–±–ª—è—î –º—ñ–ª—å–π–æ–Ω–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –ø—ñ–¥–∫–ª—é—á–µ–Ω—å —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ: –≥–æ–ª–æ—Å–æ–≤–∏–π –∑–≤'—è–∑–æ–∫, —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤. –£ 2020 —Ä–æ—Ü—ñ –≤–æ–Ω–∏ –ø–µ—Ä–µ–ø–∏—Å–∞–ª–∏ –∫—Ä–∏—Ç–∏—á–Ω—ñ —Å–µ—Ä–≤—ñ—Å–∏ –∑ Go –Ω–∞ Rust + Tokio.

**–ß–æ–º—É?**

1. **–ü–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∞ –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å**: Go's garbage collector —Å—Ç–≤–æ—Ä—é–≤–∞–≤ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ "–ø–∞—É–∑–∏" ‚Äî –Ω–µ–ø—Ä–∏–π–Ω—è—Ç–Ω–æ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∑–≤'—è–∑–∫—É
2. **–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –ø–∞–º'—è—Ç—ñ**: Rust —Å–ø–æ–∂–∏–≤–∞–≤ –∑–Ω–∞—á–Ω–æ –º–µ–Ω—à–µ RAM
3. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: Tokio –¥–æ–∑–≤–æ–ª–∏–≤ –æ–±—Ä–æ–±–ª—è—Ç–∏ –±—ñ–ª—å—à–µ –∑'—î–¥–Ω–∞–Ω—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–†–µ–∑—É–ª—å—Ç–∞—Ç: —á–∞—Å –≤—ñ–¥–≥—É–∫—É –≤–ø–∞–≤ –∑ 50–º—Å –¥–æ 10–º—Å –Ω–∞ 99-–º—É –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—ñ, –∞ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –∑–º–µ–Ω—à–∏–ª–æ—Å—å –Ω–∞ 10x.

–¶–µ –Ω–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∏ ‚Äî —Ü–µ production —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤—ñ–¥ –∫–æ–º–ø–∞–Ω—ñ—ó –∑ —Å–æ—Ç–Ω—è–º–∏ –º—ñ–ª—å–π–æ–Ω—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

---

## 38.1 –ê–†–•–Ü–¢–ï–ö–¢–£–†–ê TOKIO: –¢–†–ò –°–¢–û–í–ü–ò RUNTIME

### 38.1.1 –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∏–π –æ–≥–ª—è–¥

Tokio ‚Äî —Ü–µ –Ω–µ –º–æ–Ω–æ–ª—ñ—Ç–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞, –∞ –Ω–∞–±—ñ—Ä –≤–∑–∞—î–º–æ–ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤. –†–æ–∑—É–º—ñ–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ –¥–æ–ø–æ–º–æ–∂–µ –ø–∏—Å–∞—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–∏–π –∫–æ–¥ —Ç–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏.

–¢—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         TOKIO RUNTIME                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ     EXECUTOR      ‚îÇ  ‚îÇ     REACTOR       ‚îÇ  ‚îÇ     TIMER      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                   ‚îÇ  ‚îÇ                   ‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –í–∏–∫–æ–Ω—É—î Future   ‚îÇ  ‚îÇ  –í—ñ–¥—Å—Ç–µ–∂—É—î I/O    ‚îÇ  ‚îÇ  –ö–µ—Ä—É—î         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –ö–µ—Ä—É—î –∑–∞–¥–∞—á–∞–º–∏   ‚îÇ  ‚îÇ  –ø–æ–¥—ñ—ó (epoll,    ‚îÇ  ‚îÇ  —Ç–∞–π–º–µ—Ä–∞–º–∏     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Work-stealing    ‚îÇ  ‚îÇ  kqueue, iocp)    ‚îÇ  ‚îÇ  —Ç–∞ delay      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  –ø–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫     ‚îÇ  ‚îÇ                   ‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ           ‚îÇ                      ‚îÇ                     ‚îÇ           ‚îÇ
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                                  ‚îÇ                                  ‚îÇ
‚îÇ                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                       ‚îÇ
‚îÇ                        ‚îÇ   WAKER SYSTEM    ‚îÇ                       ‚îÇ
‚îÇ                        ‚îÇ                   ‚îÇ                       ‚îÇ
‚îÇ                        ‚îÇ  –ë—É–¥–∏—Ç—å –∑–∞–¥–∞—á—ñ    ‚îÇ                       ‚îÇ
‚îÇ                        ‚îÇ  –∫–æ–ª–∏ –ø–æ–¥—ñ—ó       ‚îÇ                       ‚îÇ
‚îÇ                        ‚îÇ  –≤—ñ–¥–±—É–ª–∏—Å—å        ‚îÇ                       ‚îÇ
‚îÇ                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                       ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 38.1.2 Executor: —Å–µ—Ä—Ü–µ runtime

**Executor** ‚Äî —Ü–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —â–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤–∏–∫–æ–Ω—É—î –≤–∞—à async –∫–æ–¥. –ô–æ–≥–æ —Ä–æ–±–æ—Ç–∞:

1. **–ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —á–µ—Ä–≥—É –∑–∞–¥–∞—á**: —è–∫—ñ Future –≥–æ—Ç–æ–≤—ñ –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
2. **–í–∏–∫–ª–∏–∫–∞—Ç–∏ `poll()`**: –æ–ø–∏—Ç—É–≤–∞—Ç–∏ Future, —á–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –≤–æ–Ω–∏
3. **–ö–µ—Ä—É–≤–∞—Ç–∏ worker –ø–æ—Ç–æ–∫–∞–º–∏**: —Ä–æ–∑–ø–æ–¥—ñ–ª—è—Ç–∏ —Ä–æ–±–æ—Ç—É –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏ –û–°
4. **–†–µ–∞–ª—ñ–∑–æ–≤—É–≤–∞—Ç–∏ work-stealing**: —è–∫—â–æ –æ–¥–∏–Ω worker –≤—ñ–ª—å–Ω–∏–π, –≤—ñ–Ω "–∫—Ä–∞–¥–µ" –∑–∞–¥–∞—á—ñ –≤ —ñ–Ω—à–∏—Ö

**Work-stealing** ‚Äî —Ü–µ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è, —â–æ –±–∞–ª–∞–Ω—Å—É—î –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –£—è–≤—ñ—Ç—å 4 –∫–∞—Å–∏—Ä–∏ –≤ —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç—ñ: —è–∫—â–æ –æ–¥–∏–Ω –∑–∞–∫—ñ–Ω—á–∏–≤ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ —Å–≤–æ—é —á–µ—Ä–≥—É, –≤—ñ–Ω –º–æ–∂–µ –≤–∑—è—Ç–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∑ —á–µ—Ä–≥–∏ —Å—É—Å—ñ–¥–∞. –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ, –≤—ñ–ª—å–Ω–∏–π worker –ø–æ—Ç—ñ–∫ –º–æ–∂–µ –≤–∑—è—Ç–∏ –∑–∞–¥–∞—á—ñ –∑ —á–µ—Ä–≥–∏ –∑–∞–π–Ω—è—Ç–æ–≥–æ.

### 38.1.3 Reactor: –¥–µ—Ç–µ–∫—Ç–æ—Ä –ø–æ–¥—ñ–π

**Reactor** –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è: "–ö–æ–ª–∏ –¥–∞–Ω—ñ –≥–æ—Ç–æ–≤—ñ?". –í—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –û–° –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è I/O –ø–æ–¥—ñ–π:

| –û–ø–µ—Ä–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ | –ú–µ—Ö–∞–Ω—ñ–∑–º |
|--------------------|----------|
| Linux | epoll |
| macOS, BSD | kqueue |
| Windows | IOCP (I/O Completion Ports) |

–¶—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –æ–¥–Ω–æ–º—É –ø–æ—Ç–æ–∫—É –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ—á—ñ–∫—É–≤–∞—Ç–∏ —Ç–∏—Å—è—á—ñ –ø–æ–¥—ñ–π (–Ω–æ–≤—ñ –¥–∞–Ω—ñ –Ω–∞ —Å–æ–∫–µ—Ç–∞—Ö, –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–∏—Å–∫–æ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π) –±–µ–∑ busy-waiting.

–ö–æ–ª–∏ –≤–∏ –ø–∏—à–µ—Ç–µ `socket.read().await`, Tokio:
1. –†–µ—î—Å—Ç—Ä—É—î —Å–æ–∫–µ—Ç —É reactor
2. –ü—Ä–∏–∑—É–ø–∏–Ω—è—î –∑–∞–¥–∞—á—É (–ø–æ–≤–µ—Ä—Ç–∞—î `Poll::Pending`)
3. –ö–æ–ª–∏ –¥–∞–Ω—ñ –ø—Ä–∏–π–¥—É—Ç—å, reactor –±—É–¥–∏—Ç—å –∑–∞–¥–∞—á—É
4. Executor –ø—Ä–æ–¥–æ–≤–∂—É—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–¥–∞—á—ñ

### 38.1.4 Timer: –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á–∞—Å–æ–º

**Timer** –∫–µ—Ä—É—î –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏, –ø–æ–≤'—è–∑–∞–Ω–∏–º–∏ –∑ —á–∞—Å–æ–º:
- `tokio::time::sleep()` ‚Äî –∑–∞—Ç—Ä–∏–º–∫–∞ –Ω–∞ –≤–∫–∞–∑–∞–Ω–∏–π —á–∞—Å
- `tokio::time::timeout()` ‚Äî –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- `tokio::time::interval()` ‚Äî –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –ø–æ–¥—ñ—ó

Timer –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö (timing wheel) –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–∏—Å—è—á–∞–º–∏ —Ç–∞–π–º–µ—Ä—ñ–≤ –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏ –Ω–∞–∫–ª–∞–¥–Ω–∏–º–∏ –≤–∏—Ç—Ä–∞—Ç–∞–º–∏.

### 38.1.5 –î–≤–∞ —Ç–∏–ø–∏ runtime: multi-thread —Ç–∞ current-thread

Tokio –ø—Ä–æ–ø–æ–Ω—É—î –¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ runtime –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏:

**Multi-thread runtime (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    MULTI-THREAD RUNTIME                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  [Worker 1] ‚îÄ‚îÄ‚îÄ Task A ‚îÄ‚îÄ‚îÄ Task C ‚îÄ‚îÄ‚îÄ Task A ‚îÄ‚îÄ‚îÄ Task F ‚îÄ‚îÄ‚îÄ        ‚îÇ
‚îÇ  [Worker 2] ‚îÄ‚îÄ‚îÄ Task B ‚îÄ‚îÄ‚îÄ Task D ‚îÄ‚îÄ‚îÄ Task B ‚îÄ‚îÄ‚îÄ Task G ‚îÄ‚îÄ‚îÄ        ‚îÇ
‚îÇ  [Worker 3] ‚îÄ‚îÄ‚îÄ Task E ‚îÄ‚îÄ‚îÄ Task A ‚îÄ‚îÄ‚îÄ Task E ‚îÄ‚îÄ‚îÄ Task H ‚îÄ‚îÄ‚îÄ        ‚îÇ
‚îÇ  [Worker 4] ‚îÄ‚îÄ‚îÄ Task D ‚îÄ‚îÄ‚îÄ Task F ‚îÄ‚îÄ‚îÄ Task C ‚îÄ‚îÄ‚îÄ Task I ‚îÄ‚îÄ‚îÄ        ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:                                                    ‚îÇ
‚îÇ  ‚Ä¢ –ö—ñ–ª—å–∫—ñ—Å—Ç—å workers = –∫—ñ–ª—å–∫—ñ—Å—Ç—å —è–¥–µ—Ä CPU (—Ç–∏–ø–æ–≤–æ)                 ‚îÇ
‚îÇ  ‚Ä¢ –ó–∞–¥–∞—á—ñ –º–æ–∂—É—Ç—å –º—ñ–≥—Ä—É–≤–∞—Ç–∏ –º—ñ–∂ workers                             ‚îÇ
‚îÇ  ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–ª—è —Å–µ—Ä–≤–µ—Ä—ñ–≤                         ‚îÇ
‚îÇ  ‚Ä¢ –¢–∏–ø–∏ –º–∞—é—Ç—å –±—É—Ç–∏ Send (–º–æ–∂—É—Ç—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏—Å—å –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏)         ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Current-thread runtime**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   CURRENT-THREAD RUNTIME                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  [Single thread] ‚îÄ Task A ‚îÄ Task B ‚îÄ Task A ‚îÄ Task C ‚îÄ Task B ‚îÄ    ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:                                                    ‚îÇ
‚îÇ  ‚Ä¢ –û–¥–∏–Ω –ø–æ—Ç—ñ–∫, –≤—Å—ñ –∑–∞–¥–∞—á—ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è —Ç–∞–º                          ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–æ—Å—Ç—ñ—à–µ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è                                            ‚îÇ
‚îÇ  ‚Ä¢ –ú–µ–Ω—à—ñ –Ω–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏                                           ‚îÇ
‚îÇ  ‚Ä¢ –¢–∏–ø–∏ –Ω–µ –º–∞—é—Ç—å –±—É—Ç–∏ Send                                          ‚îÇ
‚îÇ  ‚Ä¢ –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è CLI, —Ç–µ—Å—Ç—ñ–≤, embedded                             ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–ª–∏ —â–æ –æ–±–∏—Ä–∞—Ç–∏?**

| –°—Ü–µ–Ω–∞—Ä—ñ–π | –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π runtime | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|------------------------|---------|
| Production –≤–µ–±-—Å–µ—Ä–≤–µ—Ä | Multi-thread | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å |
| CLI —É—Ç–∏–ª—ñ—Ç–∞ | Current-thread | –ü—Ä–æ—Å—Ç–æ—Ç–∞, –º–µ–Ω—à–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–∫ |
| Unit —Ç–µ—Å—Ç–∏ | Current-thread | –î–µ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ—Å—Ç—å |
| Embedded/WASM | Current-thread | –û–±–º–µ–∂–µ–Ω–Ω—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ |
| –°–∫–ª–∞–¥–Ω–µ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è | Current-thread | –ü–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ |

---

## 38.2 –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø TOKIO –£ –ü–†–û–Ñ–ö–¢–Ü

### 38.2.1 –î–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤ Cargo.toml

Tokio ‚Äî –º–æ–¥—É–ª—å–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞. –í–∏ –æ–±–∏—Ä–∞—î—Ç–µ, —è–∫—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —á–µ—Ä–µ–∑ **features**. –¶–µ –≤–∞–∂–ª–∏–≤–æ: –º—ñ–Ω—ñ–º—ñ–∑—É—é—á–∏ features, –≤–∏ –∑–º–µ–Ω—à—É—î—Ç–µ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó —Ç–∞ —Ä–æ–∑–º—ñ—Ä –±—ñ–Ω–∞—Ä–Ω–∏–∫–∞.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –†–æ–∑–≥–ª—è–Ω–µ–º–æ —Ä—ñ–∑–Ω—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Tokio –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–æ—Ç—Ä–µ–± –ø—Ä–æ—î–∫—Ç—É.

```toml
# –í–∞—Ä—ñ–∞–Ω—Ç 1: –í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ (–¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è —Ç–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É–≤–∞–Ω–Ω—è)
[dependencies]
tokio = { version = "1", features = ["full"] }

# –í–∞—Ä—ñ–∞–Ω—Ç 2: –ú—ñ–Ω—ñ–º–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π —Å–µ—Ä–≤–µ—Ä
[dependencies]
tokio = { version = "1", features = ["rt-multi-thread", "macros", "net"] }

# –í–∞—Ä—ñ–∞–Ω—Ç 3: CLI —É—Ç–∏–ª—ñ—Ç–∞ –∑ —Ç–∞–π–º–µ—Ä–∞–º–∏
[dependencies]
tokio = { version = "1", features = ["rt", "macros", "time"] }

# –í–∞—Ä—ñ–∞–Ω—Ç 4: –¢—ñ–ª—å–∫–∏ –¥–ª—è —Ç–µ—Å—Ç—ñ–≤
[dev-dependencies]
tokio = { version = "1", features = ["rt", "macros", "test-util"] }
```

**–¢–∞–±–ª–∏—Ü—è –æ—Å–Ω–æ–≤–Ω–∏—Ö features:**

| Feature | –©–æ –Ω–∞–¥–∞—î | –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω |
|---------|----------|---------------|
| `rt` | –ë–∞–∑–æ–≤–∏–π runtime | –ó–∞–≤–∂–¥–∏ (–º—ñ–Ω—ñ–º—É–º) |
| `rt-multi-thread` | Multi-threaded runtime | Production —Å–µ—Ä–≤–µ—Ä–∏ |
| `macros` | `#[tokio::main]`, `#[tokio::test]` | –ó—Ä—É—á–Ω—ñ—Å—Ç—å |
| `time` | sleep, timeout, interval | –¢–∞–π–º–µ—Ä–∏ |
| `sync` | Async –∫–∞–Ω–∞–ª–∏, Mutex, RwLock | –ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è |
| `io-util` | AsyncRead, AsyncWrite | I/O –æ–ø–µ—Ä–∞—Ü—ñ—ó |
| `net` | TCP, UDP, Unix sockets | –ú–µ—Ä–µ–∂–∞ |
| `fs` | Async —Ñ–∞–π–ª–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó | –†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏ |
| `process` | Async –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—ñ–≤ | –ó–æ–≤–Ω—ñ—à–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ |
| `signal` | –û–±—Ä–æ–±–∫–∞ —Å–∏–≥–Ω–∞–ª—ñ–≤ –û–° | Graceful shutdown |
| `full` | –í—Å–µ –≤–∏—â–µ–∑–∞–∑–Ω–∞—á–µ–Ω–µ | –ù–∞–≤—á–∞–Ω–Ω—è, –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è –¥–ª—è –ø—ñ–¥—Ä—É—á–Ω–∏–∫–∞:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `features = ["full"]` –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ. –í production –ø—Ä–æ—î–∫—Ç–∞—Ö ‚Äî —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω–µ.

### 38.2.2 –ú–∞–∫—Ä–æ—Å #[tokio::main]: –≤—Ö—ñ–¥ –≤ async —Å–≤—ñ—Ç

–ì–æ–ª–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞: —Ñ—É–Ω–∫—Ü—ñ—è `main()` –≤ Rust ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞. –ê–ª–µ –º–∏ —Ö–æ—á–µ–º–æ –ø–∏—Å–∞—Ç–∏ async –∫–æ–¥ –∑ —Å–∞–º–æ–≥–æ –ø–æ—á–∞—Ç–∫—É. –ú–∞–∫—Ä–æ—Å `#[tokio::main]` –≤–∏—Ä—ñ—à—É—î —Ü—é –ø—Ä–æ–±–ª–µ–º—É.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É—î–º–æ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à—É async –ø—Ä–æ–≥—Ä–∞–º—É –∑ Tokio —Ç–∞ –ø–æ—è—Å–Ω–∏–º–æ, —â–æ —Ä–æ–±–∏—Ç—å –º–∞–∫—Ä–æ—Å.

```rust
// –§–∞–π–ª: src/main.rs

// –¶–µ–π –º–∞–∫—Ä–æ—Å ‚Äî "–º–∞–≥—ñ—è", —â–æ –¥–æ–∑–≤–æ–ª—è—î main –±—É—Ç–∏ async
#[tokio::main]
async fn main() {
    println!("üöÄ –ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø—É—â–µ–Ω–∞!");
    
    // –¢–µ–ø–µ—Ä –º–æ–∂–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ .await
    println!("‚è≥ –ß–µ–∫–∞—î–º–æ 2 —Å–µ–∫—É–Ω–¥–∏...");
    tokio::time::sleep(std::time::Duration::from_secs(2)).await;
    
    println!("‚úÖ –ì–æ—Ç–æ–≤–æ!");
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. `#[tokio::main]` ‚Äî —Ü–µ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏–π –º–∞–∫—Ä–æ—Å, —â–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—î –∫–æ–¥
2. –í—ñ–Ω —Å—Ç–≤–æ—Ä—é—î —Å–ø—Ä–∞–≤–∂–Ω—é —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É `fn main()`, —è–∫–∞:
   - –°—Ç–≤–æ—Ä—é—î Tokio runtime
   - –ó–∞–ø—É—Å–∫–∞—î –≤–∞—à async –∫–æ–¥ —É —Ü—å–æ–º—É runtime
   - –ë–ª–æ–∫—É—î, –ø–æ–∫–∏ async –∫–æ–¥ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
3. `tokio::time::sleep(...).await` ‚Äî async –∑–∞—Ç—Ä–∏–º–∫–∞, —â–æ –Ω–µ –±–ª–æ–∫—É—î –ø–æ—Ç—ñ–∫

**–©–æ –º–∞–∫—Ä–æ—Å –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –≥–µ–Ω–µ—Ä—É—î:**

```rust
// –¶–µ –ø—Ä–∏–±–ª–∏–∑–Ω–æ —Ç–µ, —â–æ –≥–µ–Ω–µ—Ä—É—î #[tokio::main]
fn main() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ runtime –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
    let runtime = tokio::runtime::Runtime::new()
        .expect("Failed to create Tokio runtime");
    
    // –ó–∞–ø—É—Å–∫–∞—î–º–æ async –∫–æ–¥, –±–ª–æ–∫—É—é—á–∏ –ø–æ—Ç–æ—á–Ω–∏–π –ø–æ—Ç—ñ–∫
    runtime.block_on(async {
        println!("üöÄ –ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø—É—â–µ–Ω–∞!");
        println!("‚è≥ –ß–µ–∫–∞—î–º–æ 2 —Å–µ–∫—É–Ω–¥–∏...");
        tokio::time::sleep(std::time::Duration::from_secs(2)).await;
        println!("‚úÖ –ì–æ—Ç–æ–≤–æ!");
    });
}
```

–ú–∞–∫—Ä–æ—Å ‚Äî —Ü–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏–π —Ü—É–∫–æ—Ä, —â–æ –ø—Ä–∏—Ö–æ–≤—É—î —Ü–µ—Ä–µ–º–æ–Ω—ñ—é —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è runtime. –í–∏ –º–æ–∂–µ—Ç–µ –æ–±—ñ–π—Ç–∏—Å—å –±–µ–∑ –Ω—å–æ–≥–æ, –∞–ª–µ —Ü–µ verbose —Ç–∞ –Ω–µ–∑—Ä—É—á–Ω–æ.

### 38.2.3 –í–∞—Ä—ñ–∞–Ω—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –º–∞–∫—Ä–æ—Å—É

–ú–∞–∫—Ä–æ—Å `#[tokio::main]` –ø—Ä–∏–π–º–∞—î –∞—Ç—Ä–∏–±—É—Ç–∏ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è runtime:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó runtime –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤.

```rust
// –í–∞—Ä—ñ–∞–Ω—Ç 1: –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äî multi-thread runtime
#[tokio::main]
async fn main() {
    // Runtime –∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é workers = –∫—ñ–ª—å–∫—ñ—Å—Ç—å —è–¥–µ—Ä CPU
}

// –í–∞—Ä—ñ–∞–Ω—Ç 2: –Ø–≤–Ω–æ multi-thread –∑ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é workers
#[tokio::main(flavor = "multi_thread", worker_threads = 4)]
async fn main() {
    // –†—ñ–≤–Ω–æ 4 worker –ø–æ—Ç–æ–∫–∏, –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —è–¥–µ—Ä
}

// –í–∞—Ä—ñ–∞–Ω—Ç 3: Current-thread –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö –ø—Ä–æ–≥—Ä–∞–º –∞–±–æ —Ç–µ—Å—Ç—ñ–≤
#[tokio::main(flavor = "current_thread")]
async fn main() {
    // –û–¥–∏–Ω –ø–æ—Ç—ñ–∫, –ø—Ä–æ—Å—Ç—ñ—à–µ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
}

// –í–∞—Ä—ñ–∞–Ω—Ç 4: –î–ª—è —Ç–µ—Å—Ç—ñ–≤ (–æ–∫—Ä–µ–º–∏–π –∞—Ç—Ä–∏–±—É—Ç)
#[tokio::test]
async fn test_something() {
    // Current-thread runtime –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
    assert_eq!(2 + 2, 4);
}
```

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `worker_threads`:**
- –ö–æ–ª–∏ —Ö–æ—á–µ—Ç–µ –æ–±–º–µ–∂–∏—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è CPU
- –î–ª—è –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö
- –ö–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä –¥—ñ–ª–∏—Ç—å –º–∞—à–∏–Ω—É –∑ —ñ–Ω—à–∏–º–∏ –ø—Ä–æ—Ü–µ—Å–∞–º–∏

### 38.2.4 –†—É—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è runtime

–Ü–Ω–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–µ–Ω –±—ñ–ª—å—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ runtime ‚Äî –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ —ñ—Å–Ω—É—é—á–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º –∫–æ–¥–æ–º –∞–±–æ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É—î–º–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è runtime –≤—Ä—É—á–Ω—É —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è async –∫–æ–¥—É.

```rust
use tokio::runtime::Runtime;
use std::time::Duration;

fn main() {
    // –°—Ç–≤–æ—Ä—é—î–º–æ runtime –∑ –∫–∞—Å—Ç–æ–º–Ω–∏–º–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏
    let runtime = Runtime::new()
        .expect("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ runtime");
    
    // –í–∏–∫–æ–Ω—É—î–º–æ async –∫–æ–¥, –±–ª–æ–∫—É—é—á–∏ –ø–æ—Ç–æ—á–Ω–∏–π –ø–æ—Ç—ñ–∫
    let result = runtime.block_on(async {
        println!("–í—Å–µ—Ä–µ–¥–∏–Ω—ñ async –±–ª–æ–∫—É");
        
        // –í–∏–∫–æ–Ω—É—î–º–æ async –æ–ø–µ—Ä–∞—Ü—ñ—ó
        let value = compute_async().await;
        
        println!("–û–±—á–∏—Å–ª–µ–Ω–æ: {}", value);
        value
    });
    
    // –¢—É—Ç –º–∏ –∑–Ω–æ–≤—É –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É —Å–≤—ñ—Ç—ñ
    println!("–†–µ–∑—É–ª—å—Ç–∞—Ç: {}", result);
}

async fn compute_async() -> i32 {
    tokio::time::sleep(Duration::from_millis(100)).await;
    42
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. `Runtime::new()` —Å—Ç–≤–æ—Ä—é—î multi-thread runtime
2. `runtime.block_on(future)` –∑–∞–ø—É—Å–∫–∞—î Future —ñ **–±–ª–æ–∫—É—î** –ø–æ—Ç–æ—á–Ω–∏–π –ø–æ—Ç—ñ–∫ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
3. –†–µ–∑—É–ª—å—Ç–∞—Ç Future –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –∑ `block_on`
4. –ü—ñ—Å–ª—è `block_on` –º–∏ –∑–Ω–æ–≤—É –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ä—É—á–Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è:**
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è async –∫–æ–¥—É –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫
- –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—Ç–æ–∫—ñ–≤, –Ω–∞–∑–≤–∏ –ø–æ—Ç–æ–∫—ñ–≤)
- –ö—ñ–ª—å–∫–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏—Ö runtime –≤ –æ–¥–Ω—ñ–π –ø—Ä–æ–≥—Ä–∞–º—ñ (—Ä—ñ–¥–∫–æ)

---

## 38.3 –ó–ê–ü–£–°–ö ASYNC –ö–û–î–£: SPAWN –¢–ê AWAIT

### 38.3.1 –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—è: .await vs spawn

–¶–µ **–Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏–π –∫–æ–Ω—Ü–µ–ø—Ç** —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É. –ë–∞–≥–∞—Ç–æ –Ω–æ–≤–∞—á–∫—ñ–≤ –ø–ª—É—Ç–∞—é—Ç—å `.await` —Ç–∞ `spawn`, –∞–ª–µ –≤–æ–Ω–∏ —Ä–æ–±–ª—è—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ —Ä—ñ–∑–Ω—ñ —Ä–µ—á—ñ.

**`.await`** ‚Äî –≤–∏–∫–æ–Ω—É—î Future **–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–æ—Ç–æ—á–Ω–æ—ó –∑–∞–¥–∞—á—ñ**, –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ.

**`spawn`** ‚Äî —Å—Ç–≤–æ—Ä—é—î **–Ω–æ–≤—É –Ω–µ–∑–∞–ª–µ–∂–Ω—É –∑–∞–¥–∞—á—É**, —â–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ.

–í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è —Ä—ñ–∑–Ω–∏—Ü—ñ:

```
–ü–û–°–õ–Ü–î–û–í–ù–ï –í–ò–ö–û–ù–ê–ù–ù–Ø (—Ç—ñ–ª—å–∫–∏ .await):
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ó–∞–¥–∞—á–∞ 1: [fetch_a().await]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[fetch_b().await]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[Done]
                                   ‚Üë –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –ü–Ü–°–õ–Ø fetch_a

–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: —á–∞—Å_a + —á–∞—Å_b = 3—Å + 2—Å = 5 —Å–µ–∫—É–Ω–¥


–ü–ê–†–ê–õ–ï–õ–¨–ù–ï –í–ò–ö–û–ù–ê–ù–ù–Ø (spawn):
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ó–∞–¥–∞—á–∞ 1: [fetch_a().await]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[Done]
–ó–∞–¥–∞—á–∞ 2: [fetch_b().await]‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[Done]
          ‚Üë –æ–±–∏–¥–≤—ñ –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –û–î–ù–û–ß–ê–°–ù–û

–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: max(—á–∞—Å_a, —á–∞—Å_b) = max(3—Å, 2—Å) = 3 —Å–µ–∫—É–Ω–¥–∏
```

### 38.3.2 –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑ .await

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É—î–º–æ, —â–æ –∫—ñ–ª—å–∫–∞ `.await` –ø—ñ–¥—Ä—è–¥ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ, –Ω–µ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ.

```rust
use std::time::{Duration, Instant};
use tokio::time::sleep;

#[tokio::main]
async fn main() {
    println!("üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ü–û–°–õ–Ü–î–û–í–ù–û–ì–û –≤–∏–∫–æ–Ω–∞–Ω–Ω—è");
    
    let start = Instant::now();
    
    // –ö–æ–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è —á–µ–∫–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó
    let result_a = slow_operation("A", 3).await;  // 3 —Å–µ–∫—É–Ω–¥–∏
    let result_b = slow_operation("B", 2).await;  // –ø–æ—Ç—ñ–º —â–µ 2 —Å–µ–∫—É–Ω–¥–∏
    let result_c = slow_operation("C", 1).await;  // –ø–æ—Ç—ñ–º —â–µ 1 —Å–µ–∫—É–Ω–¥–∞
    
    let elapsed = start.elapsed();
    
    println!("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏: {}, {}, {}", result_a, result_b, result_c);
    println!("‚è±Ô∏è  –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: {:.1} —Å–µ–∫—É–Ω–¥", elapsed.as_secs_f32());
    println!("   (3 + 2 + 1 = 6 —Å–µ–∫—É–Ω–¥ ‚Äî –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ!)");
}

async fn slow_operation(name: &str, seconds: u64) -> String {
    println!("   ‚ñ∂ –û–ø–µ—Ä–∞—Ü—ñ—è {} –ø–æ—á–∞–ª–∞—Å—å", name);
    sleep(Duration::from_secs(seconds)).await;
    println!("   ‚úì –û–ø–µ—Ä–∞—Ü—ñ—è {} –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å", name);
    format!("Result_{}", name)
}
```

**–í–∏–≤—ñ–¥ –ø—Ä–æ–≥—Ä–∞–º–∏:**

```
üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ü–û–°–õ–Ü–î–û–í–ù–û–ì–û –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
   ‚ñ∂ –û–ø–µ—Ä–∞—Ü—ñ—è A –ø–æ—á–∞–ª–∞—Å—å
   ‚úì –û–ø–µ—Ä–∞—Ü—ñ—è A –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å      // —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
   ‚ñ∂ –û–ø–µ—Ä–∞—Ü—ñ—è B –ø–æ—á–∞–ª–∞—Å—å         // B –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –ü–Ü–°–õ–Ø A
   ‚úì –û–ø–µ—Ä–∞—Ü—ñ—è B –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å      // —â–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏
   ‚ñ∂ –û–ø–µ—Ä–∞—Ü—ñ—è C –ø–æ—á–∞–ª–∞—Å—å         // C –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –ü–Ü–°–õ–Ø B
   ‚úì –û–ø–µ—Ä–∞—Ü—ñ—è C –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å      // —â–µ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏: Result_A, Result_B, Result_C
‚è±Ô∏è  –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: 6.0 —Å–µ–∫—É–Ω–¥
   (3 + 2 + 1 = 6 —Å–µ–∫—É–Ω–¥ ‚Äî –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ!)
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. `slow_operation("A", 3).await` –ø–æ—á–∏–Ω–∞—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
2. –í–∏–∫–æ–Ω–∞–Ω–Ω—è `main` –ø—Ä–∏–∑—É–ø–∏–Ω—è—î—Ç—å—Å—è –Ω–∞ 3 —Å–µ–∫—É–Ω–¥–∏
3. –¢—ñ–ª—å–∫–∏ –∫–æ–ª–∏ A –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è B
4. –¢—ñ–ª—å–∫–∏ –∫–æ–ª–∏ B –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è C
5. –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å ‚Äî —Å—É–º–∞ –≤—Å—ñ—Ö –∑–∞—Ç—Ä–∏–º–æ–∫

**–¶–µ –ù–ï –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å!** –ö–æ–∂–µ–Ω `.await` ‚Äî —Ü–µ —Ç–æ—á–∫–∞, –¥–µ –ø–æ—Ç–æ—á–Ω–∞ –∑–∞–¥–∞—á–∞ —á–µ–∫–∞—î. –Ü–Ω—à—ñ –∑–∞–¥–∞—á—ñ –º–æ–∂—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å, –∞–ª–µ *–º–∏* —á–µ–∫–∞—î–º–æ.

### 38.3.3 –ü–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑ tokio::spawn

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä—É—î–º–æ —Å–ø—Ä–∞–≤–∂–Ω—î –ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —á–µ—Ä–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–∫—Ä–µ–º–∏—Ö –∑–∞–¥–∞—á.

```rust
use std::time::{Duration, Instant};
use tokio::time::sleep;

#[tokio::main]
async fn main() {
    println!("üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ü–ê–†–ê–õ–ï–õ–¨–ù–û–ì–û –≤–∏–∫–æ–Ω–∞–Ω–Ω—è");
    
    let start = Instant::now();
    
    // spawn —Å—Ç–≤–æ—Ä—é—î –ù–ï–ó–ê–õ–ï–ñ–ù–Ü –∑–∞–¥–∞—á—ñ
    // –í–æ–Ω–∏ –ø–æ—á–∏–Ω–∞—é—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å –ù–ï–ì–ê–ô–ù–û, –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
    let handle_a = tokio::spawn(slow_operation("A", 3));
    let handle_b = tokio::spawn(slow_operation("B", 2));
    let handle_c = tokio::spawn(slow_operation("C", 1));
    
    // –¢–µ–ø–µ—Ä —á–µ–∫–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤—Å—ñ—Ö
    let result_a = handle_a.await.expect("Task A failed");
    let result_b = handle_b.await.expect("Task B failed");
    let result_c = handle_c.await.expect("Task C failed");
    
    let elapsed = start.elapsed();
    
    println!("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏: {}, {}, {}", result_a, result_b, result_c);
    println!("‚è±Ô∏è  –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: {:.1} —Å–µ–∫—É–Ω–¥", elapsed.as_secs_f32());
    println!("   (max(3, 2, 1) = 3 —Å–µ–∫—É–Ω–¥–∏ ‚Äî –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ!)");
}

// –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É: 'static lifetime —á–µ—Ä–µ–∑ spawn
async fn slow_operation(name: &'static str, seconds: u64) -> String {
    println!("   ‚ñ∂ –û–ø–µ—Ä–∞—Ü—ñ—è {} –ø–æ—á–∞–ª–∞—Å—å", name);
    sleep(Duration::from_secs(seconds)).await;
    println!("   ‚úì –û–ø–µ—Ä–∞—Ü—ñ—è {} –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å", name);
    format!("Result_{}", name)
}
```

**–í–∏–≤—ñ–¥ –ø—Ä–æ–≥—Ä–∞–º–∏:**

```
üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ü–ê–†–ê–õ–ï–õ–¨–ù–û–ì–û –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
   ‚ñ∂ –û–ø–µ—Ä–∞—Ü—ñ—è A –ø–æ—á–∞–ª–∞—Å—å          // –≤—Å—ñ —Ç—Ä–∏
   ‚ñ∂ –û–ø–µ—Ä–∞—Ü—ñ—è B –ø–æ—á–∞–ª–∞—Å—å          // –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è
   ‚ñ∂ –û–ø–µ—Ä–∞—Ü—ñ—è C –ø–æ—á–∞–ª–∞—Å—å          // –æ–¥–Ω–æ—á–∞—Å–Ω–æ!
   ‚úì –û–ø–µ—Ä–∞—Ü—ñ—è C –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å       // —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
   ‚úì –û–ø–µ—Ä–∞—Ü—ñ—è B –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å       // —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏
   ‚úì –û–ø–µ—Ä–∞—Ü—ñ—è A –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å       // —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏: Result_A, Result_B, Result_C
‚è±Ô∏è  –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: 3.0 —Å–µ–∫—É–Ω–¥
   (max(3, 2, 1) = 3 —Å–µ–∫—É–Ω–¥–∏ ‚Äî –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ!)
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î —Ü–µ–π –∫–æ–¥:**

1. `tokio::spawn(future)` —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É –∑–∞–¥–∞—á—É —ñ **–Ω–µ–≥–∞–π–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î JoinHandle**
2. Future –ø–æ—á–∏–Ω–∞—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ –∑ —ñ–Ω—à–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏
3. –¢—Ä–∏ spawn ‚Äî —Ç—Ä–∏ –∑–∞–¥–∞—á—ñ –ø—Ä–∞—Ü—é—é—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ
4. `handle.await` —á–µ–∫–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –∑–∞–¥–∞—á—ñ
5. –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å ‚Äî —á–∞—Å –Ω–∞–π–ø–æ–≤—ñ–ª—å–Ω—ñ—à–æ—ó –∑–∞–¥–∞—á—ñ

**JoinHandle** ‚Äî —Ü–µ "–∫–≤–∏—Ç–æ–∫" –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É. –Ø–∫—â–æ –≤–∏ –Ω–µ await'–∏—Ç–µ JoinHandle, –∑–∞–¥–∞—á–∞ –≤—Å–µ –æ–¥–Ω–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è, –∞–ª–µ –≤–∏ –Ω–µ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

### 38.3.4 –í–∏–º–æ–≥–∏ –¥–æ spawn: 'static —Ç–∞ Send

`tokio::spawn` –º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ Future, —è–∫–µ –º–æ–∂–Ω–∞ spawn'–∏—Ç–∏:

```rust
pub fn spawn<T>(future: T) -> JoinHandle<T::Output>
where
    T: Future + Send + 'static,
    T::Output: Send + 'static,
```

**–©–æ —Ü–µ –æ–∑–Ω–∞—á–∞—î:**

1. **`'static`**: Future –Ω–µ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
2. **`Send`**: Future –º–∞—î –±—É—Ç–∏ –±–µ–∑–ø–µ—á–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ —Ç–∏–ø–æ–≤—É –ø–æ–º–∏–ª–∫—É —Ç–∞ —ó—ó –≤–∏—Ä—ñ—à–µ–Ω–Ω—è.

```rust
// ‚ùå –ù–ï –ö–û–ú–ü–Ü–õ–Æ–Ñ–¢–¨–°–Ø: data –Ω–µ 'static
async fn broken_example() {
    let data = vec![1, 2, 3];  // –õ–æ–∫–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–Ω–∞
    
    tokio::spawn(async {
        // –ü–æ–º–∏–ª–∫–∞: data "–∂–∏–≤–µ" —Ç—ñ–ª—å–∫–∏ –≤ broken_example
        // –ê–ª–µ spawn'–Ω—É—Ç–∞ –∑–∞–¥–∞—á–∞ –º–æ–∂–µ –ø–µ—Ä–µ–∂–∏—Ç–∏ broken_example
        println!("{:?}", data);
    });
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ move –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è
async fn fixed_example() {
    let data = vec![1, 2, 3];
    
    tokio::spawn(async move {
        // move –∑–∞–±–∏—Ä–∞—î –≤–æ–ª–æ–¥—ñ–Ω–Ω—è data —É closure
        // –¢–µ–ø–µ—Ä data –Ω–∞–ª–µ–∂–∏—Ç—å –∑–∞–¥–∞—á—ñ
        println!("{:?}", data);
    });
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∫–ª–æ–Ω—É—î–º–æ –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
async fn shared_example() {
    let data = std::sync::Arc::new(vec![1, 2, 3]);
    
    for i in 0..3 {
        let data_clone = data.clone();  // Arc::clone ‚Äî –¥–µ—à–µ–≤–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è
        tokio::spawn(async move {
            println!("Task {}: {:?}", i, data_clone);
        });
    }
}
```

**–ü—Ä–∞–≤–∏–ª–æ:** –Ø–∫—â–æ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä —Å–∫–∞—Ä–∂–∏—Ç—å—Å—è –Ω–∞ lifetimes –ø—Ä–∏ spawn ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `move` –∞–±–æ `Arc`.

---

## 38.4 ASYNC –¢–ê–ô–ú–ï–†–ò: –ü–†–ê–í–ò–õ–¨–ù–ï –û–ß–Ü–ö–£–í–ê–ù–ù–Ø

### 38.4.1 –ß–æ–º—É std::thread::sleep ‚Äî —Ü–µ –ø–æ–≥–∞–Ω–æ –≤ async

–¶–µ **–∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–∏–π** –∫–æ–Ω—Ü–µ–ø—Ç, —è–∫–∏–π —á–∞—Å—Ç–æ —ñ–≥–Ω–æ—Ä—É—é—Ç—å –Ω–æ–≤–∞—á–∫–∏.

`std::thread::sleep` ‚Äî —Ü–µ **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –±–ª–æ–∫—É—é—á–∞** –æ–ø–µ—Ä–∞—Ü—ñ—è. –í–æ–Ω–∞ –±—É–∫–≤–∞–ª—å–Ω–æ –∑—É–ø–∏–Ω—è—î –ø–æ—Ç—ñ–∫ –û–°. –í async –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Ü–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞: –≤–∏ –±–ª–æ–∫—É—î—Ç–µ worker –ø–æ—Ç—ñ–∫, —ñ –≤—Å—ñ —ñ–Ω—à—ñ –∑–∞–¥–∞—á—ñ –Ω–∞ —Ü—å–æ–º—É worker –Ω–µ –º–æ–∂—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞—Å–ª—ñ–¥–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–ª–æ–∫—É—é—á–æ–≥–æ sleep –≤ async.

```rust
use std::time::Duration;

#[tokio::main]
async fn main() {
    println!("–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–æ–±–ª–µ–º–∏ –∑ std::thread::sleep");
    
    // –ó–∞–ø—É—Å–∫–∞—î–º–æ 3 –∑–∞–¥–∞—á—ñ
    let h1 = tokio::spawn(async {
        println!("[–ó–∞–¥–∞—á–∞ 1] –ü–æ—á–∏–Ω–∞—é...");
        
        // ‚ùå –ü–û–ì–ê–ù–û: —Ü–µ –∑–∞–±–ª–æ–∫—É—î –≤–µ—Å—å worker –ø–æ—Ç—ñ–∫!
        std::thread::sleep(Duration::from_secs(3));
        
        println!("[–ó–∞–¥–∞—á–∞ 1] –ó–∞–≤–µ—Ä—à–∏–ª–∞—Å—å");
    });
    
    let h2 = tokio::spawn(async {
        println!("[–ó–∞–¥–∞—á–∞ 2] –ü–æ—á–∏–Ω–∞—é...");
        // –¶—è –∑–∞–¥–∞—á–∞ –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∞, —è–∫—â–æ –ø–æ—Ç—Ä–∞–ø–∏—Ç—å
        // –Ω–∞ —Ç–æ–π —Å–∞–º–∏–π worker, —â–æ —ñ –ó–∞–¥–∞—á–∞ 1
        println!("[–ó–∞–¥–∞—á–∞ 2] –ó–∞–≤–µ—Ä—à–∏–ª–∞—Å—å");
    });
    
    let h3 = tokio::spawn(async {
        println!("[–ó–∞–¥–∞—á–∞ 3] –ü–æ—á–∏–Ω–∞—é...");
        println!("[–ó–∞–¥–∞—á–∞ 3] –ó–∞–≤–µ—Ä—à–∏–ª–∞—Å—å");
    });
    
    // –ß–µ–∫–∞—î–º–æ –≤—Å—ñ—Ö
    let _ = tokio::join!(h1, h2, h3);
}
```

**–©–æ –º–æ–∂–µ —Å—Ç–∞—Ç–∏—Å—å:**

–ü—Ä–∏ current-thread runtime (–æ–¥–∏–Ω –ø–æ—Ç—ñ–∫):
- –ó–∞–¥–∞—á–∞ 1 –±–ª–æ–∫—É—î **—î–¥–∏–Ω–∏–π** worker –Ω–∞ 3 —Å–µ–∫—É–Ω–¥–∏
- –ó–∞–¥–∞—á—ñ 2 —Ç–∞ 3 **–Ω–µ –º–æ–∂—É—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å** –ø—Ä–æ—Ç—è–≥–æ–º —Ü–∏—Ö 3 —Å–µ–∫—É–Ω–¥
- –í–µ—Å—å runtime "–∑–∞–≤–∏—Å"

–ü—Ä–∏ multi-thread runtime:
- –Ø–∫—â–æ –ø–æ—â–∞—Å—Ç–∏—Ç—å, –ó–∞–¥–∞—á—ñ 2 —Ç–∞ 3 –ø–æ—Ç—Ä–∞–ø–ª—è—Ç—å –Ω–∞ —ñ–Ω—à—ñ workers
- –Ø–∫—â–æ –Ω–µ –ø–æ—â–∞—Å—Ç–∏—Ç—å ‚Äî —Ç—ñ –∂ –ø—Ä–æ–±–ª–µ–º–∏
- –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–µ–≥—Ä–∞–¥—É—î –Ω–µ–ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ

### 38.4.2 tokio::time::sleep ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏, —è–∫ async sleep –¥–æ–∑–≤–æ–ª—è—î —ñ–Ω—à–∏–º –∑–∞–¥–∞—á–∞–º –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.

```rust
use std::time::Duration;
use tokio::time::sleep;

#[tokio::main]
async fn main() {
    println!("–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ async sleep");
    
    let h1 = tokio::spawn(async {
        println!("[–ó–∞–¥–∞—á–∞ 1] –ü–æ—á–∏–Ω–∞—é...");
        
        // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: async sleep –ø–æ—Å—Ç—É–ø–∞—î—Ç—å—Å—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è–º
        sleep(Duration::from_secs(3)).await;
        
        println!("[–ó–∞–¥–∞—á–∞ 1] –ó–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –ø—ñ—Å–ª—è 3—Å");
    });
    
    let h2 = tokio::spawn(async {
        println!("[–ó–∞–¥–∞—á–∞ 2] –ü–æ—á–∏–Ω–∞—é...");
        sleep(Duration::from_secs(1)).await;
        println!("[–ó–∞–¥–∞—á–∞ 2] –ó–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –ø—ñ—Å–ª—è 1—Å");
    });
    
    let h3 = tokio::spawn(async {
        println!("[–ó–∞–¥–∞—á–∞ 3] –ü–æ—á–∏–Ω–∞—é... —ñ –æ–¥—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à—É—é—Å—å");
    });
    
    let _ = tokio::join!(h1, h2, h3);
    println!("–í—Å—ñ –∑–∞–¥–∞—á—ñ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å");
}
```

**–í–∏–≤—ñ–¥:**

```
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ async sleep
[–ó–∞–¥–∞—á–∞ 1] –ü–æ—á–∏–Ω–∞—é...
[–ó–∞–¥–∞—á–∞ 2] –ü–æ—á–∏–Ω–∞—é...
[–ó–∞–¥–∞—á–∞ 3] –ü–æ—á–∏–Ω–∞—é... —ñ –æ–¥—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à—É—é—Å—å
[–ó–∞–¥–∞—á–∞ 2] –ó–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –ø—ñ—Å–ª—è 1—Å
[–ó–∞–¥–∞—á–∞ 1] –ó–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –ø—ñ—Å–ª—è 3—Å
–í—Å—ñ –∑–∞–¥–∞—á—ñ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î tokio::time::sleep:**

1. `sleep(duration)` –ø–æ–≤–µ—Ä—Ç–∞—î Future
2. –ü—Ä–∏ `.await` —Ü–µ–π Future —Ä–µ—î—Å—Ç—Ä—É—î —Ç–∞–π–º–µ—Ä —É Timer –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ
3. –ü–æ—Ç–æ—á–Ω–∞ –∑–∞–¥–∞—á–∞ **–ø–æ—Å—Ç—É–ø–∞—î—Ç—å—Å—è** (–ø–æ–≤–µ—Ä—Ç–∞—î `Poll::Pending`)
4. Worker –ø–æ—Ç—ñ–∫ –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ –∑–∞–¥–∞—á—ñ
5. –ö–æ–ª–∏ —Ç–∞–π–º–µ—Ä —Å–ø—Ä–∞—Ü—é—î, Timer –±—É–¥–∏—Ç—å –∑–∞–¥–∞—á—É
6. Executor –≤—ñ–¥–Ω–æ–≤–ª—é—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–¥–∞—á—ñ

**–ö–ª—é—á–æ–≤–∞ —Ä—ñ–∑–Ω–∏—Ü—è:**
- `std::thread::sleep`: –ø–æ—Ç—ñ–∫ **—Å–ø–∏—Ç—å** (–Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç—å)
- `tokio::time::sleep`: –∑–∞–¥–∞—á–∞ **—á–µ–∫–∞—î** (–ø–æ—Ç—ñ–∫ –≤–∏–∫–æ–Ω—É—î —ñ–Ω—à—ñ –∑–∞–¥–∞—á—ñ)

### 38.4.3 timeout: –æ–±–º–µ–∂–µ–Ω–Ω—è —á–∞—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –æ–±–º–µ–∂–∏—Ç–∏ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó.

```rust
use std::time::Duration;
use tokio::time::{sleep, timeout};

#[tokio::main]
async fn main() {
    println!("=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è timeout ===\n");
    
    // –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –û–ø–µ—Ä–∞—Ü—ñ—è –≤—Å—Ç–∏–≥–∞—î –∑–∞–≤–µ—Ä—à–∏—Ç–∏—Å—å
    println!("1. –®–≤–∏–¥–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è (1—Å) –∑ timeout 3—Å:");
    match timeout(Duration::from_secs(3), fast_operation()).await {
        Ok(result) => println!("   ‚úÖ –£—Å–ø—ñ—Ö: {}", result),
        Err(_) => println!("   ‚ùå –¢–∞–π–º–∞—É—Ç!"),
    }
    
    // –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –û–ø–µ—Ä–∞—Ü—ñ—è –Ω–µ –≤—Å—Ç–∏–≥–∞—î
    println!("\n2. –ü–æ–≤—ñ–ª—å–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è (5—Å) –∑ timeout 2—Å:");
    match timeout(Duration::from_secs(2), slow_operation()).await {
        Ok(result) => println!("   ‚úÖ –£—Å–ø—ñ—Ö: {}", result),
        Err(_) => println!("   ‚ùå –¢–∞–π–º–∞—É—Ç! –û–ø–µ—Ä–∞—Ü—ñ—è —Å–∫–∞—Å–æ–≤–∞–Ω–∞."),
    }
    
    println!("\n=== –ó–∞–≤–µ—Ä—à–µ–Ω–æ ===");
}

async fn fast_operation() -> String {
    println!("   [fast] –ü–æ—á–∏–Ω–∞—é...");
    sleep(Duration::from_secs(1)).await;
    println!("   [fast] –ì–æ—Ç–æ–≤–æ!");
    "Fast result".to_string()
}

async fn slow_operation() -> String {
    println!("   [slow] –ü–æ—á–∏–Ω–∞—é...");
    sleep(Duration::from_secs(5)).await;
    // –¶–µ–π println –ù–ï –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è –ø—Ä–∏ —Ç–∞–π–º–∞—É—Ç—ñ
    println!("   [slow] –ì–æ—Ç–æ–≤–æ!");
    "Slow result".to_string()
}
```

**–í–∏–≤—ñ–¥:**

```
=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è timeout ===

1. –®–≤–∏–¥–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è (1—Å) –∑ timeout 3—Å:
   [fast] –ü–æ—á–∏–Ω–∞—é...
   [fast] –ì–æ—Ç–æ–≤–æ!
   ‚úÖ –£—Å–ø—ñ—Ö: Fast result

2. –ü–æ–≤—ñ–ª—å–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è (5—Å) –∑ timeout 2—Å:
   [slow] –ü–æ—á–∏–Ω–∞—é...
   ‚ùå –¢–∞–π–º–∞—É—Ç! –û–ø–µ—Ä–∞—Ü—ñ—è —Å–∫–∞—Å–æ–≤–∞–Ω–∞.

=== –ó–∞–≤–µ—Ä—à–µ–Ω–æ ===
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î timeout:**

1. `timeout(duration, future)` –æ–±–≥–æ—Ä—Ç–∞—î Future
2. –ü–∞—Ä–∞–ª–µ–ª—å–Ω–æ –∑ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è–º Future –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —Ç–∞–π–º–µ—Ä
3. –Ø–∫—â–æ Future –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Ä–∞–Ω—ñ—à–µ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è `Ok(result)`
4. –Ø–∫—â–æ —Ç–∞–π–º–µ—Ä —Å–ø—Ä–∞—Ü—é—î —Ä–∞–Ω—ñ—à–µ ‚Äî Future **—Å–∫–∞—Å–æ–≤—É—î—Ç—å—Å—è** —ñ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è `Err(Elapsed)`

**–í–∞–∂–ª–∏–≤–æ:** –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç—ñ Future –ø—Ä–æ—Å—Ç–æ **drop**'–∞—î—Ç—å—Å—è. –Ø–∫—â–æ –≤—ñ–Ω —Ç—Ä–∏–º–∞–≤ —Ä–µ—Å—É—Ä—Å–∏ ‚Äî –≤–æ–Ω–∏ –∑–≤—ñ–ª—å–Ω—è—Ç—å—Å—è. –ö–æ–¥ –ø—ñ—Å–ª—è —Ç–æ—á–∫–∏ await (–¥–µ –±—É–≤ Future –ø—Ä–∏ —Å–∫–∞—Å—É–≤–∞–Ω–Ω—ñ) **–Ω–µ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è**.

### 38.4.4 interval: –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –ø–æ–¥—ñ—ó

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏, —è–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—ñ –∑–∞–¥–∞—á—ñ.

```rust
use std::time::Duration;
use tokio::time::{interval, Instant};

#[tokio::main]
async fn main() {
    println!("=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è interval ===\n");
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ —ñ–Ω—Ç–µ—Ä–≤–∞–ª 1 —Å–µ–∫—É–Ω–¥–∞
    let mut interval = interval(Duration::from_secs(1));
    
    let start = Instant::now();
    
    // –ü–µ—Ä—à–∏–π tick —Å–ø—Ä–∞—Ü—å–æ–≤—É—î –ù–ï–ì–ê–ô–ù–û
    for i in 1..=5 {
        interval.tick().await;  // –ß–µ–∫–∞—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ tick
        
        let elapsed = start.elapsed().as_secs_f32();
        println!("Tick #{}: {:.1}—Å –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É", i, elapsed);
    }
    
    println!("\n=== –ó–∞–≤–µ—Ä—à–µ–Ω–æ ===");
}
```

**–í–∏–≤—ñ–¥:**

```
=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è interval ===

Tick #1: 0.0—Å –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É     // –ü–µ—Ä—à–∏–π tick ‚Äî –Ω–µ–≥–∞–π–Ω–æ!
Tick #2: 1.0—Å –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É
Tick #3: 2.0—Å –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É
Tick #4: 3.0—Å –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É
Tick #5: 4.0—Å –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É

=== –ó–∞–≤–µ—Ä—à–µ–Ω–æ ===
```

**–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ interval:**

1. **–ü–µ—Ä—à–∏–π tick –Ω–µ–≥–∞–π–Ω–∏–π**: –Ω–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ sleep, –ø–µ—Ä—à–∏–π `tick().await` –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É
2. **–ö–æ–º–ø–µ–Ω—Å–∞—Ü—ñ—è drift**: —è–∫—â–æ –æ–±—Ä–æ–±–∫–∞ tick'–∞ –∑–∞–π–Ω—è–ª–∞ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ –ø–µ—Ä—ñ–æ–¥, –Ω–∞—Å—Ç—É–ø–Ω—ñ tick'–∏ "–Ω–∞–∑–¥–æ–≥–∞–Ω—è—é—Ç—å"
3. **MissedTickBehavior**: –º–æ–∂–Ω–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫—É –ø—Ä–∏ –ø—Ä–æ–ø—É—â–µ–Ω–∏—Ö tick'–∞—Ö

---

## 38.5 –ü–ê–†–ê–õ–ï–õ–¨–ù–ï –í–ò–ö–û–ù–ê–ù–ù–Ø: JOIN! –¢–ê SELECT!

### 38.5.1 join!: –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤—Å–µ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ, —á–µ–∫–∞—Ç–∏ –≤—Å—ñ—Ö

–ú–∞–∫—Ä–æ—Å `join!` ‚Äî –Ω–∞–π–∑—Ä—É—á–Ω—ñ—à–∏–π —Å–ø–æ—Å—ñ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ Future –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ **–≤ –º–µ–∂–∞—Ö –æ–¥–Ω—ñ—î—ó –∑–∞–¥–∞—á—ñ**.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –∫—ñ–ª—å–∫–æ—Ö –¥–∂–µ—Ä–µ–ª.

```rust
use std::time::Duration;
use tokio::time::sleep;

#[tokio::main]
async fn main() {
    println!("=== –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Ç—Ä—å–æ—Ö API –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ ===\n");
    
    let start = std::time::Instant::now();
    
    // join! –≤–∏–∫–æ–Ω—É—î –≤—Å—ñ Future –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
    // —ñ —á–µ–∫–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –í–°–Ü–•
    let (users, products, orders) = tokio::join!(
        fetch_users(),     // 3 —Å–µ–∫—É–Ω–¥–∏
        fetch_products(),  // 2 —Å–µ–∫—É–Ω–¥–∏
        fetch_orders()     // 1 —Å–µ–∫—É–Ω–¥–∞
    );
    
    let elapsed = start.elapsed();
    
    println!("\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏:");
    println!("   –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ: {:?}", users);
    println!("   –ü—Ä–æ–¥—É–∫—Ç–∏: {:?}", products);
    println!("   –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è: {:?}", orders);
    println!("\n‚è±Ô∏è  –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: {:.1}—Å", elapsed.as_secs_f32());
    println!("   (–ü–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –±—É–ª–æ –± 3+2+1=6—Å)");
}

async fn fetch_users() -> Vec<String> {
    println!("‚ñ∂ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤...");
    sleep(Duration::from_secs(3)).await;
    println!("‚úì –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ");
    vec!["Alice".into(), "Bob".into()]
}

async fn fetch_products() -> Vec<String> {
    println!("‚ñ∂ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤...");
    sleep(Duration::from_secs(2)).await;
    println!("‚úì –ü—Ä–æ–¥—É–∫—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ");
    vec!["Laptop".into(), "Phone".into()]
}

async fn fetch_orders() -> Vec<String> {
    println!("‚ñ∂ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å...");
    sleep(Duration::from_secs(1)).await;
    println!("‚úì –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ");
    vec!["Order #1".into()]
}
```

**–í–∏–≤—ñ–¥:**

```
=== –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Ç—Ä—å–æ—Ö API –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ ===

‚ñ∂ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤...
‚ñ∂ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤...
‚ñ∂ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å...
‚úì –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ        // 1—Å
‚úì –ü—Ä–æ–¥—É–∫—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ          // 2—Å
‚úì –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ       // 3—Å

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏:
   –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ: ["Alice", "Bob"]
   –ü—Ä–æ–¥—É–∫—Ç–∏: ["Laptop", "Phone"]
   –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è: ["Order #1"]

‚è±Ô∏è  –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: 3.0—Å
   (–ü–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –±—É–ª–æ –± 3+2+1=6—Å)
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î join!:**

1. –í—Å—ñ –ø–µ—Ä–µ–¥–∞–Ω—ñ Future –ø–æ—á–∏–Ω–∞—é—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ
2. join! —á–µ–∫–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è **–≤—Å—ñ—Ö** Future
3. –ü–æ–≤–µ—Ä—Ç–∞—î –∫–æ—Ä—Ç–µ–∂ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É –ø–æ—Ä—è–¥–∫—É –ø–µ—Ä–µ–¥–∞—á—ñ
4. –Ø–∫—â–æ –æ–¥–∏–Ω Future panic'–Ω–µ ‚Äî join! panic'–Ω–µ

**join! vs spawn:**

| –ê—Å–ø–µ–∫—Ç | join! | spawn |
|--------|-------|-------|
| –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É –∑–∞–¥–∞—á—É | –ù—ñ | –¢–∞–∫ |
| –í–∏–º–∞–≥–∞—î Send + 'static | –ù—ñ | –¢–∞–∫ |
| –ú–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è | –¢–∞–∫ | –ù—ñ |
| –ù–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏ | –ú–µ–Ω—à—ñ | –ë—ñ–ª—å—à—ñ |
| –°–∫–∞—Å—É–≤–∞–Ω–Ω—è | –í—Å—ñ —Ä–∞–∑–æ–º | –ù–µ–∑–∞–ª–µ–∂–Ω–æ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `join!`, –∫–æ–ª–∏ Future –ø–æ–≤'—è–∑–∞–Ω—ñ –ª–æ–≥—ñ—á–Ω–æ —Ç–∞ –º–∞—é—Ç—å –∑–∞–≤–µ—Ä—à–∏—Ç–∏—Å—å —Ä–∞–∑–æ–º. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `spawn`, –∫–æ–ª–∏ –∑–∞–¥–∞—á—ñ –Ω–µ–∑–∞–ª–µ–∂–Ω—ñ.

### 38.5.2 select!: –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤—Å–µ, —á–µ–∫–∞—Ç–∏ –ø–µ—Ä—à–æ–≥–æ

–ú–∞–∫—Ä–æ—Å `select!` ‚Äî –¥–ª—è —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ "–≥–æ–Ω–∫–∏", –¥–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç **–ø–µ—Ä—à–æ–≥–æ** –∑–∞–≤–µ—Ä—à–µ–Ω–æ–≥–æ Future.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–∞–ø–∏—Ç –¥–æ –∫—ñ–ª—å–∫–æ—Ö —Å–µ—Ä–≤–µ—Ä—ñ–≤ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –ø–µ—Ä—à–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.

```rust
use std::time::Duration;
use tokio::time::sleep;

#[tokio::main]
async fn main() {
    println!("=== –ó–∞–ø–∏—Ç –¥–æ –∫—ñ–ª—å–∫–æ—Ö —Å–µ—Ä–≤–µ—Ä—ñ–≤ ===\n");
    println!("–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞–π—à–≤–∏–¥—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.\n");
    
    let result = tokio::select! {
        // –ö–æ–∂–Ω–∞ –≥—ñ–ª–∫–∞ ‚Äî Future —Ç–∞ –∫–æ–¥ –ø—Ä–∏ –π–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ
        result = query_server_a() => {
            println!("üèÜ –°–µ—Ä–≤–µ—Ä A –≤—ñ–¥–ø–æ–≤—ñ–≤ –ø–µ—Ä—à–∏–º!");
            result
        }
        result = query_server_b() => {
            println!("üèÜ –°–µ—Ä–≤–µ—Ä B –≤—ñ–¥–ø–æ–≤—ñ–≤ –ø–µ—Ä—à–∏–º!");
            result
        }
        result = query_server_c() => {
            println!("üèÜ –°–µ—Ä–≤–µ—Ä C –≤—ñ–¥–ø–æ–≤—ñ–≤ –ø–µ—Ä—à–∏–º!");
            result
        }
    };
    
    println!("\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç: {}", result);
}

async fn query_server_a() -> String {
    println!("   [A] –ù–∞–¥—Å–∏–ª–∞—é –∑–∞–ø–∏—Ç...");
    sleep(Duration::from_secs(3)).await;  // –ü–æ–≤—ñ–ª—å–Ω–∏–π
    "Response from A".to_string()
}

async fn query_server_b() -> String {
    println!("   [B] –ù–∞–¥—Å–∏–ª–∞—é –∑–∞–ø–∏—Ç...");
    sleep(Duration::from_secs(1)).await;  // –ù–∞–π—à–≤–∏–¥—à–∏–π!
    "Response from B".to_string()
}

async fn query_server_c() -> String {
    println!("   [C] –ù–∞–¥—Å–∏–ª–∞—é –∑–∞–ø–∏—Ç...");
    sleep(Duration::from_secs(2)).await;  // –°–µ—Ä–µ–¥–Ω—ñ–π
    "Response from C".to_string()
}
```

**–í–∏–≤—ñ–¥:**

```
=== –ó–∞–ø–∏—Ç –¥–æ –∫—ñ–ª—å–∫–æ—Ö —Å–µ—Ä–≤–µ—Ä—ñ–≤ ===

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞–π—à–≤–∏–¥—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.

   [A] –ù–∞–¥—Å–∏–ª–∞—é –∑–∞–ø–∏—Ç...
   [B] –ù–∞–¥—Å–∏–ª–∞—é –∑–∞–ø–∏—Ç...
   [C] –ù–∞–¥—Å–∏–ª–∞—é –∑–∞–ø–∏—Ç...
üèÜ –°–µ—Ä–≤–µ—Ä B –≤—ñ–¥–ø–æ–≤—ñ–≤ –ø–µ—Ä—à–∏–º!

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç: Response from B
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î select!:**

1. –í—Å—ñ Future –ø–æ—á–∏–Ω–∞—é—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ
2. –Ø–∫ —Ç—ñ–ª—å–∫–∏ **–æ–¥–∏–Ω** –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è ‚Äî –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∞ –≥—ñ–ª–∫–∞
3. **–Ü–Ω—à—ñ Future —Å–∫–∞—Å–æ–≤—É—é—Ç—å—Å—è** (drop)
4. –ü–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–≥—Ä–∞—à–Ω–æ—ó –≥—ñ–ª–∫–∏

**–¢–∏–ø–æ–≤—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è select!:**

- –ó–∞–ø–∏—Ç –¥–æ –∫—ñ–ª—å–∫–æ—Ö —Ä–µ–∑–µ—Ä–≤–Ω–∏—Ö —Å–µ—Ä–≤–µ—Ä—ñ–≤
- Timeout —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞ –≥—ñ–ª–∫–∞
- Graceful shutdown (—Å–∏–≥–Ω–∞–ª vs —Ä–æ–±–æ—á–∞ –∑–∞–¥–∞—á–∞)
- –°–∫–∞—Å—É–≤–∞–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

### 38.5.3 select! –∑ —Ç–∞–π–º–∞—É—Ç–æ–º

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞–π–º–∞—É—Ç —á–µ—Ä–µ–∑ select! —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É `tokio::time::timeout`.

```rust
use std::time::Duration;
use tokio::time::sleep;

#[tokio::main]
async fn main() {
    println!("=== –û–ø–µ—Ä–∞—Ü—ñ—è –∑ —Ç–∞–π–º–∞—É—Ç–æ–º —á–µ—Ä–µ–∑ select! ===\n");
    
    tokio::select! {
        result = long_running_operation() => {
            println!("‚úÖ –û–ø–µ—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å: {}", result);
        }
        _ = sleep(Duration::from_secs(2)) => {
            println!("‚è∞ –¢–∞–π–º–∞—É—Ç! –û–ø–µ—Ä–∞—Ü—ñ—è —Å–∫–∞—Å–æ–≤–∞–Ω–∞.");
        }
    }
}

async fn long_running_operation() -> String {
    println!("‚ñ∂ –ü–æ—á–∞—Ç–æ–∫ –¥–æ–≤–≥–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó...");
    sleep(Duration::from_secs(5)).await;  // 5 —Å–µ–∫—É–Ω–¥
    "–†–µ–∑—É–ª—å—Ç–∞—Ç".to_string()
}
```

**–í–∏–≤—ñ–¥:**

```
=== –û–ø–µ—Ä–∞—Ü—ñ—è –∑ —Ç–∞–π–º–∞—É—Ç–æ–º —á–µ—Ä–µ–∑ select! ===

‚ñ∂ –ü–æ—á–∞—Ç–æ–∫ –¥–æ–≤–≥–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó...
‚è∞ –¢–∞–π–º–∞—É—Ç! –û–ø–µ—Ä–∞—Ü—ñ—è —Å–∫–∞—Å–æ–≤–∞–Ω–∞.
```

–¢–∞–π–º–∞—É—Ç (2—Å) —Å–ø—Ä–∞—Ü—å–æ–≤—É—î —Ä–∞–Ω—ñ—à–µ, –Ω—ñ–∂ –æ–ø–µ—Ä–∞—Ü—ñ—è (5—Å), —Ç–æ–º—É –æ–ø–µ—Ä–∞—Ü—ñ—è —Å–∫–∞—Å–æ–≤—É—î—Ç—å—Å—è.

---

## 38.6 SPAWN_BLOCKING: –ú–Ü–°–¢ –î–û –°–ò–ù–•–†–û–ù–ù–û–ì–û –°–í–Ü–¢–£

### 38.6.1 –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω spawn_blocking

–ù–µ –≤—Å–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ async:
- **CPU-bound –æ–±—á–∏—Å–ª–µ–Ω–Ω—è**: –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—è, –∫–æ–º–ø—Ä–µ—Å—ñ—è, –ø–∞—Ä—Å–∏–Ω–≥
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**: legacy –∫–æ–¥, C-–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
- **–ë–ª–æ–∫—É—é—á—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –≤–∏–∫–ª–∏–∫–∏**: –¥–µ—è–∫—ñ —Ñ–∞–π–ª–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó

`spawn_blocking` –≤–∏–∫–æ–Ω—É—î —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∫–æ–¥ –≤ **–æ–∫—Ä–µ–º–æ–º—É –ø—É–ª—ñ –ø–æ—Ç–æ–∫—ñ–≤**, –Ω–µ –±–ª–æ–∫—É—é—á–∏ async workers.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–æ CPU-bound —Ä–æ–±–æ—Ç–∏ –≤ async –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ.

```rust
use std::time::{Duration, Instant};

#[tokio::main]
async fn main() {
    println!("=== –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è spawn_blocking ===\n");
    
    let start = Instant::now();
    
    // –ó–∞–ø—É—Å–∫–∞—î–º–æ CPU-bound —Ä–æ–±–æ—Ç—É –≤ –æ–∫—Ä–µ–º–æ–º—É –ø—É–ª—ñ
    let compute_handle = tokio::task::spawn_blocking(|| {
        println!("[blocking] –ü–æ—á–∞—Ç–æ–∫ –≤–∞–∂–∫–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω—å...");
        
        // –°–∏–º—É–ª—è—Ü—ñ—è CPU-bound —Ä–æ–±–æ—Ç–∏
        let result = heavy_computation();
        
        println!("[blocking] –û–±—á–∏—Å–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω—ñ");
        result
    });
    
    // –ü–∞—Ä–∞–ª–µ–ª—å–Ω–æ —Ä–æ–±–∏–º–æ async I/O
    let io_handle = tokio::spawn(async {
        println!("[async] –ü–æ—á–∞—Ç–æ–∫ I/O –æ–ø–µ—Ä–∞—Ü—ñ–π...");
        tokio::time::sleep(Duration::from_secs(1)).await;
        println!("[async] I/O –∑–∞–≤–µ—Ä—à–µ–Ω–æ");
        "IO Result"
    });
    
    // –ß–µ–∫–∞—î–º–æ –æ–±–∏–¥–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
    let compute_result = compute_handle.await.expect("Compute failed");
    let io_result = io_handle.await.expect("IO failed");
    
    println!("\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏:");
    println!("   –û–±—á–∏—Å–ª–µ–Ω–Ω—è: {}", compute_result);
    println!("   I/O: {}", io_result);
    println!("   –ß–∞—Å: {:.1}—Å", start.elapsed().as_secs_f32());
}

fn heavy_computation() -> i64 {
    // –°–∏–º—É–ª—è—Ü—ñ—è –≤–∞–∂–∫–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω—å
    // (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ sleep ‚Äî —Ü–µ —Å–ø—Ä–∞–≤–∂–Ω—è —Ä–æ–±–æ—Ç–∞ CPU)
    let mut sum: i64 = 0;
    for i in 0..100_000_000 {
        sum = sum.wrapping_add(i);
    }
    sum
}
```

**–Ø–∫ –ø—Ä–∞—Ü—é—î spawn_blocking:**

1. Tokio –º–∞—î **–æ–∫—Ä–µ–º–∏–π –ø—É–ª –ø–æ—Ç–æ–∫—ñ–≤** –¥–ª—è –±–ª–æ–∫—É—é—á–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
2. `spawn_blocking` —Å—Ç–∞–≤–∏—Ç—å closure –≤ —á–µ—Ä–≥—É —Ü—å–æ–≥–æ –ø—É–ª—É
3. –ü–æ–≤–µ—Ä—Ç–∞—î JoinHandle, —è–∫–∏–π –º–æ–∂–Ω–∞ await'–∏—Ç–∏
4. Async workers **–Ω–µ –±–ª–æ–∫—É—é—Ç—å—Å—è** ‚Äî –≤–æ–Ω–∏ –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ –∑–∞–¥–∞—á—ñ
5. –ö–æ–ª–∏ blocking –æ–ø–µ—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è, JoinHandle "–ø—Ä–æ–∫–∏–¥–∞—î—Ç—å—Å—è"

**–ü—Ä–∞–≤–∏–ª–æ:** –ë—É–¥—å-—è–∫–∏–π –∫–æ–¥, —â–æ –±–ª–æ–∫—É—î –±—ñ–ª—å—à–µ –Ω—ñ–∂ –∫—ñ–ª—å–∫–∞ –º—ñ–∫—Ä–æ—Å–µ–∫—É–Ω–¥, –º–∞—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏—Å—å —á–µ—Ä–µ–∑ `spawn_blocking`.

---

## 38.7 –ó–ê–°–¢–û–°–£–í–ê–ù–ù–Ø –í –†–û–Æ –ë–ü–õ–ê

### 38.7.1 –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –≤—ñ–¥ –ø–æ—Ç–æ–∫—ñ–≤ –¥–æ async

–£ –ß–∞—Å—Ç–∏–Ω—ñ III –º–∏ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ —Ä—ñ–π –∞–≥–µ–Ω—Ç—ñ–≤ –Ω–∞ –ø–æ—Ç–æ–∫–∞—Ö. –ö–æ–∂–µ–Ω –∞–≥–µ–Ω—Ç ‚Äî –æ–∫—Ä–µ–º–∏–π –ø–æ—Ç—ñ–∫ –û–°. –î–ª—è 100 –∞–≥–µ–Ω—Ç—ñ–≤ —Ü–µ –ø—Ä–∞—Ü—é—î. –î–ª—è 10 000 ‚Äî –Ω—ñ.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ü–æ–∫–∞–∑–∞—Ç–∏, —è–∫ async –¥–æ–∑–≤–æ–ª—è—î –º–∞—Å—à—Ç–∞–±—É–≤–∞—Ç–∏ —Ä—ñ–π –¥–æ —Ç–∏—Å—è—á –∞–≥–µ–Ω—Ç—ñ–≤.

```rust
use std::time::Duration;
use tokio::time::sleep;

/// –°–∏–º—É–ª—è—Ü—ñ—è –æ–¥–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –ë–ü–õ–ê
async fn run_agent(id: u32) {
    println!("[Agent {}] –ó–∞–ø—É—â–µ–Ω–æ", id);
    
    loop {
        // –¶–∏–∫–ª perceive-decide-act
        perceive(id).await;
        let action = decide(id).await;
        
        if action == "terminate" {
            break;
        }
        
        execute_action(id, &action).await;
    }
    
    println!("[Agent {}] –ó–∞–≤–µ—Ä—à–µ–Ω–æ", id);
}

async fn perceive(id: u32) -> Vec<String> {
    // –°–∏–º—É–ª—è—Ü—ñ—è —á–∏—Ç–∞–Ω–Ω—è —Å–µ–Ω—Å–æ—Ä—ñ–≤ (I/O –æ–ø–µ—Ä–∞—Ü—ñ—è)
    sleep(Duration::from_millis(10)).await;
    vec!["target_detected".to_string()]
}

async fn decide(id: u32) -> String {
    // –®–≤–∏–¥–∫–µ —Ä—ñ—à–µ–Ω–Ω—è ‚Äî –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î await
    if rand::random::<f32>() < 0.01 {
        "terminate".to_string()
    } else {
        "patrol".to_string()
    }
}

async fn execute_action(id: u32, action: &str) {
    // –°–∏–º—É–ª—è—Ü—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥—ñ—ó
    sleep(Duration::from_millis(50)).await;
}

#[tokio::main]
async fn main() {
    const NUM_AGENTS: u32 = 1000;
    
    println!("üöÅ –ó–∞–ø—É—Å–∫ —Ä–æ—é –∑ {} –∞–≥–µ–Ω—Ç—ñ–≤", NUM_AGENTS);
    
    let start = std::time::Instant::now();
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ 1000 async –∑–∞–¥–∞—á
    let mut handles = Vec::with_capacity(NUM_AGENTS as usize);
    
    for id in 0..NUM_AGENTS {
        let handle = tokio::spawn(run_agent(id));
        handles.push(handle);
    }
    
    // –ß–µ–∫–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤—Å—ñ—Ö –∞–≥–µ–Ω—Ç—ñ–≤
    for handle in handles {
        let _ = handle.await;
    }
    
    println!("‚úÖ –í—Å—ñ –∞–≥–µ–Ω—Ç–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ä–æ–±–æ—Ç—É");
    println!("‚è±Ô∏è  –ß–∞—Å: {:.1}—Å", start.elapsed().as_secs_f32());
}
```

**–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | 1000 –ø–æ—Ç–æ–∫—ñ–≤ | 1000 async –∑–∞–¥–∞—á |
|----------|--------------|------------------|
| –ü–∞–º'—è—Ç—å (—Å—Ç–µ–∫) | ~1 –ì–ë | ~10 –ú–ë |
| –ß–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è | ~20 –º—Å | <1 –º—Å |
| –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è | 1000 √ó 5–º–∫—Å | –ü—Ä–∞–∫—Ç–∏—á–Ω–æ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ |

### 38.7.2 –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏ async —Ä–æ—é

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—ñ –Ω–∞ async –≤–∞–∂–ª–∏–≤–æ –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—å –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤:

1. **–ù—ñ—è–∫–æ–≥–æ –±–ª–æ–∫—É—é—á–æ–≥–æ –∫–æ–¥—É –≤ –∞–≥–µ–Ω—Ç–∞—Ö**: –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –º–∞—é—Ç—å –±—É—Ç–∏ async
2. **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ async –∫–∞–Ω–∞–ª–∏**: `tokio::sync::mpsc` –∑–∞–º—ñ—Å—Ç—å `std::sync::mpsc`
3. **–°–ø—ñ–ª—å–Ω–∏–π —Å—Ç–∞–Ω —á–µ—Ä–µ–∑ `Arc<RwLock<T>>`**: –¥–µ `RwLock` ‚Äî –∑ `tokio::sync`
4. **–¢–∞–π–º–∞—É—Ç–∏ –Ω–∞ –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö**: –∞–≥–µ–Ω—Ç –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω "–∑–∞–≤–∏—Å–∞—Ç–∏" –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ
5. **Graceful shutdown**: –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–æ –∑—É–ø–∏–Ω–∏—Ç–∏ –≤—Å—ñ—Ö –∞–≥–µ–Ω—Ç—ñ–≤

–î–µ—Ç–∞–ª—å–Ω—É —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é async —Ä–æ—é –º–∏ –ø–æ–±—É–¥—É—î–º–æ –≤ –†–æ–∑–¥—ñ–ª—ñ 44 (–ü—Ä–∞–∫—Ç–∏–∫—É–º v4.0).

---

## 38.8 –¢–ò–ü–û–í–Ü –ü–û–ú–ò–õ–ö–ò –¢–ê TROUBLESHOOTING

### 38.8.1 –ü–æ–º–∏–ª–∫–∞: "future cannot be sent between threads safely"

**–°–∏–º–ø—Ç–æ–º:**

```
error: future cannot be sent between threads safely
   --> src/main.rs:10:5
    |
10  |     tokio::spawn(async {
    |     ^^^^^^^^^^^^ future created by async block is not `Send`
```

**–ü—Ä–∏—á–∏–Ω–∞:** Future –º—ñ—Å—Ç–∏—Ç—å —Ç–∏–ø, —â–æ –Ω–µ —Ä–µ–∞–ª—ñ–∑—É—î `Send` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `Rc`, `RefCell`, –∞–±–æ `MutexGuard` —á–µ—Ä–µ–∑ `.await`).

**–†—ñ—à–µ–Ω–Ω—è:**

```rust
// ‚ùå –ü–û–ì–ê–ù–û: Rc –Ω–µ Send
use std::rc::Rc;

async fn broken() {
    let data = Rc::new(vec![1, 2, 3]);
    
    tokio::spawn(async move {
        // –ü–æ–º–∏–ª–∫–∞: Rc –Ω–µ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞—Ç–∏ –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏
        println!("{:?}", data);
    });
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: Arc ‚Äî Send
use std::sync::Arc;

async fn fixed() {
    let data = Arc::new(vec![1, 2, 3]);
    
    tokio::spawn(async move {
        println!("{:?}", data);
    });
}
```

### 38.8.2 –ü–æ–º–∏–ª–∫–∞: "this MutexGuard is held across an await point"

**–°–∏–º–ø—Ç–æ–º:**

```
warning: this MutexGuard is held across an await point
   --> src/main.rs:8:9
```

**–ü—Ä–∏—á–∏–Ω–∞:** –í–∏ —Ç—Ä–∏–º–∞—î—Ç–µ lock —á–µ—Ä–µ–∑ `.await`, —â–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ deadlock.

**–†—ñ—à–µ–Ω–Ω—è:**

```rust
use tokio::sync::Mutex;
use std::sync::Arc;

// ‚ùå –ü–û–ì–ê–ù–û: lock —á–µ—Ä–µ–∑ await
async fn broken(data: Arc<Mutex<Vec<i32>>>) {
    let mut guard = data.lock().await;
    guard.push(1);
    
    some_async_operation().await;  // lock –≤—Å–µ —â–µ —Ç—Ä–∏–º–∞—î—Ç—å—Å—è!
    
    guard.push(2);
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –∑–≤—ñ–ª—å–Ω—è—î–º–æ lock –ø–µ—Ä–µ–¥ await
async fn fixed(data: Arc<Mutex<Vec<i32>>>) {
    {
        let mut guard = data.lock().await;
        guard.push(1);
    }  // lock –∑–≤—ñ–ª—å–Ω—è—î—Ç—å—Å—è —Ç—É—Ç
    
    some_async_operation().await;  // lock –≤–∂–µ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ
    
    {
        let mut guard = data.lock().await;
        guard.push(2);
    }
}
```

### 38.8.3 –ü–æ–º–∏–ª–∫–∞: Runtime –∑–∞–≤–∏—Å

**–°–∏–º–ø—Ç–æ–º:** –ü—Ä–æ–≥—Ä–∞–º–∞ "–∑–∞–≤–∏—Å–ª–∞", –Ω–µ —Ä–µ–∞–≥—É—î, CPU –Ω–∞ 0% –∞–±–æ 100%.

**–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:**

1. **–ë–ª–æ–∫—É—é—á–∏–π –∫–æ–¥ –±–µ–∑ spawn_blocking:**
```rust
// ‚ùå –ë–ª–æ–∫—É—î –≤–µ—Å—å runtime
async fn bad() {
    std::thread::sleep(Duration::from_secs(60));
}
```

2. **Deadlock –Ω–∞ Mutex:**
```rust
// ‚ùå –ó–∞–¥–∞—á–∞ A —á–µ–∫–∞—î B, B —á–µ–∫–∞—î A
async fn task_a(m1: Mutex, m2: Mutex) {
    let g1 = m1.lock().await;
    some_work().await;
    let g2 = m2.lock().await;  // –ß–µ–∫–∞—î, —è–∫—â–æ B —Ç—Ä–∏–º–∞—î m2
}
```

3. **–ù–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π —Ü–∏–∫–ª –±–µ–∑ yield:**
```rust
// ‚ùå –ù—ñ–∫–æ–ª–∏ –Ω–µ –ø–æ—Å—Ç—É–ø–∞—î—Ç—å—Å—è
async fn infinite() {
    loop {
        // –ù–µ–º–∞—î .await ‚Äî –∑–∞–¥–∞—á–∞ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤—ñ–¥–¥–∞—Å—Ç—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
    }
}
```

**–†—ñ—à–µ–Ω–Ω—è:** –î–æ–¥–∞–π—Ç–µ `tokio::task::yield_now().await` –∞–±–æ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥—ñ–∫—É.

---

## 38.9 –õ–ê–ë–û–†–ê–¢–û–†–ù–ê –†–û–ë–û–¢–ê

### –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–ó–∞–∫—Ä—ñ–ø–∏—Ç–∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ —Ä–æ–±–æ—Ç–∏ –∑ Tokio: spawn, join!, select!, —Ç–∞–π–º–µ—Ä–∏.

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏ (4 –±–∞–ª–∏)

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ç—Ä–∏ async —Ñ—É–Ω–∫—Ü—ñ—ó, —â–æ —Å–∏–º—É–ª—é—é—Ç—å HTTP –∑–∞–ø–∏—Ç–∏ –¥–æ —Ä—ñ–∑–Ω–∏—Ö API:
- `fetch_weather()` ‚Äî –∑–∞—Ç—Ä–∏–º–∫–∞ 2 —Å–µ–∫—É–Ω–¥–∏, –ø–æ–≤–µ—Ä—Ç–∞—î "Sunny, 25¬∞C"
- `fetch_news()` ‚Äî –∑–∞—Ç—Ä–∏–º–∫–∞ 3 —Å–µ–∫—É–Ω–¥–∏, –ø–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –Ω–æ–≤–∏–Ω
- `fetch_stocks()` ‚Äî –∑–∞—Ç—Ä–∏–º–∫–∞ 1 —Å–µ–∫—É–Ω–¥–∞, –ø–æ–≤–µ—Ä—Ç–∞—î —Ü—ñ–Ω–∏ –∞–∫—Ü—ñ–π

–í–∏–∫–æ–Ω–∞–π—Ç–µ:
1. –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –≤—Å—ñ —Ç—Ä–∏ ‚Äî –≤–∏–º—ñ—Ä—è–π—Ç–µ —á–∞—Å
2. –ü–∞—Ä–∞–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `join!` ‚Äî –≤–∏–º—ñ—Ä—è–π—Ç–µ —á–∞—Å
3. –ü–æ—è—Å–Ω—ñ—Ç—å —Ä—ñ–∑–Ω–∏—Ü—é

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –¢–∞–π–º–∞—É—Ç —Ç–∞ fallback (3 –±–∞–ª–∏)

–†–µ–∞–ª—ñ–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é `fetch_with_fallback`:
- –°–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (—Å–∏–º—É–ª—è—Ü—ñ—è 3—Å)
- –Ø–∫—â–æ —Ç–∞–π–º–∞—É—Ç 2—Å ‚Äî –ø–µ—Ä–µ–∫–ª—é—á—ñ—Ç—å—Å—è –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä (—Å–∏–º—É–ª—è—Ü—ñ—è 1—Å)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `select!` –∞–±–æ `timeout`

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ (3 –±–∞–ª–∏)

–°—Ç–≤–æ—Ä—ñ—Ç—å –∑–∞–¥–∞—á—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É, —â–æ:
- –ö–æ–∂–Ω—ñ 2 —Å–µ–∫—É–Ω–¥–∏ –≤–∏–≤–æ–¥–∏—Ç—å "Heartbeat #N"
- –ü–∞—Ä–∞–ª–µ–ª—å–Ω–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è "–≥–æ–ª–æ–≤–Ω–∞ —Ä–æ–±–æ—Ç–∞" (—Å–∏–º—É–ª—è—Ü—ñ—è 10—Å)
- –ö–æ–ª–∏ –≥–æ–ª–æ–≤–Ω–∞ —Ä–æ–±–æ—Ç–∞ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è ‚Äî –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞–∫–æ–∂ –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è

**–ü—ñ–¥–∫–∞–∑–∫–∞:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `tokio::select!` –∑ –∫–∞–Ω–∞–ª–æ–º –¥–ª—è —Å–∏–≥–Ω–∞–ª—É –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è.

---

## 38.10 –†–ï–ó–Æ–ú–ï

### –ö–ª—é—á–æ–≤—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó

**Tokio** ‚Äî –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏–π async runtime –¥–ª—è Rust. –°–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑:
- **Executor**: –≤–∏–∫–æ–Ω—É—î Future, –∫–µ—Ä—É—î –∑–∞–¥–∞—á–∞–º–∏
- **Reactor**: –≤—ñ–¥—Å—Ç–µ–∂—É—î I/O –ø–æ–¥—ñ—ó
- **Timer**: –∫–µ—Ä—É—î —Ç–∞–π–º–µ—Ä–∞–º–∏

**#[tokio::main]** ‚Äî –º–∞–∫—Ä–æ—Å –¥–ª—è –∑–∞–ø—É—Å–∫—É async main. –°—Ç–≤–æ—Ä—é—î runtime —Ç–∞ –≤–∏–∫–æ–Ω—É—î –≤–∞—à –∫–æ–¥.

**spawn vs await:**
- `spawn` ‚Äî –Ω–æ–≤–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ –∑–∞–¥–∞—á–∞, –ø–∞—Ä–∞–ª–µ–ª—å–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- `.await` ‚Äî –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤ –ø–æ—Ç–æ—á–Ω—ñ–π –∑–∞–¥–∞—á—ñ, –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

**join!** ‚Äî –≤–∏–∫–æ–Ω—É—î –∫—ñ–ª—å–∫–∞ Future –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ, —á–µ–∫–∞—î –≤—Å—ñ—Ö.

**select!** ‚Äî –≤–∏–∫–æ–Ω—É—î –∫—ñ–ª—å–∫–∞ Future –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ, —á–µ–∫–∞—î –ø–µ—Ä—à–æ–≥–æ.

**spawn_blocking** ‚Äî –≤–∏–∫–æ–Ω—É—î —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π/CPU-bound –∫–æ–¥ –±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è async workers.

### –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∑–∞–ø–∞–º'—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è

| –ü—Ä–∞–≤–∏–ª–æ | –ü–æ—è—Å–Ω–µ–Ω–Ω—è |
|---------|-----------|
| –í async ‚Äî —Ç—ñ–ª—å–∫–∏ async –æ–ø–µ—Ä–∞—Ü—ñ—ó | `tokio::time::sleep`, –Ω–µ `std::thread::sleep` |
| CPU-bound ‚Üí spawn_blocking | –ù–µ –±–ª–æ–∫—É–π—Ç–µ async workers |
| –ü–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å –±–µ–∑ spawn ‚Üí join! | –ú–µ–Ω—à–µ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç |
| –ù–µ–∑–∞–ª–µ–∂–Ω—ñ –∑–∞–¥–∞—á—ñ ‚Üí spawn | –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—è –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ—Å—Ç—å |
| –ü–µ—Ä—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí select! | "–ì–æ–Ω–∫–∞" –º—ñ–∂ Future |
| –ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ .await | –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –ø–æ–ø–µ—Ä–µ–¥–∏—Ç—å –ø—Ä–æ unused Future |

---

## üîó –ó–í'–Ø–ó–û–ö –ó –ù–ê–°–¢–£–ü–ù–ò–ú –†–û–ó–î–Ü–õ–û–ú

–í–∏ –Ω–∞–≤—á–∏–ª–∏—Å—å –∑–∞–ø—É—Å–∫–∞—Ç–∏ async –∫–æ–¥ —Ç–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ –∑–∞–¥–∞—á—ñ. –ê–ª–µ —è–∫ –∑–∞–¥–∞—á—ñ **—Å–ø—ñ–ª–∫—É—é—Ç—å—Å—è** –º—ñ–∂ —Å–æ–±–æ—é? –£ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É —Å–≤—ñ—Ç—ñ (–ß–∞—Å—Ç–∏–Ω–∞ III) –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ –∫–∞–Ω–∞–ª–∏ `std::sync::mpsc` —Ç–∞ `Mutex`. –í async —Å–≤—ñ—Ç—ñ —î —ó—Ö–Ω—ñ –∞–Ω–∞–ª–æ–≥–∏ ‚Äî –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –¥–ª—è async –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.

–£ **–†–æ–∑–¥—ñ–ª—ñ 39: Async Channels —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** –≤–∏:
- –û–ø–∞–Ω—É—î—Ç–µ `tokio::sync::mpsc` ‚Äî async –∫–∞–Ω–∞–ª–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- –î—ñ–∑–Ω–∞—î—Ç–µ—Å—å –ø—Ä–æ `broadcast` –¥–ª—è pub/sub –ø–∞—Ç–µ—Ä–Ω—É
- –í–∏–≤—á–∏—Ç–µ `watch` –¥–ª—è —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞ –∑–º—ñ–Ω–∞–º–∏
- –ü–æ—Ä—ñ–≤–Ω—è—î—Ç–µ `tokio::sync::Mutex` –∑—ñ `std::sync::Mutex`
- –ó–∞—Å—Ç–æ—Å—É—î—Ç–µ async —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –≤ —Ä–æ—é –∞–≥–µ–Ω—Ç—ñ–≤

---

> **–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä–æ–∑–¥—ñ–ª:** [–†–æ–∑–¥—ñ–ª 39: Async Channels —Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è](./39_Async_Channels.md)
