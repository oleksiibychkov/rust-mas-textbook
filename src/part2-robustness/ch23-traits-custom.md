# –†–æ–∑–¥—ñ–ª 23: –¢—Ä–µ–π—Ç–∏ ‚Äî –≤–ª–∞—Å–Ω—ñ –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó

## –í—Å—Ç—É–ø

–£ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –ø–æ–∑–Ω–∞–π–æ–º–∏–ª–∏—Å—å –∑—ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º–∏ —Ç—Ä–µ–π—Ç–∞–º–∏ ‚Äî Debug, Clone, PartialEq. –ê–ª–µ —Å–ø—Ä–∞–≤–∂–Ω—è —Å–∏–ª–∞ —Ç—Ä–µ–π—Ç—ñ–≤ —Ä–æ–∑–∫—Ä–∏–≤–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ **–≤–ª–∞—Å–Ω—ñ**. 

–£—è–≤—ñ—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ñ–ª–æ—Ç–æ–º —Ä—ñ–∑–Ω–∏—Ö –∞–≥–µ–Ω—Ç—ñ–≤: –¥—Ä–æ–Ω-—Ä–æ–∑–≤—ñ–¥–Ω–∏–∫ –ª—ñ—Ç–∞—î, –Ω–∞–∑–µ–º–Ω–∏–π —Ä–æ–±–æ—Ç —ó–∑–¥–∏—Ç—å, –ø—ñ–¥–≤–æ–¥–Ω–∏–π –∞–ø–∞—Ä–∞—Ç –ø–ª–∏–≤–µ. –í—Å—ñ –≤–æ–Ω–∏ –º–∞—é—Ç—å —Å–ø—ñ–ª—å–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É ‚Äî —Ä—É—Ö–∞—é—Ç—å—Å—è, —Å–∫–∞–Ω—É—é—Ç—å, –∑–≤—ñ—Ç—É—é—Ç—å ‚Äî –∞–ª–µ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å —ó—ó –ø–æ-—Ä—ñ–∑–Ω–æ–º—É. –Ø–∫ –Ω–∞–ø–∏—Å–∞—Ç–∏ –∫–æ–¥, —â–æ –ø—Ä–∞—Ü—é—î –∑ **–±—É–¥—å-—è–∫–∏–º** –∞–≥–µ–Ω—Ç–æ–º?

–í—ñ–¥–ø–æ–≤—ñ–¥—å ‚Äî –≤–ª–∞—Å–Ω—ñ —Ç—Ä–µ–π—Ç–∏. –í–∏ –≤–∏–∑–Ω–∞—á–∞—î—Ç–µ —Ç—Ä–µ–π—Ç `Agent` –∑ –º–µ—Ç–æ–¥–∞–º–∏ `move_to()`, `scan()`, `status()`. –ö–æ–∂–µ–Ω —Ç–∏–ø –∞–≥–µ–Ω—Ç–∞ —Ä–µ–∞–ª—ñ–∑—É—î —Ü—ñ –º–µ—Ç–æ–¥–∏ –ø–æ-—Å–≤–æ—î–º—É, –∞–ª–µ –∫–æ–¥, —â–æ –ø—Ä–∞—Ü—é—î –∑ `impl Agent`, –Ω–µ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø—É. –¶–µ —ñ —î **–∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—è**.

–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –Ω–∞–≤—á–∏—Ç–µ—Å—å:
- –°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω—ñ —Ç—Ä–µ–π—Ç–∏
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
- –ó–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ associated types
- –†–æ–∑—É–º—ñ—Ç–∏ trait objects –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º—É

---

## 23.1 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏—Ö —Ç—Ä–µ–π—Ç—ñ–≤

### –ë–∞–∑–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

–¢—Ä–µ–π—Ç ‚Äî —Ü–µ –Ω–∞–±—ñ—Ä —Å–∏–≥–Ω–∞—Ç—É—Ä –º–µ—Ç–æ–¥—ñ–≤. –¢–∏–ø, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î —Ç—Ä–µ–π—Ç, –∑–æ–±–æ–≤'—è–∑—É—î—Ç—å—Å—è –Ω–∞–¥–∞—Ç–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é —Ü–∏—Ö –º–µ—Ç–æ–¥—ñ–≤.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—Ä–µ–π—Ç `Greeter`, —è–∫–∏–π –≤–∏–º–∞–≥–∞—î –º–µ—Ç–æ–¥ `greet()`. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–ª—è `Person` —Ç–∞ `Robot` –ø–æ-—Ä—ñ–∑–Ω–æ–º—É.

```rust
// –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç—Ä–µ–π—Ç–∞
trait Greeter {
    fn greet(&self) -> String;
}

// –¢–∏–ø Person
struct Person {
    name: String,
}

// –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—Ä–µ–π—Ç–∞ –¥–ª—è Person
impl Greeter for Person {
    fn greet(&self) -> String {
        format!("–ü—Ä–∏–≤—ñ—Ç, –º–µ–Ω–µ –∑–≤–∞—Ç–∏ {}!", self.name)
    }
}

// –¢–∏–ø Robot
struct Robot {
    model: String,
}

// –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç—Ä–µ–π—Ç–∞ –¥–ª—è Robot ‚Äî —ñ–Ω—à–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞
impl Greeter for Robot {
    fn greet(&self) -> String {
        format!("–ë–Ü–ü-–ë–û–ü. –Ø –º–æ–¥–µ–ª—å {}.", self.model)
    }
}

fn main() {
    let person = Person { name: "–ê–ª—ñ—Å–∞".to_string() };
    let robot = Robot { model: "R2D2".to_string() };
    
    // –û–¥–Ω–∞–∫–æ–≤–∏–π –º–µ—Ç–æ–¥ ‚Äî —Ä—ñ–∑–Ω–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∞
    println!("{}", person.greet());  // –ü—Ä–∏–≤—ñ—Ç, –º–µ–Ω–µ –∑–≤–∞—Ç–∏ –ê–ª—ñ—Å–∞!
    println!("{}", robot.greet());   // –ë–Ü–ü-–ë–û–ü. –Ø –º–æ–¥–µ–ª—å R2D2.
}
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1. `trait Greeter { fn greet(&self) -> String; }` ‚Äî –≤–∏–∑–Ω–∞—á–∞—î –∫–æ–Ω—Ç—Ä–∞–∫—Ç
2. `impl Greeter for Person` ‚Äî Person –∑–æ–±–æ–≤'—è–∑—É—î—Ç—å—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç
3. `impl Greeter for Robot` ‚Äî Robot –≤–∏–∫–æ–Ω—É—î —Ç–æ–π —Å–∞–º–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∞–ª–µ –ø–æ-—Å–≤–æ—î–º—É
4. –í–∏–∫–ª–∏–∫ `person.greet()` —Ç–∞ `robot.greet()` ‚Äî –æ–¥–Ω–∞–∫–æ–≤–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, —Ä—ñ–∑–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –¢—Ä–µ–π—Ç —è–∫ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —Ñ—É–Ω–∫—Ü—ñ–π

–ì–æ–ª–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤–∞–≥–∞ —Ç—Ä–µ–π—Ç—ñ–≤ ‚Äî –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–∏—Å–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –∑ **–±—É–¥—å-—è–∫–∏–º** —Ç–∏–ø–æ–º, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —Ç—Ä–µ–π—Ç.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é `introduce()`, —â–æ –ø—Ä–∏–π–º–∞—î –±—É–¥—å-—â–æ, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î `Greeter`.

```rust
trait Greeter {
    fn greet(&self) -> String;
}

struct Person { name: String }
struct Robot { model: String }

impl Greeter for Person {
    fn greet(&self) -> String {
        format!("–ü—Ä–∏–≤—ñ—Ç, —è {}!", self.name)
    }
}

impl Greeter for Robot {
    fn greet(&self) -> String {
        format!("–ë–Ü–ü! –ú–æ–¥–µ–ª—å {}.", self.model)
    }
}

// –§—É–Ω–∫—Ü—ñ—è –ø—Ä–∏–π–º–∞—î –ë–£–î–¨-–©–û, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î Greeter
fn introduce(entity: &impl Greeter) {
    println!("–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è: {}", entity.greet());
}

fn main() {
    let person = Person { name: "–Ü–≤–∞–Ω".to_string() };
    let robot = Robot { model: "C3PO".to_string() };
    
    introduce(&person);  // –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è: –ü—Ä–∏–≤—ñ—Ç, —è –Ü–≤–∞–Ω!
    introduce(&robot);   // –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è: –ë–Ü–ü! –ú–æ–¥–µ–ª—å C3PO.
}
```

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å `&impl Greeter`:**
- `&` ‚Äî –ø–æ—Å–∏–ª–∞–Ω–Ω—è (–Ω–µ –∑–∞–±–∏—Ä–∞—î–º–æ ownership)
- `impl Greeter` ‚Äî "–±—É–¥—å-—è–∫–∏–π —Ç–∏–ø, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î —Ç—Ä–µ–π—Ç Greeter"

–¶–µ **—Å—Ç–∞—Ç–∏—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º** ‚Äî –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –Ω–∞ –µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó –≥–µ–Ω–µ—Ä—É—î –æ–∫—Ä–µ–º—É –≤–µ—Ä—Å—ñ—é —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É.

---

## 23.2 –ú–µ—Ç–æ–¥–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º

### –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ default –º–µ—Ç–æ–¥–∏

–ß–∞—Å—Ç–æ –∫—ñ–ª—å–∫–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π —Ç—Ä–µ–π—Ç–∞ –º–∞—é—Ç—å –æ–¥–Ω–∞–∫–æ–≤—É –ª–æ–≥—ñ–∫—É –¥–ª—è –¥–µ—è–∫–∏—Ö –º–µ—Ç–æ–¥—ñ–≤. –ó–∞–º—ñ—Å—Ç—å –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∫–æ–¥—É, –º–æ–∂–Ω–∞ –Ω–∞–¥–∞—Ç–∏ **—Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º** –ø—Ä—è–º–æ –≤ —Ç—Ä–µ–π—Ç—ñ.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—Ä–µ–π—Ç `Sensor` –∑ –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ (`name()`, `read()`, `unit()`) —Ç–∞ –º–µ—Ç–æ–¥–∞–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (`formatted_reading()`, `is_valid()`).

```rust
trait Sensor {
    // –û–±–æ–≤'—è–∑–∫–æ–≤—ñ –º–µ—Ç–æ–¥–∏ ‚Äî –∫–æ–∂–µ–Ω —Ç–∏–ø —Ä–µ–∞–ª—ñ–∑—É—î –ø–æ-—Å–≤–æ—î–º—É
    fn name(&self) -> &str;
    fn read(&self) -> f64;
    fn unit(&self) -> &str;
    
    // –ú–µ—Ç–æ–¥–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ
    fn formatted_reading(&self) -> String {
        format!("{}: {:.2} {}", self.name(), self.read(), self.unit())
    }
    
    fn is_valid(&self) -> bool {
        let value = self.read();
        !value.is_nan() && !value.is_infinite()
    }
}

// –°–µ–Ω—Å–æ—Ä —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏
struct TemperatureSensor {
    id: String,
    celsius: f64,
}

impl Sensor for TemperatureSensor {
    fn name(&self) -> &str { &self.id }
    fn read(&self) -> f64 { self.celsius }
    fn unit(&self) -> &str { "¬∞C" }
    // formatted_reading —Ç–∞ is_valid ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å default
}

// –°–µ–Ω—Å–æ—Ä —Ç–∏—Å–∫—É ‚Äî –∑ –≤–ª–∞—Å–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
struct PressureSensor {
    id: String,
    hectopascals: f64,
}

impl Sensor for PressureSensor {
    fn name(&self) -> &str { &self.id }
    fn read(&self) -> f64 { self.hectopascals }
    fn unit(&self) -> &str { "hPa" }
    
    // –ü–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∞—î–º–æ default ‚Äî —Ç–∏—Å–∫ –º–∞—î –±—É—Ç–∏ –≤ —Ä–æ–∑—É–º–Ω–æ–º—É –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ
    fn is_valid(&self) -> bool {
        let value = self.read();
        value >= 800.0 && value <= 1200.0
    }
}

fn main() {
    let temp = TemperatureSensor {
        id: "TEMP-01".to_string(),
        celsius: 23.5,
    };
    
    let pressure = PressureSensor {
        id: "PRESS-01".to_string(),
        hectopascals: 1013.25,
    };
    
    // formatted_reading ‚Äî default –¥–ª—è –æ–±–æ—Ö
    println!("{}", temp.formatted_reading());     // TEMP-01: 23.50 ¬∞C
    println!("{}", pressure.formatted_reading()); // PRESS-01: 1013.25 hPa
    
    // is_valid ‚Äî default –¥–ª—è temp, –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è pressure
    println!("–¢–µ–º–ø. –≤–∞–ª—ñ–¥–Ω–∞: {}", temp.is_valid());
    println!("–¢–∏—Å–∫ –≤–∞–ª—ñ–¥–Ω–∏–π: {}", pressure.is_valid());
}
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1. `formatted_reading()` –º–∞—î —Ç—ñ–ª–æ –≤ —Ç—Ä–µ–π—Ç—ñ ‚Äî —Ü–µ default —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è
2. `TemperatureSensor` –Ω–µ —Ä–µ–∞–ª—ñ–∑—É—î `formatted_reading()` ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è default
3. `PressureSensor` –ø–µ—Ä–µ–≤–∏–∑–Ω–∞—á–∞—î `is_valid()` ‚Äî –≤–ª–∞—Å–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∑–∞–º—ñ—Å—Ç—å default
4. Default –º–µ—Ç–æ–¥–∏ –º–æ–∂—É—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –º–µ—Ç–æ–¥–∏ (`self.name()`, `self.read()`)

### Default –º–µ—Ç–æ–¥–∏, —â–æ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å —ñ–Ω—à—ñ –º–µ—Ç–æ–¥–∏

Default –º–µ—Ç–æ–¥–∏ –º–æ–∂—É—Ç—å –±—É–¥—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—É –ª–æ–≥—ñ–∫—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –±–∞–∑–æ–≤–∏—Ö –º–µ—Ç–æ–¥—ñ–≤.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –¢—Ä–µ–π—Ç `Movable` –∑ –±–∞–∑–æ–≤–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ `position()` —Ç–∞ `set_position()`, —ñ –ø–æ—Ö—ñ–¥–Ω–∏–º–∏ `move_by()`, `move_to()`, `distance_to()`.

```rust
trait Movable {
    // –ë–∞–∑–æ–≤—ñ –º–µ—Ç–æ–¥–∏ ‚Äî –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ
    fn position(&self) -> (f64, f64);
    fn set_position(&mut self, x: f64, y: f64);
    
    // –ü–æ—Ö—ñ–¥–Ω—ñ –º–µ—Ç–æ–¥–∏ ‚Äî –±—É–¥—É—é—Ç—å—Å—è –Ω–∞ –±–∞–∑–æ–≤–∏—Ö
    fn move_by(&mut self, dx: f64, dy: f64) {
        let (x, y) = self.position();
        self.set_position(x + dx, y + dy);
    }
    
    fn move_to(&mut self, x: f64, y: f64) {
        self.set_position(x, y);
    }
    
    fn distance_to(&self, target_x: f64, target_y: f64) -> f64 {
        let (x, y) = self.position();
        ((x - target_x).powi(2) + (y - target_y).powi(2)).sqrt()
    }
}

struct Vehicle {
    x: f64,
    y: f64,
    name: String,
}

impl Movable for Vehicle {
    fn position(&self) -> (f64, f64) {
        (self.x, self.y)
    }
    
    fn set_position(&mut self, x: f64, y: f64) {
        self.x = x;
        self.y = y;
    }
    // move_by, move_to, distance_to ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ñ!
}

fn main() {
    let mut car = Vehicle {
        x: 0.0,
        y: 0.0,
        name: "–ê–≤—Ç–æ–º–æ–±—ñ–ª—å".to_string(),
    };
    
    println!("–°—Ç–∞—Ä—Ç: {:?}", car.position());  // (0.0, 0.0)
    
    car.move_by(10.0, 5.0);
    println!("–ü—ñ—Å–ª—è move_by: {:?}", car.position());  // (10.0, 5.0)
    
    car.move_to(100.0, 100.0);
    println!("–ü—ñ—Å–ª—è move_to: {:?}", car.position());  // (100.0, 100.0)
    
    println!("–í—ñ–¥—Å—Ç–∞–Ω—å –¥–æ –ø–æ—á–∞—Ç–∫—É: {:.2}", car.distance_to(0.0, 0.0));  // 141.42
}
```

**–§—ñ–ª–æ—Å–æ—Ñ—ñ—è:** –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∏–ø—É –Ω–∞–¥–∞—î –º—ñ–Ω—ñ–º—É–º ‚Äî `position()` —Ç–∞ `set_position()`. –¢—Ä–µ–π—Ç –±—É–¥—É—î –Ω–∞ —Ü—å–æ–º—É —Å–∫–ª–∞–¥–Ω—ñ—à—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

---

## 23.3 Associated types ‚Äî –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω—ñ —Ç–∏–ø–∏

### –ü—Ä–æ–±–ª–µ–º–∞ –∑ —É–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è–º–∏

–£—è–≤—ñ—Ç—å —Ç—Ä–µ–π—Ç `Container`, —â–æ –ø—Ä–∞—Ü—é—î –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Ç–∏–ø–∞–º–∏ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤:

```rust
// –ó generics ‚Äî –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–∞–∑—É–≤–∞—Ç–∏ —Ç–∏–ø –∫–æ–∂–µ–Ω —Ä–∞–∑
trait Container<T> {
    fn get(&self) -> Option<&T>;
    fn put(&mut self, item: T);
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–∞—î –≥—Ä–æ–º—ñ–∑–¥–∫–∏–º
fn process<T, C: Container<T>>(container: &C) { /* ... */ }
```

–©–æ—Ä–∞–∑—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–∞–∑—É–≤–∞—Ç–∏ `<T>`. –ê —â–æ, —è–∫—â–æ —Ç–∏–ø –µ–ª–µ–º–µ–Ω—Ç–∞ **–≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è** —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é, –∞ –Ω–µ –∑–æ–≤–Ω—ñ?

### Associated types ‚Äî —Ä—ñ—à–µ–Ω–Ω—è

Associated type ‚Äî —Ü–µ —Ç–∏–ø, **–∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω–∏–π** –∑ —Ç—Ä–µ–π—Ç–æ–º. –ö–æ–∂–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∫–∞–∑—É—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–∏–ø.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—Ä–µ–π—Ç `Container` –∑ associated type `Item`.

```rust
trait Container {
    type Item;  // Associated type ‚Äî "—Ç–∏–ø –µ–ª–µ–º–µ–Ω—Ç–∞"
    
    fn get(&self) -> Option<&Self::Item>;
    fn put(&mut self, item: Self::Item);
    fn is_empty(&self) -> bool;
}

// –°—Ç–µ–∫ —Ü—ñ–ª–∏—Ö —á–∏—Å–µ–ª
struct IntStack {
    items: Vec<i32>,
}

impl Container for IntStack {
    type Item = i32;  // –î–ª—è IntStack, Item = i32
    
    fn get(&self) -> Option<&i32> {
        self.items.last()
    }
    
    fn put(&mut self, item: i32) {
        self.items.push(item);
    }
    
    fn is_empty(&self) -> bool {
        self.items.is_empty()
    }
}

// –°—Ç–µ–∫ —Ä—è–¥–∫—ñ–≤
struct StringStack {
    items: Vec<String>,
}

impl Container for StringStack {
    type Item = String;  // –î–ª—è StringStack, Item = String
    
    fn get(&self) -> Option<&String> {
        self.items.last()
    }
    
    fn put(&mut self, item: String) {
        self.items.push(item);
    }
    
    fn is_empty(&self) -> bool {
        self.items.is_empty()
    }
}

// –§—É–Ω–∫—Ü—ñ—è –ø—Ä–∞—Ü—é—î –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º Item
fn print_top(container: &impl Container<Item = i32>) {
    if let Some(item) = container.get() {
        println!("–í–µ—Ä—Ö–Ω—ñ–π –µ–ª–µ–º–µ–Ω—Ç: {}", item);
    }
}

fn main() {
    let mut int_stack = IntStack { items: vec![] };
    int_stack.put(1);
    int_stack.put(2);
    int_stack.put(3);
    
    print_top(&int_stack);  // –í–µ—Ä—Ö–Ω—ñ–π –µ–ª–µ–º–µ–Ω—Ç: 3
}
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1. `type Item;` ‚Äî –æ–≥–æ–ª–æ—à—É—î associated type –≤ —Ç—Ä–µ–π—Ç—ñ
2. `type Item = i32;` ‚Äî —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∫–∞–∑—É—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–∏–ø
3. `Self::Item` ‚Äî –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ associated type —É –º–µ—Ç–æ–¥–∞—Ö
4. `Container<Item = i32>` ‚Äî –≤–∫–∞–∑—É—î–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–∏–ø –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ

### –ö–æ–ª–∏ generics, –∫–æ–ª–∏ associated types?

| Generics `<T>` | Associated types |
|----------------|------------------|
| –¢–∏–ø –≤–∫–∞–∑—É—î—Ç—å—Å—è **–∑–∑–æ–≤–Ω—ñ** | –¢–∏–ø **–≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è** —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é |
| –û–¥–∏–Ω —Ç–∏–ø –º–æ–∂–µ –º–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π | –¢–∏–ø –º–∞—î –æ–¥–Ω—É —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é |
| `Vec<i32>`, `Vec<String>` ‚Äî —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ | `Iterator::Item` ‚Äî –æ–¥–∏–Ω –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —ñ—Ç–µ—Ä–∞—Ç–æ—Ä–∞ |

**–ü—Ä–∞–≤–∏–ª–æ:** –Ø–∫—â–æ –¥–ª—è —Ç–∏–ø—É —ñ—Å–Ω—É—î —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω "–ø—Ä–∏—Ä–æ–¥–Ω–∏–π" –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω–∏–π —Ç–∏–ø ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ associated type.

---

## 23.4 Trait objects ‚Äî –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º

### –°—Ç–∞—Ç–∏—á–Ω–∏–π vs –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º

–î–æ —Ü—å–æ–≥–æ –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ `impl Trait` ‚Äî —Ü–µ **—Å—Ç–∞—Ç–∏—á–Ω–∏–π** –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º. –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –≥–µ–Ω–µ—Ä—É—î –æ–∫—Ä–µ–º—É –≤–µ—Ä—Å—ñ—é —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É.

–ê–ª–µ —â–æ, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ **—Ä—ñ–∑–Ω—ñ** —Ç–∏–ø–∏ –≤ –æ–¥–Ω—ñ–π –∫–æ–ª–µ–∫—Ü—ñ—ó? –ê–±–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ "–æ–¥–∏–Ω –∑ –∫—ñ–ª—å–∫–æ—Ö —Ç–∏–ø—ñ–≤" –∑ —Ñ—É–Ω–∫—Ü—ñ—ó?

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –ó–±–µ—Ä–µ–≥—Ç–∏ —Ä—ñ–∑–Ω—ñ —Ñ—ñ–≥—É—Ä–∏ (–∫–æ–ª–æ, –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫) –≤ –æ–¥–Ω–æ–º—É –≤–µ–∫—Ç–æ—Ä—ñ.

```rust
trait Drawable {
    fn draw(&self);
}

struct Circle {
    radius: f64,
}

struct Rectangle {
    width: f64,
    height: f64,
}

impl Drawable for Circle {
    fn draw(&self) {
        println!("–ú–∞–ª—é—é –∫–æ–ª–æ –∑ —Ä–∞–¥—ñ—É—Å–æ–º {}", self.radius);
    }
}

impl Drawable for Rectangle {
    fn draw(&self) {
        println!("–ú–∞–ª—é—é –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫ {}x{}", self.width, self.height);
    }
}

fn main() {
    let circle = Circle { radius: 5.0 };
    let rect = Rectangle { width: 10.0, height: 20.0 };
    
    // ‚ùå –ù–µ –ø—Ä–∞—Ü—é—î ‚Äî —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏!
    // let shapes: Vec<???> = vec![circle, rect];
    
    // ‚úÖ Trait objects ‚Äî —Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ –≤ –æ–¥–Ω—ñ–π –∫–æ–ª–µ–∫—Ü—ñ—ó
    let shapes: Vec<Box<dyn Drawable>> = vec![
        Box::new(Circle { radius: 5.0 }),
        Box::new(Rectangle { width: 10.0, height: 20.0 }),
    ];
    
    for shape in &shapes {
        shape.draw();  // –í–∏–±—ñ—Ä –º–µ—Ç–æ–¥—É –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
    }
}
```

**–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**

1. `dyn Drawable` ‚Äî "—è–∫–∏–π—Å—å —Ç–∏–ø, —â–æ —Ä–µ–∞–ª—ñ–∑—É—î Drawable"
2. `Box<dyn Drawable>` ‚Äî –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ –Ω–∞ heap –∑ trait object
3. –†–æ–∑–º—ñ—Ä `Circle` ‚â† —Ä–æ–∑–º—ñ—Ä `Rectangle`, –∞–ª–µ —Ä–æ–∑–º—ñ—Ä `Box<dyn Drawable>` –æ–¥–Ω–∞–∫–æ–≤–∏–π
4. **vtable** (virtual table) ‚Äî —Ç–∞–±–ª–∏—Ü—è –≤–∫–∞–∑—ñ–≤–Ω–∏–∫—ñ–≤ –Ω–∞ –º–µ—Ç–æ–¥–∏, –≤–∏–±—ñ—Ä –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

### Box<dyn Trait> vs &dyn Trait

```rust
trait Processor {
    fn process(&self, data: &str) -> String;
}

struct UpperCase;
struct Reverse;

impl Processor for UpperCase {
    fn process(&self, data: &str) -> String {
        data.to_uppercase()
    }
}

impl Processor for Reverse {
    fn process(&self, data: &str) -> String {
        data.chars().rev().collect()
    }
}

// &dyn Trait ‚Äî –ø–æ—Å–∏–ª–∞–Ω–Ω—è, –Ω–µ –≤–æ–ª–æ–¥—ñ—î
fn process_ref(processor: &dyn Processor, data: &str) -> String {
    processor.process(data)
}

// Box<dyn Trait> ‚Äî –≤–æ–ª–æ–¥—ñ—î –æ–±'—î–∫—Ç–æ–º
fn process_owned(processor: Box<dyn Processor>, data: &str) -> String {
    processor.process(data)
}

// –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ trait object ‚Äî —Ç–∏–ø –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
fn get_processor(uppercase: bool) -> Box<dyn Processor> {
    if uppercase {
        Box::new(UpperCase)
    } else {
        Box::new(Reverse)
    }
}

fn main() {
    let upper = UpperCase;
    let reverse = Reverse;
    
    // –ß–µ—Ä–µ–∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
    println!("{}", process_ref(&upper, "hello"));    // HELLO
    println!("{}", process_ref(&reverse, "hello"));  // olleh
    
    // –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è trait object
    let processor = get_processor(true);
    println!("{}", processor.process("dynamic"));  // DYNAMIC
}
```

**–†—ñ–∑–Ω–∏—Ü—è:**
- `&dyn Trait` ‚Äî –ø–æ–∑–∏—á–∞—î–º–æ, –æ–±'—î–∫—Ç –∂–∏–≤–µ –¥–µ—Å—å —â–µ
- `Box<dyn Trait>` ‚Äî –≤–æ–ª–æ–¥—ñ—î–º–æ, –æ–±'—î–∫—Ç –Ω–∞ heap

---

## 23.5 Object safety ‚Äî –±–µ–∑–ø–µ–∫–∞ –æ–±'—î–∫—Ç—ñ–≤

### –ù–µ –∫–æ–∂–µ–Ω —Ç—Ä–µ–π—Ç –º–æ–∂–µ –±—É—Ç–∏ trait object

–¢—Ä–µ–π—Ç –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —è–∫ `dyn Trait` —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤—ñ–Ω **object-safe**.

**–©–æ —Ä–æ–±–∏—Ç—å —Ç—Ä–µ–π—Ç –ù–ï object-safe:**

```rust
// ‚ùå –ù–ï object-safe ‚Äî generic –º–µ—Ç–æ–¥
trait NotSafe1 {
    fn method<T>(&self, value: T);  // –†–æ–∑–º—ñ—Ä T –Ω–µ–≤—ñ–¥–æ–º–∏–π
}

// ‚ùå –ù–ï object-safe ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î Self
trait NotSafe2 {
    fn clone_self(&self) -> Self;  // –†–æ–∑–º—ñ—Ä Self –Ω–µ–≤—ñ–¥–æ–º–∏–π
}

// ‚ùå –ù–ï object-safe ‚Äî —Å—Ç–∞—Ç–∏—á–Ω–∏–π –º–µ—Ç–æ–¥
trait NotSafe3 {
    fn create() -> Self;  // –ù–µ–º–∞—î &self ‚Äî –Ω–µ –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —á–µ—Ä–µ–∑ vtable
}

// ‚úÖ Object-safe
trait Safe {
    fn method(&self);
    fn method_with_args(&self, x: i32) -> i32;
}
```

**–ß–æ–º—É?** Trait object (`dyn Trait`) ‚Äî —Ü–µ –≤–∫–∞–∑—ñ–≤–Ω–∏–∫ + vtable. –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –Ω–µ –∑–Ω–∞—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–∏–ø, —Ç—ñ–ª—å–∫–∏ –Ω–∞–±—ñ—Ä –º–µ—Ç–æ–¥—ñ–≤. –î–ª—è generic –º–µ—Ç–æ–¥—ñ–≤ —á–∏ `Self` –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ç–∏–ø ‚Äî —Ü–µ –Ω–µ–º–æ–∂–ª–∏–≤–æ –∑ dyn.

### –û–±—Ö—ñ–¥ –æ–±–º–µ–∂–µ–Ω—å

**–í–∞—Ä—ñ–∞–Ω—Ç 1:** –ó–∞–º—ñ—Å—Ç—å `-> Self` –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ `Box<dyn Trait>`:

```rust
trait Cloneable {
    fn clone_box(&self) -> Box<dyn Cloneable>;
}

#[derive(Clone)]
struct Data {
    value: i32,
}

impl Cloneable for Data {
    fn clone_box(&self) -> Box<dyn Cloneable> {
        Box::new(self.clone())
    }
}

fn main() {
    let original: Box<dyn Cloneable> = Box::new(Data { value: 42 });
    let cloned = original.clone_box();
}
```

**–í–∞—Ä—ñ–∞–Ω—Ç 2:** –í–∏–∫–ª—é—á–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º–Ω–∏–π –º–µ—Ç–æ–¥ –∑ trait object —á–µ—Ä–µ–∑ `where Self: Sized`:

```rust
trait Mixed {
    // Object-safe –º–µ—Ç–æ–¥
    fn safe_method(&self);
    
    // –ù–ï object-safe, –∞–ª–µ –≤–∏–∫–ª—é—á–µ–Ω–∏–π –∑ dyn
    fn unsafe_method(&self) -> Self where Self: Sized;
}

struct MyType;

impl Mixed for MyType {
    fn safe_method(&self) {
        println!("–ë–µ–∑–ø–µ—á–Ω–∏–π!");
    }
    
    fn unsafe_method(&self) -> Self {
        MyType
    }
}

fn main() {
    let obj: &dyn Mixed = &MyType;
    obj.safe_method();  // OK
    // obj.unsafe_method();  // ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π —á–µ—Ä–µ–∑ dyn
}
```

---

## 23.6 –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥: —ñ—î—Ä–∞—Ä—Ö—ñ—è —Ç—Ä–µ–π—Ç—ñ–≤ –¥–ª—è –∞–≥–µ–Ω—Ç–∞

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ç—Ä–µ–π—Ç—ñ–≤ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –∞–≥–µ–Ω—Ç—ñ–≤ –ë–ü–õ–ê. –ê–≥–µ–Ω—Ç–∏ –º–∞—é—Ç—å: —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é, –ø–æ–∑–∏—Ü—ñ—é, –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä—É—Ö—É, —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è, –∑–∞—Ä—è–¥ –±–∞—Ç–∞—Ä–µ—ó.

```rust
use std::fmt;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –ë–ê–ó–û–í–Ü –¢–ò–ü–ò
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

#[derive(Debug, Clone, Copy, PartialEq, Default)]
pub struct Position {
    pub x: f64,
    pub y: f64,
    pub z: f64,
}

impl Position {
    pub fn new(x: f64, y: f64, z: f64) -> Self {
        Self { x, y, z }
    }
    
    pub fn distance_to(&self, other: &Position) -> f64 {
        let dx = self.x - other.x;
        let dy = self.y - other.y;
        let dz = self.z - other.z;
        (dx*dx + dy*dy + dz*dz).sqrt()
    }
}

impl fmt::Display for Position {
    fn fmt(&self, f: &mut fmt::Formatter<'_>) -> fmt::Result {
        write!(f, "({:.1}, {:.1}, {:.1})", self.x, self.y, self.z)
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –¢–†–ï–ô–¢: IDENTIFIABLE ‚Äî —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∞–≥–µ–Ω—Ç–∞
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

pub trait Identifiable {
    fn id(&self) -> &str;
    fn agent_type(&self) -> &str;
    
    // Default –º–µ—Ç–æ–¥ ‚Äî –∫–æ–º–±—ñ–Ω—É—î —Ç–∏–ø —Ç–∞ id
    fn full_id(&self) -> String {
        format!("{}:{}", self.agent_type(), self.id())
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –¢–†–ï–ô–¢: LOCATABLE ‚Äî –ø–æ–∑–∏—Ü—ñ—è —É –ø—Ä–æ—Å—Ç–æ—Ä—ñ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

pub trait Locatable {
    fn position(&self) -> Position;
    
    fn distance_to(&self, target: &Position) -> f64 {
        self.position().distance_to(target)
    }
    
    fn is_near(&self, target: &Position, threshold: f64) -> bool {
        self.distance_to(target) <= threshold
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –¢–†–ï–ô–¢: MOVABLE ‚Äî –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ä—É—Ö—É (–≤–∏–º–∞–≥–∞—î Locatable)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

pub trait Movable: Locatable {
    type MoveError: fmt::Debug;  // Associated type –¥–ª—è –ø–æ–º–∏–ª–æ–∫
    
    fn move_to(&mut self, target: Position) -> Result<(), Self::MoveError>;
    fn max_speed(&self) -> f64;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –¢–†–ï–ô–¢: POWERED ‚Äî –±–∞—Ç–∞—Ä–µ—è
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

pub trait Powered {
    fn battery_level(&self) -> u8;
    fn consume_battery(&mut self, amount: u8);
    
    fn is_battery_low(&self) -> bool {
        self.battery_level() < 20
    }
    
    fn is_battery_critical(&self) -> bool {
        self.battery_level() < 10
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –¢–†–ï–ô–¢: AGENT ‚Äî –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∏–π (supertraits)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Agent –≤–∏–º–∞–≥–∞—î –≤—Å—ñ –±–∞–∑–æ–≤—ñ —Ç—Ä–µ–π—Ç–∏
pub trait Agent: Identifiable + Locatable + Movable + Powered {
    fn status(&self) -> String {
        format!(
            "[{}] –ü–æ–∑–∏—Ü—ñ—è: {} | –ë–∞—Ç–∞—Ä–µ—è: {}%",
            self.full_id(),
            self.position(),
            self.battery_level()
        )
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –†–ï–ê–õ–Ü–ó–ê–¶–Ü–Ø: DroneAgent
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

pub struct DroneAgent {
    id: String,
    position: Position,
    battery: u8,
    max_speed: f64,
}

#[derive(Debug)]
pub enum DroneError {
    LowBattery,
    OutOfRange,
}

impl DroneAgent {
    pub fn new(id: &str) -> Self {
        Self {
            id: id.to_string(),
            position: Position::default(),
            battery: 100,
            max_speed: 20.0,
        }
    }
}

impl Identifiable for DroneAgent {
    fn id(&self) -> &str { &self.id }
    fn agent_type(&self) -> &str { "DRONE" }
}

impl Locatable for DroneAgent {
    fn position(&self) -> Position { self.position }
}

impl Movable for DroneAgent {
    type MoveError = DroneError;
    
    fn move_to(&mut self, target: Position) -> Result<(), DroneError> {
        if self.is_battery_critical() {
            return Err(DroneError::LowBattery);
        }
        
        let distance = self.distance_to(&target);
        let cost = (distance / 50.0) as u8 + 1;
        
        self.position = target;
        self.consume_battery(cost);
        Ok(())
    }
    
    fn max_speed(&self) -> f64 { self.max_speed }
}

impl Powered for DroneAgent {
    fn battery_level(&self) -> u8 { self.battery }
    
    fn consume_battery(&mut self, amount: u8) {
        self.battery = self.battery.saturating_sub(amount);
    }
}

// Blanket implementation ‚Äî Agent –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π
impl Agent for DroneAgent {}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –†–ï–ê–õ–Ü–ó–ê–¶–Ü–Ø: RoverAgent
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

pub struct RoverAgent {
    id: String,
    position: Position,
    battery: u8,
}

#[derive(Debug)]
pub enum RoverError {
    BatteryDepleted,
    CannotFly,  // Rover –Ω–µ –º–æ–∂–µ –ª—ñ—Ç–∞—Ç–∏
}

impl RoverAgent {
    pub fn new(id: &str) -> Self {
        Self {
            id: id.to_string(),
            position: Position::default(),
            battery: 100,
        }
    }
}

impl Identifiable for RoverAgent {
    fn id(&self) -> &str { &self.id }
    fn agent_type(&self) -> &str { "ROVER" }
}

impl Locatable for RoverAgent {
    fn position(&self) -> Position { self.position }
}

impl Movable for RoverAgent {
    type MoveError = RoverError;
    
    fn move_to(&mut self, target: Position) -> Result<(), RoverError> {
        if self.battery == 0 {
            return Err(RoverError::BatteryDepleted);
        }
        
        // Rover –Ω–µ –º–æ–∂–µ –ª—ñ—Ç–∞—Ç–∏!
        if target.z > 0.0 {
            return Err(RoverError::CannotFly);
        }
        
        let distance = self.distance_to(&target);
        let cost = (distance / 30.0) as u8 + 1;  // Rover –º–µ–Ω—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π
        
        self.position = Position::new(target.x, target.y, 0.0);
        self.consume_battery(cost);
        Ok(())
    }
    
    fn max_speed(&self) -> f64 { 5.0 }  // Rover –ø–æ–≤—ñ–ª—å–Ω—ñ—à–∏–π
}

impl Powered for RoverAgent {
    fn battery_level(&self) -> u8 { self.battery }
    
    fn consume_battery(&mut self, amount: u8) {
        self.battery = self.battery.saturating_sub(amount);
    }
}

impl Agent for RoverAgent {}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –§–£–ù–ö–¶–Ü–á, –©–û –ü–†–ê–¶–Æ–Æ–¢–¨ –ó –ë–£–î–¨-–Ø–ö–ò–ú –ê–ì–ï–ù–¢–û–ú
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// –°—Ç–∞—Ç–∏—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º ‚Äî –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –≥–µ–Ω–µ—Ä—É—î –æ–∫—Ä–µ–º—É –≤–µ—Ä—Å—ñ—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É
fn print_status(agent: &impl Agent) {
    println!("{}", agent.status());
}

// Generic –∑ trait bounds
fn patrol<A: Agent>(agent: &mut A, waypoints: Vec<Position>) {
    println!("\nüöÄ –ü–∞—Ç—Ä—É–ª—é–≤–∞–Ω–Ω—è: {}", agent.full_id());
    
    for (i, wp) in waypoints.iter().enumerate() {
        println!("üìç Waypoint {}: {}", i + 1, wp);
        
        match agent.move_to(*wp) {
            Ok(()) => println!("   ‚úÖ –î–æ—Å—è–≥–Ω—É—Ç–æ. {}", agent.status()),
            Err(e) => {
                println!("   ‚ùå –ü–æ–º–∏–ª–∫–∞: {:?}", e);
                break;
            }
        }
    }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –î–ï–ú–û–ù–°–¢–†–ê–¶–Ü–Ø
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

fn main() {
    println!("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
    println!("‚ïë           –î–ï–ú–û–ù–°–¢–†–ê–¶–Ü–Ø –Ü–Ñ–†–ê–†–•–Ü–á –¢–†–ï–ô–¢–Ü–í                       ‚ïë");
    println!("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    
    let mut drone = DroneAgent::new("SCOUT-001");
    let mut rover = RoverAgent::new("GROUND-001");
    
    // –°—Ç–∞—Ç–∏—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º ‚Äî –æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±–æ—Ö —Ç–∏–ø—ñ–≤
    println!("\n=== –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å ===");
    print_status(&drone);
    print_status(&rover);
    
    // –ü–∞—Ç—Ä—É–ª—é–≤–∞–Ω–Ω—è drone (–º–æ–∂–µ –ª—ñ—Ç–∞—Ç–∏)
    let drone_waypoints = vec![
        Position::new(100.0, 0.0, 50.0),
        Position::new(100.0, 100.0, 50.0),
    ];
    patrol(&mut drone, drone_waypoints);
    
    // –ü–∞—Ç—Ä—É–ª—é–≤–∞–Ω–Ω—è rover (—Ç—ñ–ª—å–∫–∏ –ø–æ –∑–µ–º–ª—ñ)
    let rover_waypoints = vec![
        Position::new(50.0, 0.0, 0.0),
        Position::new(50.0, 50.0, 0.0),
    ];
    patrol(&mut rover, rover_waypoints);
    
    // –°–ø—Ä–æ–±–∞ rover –ø–æ–ª–µ—Ç—ñ—Ç–∏ ‚Äî –ø–æ–º–∏–ª–∫–∞
    println!("\n=== Rover –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –∑–ª–µ—Ç—ñ—Ç–∏ ===");
    match rover.move_to(Position::new(0.0, 0.0, 100.0)) {
        Ok(()) => println!("–ó–ª–µ—Ç—ñ–≤ (?)"),
        Err(e) => println!("–ü–æ–º–∏–ª–∫–∞: {:?}", e),  // CannotFly
    }
    
    println!("\n=== –§—ñ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ç—É—Å ===");
    print_status(&drone);
    print_status(&rover);
}
```

**–©–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Ü–µ–π –ø—Ä–∏–∫–ª–∞–¥:**

1. **–Ü—î—Ä–∞—Ä—Ö—ñ—è —Ç—Ä–µ–π—Ç—ñ–≤:** `Agent: Identifiable + Locatable + Movable + Powered`
2. **Supertraits:** `Movable: Locatable` ‚Äî Movable –≤–∏–º–∞–≥–∞—î Locatable
3. **Associated types:** `type MoveError` ‚Äî –∫–æ–∂–µ–Ω –∞–≥–µ–Ω—Ç –º–∞—î —Å–≤—ñ–π —Ç–∏–ø –ø–æ–º–∏–ª–∫–∏
4. **Default –º–µ—Ç–æ–¥–∏:** `full_id()`, `is_battery_low()`, `status()`
5. **Blanket implementation:** `impl Agent for DroneAgent {}` ‚Äî –ø–æ—Ä–æ–∂–Ω—î —Ç—ñ–ª–æ, –≤—Å–µ –∑ defaults
6. **–°—Ç–∞—Ç–∏—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º:** `print_status(&impl Agent)` –ø—Ä–∞—Ü—é—î –∑ –æ–±–æ–º–∞ —Ç–∏–ø–∞–º–∏

---

## 23.7 –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞

**–ó–∞–≤–¥–∞–Ω–Ω—è:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ç—Ä–µ–π—Ç—ñ–≤ –¥–ª—è —Å–µ–Ω—Å–æ—Ä—ñ–≤ –∞–≥–µ–Ω—Ç–∞.

### –ß–∞—Å—Ç–∏–Ω–∞ 1: –ë–∞–∑–æ–≤—ñ —Ç—Ä–µ–π—Ç–∏ (3 –±–∞–ª–∏)

```rust
trait Sensor {
    fn id(&self) -> &str;
    fn read(&self) -> f64;
    fn unit(&self) -> &str;
    fn formatted(&self) -> String;  // Default
}

trait Calibratable {
    fn calibrate(&mut self);
    fn is_calibrated(&self) -> bool;
}
```

### –ß–∞—Å—Ç–∏–Ω–∞ 2: –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó (4 –±–∞–ª–∏)

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ç—Ä–∏ —Ç–∏–ø–∏ —Å–µ–Ω—Å–æ—Ä—ñ–≤:
- `TemperatureSensor` ‚Äî ¬∞C
- `HumiditySensor` ‚Äî %
- `PressureSensor` ‚Äî hPa

–ö–æ–∂–µ–Ω —Ä–µ–∞–ª—ñ–∑—É—î `Sensor` —Ç–∞ `Calibratable`.

### –ß–∞—Å—Ç–∏–Ω–∞ 3: SensorArray –∑ trait objects (3 –±–∞–ª–∏)

```rust
struct SensorArray {
    sensors: Vec<Box<dyn Sensor>>,
}

impl SensorArray {
    fn add(&mut self, sensor: Box<dyn Sensor>);
    fn read_all(&self) -> Vec<(String, f64)>;
}
```

**–ö—Ä–∏—Ç–µ—Ä—ñ—ó –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è:**

| –ö—Ä–∏—Ç–µ—Ä—ñ–π | –ë–∞–ª–∏ |
|----------|------|
| –ë–∞–∑–æ–≤—ñ —Ç—Ä–µ–π—Ç–∏ –∑ default –º–µ—Ç–æ–¥–∞–º–∏ | 3 |
| –¢—Ä–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Å–µ–Ω—Å–æ—Ä—ñ–≤ | 4 |
| SensorArray –∑ trait objects | 3 |
| **–ú–∞–∫—Å–∏–º—É–º** | **10** |

---

## –ü—ñ–¥—Å—É–º–æ–∫

–í–ª–∞—Å–Ω—ñ —Ç—Ä–µ–π—Ç–∏ ‚Äî –ø–æ—Ç—É–∂–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü—ñ—ó:

| –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|-----------|-------------|
| **–í–ª–∞—Å–Ω–∏–π —Ç—Ä–µ–π—Ç** | –í–∏–∑–Ω–∞—á–∞—î —Å–ø—ñ–ª—å–Ω—É –ø–æ–≤–µ–¥—ñ–Ω–∫—É –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ |
| **Default –º–µ—Ç–æ–¥–∏** | –ù–∞–¥–∞—î —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º |
| **Associated types** | –¢–∏–ø, –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—î—é |
| **Supertraits** | –¢—Ä–µ–π—Ç –≤–∏–º–∞–≥–∞—î —ñ–Ω—à–∏–π —Ç—Ä–µ–π—Ç |
| **Trait objects** | –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º —á–µ—Ä–µ–∑ `dyn Trait` |
| **Object safety** | –í–∏–º–æ–≥–∏ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —è–∫ trait object |

**–°—Ç–∞—Ç–∏—á–Ω–∏–π vs –¥–∏–Ω–∞–º—ñ—á–Ω–∏–π –ø–æ–ª—ñ–º–æ—Ä—Ñ—ñ–∑–º:**

| `impl Trait` | `dyn Trait` |
|--------------|-------------|
| –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è ‚Äî –æ–∫—Ä–µ–º–∞ –≤–µ—Ä—Å—ñ—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É | Runtime ‚Äî vtable |
| –®–≤–∏–¥—à–µ (inlining) | –ì–Ω—É—á–∫—ñ—à–µ (—Ä—ñ–∑–Ω—ñ —Ç–∏–ø–∏ –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó) |
| –ë—ñ–ª—å—à–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–∫ | –ú–µ–Ω—à–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–∫ |

---

## –ó–≤'—è–∑–æ–∫ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º —Ä–æ–∑–¥—ñ–ª–æ–º

–í–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏ –≤–ª–∞—Å–Ω—ñ —Ç—Ä–µ–π—Ç–∏ –¥–ª—è –∞–≥–µ–Ω—Ç—ñ–≤. –¢–µ–ø–µ—Ä —á–∞—Å –Ω–∞–≤—á–∏—Ç–∏—Å—å –ø–∏—Å–∞—Ç–∏ **generic** —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å –∑ –±—É–¥—å-—è–∫–∏–º–∏ —Ç–∏–ø–∞–º–∏.

–£ **–†–æ–∑–¥—ñ–ª—ñ 24: –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä–∏—á–Ω—ñ —Ç–∏–ø–∏** –≤–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å:
- –Ø–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ generic —Ñ—É–Ω–∫—Ü—ñ—ó
- –Ø–∫ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ generic —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
- –Ø–∫ –ø—Ä–∞—Ü—é—î –º–æ–Ω–æ–º–æ—Ä—Ñ—ñ–∑–∞—Ü—ñ—è
- –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ turbofish `::<>`
