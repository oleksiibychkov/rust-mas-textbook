# –†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏ —Ç–∞ —à–ª—è—Ö–∞–º–∏

---

## üìã –ê–Ω–æ—Ç–∞—Ü—ñ—è

–¶–µ–π —Ä–æ–∑–¥—ñ–ª –æ—Ö–æ–ø–ª—é—î –ø–æ–≤–Ω–∏–π —Å–ø–µ–∫—Ç—Ä —Ä–æ–±–æ—Ç–∏ –∑ —Ñ–∞–π–ª–∞–º–∏ –≤ Rust ‚Äî –≤—ñ–¥ –±–∞–∑–æ–≤–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å—É –¥–æ –ø—ñ–¥—Å—Ç—É–ø–Ω–∏—Ö –∫—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω–∏—Ö –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç–µ–π. –í–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å, —è–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏, —á–∏—Ç–∞—Ç–∏ —Ç–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏, —á–æ–º—É —à–ª—è—Ö, —â–æ –ø—Ä–∞—Ü—é—î –Ω–∞ Linux, –º–æ–∂–µ –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–∞ Windows, —Ç–∞ —è–∫ —É–Ω–∏–∫–Ω—É—Ç–∏ –≤—Ç—Ä–∞—Ç–∏ –¥–∞–Ω–∏—Ö —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—É –æ–±—Ä–æ–±–∫—É –∫–æ–¥—É–≤–∞–Ω—å. –£ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ —Ä–æ—é –ë–ü–õ–ê —Ñ–∞–π–ª–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó, –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π –º—ñ—Å—ñ–π, –∫–µ—à—É–≤–∞–Ω–Ω—è –∫–∞—Ä—Ç ‚Äî —ñ –ø–æ–º–∏–ª–∫–∞ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –≤—Ç—Ä–∞—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø–æ–ª—å–æ—Ç—É.

---

## üéØ –¶—ñ–ª—ñ –Ω–∞–≤—á–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ:

1. **–ß–∏—Ç–∞—Ç–∏ —Ç–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏** —Ñ–∞–π–ª–∏ —Ä—ñ–∑–Ω–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
2. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏** –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–∏–π I/O –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
3. **–ü—Ä–∞—Ü—é–≤–∞—Ç–∏** –∑ —à–ª—è—Ö–∞–º–∏ —á–µ—Ä–µ–∑ Path —Ç–∞ PathBuf
4. **–†–æ–∑—É–º—ñ—Ç–∏** –∫—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω—ñ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ —Ñ–∞–π–ª–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º
5. **–û–±—Ä–æ–±–ª—è—Ç–∏** —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤ –∑ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º –∫–æ–¥—É–≤–∞–Ω–Ω—è–º
6. **–£–Ω–∏–∫–∞—Ç–∏** —Ç–∏–ø–æ–≤–∏—Ö –ø–æ–º–∏–ª–æ–∫ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ —Ñ–∞–π–ª–∞–º–∏
7. **–ó–∞–±–µ–∑–ø–µ—á—É–≤–∞—Ç–∏** –∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π

---

## üìö –ö–ª—é—á–æ–≤—ñ —Ç–µ—Ä–º—ñ–Ω–∏

| –¢–µ—Ä–º—ñ–Ω | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|------------|
| **File** | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏–º —Ñ–∞–π–ª–æ–º |
| **Path** | –ù–µ–∑–º—ñ–Ω–Ω–∏–π —Å–ª–∞–π—Å —à–ª—è—Ö—É (–∞–Ω–∞–ª–æ–≥ &str) |
| **PathBuf** | –í–æ–ª–æ–¥—ñ—é—á–∏–π –±—É—Ñ–µ—Ä —à–ª—è—Ö—É (–∞–Ω–∞–ª–æ–≥ String) |
| **BufReader/BufWriter** | –û–±–≥–æ—Ä—Ç–∫–∏ –¥–ª—è –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–æ–≥–æ I/O |
| **OsString/OsStr** | –†—è–¥–∫–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ |
| **file descriptor** | –ß–∏—Å–ª–æ–≤–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ —Ñ–∞–π–ª—É –≤ –û–° |

---

## üí° –ú–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏–π –∫–µ–π—Å: –ó–Ω–∏–∫–ª—ñ –ª–æ–≥–∏ –ø–æ–ª—å–æ—Ç—É

–ö–æ–º–∞–Ω–¥–∞ —Ä–æ–∑—Ä–æ–±–ª—è–ª–∞ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—Ä–æ–Ω—ñ–≤. –ö–æ–¥ –ø—Ä–∞—Ü—é–≤–∞–≤ —ñ–¥–µ–∞–ª—å–Ω–æ –Ω–∞ –º–∞—à–∏–Ω–∞—Ö —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ (macOS —Ç–∞ Linux). –ê–ª–µ –∫–æ–ª–∏ —Å–∏—Å—Ç–µ–º—É —Ä–æ–∑–≥–æ—Ä–Ω—É–ª–∏ –Ω–∞ –Ω–∞–∑–µ–º–Ω—ñ–π —Å—Ç–∞–Ω—Ü—ñ—ó –∑ Windows, –ø–æ—á–∞–ª–∏—Å—è –ø—Ä–æ–±–ª–µ–º–∏.

–°–ø–æ—á–∞—Ç–∫—É —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–≥–ª–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è –ª–æ–≥—ñ–≤:
```rust
let log_path = format!("logs/{}/flight.log", mission_id);
std::fs::create_dir_all(&log_path)?;  // –ü–æ–º–∏–ª–∫–∞ –Ω–∞ Windows!
```

–ü—Ä–∏—á–∏–Ω–∞: `mission_id` –º—ñ—Å—Ç–∏–≤ —Å–∏–º–≤–æ–ª `:` (—Ñ–æ—Ä–º–∞—Ç —á–∞—Å—É `14:30:00`), —è–∫–∏–π –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏–π —É —à–ª—è—Ö–∞—Ö Windows.

–ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤–∏–Ω–∏–∫–ª–∞ –Ω–æ–≤–∞ –ø—Ä–æ–±–ª–µ–º–∞: –ª–æ–≥–∏ —ñ—Å–Ω—É–≤–∞–ª–∏, –∞–ª–µ –±—É–ª–∏ –ø–æ—Ä–æ–∂–Ω—ñ. –ê–Ω–∞–ª—ñ–∑ –ø–æ–∫–∞–∑–∞–≤:
```rust
fn log_telemetry(file: &mut File, data: &str) {
    write!(file, "{}\n", data).unwrap();
    // –î–∞–Ω—ñ –≤ –±—É—Ñ–µ—Ä—ñ, –∞–ª–µ –Ω–µ –Ω–∞ –¥–∏—Å–∫—É!
}
```

–ü—Ä–∏ –∞–≤–∞—Ä—ñ–π–Ω–æ–º—É –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ (crash, –≤—Ç—Ä–∞—Ç–∞ –∂–∏–≤–ª–µ–Ω–Ω—è) –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –≤—Ç—Ä–∞—á–∞–ª–∏—Å—å. –ù–∞ Linux —Ü–µ —Ç—Ä–∞–ø–ª—è–ª–æ—Å—å —Ä—ñ–¥—à–µ —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å–∏–≤–Ω—ñ—à–∏–π flush, –Ω–∞ Windows ‚Äî –ø–æ—Å—Ç—ñ–π–Ω–æ.

–§—ñ–Ω–∞–ª—å–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞: –¥–µ—è–∫—ñ –ª–æ–≥–∏ –º—ñ—Å—Ç–∏–ª–∏ "–∫—Ä–∞–∫–æ–∑—è–±—Ä–∏" –∑–∞–º—ñ—Å—Ç—å –∫–∏—Ä–∏–ª–∏—Ü—ñ —É –Ω–∞–∑–≤–∞—Ö —Ç–æ—á–æ–∫ –º–∞—Ä—à—Ä—É—Ç—É. –ü—Ä–∏—á–∏–Ω–∞ ‚Äî –∑–º—ñ—à—É–≤–∞–Ω–Ω—è UTF-8 —Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥—É–≤–∞–Ω–Ω—è Windows (CP1251).

–¢—Ä–∏ —Ä—ñ–∑–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏, –æ–¥–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—î —Ä–æ–∑—É–º—ñ–Ω–Ω—è –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç–µ–π —Ñ–∞–π–ª–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º.

---

# –ß–ê–°–¢–ò–ù–ê 1: –û–°–ù–û–í–ò –†–û–ë–û–¢–ò –ó –§–ê–ô–õ–ê–ú–ò

---

## –¢–ï–û–†–Ü–Ø: –í–Ü–î–ö–†–ò–¢–¢–Ø –¢–ê –°–¢–í–û–†–ï–ù–ù–Ø –§–ê–ô–õ–Ü–í

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ File

`std::fs::File` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Ñ–∞–π–ª. –¶–µ –æ–±–≥–æ—Ä—Ç–∫–∞ –Ω–∞–¥ file descriptor –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏:

```rust
use std::fs::File;

// –í—ñ–¥–∫—Ä–∏—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π —Ñ–∞–π–ª –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è
let file = File::open("data.txt")?;

// –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø–∏—Å—É (–ø–µ—Ä–µ–∑–∞–ø–∏—à–µ —ñ—Å–Ω—É—é—á–∏–π!)
let file = File::create("output.txt")?;
```

–í–∞–∂–ª–∏–≤–æ —Ä–æ–∑—É–º—ñ—Ç–∏: `File::open` –≤—ñ–¥–∫—Ä–∏–≤–∞—î –ª–∏—à–µ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è, `File::create` –ª–∏—à–µ –¥–ª—è –∑–∞–ø–∏—Å—É (—ñ —Å—Ç–≤–æ—Ä—é—î —Ñ–∞–π–ª, —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î).

### –©–æ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å —Ü—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

–û–±–∏–¥–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å `Result<File, std::io::Error>`:

```rust
use std::fs::File;
use std::io;

fn open_config() -> io::Result<File> {
    let file = File::open("config.toml")?;
    Ok(file)
}

// –ú–æ–∂–ª–∏–≤—ñ –ø–æ–º–∏–ª–∫–∏:
// - NotFound: —Ñ–∞–π–ª –Ω–µ —ñ—Å–Ω—É—î
// - PermissionDenied: –Ω–µ–º–∞—î –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É
// - AlreadyExists: (–¥–ª—è create –∑ –ø–µ–≤–Ω–∏–º–∏ –æ–ø—Ü—ñ—è–º–∏)
// - —Ç–∞ —ñ–Ω—à—ñ...
```

### OpenOptions ‚Äî –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å

–î–ª—è —Å–∫–ª–∞–¥–Ω—ñ—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `OpenOptions`:

```rust
use std::fs::OpenOptions;

// –í—ñ–¥–∫—Ä–∏—Ç–∏ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è —ñ –∑–∞–ø–∏—Å—É
let file = OpenOptions::new()
    .read(true)
    .write(true)
    .open("data.txt")?;

// –í—ñ–¥–∫—Ä–∏—Ç–∏ –¥–ª—è –¥–æ–ø–∏—Å—É–≤–∞–Ω–Ω—è (append)
let file = OpenOptions::new()
    .append(true)
    .open("log.txt")?;

// –°—Ç–≤–æ—Ä–∏—Ç–∏, –ª–∏—à–µ —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î
let file = OpenOptions::new()
    .write(true)
    .create_new(true)  // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ —Ñ–∞–π–ª —ñ—Å–Ω—É—î
    .open("unique.txt")?;

// –°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–±–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π, –Ω–µ –æ–±—Ä—ñ–∑–∞—é—á–∏
let file = OpenOptions::new()
    .write(true)
    .create(true)      // –°—Ç–≤–æ—Ä–∏—Ç–∏, —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î
    .truncate(false)   // –ù–µ –æ–±—Ä—ñ–∑–∞—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π
    .open("data.txt")?;
```

### –¢–∞–±–ª–∏—Ü—è —Ä–µ–∂–∏–º—ñ–≤ OpenOptions

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å |
|-------|------|
| `.read(true)` | –î–æ–∑–≤–æ–ª–∏—Ç–∏ —á–∏—Ç–∞–Ω–Ω—è |
| `.write(true)` | –î–æ–∑–≤–æ–ª–∏—Ç–∏ –∑–∞–ø–∏—Å |
| `.append(true)` | –ó–∞–ø–∏—Å —É –∫—ñ–Ω–µ—Ü—å —Ñ–∞–π–ª—É |
| `.truncate(true)` | –û–±—Ä—ñ–∑–∞—Ç–∏ —Ñ–∞–π–ª –¥–æ –Ω—É–ª—è –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ |
| `.create(true)` | –°—Ç–≤–æ—Ä–∏—Ç–∏, —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î |
| `.create_new(true)` | –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª–∏—à–µ —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î (–ø–æ–º–∏–ª–∫–∞ —ñ–Ω–∞–∫—à–µ) |

### RAII: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–∫—Ä–∏—Ç—Ç—è

File —Ä–µ–∞–ª—ñ–∑—É—î Drop ‚Äî —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑—ñ scope:

```rust
fn process_file() -> io::Result<()> {
    let file = File::open("data.txt")?;
    // ... —Ä–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–æ–º ...
    Ok(())
}  // file –≤–∏—Ö–æ–¥–∏—Ç—å –∑—ñ scope ‚Üí Drop ‚Üí —Ñ–∞–π–ª –∑–∞–∫—Ä–∏–≤–∞—î—Ç—å—Å—è
```

–ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `close()` –≤—Ä—É—á–Ω—É. –ê–ª–µ —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—Ä–æ–±–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É –∑–∞–∫—Ä–∏—Ç—Ç—è:

```rust
use std::fs::File;
use std::io::Write;

fn write_important_data() -> io::Result<()> {
    let mut file = File::create("important.txt")?;
    write!(file, "critical data")?;
    
    // –Ø–≤–Ω–∏–π sync –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó –∑–∞–ø–∏—Å—É –Ω–∞ –¥–∏—Å–∫
    file.sync_all()?;
    
    Ok(())
}
```

---

## –¢–ï–û–†–Ü–Ø: –ß–ò–¢–ê–ù–ù–Ø –§–ê–ô–õ–Ü–í

### –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–±: read_to_string

–î–ª—è –Ω–µ–≤–µ–ª–∏–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤:

```rust
use std::fs;

let content = fs::read_to_string("config.toml")?;
println!("Config:\n{}", content);
```

–¶–µ —á–∏—Ç–∞—î –≤–µ—Å—å —Ñ–∞–π–ª —É –ø–∞–º'—è—Ç—å —è–∫ String. –ü—Ä–æ—Å—Ç–∏–π, –∞–ª–µ –º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è:
- –í–µ—Å—å —Ñ–∞–π–ª –º–∞—î –ø–æ–º—ñ—Å—Ç–∏—Ç–∏—Å—å —É –ø–∞–º'—è—Ç—å
- –§–∞–π–ª –º–∞—î –±—É—Ç–∏ –≤–∞–ª—ñ–¥–Ω–∏–º UTF-8

### –ß–∏—Ç–∞–Ω–Ω—è –±—ñ–Ω–∞—Ä–Ω–∏—Ö –¥–∞–Ω–∏—Ö: read

```rust
use std::fs;

let bytes: Vec<u8> = fs::read("image.png")?;
println!("File size: {} bytes", bytes.len());
```

### –ß–∏—Ç–∞–Ω–Ω—è –∑ File –Ω–∞–ø—Ä—è–º—É

```rust
use std::fs::File;
use std::io::Read;

let mut file = File::open("data.txt")?;
let mut content = String::new();
file.read_to_string(&mut content)?;
```

–ê–±–æ —á–∏—Ç–∞–Ω–Ω—è —É –±—É—Ñ–µ—Ä:

```rust
use std::fs::File;
use std::io::Read;

let mut file = File::open("data.bin")?;
let mut buffer = [0u8; 1024];
let bytes_read = file.read(&mut buffer)?;
println!("Read {} bytes", bytes_read);
```

### –ß–∏—Ç–∞–Ω–Ω—è –ø–æ —Ä—è–¥–∫–∞—Ö: BufReader

–î–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ —á–∏—Ç–∞–π—Ç–µ –ø–æ —Ä—è–¥–∫–∞—Ö:

```rust
use std::fs::File;
use std::io::{BufRead, BufReader};

let file = File::open("large_log.txt")?;
let reader = BufReader::new(file);

for line in reader.lines() {
    let line = line?;  // lines() –ø–æ–≤–µ—Ä—Ç–∞—î Result –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞
    println!("{}", line);
}
```

–¶–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–∞–º'—è—Ç—å ‚Äî —É –∫–æ–∂–µ–Ω –º–æ–º–µ–Ω—Ç —É –ø–∞–º'—è—Ç—ñ –ª–∏—à–µ –ø–æ—Ç–æ—á–Ω–∏–π —Ä—è–¥–æ–∫.

### BufReader: —á–æ–º—É –≤—ñ–Ω –≤–∞–∂–ª–∏–≤–∏–π

–ë–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü—ñ—ó –∫–æ–∂–µ–Ω –≤–∏–∫–ª–∏–∫ `read` ‚Äî —Ü–µ —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫, —â–æ –ø–æ–≤—ñ–ª—å–Ω–æ:

```rust
// –ü–æ–≤—ñ–ª—å–Ω–æ: –±–∞–≥–∞—Ç–æ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤
let mut file = File::open("data.txt")?;
let mut byte = [0u8; 1];
while file.read(&mut byte)? > 0 {
    process_byte(byte[0]);
}

// –®–≤–∏–¥–∫–æ: —á–∏—Ç–∞–Ω–Ω—è –±–ª–æ–∫–∞–º–∏
let file = File::open("data.txt")?;
let mut reader = BufReader::new(file);  // –ë—É—Ñ–µ—Ä 8KB –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
let mut byte = [0u8; 1];
while reader.read(&mut byte)? > 0 {
    process_byte(byte[0]);
}
```

BufReader —á–∏—Ç–∞—î –≤–µ–ª–∏–∫—ñ –±–ª–æ–∫–∏ –∑ –¥–∏—Å–∫—É —ñ –≤—ñ–¥–¥–∞—î —ó—Ö –ø–æ —á–∞—Å—Ç–∏–Ω–∞—Ö. –†—ñ–∑–Ω–∏—Ü—è –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –º–æ–∂–µ –±—É—Ç–∏ 100x.

### –í–ª–∞—Å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –±—É—Ñ–µ—Ä–∞

```rust
let file = File::open("huge_file.dat")?;
let reader = BufReader::with_capacity(64 * 1024, file);  // 64KB –±—É—Ñ–µ—Ä
```

---

## –¢–ï–û–†–Ü–Ø: –ó–ê–ü–ò–° –£ –§–ê–ô–õ–ò

### –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–±: fs::write

```rust
use std::fs;

fs::write("output.txt", "Hello, World!")?;

// –ê–±–æ –±—ñ–Ω–∞—Ä–Ω—ñ –¥–∞–Ω—ñ
let data = vec![0u8, 1, 2, 3, 4];
fs::write("output.bin", &data)?;
```

`fs::write` —Å—Ç–≤–æ—Ä—é—î —Ñ–∞–π–ª, —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î, —ñ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î —ñ—Å–Ω—É—é—á–∏–π.

### –ó–∞–ø–∏—Å —á–µ—Ä–µ–∑ File

```rust
use std::fs::File;
use std::io::Write;

let mut file = File::create("output.txt")?;
write!(file, "Hello, {}!\n", "World")?;
writeln!(file, "Line 2")?;
file.write_all(b"Raw bytes")?;
```

–†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –º–µ—Ç–æ–¥–∞–º–∏:
- `write!` / `writeln!` ‚Äî —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π –≤–∏–≤—ñ–¥ (—è–∫ println!)
- `write_all` ‚Äî –∑–∞–ø–∏—Å—É—î –≤—Å—ñ –±–∞–π—Ç–∏ –∞–±–æ –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–º–∏–ª–∫—É
- `write` ‚Äî –º–æ–∂–µ –∑–∞–ø–∏—Å–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω—É (–ø–æ–≤–µ—Ä—Ç–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å–∞–Ω–∏—Ö –±–∞–π—Ç)

### BufWriter –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

```rust
use std::fs::File;
use std::io::{BufWriter, Write};

let file = File::create("output.txt")?;
let mut writer = BufWriter::new(file);

for i in 0..10000 {
    writeln!(writer, "Line {}", i)?;
}

// –í–∞–∂–ª–∏–≤–æ: flush –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó –∑–∞–ø–∏—Å—É
writer.flush()?;
```

–ë–µ–∑ BufWriter –∫–æ–∂–µ–Ω writeln! ‚Äî —Ü–µ —Å–∏—Å—Ç–µ–º–Ω–∏–π –≤–∏–∫–ª–∏–∫. –ó BufWriter –¥–∞–Ω—ñ –Ω–∞–∫–æ–ø–∏—á—É—é—Ç—å—Å—è –≤ –ø–∞–º'—è—Ç—ñ —Ç–∞ –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –±–ª–æ–∫–∞–º–∏.

### –ì–∞—Ä–∞–Ω—Ç—ñ—è –∑–∞–ø–∏—Å—É –Ω–∞ –¥–∏—Å–∫: sync

–ù–∞–≤—ñ—Ç—å –ø—ñ—Å–ª—è `flush()` –¥–∞–Ω—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤ –∫–µ—à—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏. –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö:

```rust
let mut file = File::create("critical.dat")?;
file.write_all(b"important data")?;

// flush() ‚Äî –∑ –±—É—Ñ–µ—Ä–∞ Rust —É –∫–µ—à –û–°
// sync_all() ‚Äî –∑ –∫–µ—à—É –û–° –Ω–∞ —Ñ—ñ–∑–∏—á–Ω–∏–π –¥–∏—Å–∫
file.sync_all()?;
```

`sync_all()` –ø–æ–≤—ñ–ª—å–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ª–∏—à–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

---

## –¢–ï–û–†–Ü–Ø: –î–û–ü–ò–°–£–í–ê–ù–ù–Ø –î–û –§–ê–ô–õ–£ (APPEND)

### –í—ñ–¥–∫—Ä–∏—Ç—Ç—è –¥–ª—è append

```rust
use std::fs::OpenOptions;
use std::io::Write;

let mut file = OpenOptions::new()
    .append(true)
    .create(true)  // –°—Ç–≤–æ—Ä–∏—Ç–∏, —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î
    .open("log.txt")?;

writeln!(file, "New log entry")?;
```

–†–µ–∂–∏–º append –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Å –¥–æ–¥–∞—î—Ç—å—Å—è –≤ –∫—ñ–Ω–µ—Ü—å —Ñ–∞–π–ª—É, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –∫—ñ–ª—å–∫–∞ –ø—Ä–æ—Ü–µ—Å—ñ–≤ –ø–∏—à—É—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ (–Ω–∞ —Ä—ñ–≤–Ω—ñ –û–°).

### –†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ append —Ç–∞ write + seek

```rust
// Append: –∞—Ç–æ–º–∞—Ä–Ω–∏–π –∑–∞–ø–∏—Å —É –∫—ñ–Ω–µ—Ü—å
let mut file = OpenOptions::new().append(true).open("log.txt")?;

// Write + seek: –ù–ï –∞—Ç–æ–º–∞—Ä–Ω–∏–π!
let mut file = OpenOptions::new().write(true).open("log.txt")?;
file.seek(SeekFrom::End(0))?;  // –Ü–Ω—à–∏–π –ø—Ä–æ—Ü–µ—Å –º–æ–∂–µ –∑–∞–ø–∏—Å–∞—Ç–∏ —Ç—É—Ç!
file.write_all(b"data")?;      // –ú–æ–∂–µ–º–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ —á—É–∂—ñ –¥–∞–Ω—ñ
```

---

## –¢–ï–û–†–Ü–Ø: –ü–û–ó–ò–¶–Ü–û–ù–£–í–ê–ù–ù–Ø –£ –§–ê–ô–õ–Ü (SEEK)

### –¢—Ä–µ–π—Ç Seek

```rust
use std::fs::File;
use std::io::{Read, Seek, SeekFrom};

let mut file = File::open("data.bin")?;

// –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ø–æ–∑–∏—Ü—ñ—é 100 –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É
file.seek(SeekFrom::Start(100))?;

// –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ 50 –±–∞–π—Ç –≤–ø–µ—Ä–µ–¥ –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ—ó –ø–æ–∑–∏—Ü—ñ—ó
file.seek(SeekFrom::Current(50))?;

// –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ 10 –±–∞–π—Ç –¥–æ –∫—ñ–Ω—Ü—è
file.seek(SeekFrom::End(-10))?;

// –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –ø–æ–∑–∏—Ü—ñ—é
let position = file.stream_position()?;
```

### –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É —Ñ–∞–π–ª—É

```rust
use std::fs::File;
use std::io::{Seek, SeekFrom};

let mut file = File::open("data.bin")?;
let size = file.seek(SeekFrom::End(0))?;
file.seek(SeekFrom::Start(0))?;  // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞ –ø–æ—á–∞—Ç–æ–∫

println!("File size: {} bytes", size);
```

–ê–±–æ –ø—Ä–æ—Å—Ç—ñ—à–µ —á–µ—Ä–µ–∑ –º–µ—Ç–∞–¥–∞–Ω—ñ:

```rust
use std::fs;

let metadata = fs::metadata("data.bin")?;
println!("File size: {} bytes", metadata.len());
```

---

## –¢–ï–û–†–Ü–Ø: –†–û–ë–û–¢–ê –ó –î–ò–†–ï–ö–¢–û–†–Ü–Ø–ú–ò

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ–π

```rust
use std::fs;

// –°—Ç–≤–æ—Ä–∏—Ç–∏ –æ–¥–Ω—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
fs::create_dir("new_folder")?;

// –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—Å—é —ñ—î—Ä–∞—Ä—Ö—ñ—é
fs::create_dir_all("path/to/nested/folder")?;
```

`create_dir_all` –Ω–µ –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–º–∏–ª–∫—É, —è–∫—â–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –≤–∂–µ —ñ—Å–Ω—É—î.

### –ß–∏—Ç–∞–Ω–Ω—è –≤–º—ñ—Å—Ç—É –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó

```rust
use std::fs;

for entry in fs::read_dir(".")? {
    let entry = entry?;
    let path = entry.path();
    
    if path.is_dir() {
        println!("DIR:  {}", path.display());
    } else {
        println!("FILE: {}", path.display());
    }
}
```

### –†–µ–∫—É—Ä—Å–∏–≤–Ω–∏–π –æ–±—Ö—ñ–¥ (walkdir crate)

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –Ω–µ –º–∞—î —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –æ–±—Ö–æ–¥—É. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `walkdir`:

```rust
use walkdir::WalkDir;

for entry in WalkDir::new("src") {
    let entry = entry?;
    println!("{}", entry.path().display());
}
```

### –í–∏–¥–∞–ª–µ–Ω–Ω—è

```rust
use std::fs;

// –í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª
fs::remove_file("file.txt")?;

// –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—é –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
fs::remove_dir("empty_folder")?;

// –í–∏–¥–∞–ª–∏—Ç–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –∑ –≤–º—ñ—Å—Ç–æ–º (–û–ë–ï–†–ï–ñ–ù–û!)
fs::remove_dir_all("folder_with_contents")?;
```

### –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è

```rust
use std::fs;

// –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ñ–∞–π–ª
fs::copy("source.txt", "dest.txt")?;

// –ü–µ—Ä–µ–º—ñ—Å—Ç–∏—Ç–∏/–ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞—Ç–∏
fs::rename("old_name.txt", "new_name.txt")?;
```

---

## –¢–ï–û–†–Ü–Ø: –ú–ï–¢–ê–î–ê–ù–Ü –§–ê–ô–õ–Ü–í

### –û—Ç—Ä–∏–º–∞–Ω–Ω—è –º–µ—Ç–∞–¥–∞–Ω–∏—Ö

```rust
use std::fs;

let metadata = fs::metadata("file.txt")?;

println!("Size: {} bytes", metadata.len());
println!("Is file: {}", metadata.is_file());
println!("Is dir: {}", metadata.is_dir());
println!("Is symlink: {}", metadata.is_symlink());
println!("Readonly: {}", metadata.permissions().readonly());
```

### –ß–∞—Å –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

```rust
use std::fs;
use std::time::SystemTime;

let metadata = fs::metadata("file.txt")?;

if let Ok(modified) = metadata.modified() {
    let age = SystemTime::now().duration_since(modified)?;
    println!("Modified {} seconds ago", age.as_secs());
}
```

### –ó–º—ñ–Ω–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É (Unix)

```rust
use std::fs;
use std::os::unix::fs::PermissionsExt;

let mut perms = fs::metadata("script.sh")?.permissions();
perms.set_mode(0o755);  // rwxr-xr-x
fs::set_permissions("script.sh", perms)?;
```

---

## –¢–ï–û–†–Ü–Ø: –¢–ò–ú–ß–ê–°–û–í–Ü –§–ê–ô–õ–ò

### –ö—Ä–µ–π—Ç tempfile

```rust
use tempfile::{tempfile, NamedTempFile, tempdir};
use std::io::Write;

// –ê–Ω–æ–Ω—ñ–º–Ω–∏–π —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è)
let mut file = tempfile()?;
write!(file, "temporary data")?;
// –§–∞–π–ª –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –ø—Ä–∏ drop

// –Ü–º–µ–Ω–æ–≤–∞–Ω–∏–π —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª
let mut file = NamedTempFile::new()?;
println!("Temp path: {}", file.path().display());
write!(file, "data")?;
// –§–∞–π–ª –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –ø—Ä–∏ drop

// –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª
let file = NamedTempFile::new()?;
let path = file.into_temp_path();
path.persist("permanent.txt")?;  // –ü–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–∞ –ø–æ—Å—Ç—ñ–π–Ω–∏–π

// –¢–∏–º—á–∞—Å–æ–≤–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
let dir = tempdir()?;
let file_path = dir.path().join("data.txt");
fs::write(&file_path, "content")?;
// –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è —ñ –≤–º—ñ—Å—Ç –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –ø—Ä–∏ drop
```

---

# –ß–ê–°–¢–ò–ù–ê 2: –®–õ–Ø–•–ò –í RUST

---

## –¢–ï–û–†–Ü–Ø: PATH –¢–ê PATHBUF

### –ê–Ω–∞–ª–æ–≥—ñ—è –∑ —Ä—è–¥–∫–∞–º–∏

| –í–æ–ª–æ–¥—ñ—é—á–∏–π | –°–ª–∞–π—Å | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|------------|-------|-------------|
| `String` | `&str` | UTF-8 —Ç–µ–∫—Å—Ç |
| `PathBuf` | `&Path` | –®–ª—è—Ö —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ |
| `OsString` | `&OsStr` | –†—è–¥–æ–∫ –û–° |

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —à–ª—è—Ö—ñ–≤

```rust
use std::path::{Path, PathBuf};

// Path ‚Äî —Å–ª–∞–π—Å, –Ω–µ –≤–æ–ª–æ–¥—ñ—î –¥–∞–Ω–∏–º–∏
let path: &Path = Path::new("/home/user/file.txt");

// PathBuf ‚Äî –≤–æ–ª–æ–¥—ñ—î –¥–∞–Ω–∏–º–∏
let path_buf: PathBuf = PathBuf::from("/home/user/file.txt");

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è
let path: &Path = path_buf.as_path();
let path_buf: PathBuf = path.to_path_buf();
```

### –ü–æ–±—É–¥–æ–≤–∞ —à–ª—è—Ö—ñ–≤

```rust
use std::path::PathBuf;

let mut path = PathBuf::from("/home/user");
path.push("documents");        // /home/user/documents
path.push("report.txt");       // /home/user/documents/report.txt

// –ê–±–æ —á–µ—Ä–µ–∑ join
let path = PathBuf::from("/home/user")
    .join("documents")
    .join("report.txt");

// join –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π PathBuf, –Ω–µ –∑–º—ñ–Ω—é—î –æ—Ä–∏–≥—ñ–Ω–∞–ª
let base = Path::new("/home/user");
let full = base.join("file.txt");  // base –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —à–ª—è—Ö—É

```rust
use std::path::Path;

let path = Path::new("/home/user/documents/report.txt");

// –ë–∞—Ç—å–∫—ñ–≤—Å—å–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
println!("Parent: {:?}", path.parent());  // Some("/home/user/documents")

// –Ü–º'—è —Ñ–∞–π–ª—É
println!("File name: {:?}", path.file_name());  // Some("report.txt")

// –û—Å–Ω–æ–≤–∞ —ñ–º–µ–Ω—ñ (–±–µ–∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è)
println!("Stem: {:?}", path.file_stem());  // Some("report")

// –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è
println!("Extension: {:?}", path.extension());  // Some("txt")

// –Ü—Ç–µ—Ä–∞—Ü—ñ—è –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
for component in path.components() {
    println!("{:?}", component);
}
// RootDir, Normal("home"), Normal("user"), Normal("documents"), Normal("report.txt")
```

### –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —à–ª—è—Ö—É

```rust
use std::path::PathBuf;

let mut path = PathBuf::from("/home/user/report.txt");

// –ó–º—ñ–Ω–∏—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è
path.set_extension("pdf");  // /home/user/report.pdf

// –ó–º—ñ–Ω–∏—Ç–∏ —ñ–º'—è —Ñ–∞–π–ª—É
path.set_file_name("document.docx");  // /home/user/document.docx

// –í–∏–¥–∞–ª–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
path.pop();  // /home/user
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ —à–ª—è—Ö—É

```rust
use std::path::Path;

let path = Path::new("/home/user/file.txt");

// –ß–∏ —ñ—Å–Ω—É—î
if path.exists() {
    println!("File exists");
}

// –¢–∏–ø
if path.is_file() {
    println!("It's a file");
}
if path.is_dir() {
    println!("It's a directory");
}
if path.is_symlink() {
    println!("It's a symbolic link");
}

// –ê–±—Å–æ–ª—é—Ç–Ω–∏–π —á–∏ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π
if path.is_absolute() {
    println!("Absolute path");
}
if path.is_relative() {
    println!("Relative path");
}
```

### –ö–∞–Ω–æ–Ω—ñ–∑–∞—Ü—ñ—è —à–ª—è—Ö—É

```rust
use std::path::Path;

let path = Path::new("./documents/../file.txt");

// –ö–∞–Ω–æ–Ω—ñ—á–Ω–∏–π —à–ª—è—Ö (—Ä–æ–∑–≤'—è–∑—É—î .., symlinks)
let canonical = path.canonicalize()?;
// –ù–∞–ø—Ä–∏–∫–ª–∞–¥: /home/user/file.txt

// –£–í–ê–ì–ê: canonicalize –≤–∏–º–∞–≥–∞—î —ñ—Å–Ω—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—É!
```

---

# –ß–ê–°–¢–ò–ù–ê 3: –ü–Ü–î–°–¢–£–ü–ù–Ü –ó–ê–î–ê–ß–Ü

---

## –¢–ï–û–†–Ü–Ø: –ö–†–û–°–ü–õ–ê–¢–§–û–†–ú–ù–Ü –í–Ü–î–ú–Ü–ù–ù–û–°–¢–Ü

### –†–æ–∑–¥—ñ–ª—é–≤–∞—á—ñ —à–ª—è—Ö—ñ–≤

```rust
// –ù–ï –†–û–ë–Ü–¢–¨ –¢–ê–ö!
let path = "logs/2024/january/data.txt";  // –ù–µ –ø—Ä–∞—Ü—é—î –Ω–∞ Windows

// –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Path
use std::path::PathBuf;
let path = PathBuf::from("logs")
    .join("2024")
    .join("january")
    .join("data.txt");
```

| –°–∏—Å—Ç–µ–º–∞ | –†–æ–∑–¥—ñ–ª—é–≤–∞—á | –ü—Ä–∏–∫–ª–∞–¥ |
|---------|------------|---------|
| Unix/Linux/macOS | `/` | `/home/user/file.txt` |
| Windows | `\` | `C:\Users\user\file.txt` |

Rust –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ä–æ–∑–¥—ñ–ª—é–≤–∞—á —á–µ—Ä–µ–∑ `Path::join()`.

### –ó–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ —Å–∏–º–≤–æ–ª–∏ –≤ —ñ–º–µ–Ω–∞—Ö —Ñ–∞–π–ª—ñ–≤

**Windows –∑–∞–±–æ—Ä–æ–Ω—è—î:**
- `< > : " / \ | ? *`
- –Ü–º–µ–Ω–∞: `CON, PRN, AUX, NUL, COM1-COM9, LPT1-LPT9`
- –ü—Ä–æ–±—ñ–ª –∞–±–æ –∫—Ä–∞–ø–∫–∞ –≤ –∫—ñ–Ω—Ü—ñ —ñ–º–µ–Ω—ñ

**Unix –∑–∞–±–æ—Ä–æ–Ω—è—î:**
- `/` (—Ä–æ–∑–¥—ñ–ª—é–≤–∞—á)
- `\0` (null terminator)

```rust
fn sanitize_filename(name: &str) -> String {
    let forbidden = ['<', '>', ':', '"', '/', '\\', '|', '?', '*'];
    let mut result: String = name
        .chars()
        .map(|c| if forbidden.contains(&c) { '_' } else { c })
        .collect();
    
    // –í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –∫—Ä–∞–ø–∫–∏ –≤ –∫—ñ–Ω—Ü—ñ (Windows)
    while result.ends_with(' ') || result.ends_with('.') {
        result.pop();
    }
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω—ñ —ñ–º–µ–Ω–∞ Windows
    let reserved = ["CON", "PRN", "AUX", "NUL", 
                    "COM1", "COM2", "COM3", "COM4", "COM5", 
                    "COM6", "COM7", "COM8", "COM9",
                    "LPT1", "LPT2", "LPT3", "LPT4", "LPT5", 
                    "LPT6", "LPT7", "LPT8", "LPT9"];
    
    let upper = result.to_uppercase();
    let stem = upper.split('.').next().unwrap_or("");
    if reserved.contains(&stem) {
        result = format!("_{}", result);
    }
    
    result
}
```

### –ß—É—Ç–ª–∏–≤—ñ—Å—Ç—å –¥–æ —Ä–µ–≥—ñ—Å—Ç—Ä—É

**Unix**: —Ä–µ–≥—ñ—Å—Ç—Ä –≤–∞–∂–ª–∏–≤–∏–π. `File.txt` —ñ `file.txt` ‚Äî —Ä—ñ–∑–Ω—ñ —Ñ–∞–π–ª–∏.

**Windows/macOS**: —Ä–µ–≥—ñ—Å—Ç—Ä –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è, –∞–ª–µ —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è –ø—Ä–∏ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ.

```rust
use std::path::Path;

// –ù–∞ Unix
Path::new("File.txt").exists();  // true
Path::new("file.txt").exists();  // false (—ñ–Ω—à–∏–π —Ñ–∞–π–ª!)

// –ù–∞ Windows/macOS
Path::new("File.txt").exists();  // true
Path::new("file.txt").exists();  // true (—Ç–æ–π —Å–∞–º–∏–π —Ñ–∞–π–ª!)
```

–ü–∞—Å—Ç–∫–∞: —Ç–µ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –Ω–∞ macOS —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞, –ø–∞–¥–∞—é—Ç—å –Ω–∞ Linux CI.

### –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –¥–æ–≤–∂–∏–Ω–∞ —à–ª—è—Ö—É

| –°–∏—Å—Ç–µ–º–∞ | –û–±–º–µ–∂–µ–Ω–Ω—è |
|---------|-----------|
| Windows | 260 —Å–∏–º–≤–æ–ª—ñ–≤ (–º–æ–∂–Ω–∞ –∑–±—ñ–ª—å—à–∏—Ç–∏ —á–µ—Ä–µ–∑ `\\?\`) |
| Linux | 4096 —Å–∏–º–≤–æ–ª—ñ–≤ (PATH_MAX) |
| macOS | 1024 —Å–∏–º–≤–æ–ª–∏ |

```rust
// Windows: –¥–æ–≤–≥—ñ —à–ª—è—Ö–∏ —á–µ—Ä–µ–∑ prefix
#[cfg(windows)]
fn long_path(path: &Path) -> PathBuf {
    let mut long = PathBuf::from(r"\\?\");
    long.push(path.canonicalize().unwrap_or_else(|_| path.to_path_buf()));
    long
}
```

---

## –¢–ï–û–†–Ü–Ø: –ö–û–î–£–í–ê–ù–ù–Ø –Ü–ú–ï–ù –§–ê–ô–õ–Ü–í

### –ü—Ä–æ–±–ª–µ–º–∞: —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤ ‚Äî –Ω–µ UTF-8

Rust —Ä—è–¥–∫–∏ (`String`, `&str`) ‚Äî –∑–∞–≤–∂–¥–∏ –≤–∞–ª—ñ–¥–Ω–∏–π UTF-8. –ê–ª–µ —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤ —É —Ä—ñ–∑–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö:

**Linux**: –±—É–¥—å-—è–∫–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –±–∞–π—Ç—ñ–≤, –∫—Ä—ñ–º `/` —ñ `\0`. UTF-8 –Ω–µ –≥–∞—Ä–∞–Ω—Ç—É—î—Ç—å—Å—è.

**macOS**: UTF-8, –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —É —Ñ–æ—Ä–º—ñ NFD.

**Windows**: UTF-16, –¥–µ—è–∫—ñ —Å–∏–º–≤–æ–ª–∏ –Ω–µ–º–æ–∂–ª–∏–≤–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–∏ –≤ UTF-8.

### OsString —Ç–∞ OsStr

Rust –º–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Ç–∏–ø–∏ –¥–ª—è "—Ä—è–¥–∫—ñ–≤ –û–°":

```rust
use std::ffi::{OsString, OsStr};
use std::path::Path;

let path = Path::new("—Ñ–∞–π–ª.txt");

// file_name() –ø–æ–≤–µ—Ä—Ç–∞—î Option<&OsStr>, –Ω–µ Option<&str>!
let name: Option<&OsStr> = path.file_name();

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ &str –º–æ–∂–µ –ø—Ä–æ–≤–∞–ª–∏—Ç–∏—Å—å
if let Some(name) = name {
    match name.to_str() {
        Some(s) => println!("UTF-8 name: {}", s),
        None => println!("Non-UTF-8 name: {:?}", name),
    }
}
```

### Lossy –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è

```rust
use std::path::Path;

let path = Path::new("—Ñ–∞–π–ª.txt");

// to_string_lossy() –∑–∞–≤–∂–¥–∏ —É—Å–ø—ñ—à–Ω–∞, –∞–ª–µ –º–æ–∂–µ –∑–∞–º—ñ–Ω–∏—Ç–∏ —Å–∏–º–≤–æ–ª–∏
let name = path.file_name().unwrap().to_string_lossy();
println!("{}", name);  // –ù–µ–≤–∞–ª—ñ–¥–Ω—ñ UTF-8 –±–∞–π—Ç–∏ —Å—Ç–∞–Ω—É—Ç—å ÔøΩ
```

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –∑ –Ω–µ-UTF-8 —ñ–º–µ–Ω–∞–º–∏

```rust
use std::ffi::OsStr;
use std::os::unix::ffi::OsStrExt;
use std::fs::File;
use std::path::Path;

#[cfg(unix)]
fn create_weird_file() -> std::io::Result<()> {
    // –Ü–º'—è –∑ –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–º UTF-8
    let invalid_utf8 = [0x66, 0x69, 0x6c, 0x65, 0xff, 0x2e, 0x74, 0x78, 0x74];
    let name = OsStr::from_bytes(&invalid_utf8);
    let path = Path::new(name);
    
    File::create(path)?;
    Ok(())
}
```

### –ü–∞—Å—Ç–∫–∞: display() vs to_string_lossy()

```rust
let path = Path::new("/some/path");

// display() ‚Äî –¥–ª—è –ø–æ–∫–∞–∑—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É (–º–æ–∂–µ –º–∞—Ç–∏ placeholder –¥–ª—è –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏—Ö)
println!("Path: {}", path.display());

// to_string_lossy() ‚Äî –æ—Ç—Ä–∏–º–∞—Ç–∏ Cow<str>
let s: std::borrow::Cow<str> = path.to_string_lossy();
```

---

## –¢–ï–û–†–Ü–Ø: –°–ò–ú–í–û–õ–Ü–ß–ù–Ü –ü–û–°–ò–õ–ê–ù–ù–Ø

### –ß–∏—Ç–∞–Ω–Ω—è symlink

```rust
use std::fs;
use std::path::Path;

let link = Path::new("link_to_file");

// –ö—É–¥–∏ –≤–∫–∞–∑—É—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è
let target = fs::read_link(link)?;
println!("Link points to: {}", target.display());

// metadata() —Å–ª—ñ–¥—É—î –∑–∞ symlink
let meta = fs::metadata(link)?;  // –ú–µ—Ç–∞–¥–∞–Ω—ñ —Ü—ñ–ª—å–æ–≤–æ–≥–æ —Ñ–∞–π–ª—É

// symlink_metadata() –Ω–µ —Å–ª—ñ–¥—É—î
let link_meta = fs::symlink_metadata(link)?;  // –ú–µ—Ç–∞–¥–∞–Ω—ñ —Å–∞–º–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
```

### –°—Ç–≤–æ—Ä–µ–Ω–Ω—è symlink

```rust
use std::os::unix::fs::symlink;

#[cfg(unix)]
fn create_link() -> std::io::Result<()> {
    symlink("/path/to/target", "/path/to/link")?;
    Ok(())
}

#[cfg(windows)]
fn create_link() -> std::io::Result<()> {
    use std::os::windows::fs::{symlink_file, symlink_dir};
    symlink_file("target.txt", "link.txt")?;
    // Windows —Ä–æ–∑—Ä—ñ–∑–Ω—è—î symlinks –Ω–∞ —Ñ–∞–π–ª–∏ —Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
    Ok(())
}
```

### –ü–∞—Å—Ç–∫–∞: –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—ñ —Ü–∏–∫–ª–∏

```rust
// –Ø–∫—â–æ a ‚Üí b ‚Üí a (—Ü–∏–∫–ª)
let canonical = Path::new("a").canonicalize();  // –ü–æ–º–∏–ª–∫–∞!
```

–ü—Ä–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º—É –æ–±—Ö–æ–¥—ñ –≤—Ä–∞—Ö–æ–≤—É–π—Ç–µ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Ü–∏–∫–ª—ñ–≤ —á–µ—Ä–µ–∑ symlinks.

---

## –¢–ï–û–†–Ü–Ø: –ê–¢–û–ú–ê–†–ù–Ü–°–¢–¨ –û–ü–ï–†–ê–¶–Ü–ô

### –ü—Ä–æ–±–ª–µ–º–∞: –æ–ø–µ—Ä–∞—Ü—ñ—ó –Ω–µ –∞—Ç–æ–º–∞—Ä–Ω—ñ

```rust
// –ù–µ–±–µ–∑–ø–µ—á–Ω–æ: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è ‚Äî –æ–∫—Ä–µ–º—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
if !path.exists() {
    // –Ü–Ω—à–∏–π –ø—Ä–æ—Ü–µ—Å –º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª —Ç—É—Ç!
    File::create(path)?;
}
```

### –†—ñ—à–µ–Ω–Ω—è: create_new

```rust
use std::fs::OpenOptions;

let file = OpenOptions::new()
    .write(true)
    .create_new(true)  // –ê—Ç–æ–º–∞—Ä–Ω–æ: —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ª–∏—à–µ —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î
    .open(path)?;
```

### –ê—Ç–æ–º–∞—Ä–Ω–∏–π –∑–∞–ø–∏—Å —á–µ—Ä–µ–∑ rename

```rust
use std::fs::{self, File};
use std::io::Write;

fn atomic_write(path: &Path, content: &[u8]) -> std::io::Result<()> {
    // –ó–∞–ø–∏—Å–∞—Ç–∏ —É —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª
    let tmp_path = path.with_extension("tmp");
    let mut file = File::create(&tmp_path)?;
    file.write_all(content)?;
    file.sync_all()?;  // –ì–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å –Ω–∞ –¥–∏—Å–∫
    
    // –ê—Ç–æ–º–∞—Ä–Ω–æ –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞—Ç–∏
    fs::rename(&tmp_path, path)?;
    
    Ok(())
}
```

–ù–∞ –±—ñ–ª—å—à–æ—Å—Ç—ñ —Ñ–∞–π–ª–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º `rename` –∞—Ç–æ–º–∞—Ä–Ω–∏–π, —è–∫—â–æ source —ñ dest –Ω–∞ –æ–¥–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ.

---

## –¢–ï–û–†–Ü–Ø: –ë–£–§–ï–†–ò–ó–ê–¶–Ü–Ø –¢–ê –í–¢–†–ê–¢–ê –î–ê–ù–ò–•

### –ü—Ä–æ–±–ª–µ–º–∞: –¥–∞–Ω—ñ –≤ –±—É—Ñ–µ—Ä—ñ

```rust
use std::fs::File;
use std::io::{BufWriter, Write};

let file = File::create("data.txt")?;
let mut writer = BufWriter::new(file);

write!(writer, "important data")?;
// –î–∞–Ω—ñ –≤ –±—É—Ñ–µ—Ä—ñ BufWriter!

// –Ø–∫—â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ crash —Ç—É—Ç ‚Äî –¥–∞–Ω—ñ –≤—Ç—Ä–∞—á–µ–Ω—ñ!
```

### –†—ñ—à–µ–Ω–Ω—è: —è–≤–Ω–∏–π flush

```rust
let file = File::create("data.txt")?;
let mut writer = BufWriter::new(file);

write!(writer, "important data")?;
writer.flush()?;  // –ü—Ä–∏–º—É—Å–æ–≤–æ –∑–∞–ø–∏—Å–∞—Ç–∏ –±—É—Ñ–µ—Ä
```

### Drop –≤–∏–∫–ª–∏–∫–∞—î flush, –∞–ª–µ —ñ–≥–Ω–æ—Ä—É—î –ø–æ–º–∏–ª–∫–∏

```rust
impl<W: Write> Drop for BufWriter<W> {
    fn drop(&mut self) {
        // flush –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, –∞–ª–µ –ø–æ–º–∏–ª–∫–∞ —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è!
        let _ = self.flush();
    }
}
```

–¢–æ–º—É –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∑–∞–≤–∂–¥–∏ –≤–∏–∫–ª–∏–∫–∞–π—Ç–µ flush() —è–≤–Ω–æ.

### sync_all vs sync_data

```rust
let mut file = File::create("data.txt")?;
file.write_all(b"data")?;

// sync_data: –∑–∞–ø–∏—Å–∞—Ç–∏ –¥–∞–Ω—ñ –Ω–∞ –¥–∏—Å–∫
file.sync_data()?;

// sync_all: –∑–∞–ø–∏—Å–∞—Ç–∏ –¥–∞–Ω—ñ –Ü –º–µ—Ç–∞–¥–∞–Ω—ñ (—Ä–æ–∑–º—ñ—Ä, —á–∞—Å –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó)
file.sync_all()?;
```

`sync_data` —à–≤–∏–¥—à–∏–π, –∞–ª–µ `sync_all` –±–µ–∑–ø–µ—á–Ω—ñ—à–∏–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

---

## –¢–ï–û–†–Ü–Ø: –ü–†–ê–í–ê –î–û–°–¢–£–ü–£

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤

```rust
use std::fs;

let metadata = fs::metadata("file.txt")?;
let permissions = metadata.permissions();

if permissions.readonly() {
    println!("File is read-only");
}
```

### –ó–º—ñ–Ω–∞ –ø—Ä–∞–≤ (Unix)

```rust
use std::fs;
use std::os::unix::fs::PermissionsExt;

// –ó—Ä–æ–±–∏—Ç–∏ –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º
let mut perms = fs::metadata("script.sh")?.permissions();
perms.set_mode(0o755);
fs::set_permissions("script.sh", perms)?;

// –ó—Ä–æ–±–∏—Ç–∏ read-only
let mut perms = fs::metadata("data.txt")?.permissions();
perms.set_readonly(true);
fs::set_permissions("data.txt", perms)?;
```

### –ü–∞—Å—Ç–∫–∞: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤ ‚â† –≥–∞—Ä–∞–Ω—Ç—ñ—è —É—Å–ø—ñ—Ö—É

```rust
// –ü–æ–≥–∞–Ω–æ: TOCTOU (Time Of Check To Time Of Use)
if metadata.permissions().readonly() == false {
    // –ü—Ä–∞–≤–∞ –º–æ–∂—É—Ç—å –∑–º—ñ–Ω–∏—Ç–∏—Å—å —Ç—É—Ç!
    file.write_all(b"data")?;
}

// –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ–±—É–π—Ç–µ —ñ –æ–±—Ä–æ–±—ñ—Ç—å –ø–æ–º–∏–ª–∫—É
match file.write_all(b"data") {
    Ok(_) => println!("Written"),
    Err(e) if e.kind() == io::ErrorKind::PermissionDenied => {
        println!("No permission");
    }
    Err(e) => return Err(e),
}
```

---

## –¢–ï–û–†–Ü–Ø: –í–ï–õ–ò–ö–Ü –§–ê–ô–õ–ò

### –ü—Ä–æ–±–ª–µ–º–∞: —á–∏—Ç–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ —Ñ–∞–π–ª—É

```rust
// –ù–µ–±–µ–∑–ø–µ—á–Ω–æ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤!
let content = fs::read_to_string("huge_file.txt")?;  // 10GB —É –ø–∞–º'—è—Ç—ñ!
```

### –†—ñ—à–µ–Ω–Ω—è: –ø–æ—Ç–æ–∫–æ–≤–∞ –æ–±—Ä–æ–±–∫–∞

```rust
use std::fs::File;
use std::io::{BufRead, BufReader};

let file = File::open("huge_file.txt")?;
let reader = BufReader::new(file);

for line in reader.lines() {
    let line = line?;
    process_line(&line);  // –ü–æ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É –≤ –ø–∞–º'—è—Ç—ñ
}
```

### Memory-mapped files

–î–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤ –∑ –≤–∏–ø–∞–¥–∫–æ–≤–∏–º –¥–æ—Å—Ç—É–ø–æ–º:

```rust
use memmap2::Mmap;
use std::fs::File;

let file = File::open("huge_file.bin")?;
let mmap = unsafe { Mmap::map(&file)? };

// –î–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö —è–∫ –¥–æ —Å–ª–∞–π—Å—É
let byte = mmap[1000000];  // –û–° –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å –ø–æ—Ç—Ä—ñ–±–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É
```

---

## –ü–†–ê–ö–¢–ò–ß–ù–Ü –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–á

### –ü—Ä–∞–≤–∏–ª–æ 1: –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Path –¥–ª—è —à–ª—è—Ö—ñ–≤

```rust
// –ü–æ–≥–∞–Ω–æ
let path = "logs/" + &date + "/data.txt";

// –î–æ–±—Ä–µ
let path = PathBuf::from("logs").join(&date).join("data.txt");
```

### –ü—Ä–∞–≤–∏–ª–æ 2: –û–±—Ä–æ–±–ª—è–π—Ç–µ OsStr –ø—Ä–∞–≤–∏–ª—å–Ω–æ

```rust
// –ü–æ–≥–∞–Ω–æ: –º–æ–∂–µ –ø–∞–Ω—ñ–∫—É–≤–∞—Ç–∏
let name = path.file_name().unwrap().to_str().unwrap();

// –î–æ–±—Ä–µ: –æ–±—Ä–æ–±–ª—è—î–º–æ –Ω–µ-UTF-8
let name = path.file_name()
    .map(|n| n.to_string_lossy())
    .unwrap_or_default();
```

### –ü—Ä–∞–≤–∏–ª–æ 3: flush() –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö

```rust
let mut writer = BufWriter::new(file);
// ... –∑–∞–ø–∏—Å ...
writer.flush()?;  // –û–±–æ–≤'—è–∑–∫–æ–≤–æ!
```

### –ü—Ä–∞–≤–∏–ª–æ 4: –ê—Ç–æ–º–∞—Ä–Ω–∏–π –∑–∞–ø–∏—Å —á–µ—Ä–µ–∑ rename

```rust
fn safe_write(path: &Path, content: &[u8]) -> io::Result<()> {
    let tmp = path.with_extension("tmp");
    fs::write(&tmp, content)?;
    fs::rename(&tmp, path)?;
    Ok(())
}
```

### –ü—Ä–∞–≤–∏–ª–æ 5: –°–∞–Ω—ñ—Ç–∏–∑—É–π—Ç–µ —ñ–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

```rust
let user_filename = get_user_input();
let safe_filename = sanitize_filename(&user_filename);
let path = base_dir.join(safe_filename);
```

### –ü—Ä–∞–≤–∏–ª–æ 6: –ü–æ—Ç–æ–∫–æ–≤–∞ –æ–±—Ä–æ–±–∫–∞ –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤

```rust
// –ü–æ–≥–∞–Ω–æ
let data = fs::read("huge.bin")?;

// –î–æ–±—Ä–µ
let file = File::open("huge.bin")?;
let reader = BufReader::new(file);
```

---

## –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –¥–æ —Ä–æ—é –ë–ü–õ–ê

### –ë–µ–∑–ø–µ—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó

```rust
use std::fs::{File, OpenOptions};
use std::io::{BufWriter, Write};
use std::path::{Path, PathBuf};

pub struct FlightLogger {
    writer: BufWriter<File>,
    path: PathBuf,
    entries_since_flush: usize,
}

impl FlightLogger {
    pub fn new(mission_id: &str, drone_id: u32) -> std::io::Result<Self> {
        // –°–∞–Ω—ñ—Ç–∏–∑—É—î–º–æ mission_id (–º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ timestamp –∑ ":")
        let safe_mission = sanitize_filename(mission_id);
        
        let dir = PathBuf::from("logs")
            .join(&safe_mission)
            .join(format!("drone_{}", drone_id));
        
        std::fs::create_dir_all(&dir)?;
        
        let path = dir.join("telemetry.csv");
        
        let file = OpenOptions::new()
            .create(true)
            .append(true)
            .open(&path)?;
        
        let mut writer = BufWriter::new(file);
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ CSV, —è–∫—â–æ —Ñ–∞–π–ª –ø–æ—Ä–æ–∂–Ω—ñ–π
        if path.metadata()?.len() == 0 {
            writeln!(writer, "timestamp,lat,lon,alt,battery,status")?;
        }
        
        Ok(Self {
            writer,
            path,
            entries_since_flush: 0,
        })
    }
    
    pub fn log(&mut self, telemetry: &Telemetry) -> std::io::Result<()> {
        writeln!(
            self.writer,
            "{},{},{},{},{},{}",
            telemetry.timestamp,
            telemetry.position.latitude,
            telemetry.position.longitude,
            telemetry.position.altitude,
            telemetry.battery_percent,
            telemetry.status,
        )?;
        
        self.entries_since_flush += 1;
        
        // Flush –∫–æ–∂–Ω—ñ 10 –∑–∞–ø–∏—Å—ñ–≤ –¥–ª—è –±–∞–ª–∞–Ω—Å—É –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
        if self.entries_since_flush >= 10 {
            self.writer.flush()?;
            self.entries_since_flush = 0;
        }
        
        Ok(())
    }
    
    pub fn close(mut self) -> std::io::Result<()> {
        self.writer.flush()?;
        // sync –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó –∑–∞–ø–∏—Å—É
        self.writer.get_ref().sync_all()?;
        Ok(())
    }
}

fn sanitize_filename(name: &str) -> String {
    name.chars()
        .map(|c| match c {
            '<' | '>' | ':' | '"' | '/' | '\\' | '|' | '?' | '*' => '_',
            c if c.is_control() => '_',
            c => c,
        })
        .collect()
}
```

### –ê—Ç–æ–º–∞—Ä–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –º—ñ—Å—ñ—ó

```rust
use std::fs;
use std::path::Path;

pub fn save_mission_config(path: &Path, config: &MissionConfig) -> std::io::Result<()> {
    let json = serde_json::to_string_pretty(config)
        .map_err(|e| std::io::Error::new(std::io::ErrorKind::InvalidData, e))?;
    
    // –ê—Ç–æ–º–∞—Ä–Ω–∏–π –∑–∞–ø–∏—Å
    let tmp_path = path.with_extension("tmp");
    fs::write(&tmp_path, &json)?;
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ –º–æ–∂–µ–º–æ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –Ω–∞–∑–∞–¥
    let verification: MissionConfig = serde_json::from_str(
        &fs::read_to_string(&tmp_path)?
    ).map_err(|e| std::io::Error::new(std::io::ErrorKind::InvalidData, e))?;
    
    if verification != *config {
        fs::remove_file(&tmp_path)?;
        return Err(std::io::Error::new(
            std::io::ErrorKind::InvalidData,
            "Verification failed"
        ));
    }
    
    fs::rename(&tmp_path, path)?;
    
    // sync –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó rename –Ω–∞ –¥–µ—è–∫–∏—Ö FS
    #[cfg(unix)]
    if let Some(parent) = path.parent() {
        if let Ok(dir) = fs::File::open(parent) {
            let _ = dir.sync_all();
        }
    }
    
    Ok(())
}
```

### –ö—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏

```rust
use std::path::{Path, PathBuf};

pub struct MapLoader {
    cache_dir: PathBuf,
}

impl MapLoader {
    pub fn new() -> std::io::Result<Self> {
        // –ö—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω–∏–π —à–ª—è—Ö –¥–æ –∫–µ—à—É
        let cache_dir = if cfg!(windows) {
            PathBuf::from(std::env::var("LOCALAPPDATA").unwrap_or_else(|_| ".".into()))
                .join("DroneSwarm")
                .join("MapCache")
        } else if cfg!(target_os = "macos") {
            PathBuf::from(std::env::var("HOME").unwrap_or_else(|_| ".".into()))
                .join("Library")
                .join("Caches")
                .join("DroneSwarm")
        } else {
            // Linux —Ç–∞ —ñ–Ω—à—ñ
            PathBuf::from(std::env::var("XDG_CACHE_HOME")
                .unwrap_or_else(|_| {
                    std::env::var("HOME")
                        .map(|h| format!("{}/.cache", h))
                        .unwrap_or_else(|_| ".cache".into())
                }))
                .join("droneswarm")
        };
        
        std::fs::create_dir_all(&cache_dir)?;
        
        Ok(Self { cache_dir })
    }
    
    pub fn get_tile(&self, x: u32, y: u32, zoom: u8) -> std::io::Result<Vec<u8>> {
        let tile_path = self.cache_dir
            .join(format!("{}", zoom))
            .join(format!("{}", x))
            .join(format!("{}.png", y));
        
        if tile_path.exists() {
            std::fs::read(&tile_path)
        } else {
            // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ –º–µ—Ä–µ–∂—ñ —Ç–∞ –∑–±–µ—Ä–µ–≥—Ç–∏
            let data = download_tile(x, y, zoom)?;
            
            if let Some(parent) = tile_path.parent() {
                std::fs::create_dir_all(parent)?;
            }
            
            std::fs::write(&tile_path, &data)?;
            Ok(data)
        }
    }
}
```

---

## –†–µ–∑—é–º–µ

–£ —Ü—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –º–∏ —Ä–æ–∑–≥–ª—è–Ω—É–ª–∏ —Ä–æ–±–æ—Ç—É –∑ —Ñ–∞–π–ª–∞–º–∏ —Ç–∞ —à–ª—è—Ö–∞–º–∏.

**–û—Å–Ω–æ–≤–∏**:
- `File::open` –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è, `File::create` –¥–ª—è –∑–∞–ø–∏—Å—É
- `OpenOptions` –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é —Ä–µ–∂–∏–º—ñ–≤
- `BufReader`/`BufWriter` –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ I/O
- `Path` (—Å–ª–∞–π—Å) —Ç–∞ `PathBuf` (–≤–æ–ª–æ–¥—ñ—é—á–∏–π) –¥–ª—è —à–ª—è—Ö—ñ–≤
- RAII –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–∫—Ä–∏–≤–∞—î —Ñ–∞–π–ª–∏

**–ö—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω—ñ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ**:
- –†–æ–∑–¥—ñ–ª—é–≤–∞—á—ñ: `/` –Ω–∞ Unix, `\` –Ω–∞ Windows
- –ó–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ —Å–∏–º–≤–æ–ª–∏: `< > : " / \ | ? *` –Ω–∞ Windows
- –†–µ–≥—ñ—Å—Ç—Ä: –≤–∞–∂–ª–∏–≤–∏–π –Ω–∞ Linux, —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è –Ω–∞ Windows/macOS
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –¥–æ–≤–∂–∏–Ω–∞ —à–ª—è—Ö—É —Ä—ñ–∑–Ω–∞

**–ö–æ–¥—É–≤–∞–Ω–Ω—è**:
- –Ü–º–µ–Ω–∞ —Ñ–∞–π–ª—ñ–≤ ‚Äî –Ω–µ –∑–∞–≤–∂–¥–∏ UTF-8
- `OsString`/`OsStr` –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó —Ä–æ–±–æ—Ç–∏
- `to_string_lossy()` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó –∑ –º–æ–∂–ª–∏–≤–æ—é –≤—Ç—Ä–∞—Ç–æ—é

**–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**:
- `flush()` –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö
- `sync_all()` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó –∑–∞–ø–∏—Å—É –Ω–∞ –¥–∏—Å–∫
- –ê—Ç–æ–º–∞—Ä–Ω–∏–π –∑–∞–ø–∏—Å —á–µ—Ä–µ–∑ —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª + rename
- `create_new` –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è

**–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**:
- `BufReader`/`BufWriter` –¥–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤
- –ü–æ—Ç–æ–∫–æ–≤–∞ –æ–±—Ä–æ–±–∫–∞ –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤
- Memory-mapped files –¥–ª—è –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø—É

---

## üîó –ó–≤'—è–∑–æ–∫ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º –º–∞—Ç–µ—Ä—ñ–∞–ª–æ–º

–í–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Å–µ—Ä—ñ—é —Ä–æ–∑–¥—ñ–ª—ñ–≤ –ø—Ä–æ –ø—ñ–¥—Å—Ç—É–ø–Ω—ñ –∑–∞–¥–∞—á—ñ –≤ Rust! –¶—ñ –∑–Ω–∞–Ω–Ω—è —Ñ–æ—Ä–º—É—é—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω–æ–≥–æ, –∫—Ä–æ—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è, —â–æ –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∞—Ü—é—î –∑ —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏, —Ä–µ—Å—É—Ä—Å–∞–º–∏ —Ç–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞–º–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.
