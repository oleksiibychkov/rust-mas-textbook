# –†–æ–∑–¥—ñ–ª 45: –ú–∞–∫—Ä–æ—Å–∏ ‚Äî –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ñ (macro_rules!)

---

## üìã –ê–Ω–æ—Ç–∞—Ü—ñ—è

–î–æ —Ü—å–æ–≥–æ –º–æ–º–µ–Ω—Ç—É –≤–∏ –ø–∏—Å–∞–ª–∏ **–∫–æ–¥, —â–æ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è**. –¢–µ–ø–µ—Ä –º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —á–æ–≥–æ—Å—å –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ —ñ–Ω—à–æ–≥–æ ‚Äî **–∫–æ–¥, —â–æ –ø–∏—à–µ –∫–æ–¥**. –¶–µ –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è: –≤–∏ –≤–∏–∑–Ω–∞—á–∞—î—Ç–µ —à–∞–±–ª–æ–Ω–∏, —ñ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä —Ä–æ–∑–≥–æ—Ä—Ç–∞—î —ó—Ö —É –∑–≤–∏—á–∞–π–Ω–∏–π Rust-–∫–æ–¥ **—â–µ –¥–æ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó**.

–ß–æ–º—É —Ü–µ –≤–∞–∂–ª–∏–≤–æ? –ü–æ–¥—É–º–∞–π—Ç–µ –ø—Ä–æ `println!` ‚Äî –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ –π–æ–≥–æ –∑ –ø–µ—Ä—à–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É. –¶–µ –Ω–µ —Ñ—É–Ω–∫—Ü—ñ—è, –∞ –º–∞–∫—Ä–æ—Å. –§—É–Ω–∫—Ü—ñ—è –Ω–µ –º–æ–≥–ª–∞ –± –ø—Ä–∏–π–º–∞—Ç–∏ –∑–º—ñ–Ω–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ —Ç–∞ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –∫–æ–¥ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤–∏–ø–∞–¥–∫—É. –ê–±–æ `vec![1, 2, 3]` ‚Äî –µ–ª–µ–≥–∞–Ω—Ç–Ω–∏–π —Å–ø–æ—Å—ñ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤–µ–∫—Ç–æ—Ä, –Ω–µ–º–æ–∂–ª–∏–≤–∏–π –±–µ–∑ –º–∞–∫—Ä–æ—Å—ñ–≤.

–£ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –º–∞–∫—Ä–æ—Å–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å –∑–∞—Ö–æ–ø–ª—é—é—á—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:
- **DSL –¥–ª—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –∞–≥–µ–Ω—Ç—ñ–≤**: –û–ø–∏—Å—É–≤–∞—Ç–∏ –ª–æ–≥—ñ–∫—É –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ, –∞ –Ω–µ —ñ–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ
- **–ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è boilerplate**: –û–¥–∏–Ω –º–∞–∫—Ä–æ—Å –∑–∞–º—ñ—Å—Ç—å –¥–µ—Å—è—Ç–∫—ñ–≤ –æ–¥–Ω–æ—Ç–∏–ø–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
- **–ú–∞—à–∏–Ω–∏ —Å—Ç–∞–Ω—ñ–≤**: –ö–æ–º–ø–∞–∫—Ç–Ω–∏–π –æ–ø–∏—Å –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤ –º—ñ–∂ —Å—Ç–∞–Ω–∞–º–∏ –∞–≥–µ–Ω—Ç–∞
- **–õ–æ–≥—É–≤–∞–Ω–Ω—è –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è ID –∞–≥–µ–Ω—Ç–∞, —á–∞—Å–æ–≤–∏—Ö –º—ñ—Ç–æ–∫

–¶–µ–π —Ä–æ–∑–¥—ñ–ª –ø—Ä–∏—Å–≤—è—á–µ–Ω–∏–π **–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏–º –º–∞–∫—Ä–æ—Å–∞–º** (`macro_rules!`) ‚Äî –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–æ–º—É —Ç–∞ –Ω–∞–π–¥–æ—Å—Ç—É–ø–Ω—ñ—à–æ–º—É —Ç–∏–ø—É –º–∞–∫—Ä–æ—Å—ñ–≤ —É Rust. –í–æ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤—ñ **–ø–∞—Ç—Ç–µ—Ä–Ω-–º–∞—Ç—á–∏–Ω–≥—É**: –≤–∏ –æ–ø–∏—Å—É—î—Ç–µ —à–∞–±–ª–æ–Ω –≤—Ö—ñ–¥–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤, –∞ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –∑–∞–º—ñ–Ω—é—î —ó—Ö –Ω–∞ –≤–∫–∞–∑–∞–Ω–∏–π –∫–æ–¥.

---

## üéØ –¶—ñ–ª—ñ –Ω–∞–≤—á–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É –≤–∏ –∑–º–æ–∂–µ—Ç–µ:

1. **–†–æ–∑—É–º—ñ—Ç–∏** —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É —Ä—ñ–∑–Ω–∏—Ü—é –º—ñ–∂ –º–∞–∫—Ä–æ—Å–∞–º–∏ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏
2. **–ß–∏—Ç–∞—Ç–∏** —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏—Ö –º–∞–∫—Ä–æ—Å—ñ–≤ —Ç–∞ —Ä–æ–∑—É–º—ñ—Ç–∏ —ó—Ö —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
3. **–ü–∏—Å–∞—Ç–∏** –≤–ª–∞—Å–Ω—ñ –º–∞–∫—Ä–æ—Å–∏ –∑ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ —Ç–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è–º–∏
4. **–ó–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏** —Ç–∏–ø–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤ (expr, ident, ty, tt —Ç–æ—â–æ)
5. **–°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏** –ø—Ä–æ—Å—Ç—ñ DSL –¥–ª—è –æ–ø–∏—Å—É –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –∞–≥–µ–Ω—Ç—ñ–≤
6. **–ù–∞–ª–∞–≥–æ–¥–∂—É–≤–∞—Ç–∏** –º–∞–∫—Ä–æ—Å–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é cargo expand

---

## üìö –ö–ª—é—á–æ–≤—ñ —Ç–µ—Ä–º—ñ–Ω–∏

| –¢–µ—Ä–º—ñ–Ω | –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|--------|------------|
| **–ú–∞–∫—Ä–æ—Å** | –ö–æ–¥, —â–æ –≥–µ–Ω–µ—Ä—É—î —ñ–Ω—à–∏–π –∫–æ–¥ –ø—ñ–¥ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó; –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–∞ |
| **macro_rules!** | –°–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏—Ö –º–∞–∫—Ä–æ—Å—ñ–≤ —É Rust |
| **–ü–∞—Ç—Ç–µ—Ä–Ω** | –®–∞–±–ª–æ–Ω, —â–æ –æ–ø–∏—Å—É—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Ö—ñ–¥–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ –º–∞–∫—Ä–æ—Å–∞ |
| **–†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è (Expansion)** | –ü—Ä–æ—Ü–µ—Å –∑–∞–º—ñ–Ω–∏ –≤–∏–∫–ª–∏–∫—É –º–∞–∫—Ä–æ—Å–∞ –Ω–∞ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–¥ |
| **–¢–æ–∫–µ–Ω** | –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∞ –æ–¥–∏–Ω–∏—Ü—è (—ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä, —á–∏—Å–ª–æ, –æ–ø–µ—Ä–∞—Ç–æ—Ä) |
| **–§—Ä–∞–≥–º–µ–Ω—Ç (Fragment)** | –¢–∏–ø —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–æ—ó –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó, —â–æ –∑–∞—Ö–æ–ø–ª—é—î—Ç—å—Å—è ($x:expr, $y:ident) |
| **–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è (Repetition)** | –ú–µ—Ö–∞–Ω—ñ–∑–º –æ–±—Ä–æ–±–∫–∏ –∑–º—ñ–Ω–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ ($(...)*) |
| **–ì—ñ–≥—ñ—î–Ω–∞** | –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ —ñ–º–µ–Ω –º—ñ–∂ –∫–æ–¥–æ–º –º–∞–∫—Ä–æ—Å–∞ —Ç–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –≤–∏–∫–ª–∏–∫—É |
| **DSL** | Domain-Specific Language ‚Äî –º–æ–≤–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ |

---

## üí° –ú–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏–π –∫–µ–π—Å: –ß–æ–º—É —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ?

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –∑–Ω–∞–π–æ–º–∏–π –∫–æ–¥:

```rust
let numbers = vec![1, 2, 3, 4, 5];
println!("Sum: {}, Count: {}", numbers.iter().sum::<i32>(), numbers.len());
```

–°–ø—Ä–æ–±—É–π–º–æ —É—è–≤–∏—Ç–∏ `vec!` —Ç–∞ `println!` —è–∫ —Ñ—É–Ω–∫—Ü—ñ—ó:

```rust
// –Ø–∫ –±–∏ –≤–∏–≥–ª—è–¥–∞–ª–∞ —Ñ—É–Ω–∫—Ü—ñ—è vec?
fn vec<T>(???) -> Vec<T> {
    // –Ø–∫ –ø—Ä–∏–π–Ω—è—Ç–∏ –∑–º—ñ–Ω–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤?
    // Rust —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å varargs!
}

// –Ø–∫ –±–∏ –≤–∏–≥–ª—è–¥–∞–ª–∞ —Ñ—É–Ω–∫—Ü—ñ—è println?
fn println(format: &str, ???) {
    // –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∫—ñ–ª—å–∫–æ—Å—Ç—ñ {} —Ç–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤?
    // –ü—ñ–¥ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó, –∞ –Ω–µ runtime!
}
```

**–ù–µ–º–æ–∂–ª–∏–≤–æ.** –§—É–Ω–∫—Ü—ñ—ó —É Rust:
- –ú–∞—é—Ç—å —Ñ—ñ–∫—Å–æ–≤–∞–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
- –ù–µ –º–æ–∂—É—Ç—å –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ä—ñ–∑–Ω–∏–π –∫–æ–¥ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤
- –ù–µ –º–æ–∂—É—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –¥–æ–≤—ñ–ª—å–Ω–∏–º–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏–º–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è–º–∏

–ú–∞–∫—Ä–æ—Å–∏ –≤–∏—Ä—ñ—à—É—é—Ç—å —Ü—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è, –±–æ –ø—Ä–∞—Ü—é—é—Ç—å **–¥–æ** —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó.

---

## 45.1 –ú–ê–ö–†–û–°–ò VS –§–£–ù–ö–¶–Ü–á: –§–£–ù–î–ê–ú–ï–ù–¢–ê–õ–¨–ù–ê –†–Ü–ó–ù–ò–¶–Ø

### 45.1.1 –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è: compile-time vs runtime

–ù–∞–π–≥–æ–ª–æ–≤–Ω—ñ—à–∞ —Ä—ñ–∑–Ω–∏—Ü—è ‚Äî **–∫–æ–ª–∏** –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è "–≤–∏–∫–æ–Ω–∞–Ω–Ω—è":

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –§–£–ù–ö–¶–Ü–Ø                                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  –í–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥          –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è           –í–∏–∫–æ–Ω–∞–Ω–Ω—è               ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ          ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ           ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ               ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  fn add(a, b)    ‚îÄ‚îÄ‚îÄ‚ñ∫  –ú–∞—à–∏–Ω–Ω–∏–π     ‚îÄ‚îÄ‚îÄ‚ñ∫   add(2, 3)               ‚îÇ
‚îÇ     { a + b }          –∫–æ–¥ add              ‚îÇ                       ‚îÇ
‚îÇ                                             ‚ñº                       ‚îÇ
‚îÇ                                          –û–±—á–∏—Å–ª–µ–Ω–Ω—è:               ‚îÇ
‚îÇ                                          2 + 3 = 5                 ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  –ö–æ–¥ —Ñ—É–Ω–∫—Ü—ñ—ó –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑,                                ‚îÇ
‚îÇ  –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å —Ä–æ–±–æ—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–∏                               ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ú–ê–ö–†–û–°                                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  –í–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥       –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è         –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è      –í–∏–∫–æ–Ω–∞–Ω–Ω—è   ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ       ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ      ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  vec![1,2,3]  ‚îÄ‚îÄ‚îÄ‚ñ∫  {                 ‚îÄ‚îÄ‚îÄ‚ñ∫  –ú–∞—à–∏–Ω–Ω–∏–π  ‚îÄ‚îÄ‚îÄ‚ñ∫  ...    ‚îÇ
‚îÇ                      let mut v =            –∫–æ–¥                     ‚îÇ
‚îÇ                        Vec::new();                                  ‚îÇ
‚îÇ                      v.push(1);                                     ‚îÇ
‚îÇ                      v.push(2);                                     ‚îÇ
‚îÇ                      v.push(3);                                     ‚îÇ
‚îÇ                      v                                              ‚îÇ
‚îÇ                     }                                               ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  –ú–∞–∫—Ä–æ—Å —Ä–æ–∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è –î–û –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó,                               ‚îÇ
‚îÇ  —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π –∫–æ–¥                           ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 45.1.2 –©–æ –º–æ–∂—É—Ç—å –º–∞–∫—Ä–æ—Å–∏, —á–æ–≥–æ –Ω–µ –º–æ–∂—É—Ç—å —Ñ—É–Ω–∫—Ü—ñ—ó

| –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å | –§—É–Ω–∫—Ü—ñ—è | –ú–∞–∫—Ä–æ—Å |
|------------|---------|--------|
| –ó–º—ñ–Ω–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ | ‚ùå | ‚úÖ `vec![1, 2, 3, 4, 5]` |
| –ê—Ä–≥—É–º–µ–Ω—Ç–∏ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ (–±–µ–∑ generics) | ‚ùå | ‚úÖ `println!("{} {}", 42, "hi")` |
| –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ | ‚ùå | ‚úÖ `concat_idents!(foo, bar)` |
| –£–º–æ–≤–Ω–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—è –∫–æ–¥—É | ‚ùå | ‚úÖ `cfg!(debug_assertions)` |
| –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π | ‚ùå | ‚úÖ DSL |
| –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó | ‚ùå | ‚úÖ `assert!` —Å—Ç–∞—Ç–∏—á–Ω–æ |
| –¢–∏–ø—ñ–∑–æ–≤–∞–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ | ‚úÖ | ‚ùå (—Ç—ñ–ª—å–∫–∏ —Ç–æ–∫–µ–Ω–∏) |
| –†–µ–∫—É—Ä—Å—ñ—è –±–µ–∑ –æ–±–º–µ–∂–µ–Ω—å | ‚úÖ | ‚ö†Ô∏è (–ª—ñ–º—ñ—Ç —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è) |

### 45.1.3 –ó–Ω–∞–∫ –æ–∫–ª–∏–∫—É ‚Äî –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –º–∞—Ä–∫–µ—Ä

–£ Rust –ø—Ä–∏–π–Ω—è—Ç–æ –ø–æ–∑–Ω–∞—á–∞—Ç–∏ –≤–∏–∫–ª–∏–∫–∏ –º–∞–∫—Ä–æ—Å—ñ–≤ –∑–Ω–∞–∫–æ–º –æ–∫–ª–∏–∫—É:

```rust
println!("Hello");   // –ú–∞–∫—Ä–æ—Å
vec![1, 2, 3];       // –ú–∞–∫—Ä–æ—Å
assert_eq!(a, b);    // –ú–∞–∫—Ä–æ—Å

print("Hello");      // –§—É–Ω–∫—Ü—ñ—è (—è–∫–±–∏ —ñ—Å–Ω—É–≤–∞–ª–∞)
Vec::new();          // –§—É–Ω–∫—Ü—ñ—è (–∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω–∞)
```

–¶–µ **–∫–æ–Ω–≤–µ–Ω—Ü—ñ—è —Ç–∞ –≤–∏–º–æ–≥–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É** ‚Äî –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –∑–Ω–∞—î, —â–æ `name!` ‚Äî —Ü–µ –≤–∏–∫–ª–∏–∫ –º–∞–∫—Ä–æ—Å–∞ —ñ –ø–æ—Ç—Ä–µ–±—É—î –æ—Å–æ–±–ª–∏–≤–æ—ó –æ–±—Ä–æ–±–∫–∏.

---

## 45.2 –°–ò–ù–¢–ê–ö–°–ò–° macro_rules!

### 45.2.1 –ë–∞–∑–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏–π –º–∞–∫—Ä–æ—Å –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `macro_rules!`:

```rust
macro_rules! —ñ–º'—è_–º–∞–∫—Ä–æ—Å–∞ {
    // –ü—Ä–∞–≤–∏–ª–æ 1
    (–ø–∞—Ç—Ç–µ—Ä–Ω1) => {
        —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è1
    };
    
    // –ü—Ä–∞–≤–∏–ª–æ 2
    (–ø–∞—Ç—Ç–µ—Ä–Ω2) => {
        —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è2
    };
    
    // ... –±—ñ–ª—å—à–µ –ø—Ä–∞–≤–∏–ª
}
```

**–ü–∞—Ç—Ç–µ—Ä–Ω** –æ–ø–∏—Å—É—î, —è–∫ –≤–∏–≥–ª—è–¥–∞—î –≤–∏–∫–ª–∏–∫ –º–∞–∫—Ä–æ—Å–∞.
**–†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è** ‚Äî —â–æ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –∑–∞–º—ñ—Å—Ç—å –≤–∏–∫–ª–∏–∫—É.

### 45.2.2 –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π –º–∞–∫—Ä–æ—Å

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å, —â–æ –ø—Ä–æ—Å—Ç–æ –≤–∏–≤–æ–¥–∏—Ç—å –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –±–µ–∑ –∂–æ–¥–Ω–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤.

```rust
macro_rules! say_hello {
    // –ü–æ—Ä–æ–∂–Ω—ñ–π –ø–∞—Ç—Ç–µ—Ä–Ω ‚Äî –º–∞–∫—Ä–æ—Å –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤
    () => {
        println!("Hello, macro world!");
    };
}

fn main() {
    say_hello!();  // –í–∏–∫–ª–∏–∫ –º–∞–∫—Ä–æ—Å–∞
}
```

**–†–æ–∑–≥–ª—è–Ω–µ–º–æ, —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**

1. `say_hello!()` ‚Äî –≤–∏–∫–ª–∏–∫ –º–∞–∫—Ä–æ—Å–∞ –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º —Å–ø–∏—Å–∫–æ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤
2. –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –∑–Ω–∞—Ö–æ–¥–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ `() => { ... }`
3. –ü–∞—Ç—Ç–µ—Ä–Ω `()` –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏–∫–ª–∏–∫—É `()`
4. –í–∏–∫–ª–∏–∫ –∑–∞–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `println!("Hello, macro world!");`
5. –î–∞–ª—ñ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π –∫–æ–¥

### 45.2.3 –ú–∞–∫—Ä–æ—Å –∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å, —â–æ –ø—Ä–∏–π–º–∞—î –≤–∏—Ä–∞–∑ —ñ –≤–∏–≤–æ–¥–∏—Ç—å –π–æ–≥–æ –∑ –æ–ø–∏—Å–æ–º.

```rust
macro_rules! show_value {
    // $name ‚Äî –∑–∞—Ö–æ–ø–ª–µ–Ω–∞ –∑–º—ñ–Ω–Ω–∞
    // :expr ‚Äî —Ç–∏–ø —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ (–≤–∏—Ä–∞–∑)
    ($value:expr) => {
        println!("Value: {} = {}", stringify!($value), $value);
    };
}

fn main() {
    let x = 42;
    show_value!(x);           // Value: x = 42
    show_value!(x + 10);      // Value: x + 10 = 52
    show_value!(x * 2 + 1);   // Value: x * 2 + 1 = 85
}
```

**–†–æ–∑–≥–ª—è–Ω–µ–º–æ –∫–ª—é—á–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏:**

1. **`$value`** ‚Äî —ñ–º'—è –∑–∞—Ö–æ–ø–ª–µ–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó (–ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `$`)
2. **`:expr`** ‚Äî —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ç–∏–ø—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ (–≤–∏—Ä–∞–∑)
3. **`stringify!($value)`** ‚Äî –≤–±—É–¥–æ–≤–∞–Ω–∏–π –º–∞–∫—Ä–æ—Å, —â–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î —Ç–æ–∫–µ–Ω–∏ –Ω–∞ —Ä—è–¥–æ–∫
4. **`$value`** —É —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—ñ ‚Äî –ø—ñ–¥—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è –∑–∞—Ö–æ–ø–ª–µ–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è

### 45.2.4 –¢–∏–ø–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤ (Fragment Specifiers)

–§—Ä–∞–≥–º–µ–Ω—Ç –≤–∏–∑–Ω–∞—á–∞—î, **—è–∫–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç** –º–æ–∂–µ –±—É—Ç–∏ –∑–∞—Ö–æ–ø–ª–µ–Ω–∏–π:

| –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ç–æ—Ä | –©–æ –∑–∞—Ö–æ–ø–ª—é—î | –ü—Ä–∏–∫–ª–∞–¥ |
|--------------|-------------|---------|
| `expr` | –í–∏—Ä–∞–∑ (expression) | `42`, `x + 1`, `foo()` |
| `ident` | –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä | `foo`, `MyStruct`, `x` |
| `ty` | –¢–∏–ø | `i32`, `Vec<String>`, `&str` |
| `pat` | –ü–∞—Ç—Ç–µ—Ä–Ω | `Some(x)`, `(a, b)`, `_` |
| `stmt` | –û–ø–µ—Ä–∞—Ç–æ—Ä (statement) | `let x = 5;` |
| `block` | –ë–ª–æ–∫ –∫–æ–¥—É | `{ ... }` |
| `item` | –ï–ª–µ–º–µ–Ω—Ç –º–æ–¥—É–ª—è | `fn foo()`, `struct S` |
| `literal` | –õ—ñ—Ç–µ—Ä–∞–ª | `42`, `"hello"`, `true` |
| `path` | –®–ª—è—Ö | `std::vec::Vec`, `crate::module` |
| `tt` | –û–¥–∏–Ω —Ç–æ–∫–µ–Ω –∞–±–æ –¥–µ—Ä–µ–≤–æ | –ë—É–¥—å-—â–æ |
| `meta` | –ê—Ç—Ä–∏–±—É—Ç | `derive(Debug)` |

**`tt` (token tree)** ‚Äî –Ω–∞–π–≥–Ω—É—á–∫—ñ—à–∏–π, –∞–ª–µ –Ω–∞–π–º–µ–Ω—à —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–π. –ó–∞—Ö–æ–ø–ª—é—î –±—É–¥—å-—è–∫–∏–π —Ç–æ–∫–µ–Ω –∞–±–æ –≥—Ä—É–ø—É —Ç–æ–∫–µ–Ω—ñ–≤ —É –¥—É–∂–∫–∞—Ö.

### 45.2.5 –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥: –º–∞–∫—Ä–æ—Å –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å, —â–æ –≥–µ–Ω–µ—Ä—É—î –ø—Ä–æ—Å—Ç—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑ –æ–¥–Ω–∏–º –ø–æ–ª–µ–º —Ç–∞ –º–µ—Ç–æ–¥–æ–º new.

```rust
macro_rules! simple_struct {
    // $name:ident ‚Äî —ñ–º'—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
    // $field:ident ‚Äî —ñ–º'—è –ø–æ–ª—è
    // $ty:ty ‚Äî —Ç–∏–ø –ø–æ–ª—è
    ($name:ident, $field:ident: $ty:ty) => {
        struct $name {
            $field: $ty,
        }
        
        impl $name {
            fn new($field: $ty) -> Self {
                Self { $field }
            }
        }
    };
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
simple_struct!(Point, x: f64);
simple_struct!(Counter, value: u32);

fn main() {
    let p = Point::new(3.14);
    let c = Counter::new(0);
    
    println!("Point x: {}", p.x);
    println!("Counter: {}", c.value);
}
```

**–†–æ–∑–≥–ª—è–Ω–µ–º–æ, —â–æ –≥–µ–Ω–µ—Ä—É—î –º–∞–∫—Ä–æ—Å:**

–í–∏–∫–ª–∏–∫ `simple_struct!(Point, x: f64);` —Ä–æ–∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è –≤:

```rust
struct Point {
    x: f64,
}

impl Point {
    fn new(x: f64) -> Self {
        Self { x }
    }
}
```

–û–¥–∏–Ω —Ä—è–¥–æ–∫ –∫–æ–¥—É –≥–µ–Ω–µ—Ä—É—î –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º!

---

## 45.3 –ü–û–í–¢–û–†–ï–ù–ù–Ø (REPETITION)

### 45.3.1 –ü—Ä–æ–±–ª–µ–º–∞ –∑–º—ñ–Ω–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤

–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º–∞–∫—Ä–æ—Å, —â–æ –ø—Ä–∏–π–º–∞—î **–±—É–¥—å-—è–∫—É** –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤?

```rust
// –•–æ—á–µ–º–æ —â–æ—Å—å —Ç–∞–∫–µ:
sum!(1);              // 1
sum!(1, 2);           // 3
sum!(1, 2, 3, 4, 5);  // 15
```

–§—É–Ω–∫—Ü—ñ—è –Ω–µ –º–æ–∂–µ —Ü—å–æ–≥–æ –∑—Ä–æ–±–∏—Ç–∏ ‚Äî –≤–æ–Ω–∞ –º–∞—î —Ñ—ñ–∫—Å–æ–≤–∞–Ω—É —Å–∏–≥–Ω–∞—Ç—É—Ä—É.

### 45.3.2 –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è

–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É—î—Ç—å—Å—è —è–∫ `$( ... ) —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫ –ø–æ–≤—Ç–æ—Ä—é–≤–∞—á`:

```
$( $element:expr ),*
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ ‚îÇ
‚îÇ        ‚îÇ        ‚îÇ ‚îÇ
‚îÇ   –©–æ –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è ‚îÇ
‚îÇ                 ‚îÇ ‚îÇ
‚îÇ         –†–æ–∑–¥—ñ–ª—å–Ω–∏–∫ (–∫–æ–º–∞)
‚îÇ                   ‚îÇ
‚îÇ           –ü–æ–≤—Ç–æ—Ä—é–≤–∞—á (* = 0+, + = 1+, ? = 0-1)
```

**–ü–æ–≤—Ç–æ—Ä—é–≤–∞—á—ñ:**
- `*` ‚Äî –Ω—É–ª—å –∞–±–æ –±—ñ–ª—å—à–µ —Ä–∞–∑—ñ–≤
- `+` ‚Äî –æ–¥–∏–Ω –∞–±–æ –±—ñ–ª—å—à–µ —Ä–∞–∑—ñ–≤
- `?` ‚Äî –Ω—É–ª—å –∞–±–æ –æ–¥–∏–Ω —Ä–∞–∑

### 45.3.3 –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è vec!

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –†–æ–∑–≥–ª—è–Ω–µ–º–æ —Å–ø—Ä–æ—â–µ–Ω—É —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é –º–∞–∫—Ä–æ—Å–∞ `vec!`.

```rust
macro_rules! my_vec {
    // –ü–∞—Ç—Ç–µ—Ä–Ω: –Ω—É–ª—å –∞–±–æ –±—ñ–ª—å—à–µ –≤–∏—Ä–∞–∑—ñ–≤, —Ä–æ–∑–¥—ñ–ª–µ–Ω–∏—Ö –∫–æ–º–∞–º–∏
    ( $( $element:expr ),* ) => {
        {
            let mut temp_vec = Vec::new();
            $(
                // –¶–µ–π –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ $element
                temp_vec.push($element);
            )*
            temp_vec
        }
    };
}

fn main() {
    let v1 = my_vec![];              // –ü–æ—Ä–æ–∂–Ω—ñ–π –≤–µ–∫—Ç–æ—Ä
    let v2 = my_vec![1];             // vec![1]
    let v3 = my_vec![1, 2, 3, 4, 5]; // vec![1, 2, 3, 4, 5]
    
    println!("{:?}", v3);  // [1, 2, 3, 4, 5]
}
```

**–†–æ–∑–≥–ª—è–Ω–µ–º–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –¥–ª—è `my_vec![1, 2, 3]`:**

```rust
// –í—Ö—ñ–¥: my_vec![1, 2, 3]

// –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è:
// $element = [1, 2, 3] (—Ç—Ä–∏ –µ–ª–µ–º–µ–Ω—Ç–∏)

// –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è:
{
    let mut temp_vec = Vec::new();
    temp_vec.push(1);  // –ü–µ—Ä—à–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è
    temp_vec.push(2);  // –î—Ä—É–≥–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è
    temp_vec.push(3);  // –¢—Ä–µ—Ç—î –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è
    temp_vec
}
```

### 45.3.4 –ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –∑ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫–æ–º

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å –¥–ª—è –æ–±—á–∏—Å–ª–µ–Ω–Ω—è —Å—É–º–∏.

```rust
macro_rules! sum {
    // –û–¥–∏–Ω –∞–±–æ –±—ñ–ª—å—à–µ –≤–∏—Ä–∞–∑—ñ–≤, —Ä–æ–∑–¥—ñ–ª–µ–Ω–∏—Ö –∫–æ–º–∞–º–∏
    ( $( $x:expr ),+ ) => {
        {
            let mut total = 0;
            $(
                total += $x;
            )+
            total
        }
    };
}

fn main() {
    let result = sum!(1, 2, 3, 4, 5);
    println!("Sum: {}", result);  // Sum: 15
}
```

**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É:** `+` –∑–∞–º—ñ—Å—Ç—å `*` –æ–∑–Ω–∞—á–∞—î "–æ–¥–∏–Ω –∞–±–æ –±—ñ–ª—å—à–µ". `sum!()` –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ –±—É–¥–µ –ø–æ–º–∏–ª–∫–æ—é –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó.

### 45.3.5 –í–∫–ª–∞–¥–µ–Ω—ñ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è

–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∫–ª–∞–¥–µ–Ω–∏–º–∏:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–∞—Ç—Ä–∏—Ü—ñ (–≤–µ–∫—Ç–æ—Ä –≤–µ–∫—Ç–æ—Ä—ñ–≤).

```rust
macro_rules! matrix {
    // –ó–æ–≤–Ω—ñ—à–Ω—î –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è: —Ä—è–¥–∫–∏, —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ ;
    // –í–Ω—É—Ç—Ä—ñ—à–Ω—î –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è: –µ–ª–µ–º–µ–Ω—Ç–∏, —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ ,
    ( $( [ $( $element:expr ),* ] );* ) => {
        vec![
            $(
                vec![ $( $element ),* ]
            ),*
        ]
    };
}

fn main() {
    let m = matrix![
        [1, 2, 3];
        [4, 5, 6];
        [7, 8, 9]
    ];
    
    println!("{:?}", m);
    // [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
}
```

---

## 45.4 –ö–Ü–õ–¨–ö–ê –ü–†–ê–í–ò–õ –¢–ê –†–ï–ö–£–†–°–Ü–Ø

### 45.4.1 –ü–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞–∫—Ä–æ—Å—ñ–≤

–û–¥–∏–Ω –º–∞–∫—Ä–æ—Å –º–æ–∂–µ –º–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –ø—Ä–∞–≤–∏–ª –∑ —Ä—ñ–∑–Ω–∏–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏:

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Ä—ñ–≤–Ω—è–º–∏.

```rust
macro_rules! log_message {
    // –ü—Ä–∞–≤–∏–ª–æ 1: —Ç—ñ–ª—å–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    ($msg:expr) => {
        println!("[LOG] {}", $msg);
    };
    
    // –ü—Ä–∞–≤–∏–ª–æ 2: —Ä—ñ–≤–µ–Ω—å + –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    ($level:ident, $msg:expr) => {
        println!("[{}] {}", stringify!($level), $msg);
    };
    
    // –ü—Ä–∞–≤–∏–ª–æ 3: —Ä—ñ–≤–µ–Ω—å + —Ñ–æ—Ä–º–∞—Ç–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫
    ($level:ident, $fmt:expr, $($arg:expr),*) => {
        println!(concat!("[", stringify!($level), "] ", $fmt), $($arg),*);
    };
}

fn main() {
    log_message!("Simple message");
    // [LOG] Simple message
    
    log_message!(INFO, "With level");
    // [INFO] With level
    
    log_message!(WARN, "Value is {}", 42);
    // [WARN] Value is 42
}
```

**–í–∞–∂–ª–∏–≤–æ:** –ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è **–∑–≤–µ—Ä—Ö—É –≤–Ω–∏–∑**. –ü–µ—Ä—à–µ, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø–∞—Ç—Ç–µ—Ä–Ω—É ‚Äî –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è.

### 45.4.2 –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∞–≤–∏–ª –∫—Ä–∏—Ç–∏—á–Ω–∏–π

```rust
macro_rules! example {
    // ‚ùå –ü–û–ì–ê–ù–û: –∑–∞–≥–∞–ª—å–Ω–µ –ø—Ä–∞–≤–∏–ª–æ –ø–µ—Ä—à–∏–º
    ($($t:tt)*) => { "catch all" };  // –ó–∞—Ö–æ–ø–ª—é—î –í–°–ï
    ($x:expr) => { "expression" };   // –ù—ñ–∫–æ–ª–∏ –Ω–µ —Å–ø—Ä–∞—Ü—é—î!
}

macro_rules! example_correct {
    // ‚úÖ –î–û–ë–†–ï: —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä—à–∏–º–∏
    ($x:expr) => { "expression" };   // –°–ø—Ä–∞—Ü—é—î –¥–ª—è –≤–∏—Ä–∞–∑—ñ–≤
    ($($t:tt)*) => { "catch all" };  // –î–ª—è –≤—Å—å–æ–≥–æ —ñ–Ω—à–æ–≥–æ
}
```

**–ü—Ä–∞–≤–∏–ª–æ:** –°–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –ø–∞—Ç—Ç–µ—Ä–Ω–∏ ‚Äî –ø–µ—Ä—à–∏–º–∏, –∑–∞–≥–∞–ª—å–Ω—ñ ‚Äî –æ—Å—Ç–∞–Ω–Ω—ñ–º–∏.

### 45.4.3 –†–µ–∫—É—Ä—Å–∏–≤–Ω—ñ –º–∞–∫—Ä–æ—Å–∏

–ú–∞–∫—Ä–æ—Å–∏ –º–æ–∂—É—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Å–µ–±–µ, —â–æ –¥–æ–∑–≤–æ–ª—è—î –æ–±—Ä–æ–±–ª—è—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–æ–≤—ñ–ª—å–Ω–æ—ó –≥–ª–∏–±–∏–Ω–∏.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å, —â–æ –ø—ñ–¥—Ä–∞—Ö–æ–≤—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–¥–∞–Ω–∏—Ö –≤–∏—Ä–∞–∑—ñ–≤.

```rust
macro_rules! count_exprs {
    // –ë–∞–∑–æ–≤–∏–π –≤–∏–ø–∞–¥–æ–∫: 0 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ ‚Üí 0
    () => { 0usize };
    
    // –†–µ–∫—É—Ä—Å–∏–≤–Ω–∏–π –≤–∏–ø–∞–¥–æ–∫: –≤—ñ–¥–æ–∫—Ä–µ–º–ª—é—î–º–æ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç
    // 1 + (–ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ—à—Ç–∏)
    ($head:expr) => { 1usize };
    
    ($head:expr, $($tail:expr),+) => {
        1usize + count_exprs!($($tail),+)
    };
}

fn main() {
    let count = count_exprs!(a, b, c, d, e);
    println!("Count: {}", count);  // Count: 5
}
```

**–†–æ–∑–≥–ª—è–Ω–µ–º–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –¥–ª—è `count_exprs!(a, b, c)`:**

```
count_exprs!(a, b, c)
  = 1 + count_exprs!(b, c)
  = 1 + 1 + count_exprs!(c)
  = 1 + 1 + 1
  = 3
```

**–ó–∞—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è:** Rust –º–∞—î –ª—ñ–º—ñ—Ç –≥–ª–∏–±–∏–Ω–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –º–∞–∫—Ä–æ—Å—ñ–≤ (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 128). –î–ª—è –≥–ª–∏–±–æ–∫–æ—ó —Ä–µ–∫—É—Ä—Å—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ `#![recursion_limit = "256"]`.

---

## 45.5 –ì–Ü–ì–Ü–Ñ–ù–ê –ú–ê–ö–†–û–°–Ü–í

### 45.5.1 –©–æ —Ç–∞–∫–µ –≥—ñ–≥—ñ—î–Ω–∞?

**–ì—ñ–≥—ñ—î–Ω–∞ –º–∞–∫—Ä–æ—Å—ñ–≤** ‚Äî —Ü–µ –º–µ—Ö–∞–Ω—ñ–∑–º, —â–æ –∑–∞–ø–æ–±—ñ–≥–∞—î –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∞–º —ñ–º–µ–Ω –º—ñ–∂ –∑–º—ñ–Ω–Ω–∏–º–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–∞–∫—Ä–æ—Å–∞ —Ç–∞ –∑–º—ñ–Ω–Ω–∏–º–∏ –≤ –∫–æ–¥—ñ, –¥–µ –º–∞–∫—Ä–æ—Å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è.

–†–æ–∑–≥–ª—è–Ω–µ–º–æ –ø—Ä–æ–±–ª–µ–º—É:

```rust
macro_rules! use_x {
    ($body:expr) => {
        {
            let x = 42;  // x –≤–∏–∑–Ω–∞—á–µ–Ω–æ –≤ –º–∞–∫—Ä–æ—Å—ñ
            $body         // —Ç—É—Ç —Ç–µ–∂ –º–æ–∂–µ –±—É—Ç–∏ x
        }
    };
}

fn main() {
    let x = 10;
    let result = use_x!(x * 2);  // –Ø–∫–µ x? 10 —á–∏ 42?
}
```

–£ Rust ‚Äî **–≥—ñ–≥—ñ—î–Ω—ñ—á–Ω—ñ –º–∞–∫—Ä–æ—Å–∏**. –ó–º—ñ–Ω–Ω–∞ `x` –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º–∞–∫—Ä–æ—Å–∞ —ñ `x` —ñ–∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É ‚Äî **—Ä—ñ–∑–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ**. –í–æ–Ω–∏ –Ω–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—é—Ç—å. –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ `10 * 2 = 20`.

### 45.5.2 –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—ñ–≥—ñ—î–Ω–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ì–Ü–ì–Ü–Ñ–ù–ê –ú–ê–ö–†–û–°–Ü–í                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                     ‚îÇ
‚îÇ  –ó–æ–≤–Ω—ñ—à–Ω—ñ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  let x = 10;   // x_–∑–æ–≤–Ω—ñ—à–Ω—ñ–π                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  use_x!(x * 2)                                              ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                              ‚îÇ                                      ‚îÇ
‚îÇ                              ‚ñº                                      ‚îÇ
‚îÇ  –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –º–∞–∫—Ä–æ—Å–∞:                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  {                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ      let x = 42;   // x_–º–∞–∫—Ä–æ—Å–∞ (—ñ–Ω—à–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç!)          ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ      x_–∑–æ–≤–Ω—ñ—à–Ω—ñ–π * 2  // –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è x –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  }                                                          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                              ‚îÇ                                      ‚îÇ
‚îÇ  –†–µ–∑—É–ª—å—Ç–∞—Ç: 10 * 2 = 20 (–Ω–µ 42 * 2!)                               ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 45.5.3 –Ø–≤–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤

–Ü–Ω–æ–¥—ñ –≤–∞–º **–ø–æ—Ç—Ä—ñ–±–Ω–æ** –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑—ñ –∑–º—ñ–Ω–Ω–æ—é –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –≤–∏–∫–ª–∏–∫—É. –î–ª—è —Ü—å–æ–≥–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —ó—ó —è–∫ `ident`:

```rust
macro_rules! increment {
    ($var:ident) => {
        $var += 1;  // –Ø–≤–Ω–æ –ø—Ä–∞—Ü—é—î–º–æ –∑—ñ –∑–º—ñ–Ω–Ω–æ—é –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
    };
}

fn main() {
    let mut counter = 0;
    increment!(counter);  // counter —Å—Ç–∞—î 1
    increment!(counter);  // counter —Å—Ç–∞—î 2
    println!("Counter: {}", counter);  // Counter: 2
}
```

### 45.5.4 $crate ‚Äî –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–æ—Ç–æ—á–Ω–∏–π –∫—Ä–µ–π—Ç

–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ñ –º–∞–∫—Ä–æ—Å—ñ–≤ —É –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `$crate` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö —à–ª—è—Ö—ñ–≤:

```rust
// –£ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ my_lib
pub struct Config { /* ... */ }

macro_rules! create_config {
    () => {
        $crate::Config::default()  // –ó–∞–≤–∂–¥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —à–ª—è—Ö
    };
}
```

–ë–µ–∑ `$crate` –º–∞–∫—Ä–æ—Å –∑–ª–∞–º–∞—î—Ç—å—Å—è, —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–µ—Ä–µ–π–º–µ–Ω—É—î –∫—Ä–µ–π—Ç –ø—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ (`use my_lib as lib`).

---

## 45.6 DSL –î–õ–Ø –ê–ì–ï–ù–¢–Ü–í

### 45.6.1 –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è Domain-Specific Language

**DSL (Domain-Specific Language)** ‚Äî –º–æ–≤–∞, —Å—Ç–≤–æ—Ä–µ–Ω–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ. –ó–∞–º—ñ—Å—Ç—å –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, DSL –¥–æ–∑–≤–æ–ª—è—î –æ–ø–∏—Å—É–≤–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è —É —Ç–µ—Ä–º—ñ–Ω–∞—Ö —Å–∞–º–æ—ó –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ.

–ü—Ä–∏–∫–ª–∞–¥–∏ DSL:
- SQL –¥–ª—è –±–∞–∑ –¥–∞–Ω–∏—Ö
- HTML –¥–ª—è —Ä–æ–∑–º—ñ—Ç–∫–∏
- CSS –¥–ª—è —Å—Ç–∏–ª—ñ–≤
- Regular expressions –¥–ª—è –ø–æ—à—É–∫—É

–ú–∞–∫—Ä–æ—Å–∏ Rust –¥–æ–∑–≤–æ–ª—è—é—Ç—å —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ **–≤–±—É–¥–æ–≤–∞–Ω—ñ DSL** ‚Äî —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Rust-–∫–æ–¥—É.

### 45.6.2 DSL –¥–ª—è –º–∞—à–∏–Ω–∏ —Å—Ç–∞–Ω—ñ–≤ –∞–≥–µ–Ω—Ç–∞

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–ø–∏—Å—É –º–∞—à–∏–Ω–∏ —Å—Ç–∞–Ω—ñ–≤ –∞–≥–µ–Ω—Ç–∞ ‚Äî —Å—Ç–∞–Ω—ñ–≤ —Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤ –º—ñ–∂ –Ω–∏–º–∏.

```rust
macro_rules! state_machine {
    (
        $machine:ident {
            $(
                $state:ident => {
                    $( $event:ident -> $next:ident ),* $(,)?
                }
            ),* $(,)?
        }
    ) => {
        #[derive(Debug, Clone, Copy, PartialEq)]
        enum $machine {
            $( $state ),*
        }
        
        impl $machine {
            fn transition(&self, event: &str) -> Option<Self> {
                match (self, event) {
                    $(
                        $(
                            ($machine::$state, stringify!($event)) => 
                                Some($machine::$next),
                        )*
                    )*
                    _ => None,
                }
            }
            
            fn name(&self) -> &'static str {
                match self {
                    $( $machine::$state => stringify!($state), )*
                }
            }
        }
    };
}
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü—å–æ–≥–æ DSL:**

```rust
state_machine! {
    DroneState {
        Idle => {
            start -> Patrolling,
            emergency -> Emergency,
        },
        Patrolling => {
            target_found -> Investigating,
            low_battery -> Returning,
            emergency -> Emergency,
        },
        Investigating => {
            done -> Patrolling,
            low_battery -> Returning,
        },
        Returning => {
            arrived -> Idle,
        },
        Emergency => {
            resolved -> Idle,
        },
    }
}

fn main() {
    let mut state = DroneState::Idle;
    
    // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤
    println!("–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω: {}", state.name());
    
    if let Some(new_state) = state.transition("start") {
        state = new_state;
        println!("–ü—ñ—Å–ª—è 'start': {}", state.name());
    }
    
    if let Some(new_state) = state.transition("target_found") {
        state = new_state;
        println!("–ü—ñ—Å–ª—è 'target_found': {}", state.name());
    }
    
    // –ù–µ–≤–∞–ª—ñ–¥–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥
    if state.transition("arrived").is_none() {
        println!("–ü–µ—Ä–µ—Ö—ñ–¥ 'arrived' –∑ {} –Ω–µ–º–æ–∂–ª–∏–≤–∏–π", state.name());
    }
}
```

**–í–∏–≤—ñ–¥:**

```
–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω: Idle
–ü—ñ—Å–ª—è 'start': Patrolling
–ü—ñ—Å–ª—è 'target_found': Investigating
–ü–µ—Ä–µ—Ö—ñ–¥ 'arrived' –∑ Investigating –Ω–µ–º–æ–∂–ª–∏–≤–∏–π
```

**–©–æ –≥–µ–Ω–µ—Ä—É—î —Ü–µ–π –º–∞–∫—Ä–æ—Å:**

1. **Enum** –∑—ñ –≤—Å—ñ–º–∞ —Å—Ç–∞–Ω–∞–º–∏
2. **–ú–µ—Ç–æ–¥ transition** ‚Äî –æ–±—Ä–æ–±–ª—è—î –ø–æ–¥—ñ—ó —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π —Å—Ç–∞–Ω
3. **–ú–µ—Ç–æ–¥ name** ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–∞–∑–≤—É —Å—Ç–∞–Ω—É —è–∫ —Ä—è–¥–æ–∫

–ó–∞–º—ñ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è match –∑ –¥–µ—Å—è—Ç–∫–∞–º–∏ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤, –º–∏ –æ–ø–∏—Å—É—î–º–æ –º–∞—à–∏–Ω—É —Å—Ç–∞–Ω—ñ–≤ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ.

### 45.6.3 DSL –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –∞–≥–µ–Ω—Ç–∞

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å –¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º ID –∞–≥–µ–Ω—Ç–∞ —Ç–∞ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è–º.

```rust
macro_rules! agent_log {
    // DEBUG ‚Äî —Ç—ñ–ª—å–∫–∏ –≤ debug-–∑–±—ñ—Ä–∫–∞—Ö
    ($agent:expr, DEBUG, $($arg:tt)*) => {
        #[cfg(debug_assertions)]
        println!(
            "[Agent {:3}] [DEBUG] {}", 
            $agent.id(), 
            format!($($arg)*)
        );
    };
    
    // INFO ‚Äî –∑–∞–≤–∂–¥–∏
    ($agent:expr, INFO, $($arg:tt)*) => {
        println!(
            "[Agent {:3}] [INFO]  {}", 
            $agent.id(), 
            format!($($arg)*)
        );
    };
    
    // WARN ‚Äî –∑ –µ–º–æ–¥–∑—ñ
    ($agent:expr, WARN, $($arg:tt)*) => {
        println!(
            "[Agent {:3}] [WARN]  ‚ö†Ô∏è  {}", 
            $agent.id(), 
            format!($($arg)*)
        );
    };
    
    // ERROR ‚Äî –∑ –µ–º–æ–¥–∑—ñ —Ç–∞ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è–º
    ($agent:expr, ERROR, $($arg:tt)*) => {
        eprintln!(
            "[Agent {:3}] [ERROR] ‚ùå {}", 
            $agent.id(), 
            format!($($arg)*)
        );
    };
}

// –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
struct Agent {
    agent_id: u32,
    battery: u8,
}

impl Agent {
    fn id(&self) -> u32 { self.agent_id }
    
    fn check_battery(&self) {
        agent_log!(self, DEBUG, "Checking battery level");
        
        if self.battery < 20 {
            agent_log!(self, WARN, "Low battery: {}%", self.battery);
        } else {
            agent_log!(self, INFO, "Battery OK: {}%", self.battery);
        }
    }
}

fn main() {
    let agent = Agent { agent_id: 42, battery: 15 };
    agent.check_battery();
}
```

**–í–∏–≤—ñ–¥:**

```
[Agent  42] [DEBUG] Checking battery level
[Agent  42] [WARN]  ‚ö†Ô∏è  Low battery: 15%
```

### 45.6.4 DSL –¥–ª—è –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–º–∞–Ω–¥

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á—ñ:** –°—Ç–≤–æ—Ä–∏–º–æ –º–∞–∫—Ä–æ—Å –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–±–æ—Ä—É –∫–æ–º–∞–Ω–¥ –∞–≥–µ–Ω—Ç–∞.

```rust
macro_rules! define_commands {
    (
        $enum_name:ident {
            $( $cmd:ident $( ( $($field:ident : $ty:ty),* ) )? ),* $(,)?
        }
    ) => {
        #[derive(Debug, Clone)]
        enum $enum_name {
            $(
                $cmd $( { $($field: $ty),* } )?,
            )*
        }
        
        impl $enum_name {
            fn name(&self) -> &'static str {
                match self {
                    $( $enum_name::$cmd { .. } => stringify!($cmd), )*
                }
            }
        }
    };
}

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
define_commands! {
    AgentCommand {
        Start,
        Stop,
        MoveTo(x: f64, y: f64),
        Scan(radius: f64),
        Report(message: String),
    }
}

fn main() {
    let cmd1 = AgentCommand::Start;
    let cmd2 = AgentCommand::MoveTo { x: 10.0, y: 20.0 };
    let cmd3 = AgentCommand::Report { message: "All clear".to_string() };
    
    println!("Command: {}", cmd1.name());  // Start
    println!("Command: {}", cmd2.name());  // MoveTo
    println!("Command: {:?}", cmd3);       // Report { message: "All clear" }
}
```

---

## 45.7 –ù–ê–õ–ê–ì–û–î–ñ–ï–ù–ù–Ø –ú–ê–ö–†–û–°–Ü–í

### 45.7.1 cargo expand

–ù–∞–π–ø–æ—Ç—É–∂–Ω—ñ—à–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –º–∞–∫—Ä–æ—Å—ñ–≤ ‚Äî `cargo expand`. –í—ñ–Ω –ø–æ–∫–∞–∑—É—î –∫–æ–¥ **–ø—ñ—Å–ª—è** —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤—Å—ñ—Ö –º–∞–∫—Ä–æ—Å—ñ–≤.

**–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è:**

```bash
cargo install cargo-expand
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**

```bash
# –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –≤–µ—Å—å –∫–æ–¥
cargo expand

# –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –º–æ–¥—É–ª—å
cargo expand module_name

# –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é
cargo expand main
```

**–ü—Ä–∏–∫–ª–∞–¥:**

```rust
// –ö–æ–¥ –¥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
fn main() {
    let v = vec![1, 2, 3];
    println!("v = {:?}", v);
}
```

```rust
// –ü—ñ—Å–ª—è cargo expand (—Å–ø—Ä–æ—â–µ–Ω–æ)
fn main() {
    let v = {
        let mut temp = Vec::new();
        temp.push(1);
        temp.push(2);
        temp.push(3);
        temp
    };
    
    std::io::_print(
        format_args!("v = {0:?}\n", v)
    );
}
```

### 45.7.2 trace_macros!

–î–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –ø—ñ–¥ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó:

```rust
#![feature(trace_macros)]

trace_macros!(true);
let v = vec![1, 2, 3];
trace_macros!(false);
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –ü–æ—Ç—Ä–µ–±—É—î nightly Rust.

### 45.7.3 –¢–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ —ó—Ö –≤–∏—Ä—ñ—à–µ–Ω–Ω—è

**–ü–æ–º–∏–ª–∫–∞: "no rules expected the token"**

```rust
macro_rules! my_macro {
    ($x:expr) => { $x };
}

my_macro!(let x = 5);  // –ü–æ–º–∏–ª–∫–∞! let x = 5 ‚Äî —Ü–µ stmt, –Ω–µ expr
```

**–†—ñ—à–µ–Ω–Ω—è:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–∏–ø —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `stmt` –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ–≤.

**–ü–æ–º–∏–ª–∫–∞: "recursion limit reached"**

```rust
macro_rules! infinite {
    () => { infinite!() };  // –ù–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∞ —Ä–µ–∫—É—Ä—Å—ñ—è
}
```

**–†—ñ—à–µ–Ω–Ω—è:** –î–æ–¥–∞–π—Ç–µ –±–∞–∑–æ–≤–∏–π –≤–∏–ø–∞–¥–æ–∫ –∞–±–æ –∑–±—ñ–ª—å—à—ñ—Ç—å –ª—ñ–º—ñ—Ç:

```rust
#![recursion_limit = "256"]
```

**–ü–æ–º–∏–ª–∫–∞: "unexpected end of macro invocation"**

```rust
macro_rules! needs_arg {
    ($x:expr) => { $x };
}

needs_arg!();  // –ü–æ–º–∏–ª–∫–∞! –û—á—ñ–∫—É—î—Ç—å—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç
```

**–†—ñ—à–µ–Ω–Ω—è:** –î–æ–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ –≤–∏–∫–ª–∏–∫—É –∞–±–æ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç.

---

## 45.8 –ö–û–õ–ò –í–ò–ö–û–†–ò–°–¢–û–í–£–í–ê–¢–ò –ú–ê–ö–†–û–°–ò

### 45.8.1 –•–æ—Ä–æ—à—ñ –≤–∏–ø–∞–¥–∫–∏ –¥–ª—è –º–∞–∫—Ä–æ—Å—ñ–≤

**‚úÖ –ó–º—ñ–Ω–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤:**

```rust
// –ù–µ–º–æ–∂–ª–∏–≤–æ —è–∫ —Ñ—É–Ω–∫—Ü—ñ—è
my_log!(INFO, "User {} logged in from {}", user_id, ip_address);
```

**‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è boilerplate:**

```rust
// –û–¥–∏–Ω –º–∞–∫—Ä–æ—Å –∑–∞–º—ñ—Å—Ç—å 10 impl
impl_serialize!(Type1, Type2, Type3, Type4, Type5);
```

**‚úÖ DSL –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ:**

```rust
state_machine! {
    AgentState { Idle => { start -> Active } }
}
```

**‚úÖ –£–º–æ–≤–Ω–∞ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—è:**

```rust
debug_only!(expensive_validation());
```

### 45.8.2 –ü–æ–≥–∞–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ –¥–ª—è –º–∞–∫—Ä–æ—Å—ñ–≤

**‚ùå –ö–æ–ª–∏ —Ñ—É–Ω–∫—Ü—ñ—è –¥–æ—Å—Ç–∞—Ç–Ω—è:**

```rust
// –ù–∞–≤—ñ—â–æ –º–∞–∫—Ä–æ—Å –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è?
macro_rules! add { ($a:expr, $b:expr) => { $a + $b } }

// –ö—Ä–∞—â–µ:
fn add(a: i32, b: i32) -> i32 { a + b }
```

**‚ùå –°–∫–ª–∞–¥–Ω–∞ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞:**

–ú–∞–∫—Ä–æ—Å–∏ –≤–∞–∂–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ç–∞ –Ω–∞–ª–∞–≥–æ–¥–∂—É–≤–∞—Ç–∏. –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ –º–∞—î –±—É—Ç–∏ —É —Ñ—É–Ω–∫—Ü—ñ—è—Ö.

**‚ùå –ö–æ–ª–∏ generics –¥–æ—Å—Ç–∞—Ç–Ω—ñ:**

```rust
// –Ø–∫—â–æ —Ä—ñ–∑–Ω–∏—Ü—è —Ç—ñ–ª—å–∫–∏ –≤ —Ç–∏–ø—ñ ‚Äî generics
fn process<T: Process>(item: T) { ... }
```

### 45.8.3 –ü—Ä–∞–≤–∏–ª–æ –≤–∏–±–æ—Ä—É

> **–°–ø–æ—á–∞—Ç–∫—É —Å–ø—Ä–æ–±—É–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é –∞–±–æ generics. –Ø–∫—â–æ –Ω–µ–º–æ–∂–ª–∏–≤–æ ‚Äî —Ç–æ–¥—ñ –º–∞–∫—Ä–æ—Å.**

–ú–∞–∫—Ä–æ—Å–∏ –ø–æ—Ç—É–∂–Ω—ñ, –∞–ª–µ:
- –°–∫–ª–∞–¥–Ω—ñ—à—ñ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è
- –°–∫–ª–∞–¥–Ω—ñ—à—ñ –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è
- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏ –º–µ–Ω—à –∑—Ä–æ–∑—É–º—ñ–ª—ñ
- –ù–µ –º–∞—é—Ç—å —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó –¥–æ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

---

## 45.9 –õ–ê–ë–û–†–ê–¢–û–†–ù–ê –†–û–ë–û–¢–ê

### –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏

–û–ø–∞–Ω—É–≤–∞—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏—Ö –º–∞–∫—Ä–æ—Å—ñ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –∫–æ–¥—É –∞–≥–µ–Ω—Ç—ñ–≤.

### –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ú–∞–∫—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è (3 –±–∞–ª–∏)

–°—Ç–≤–æ—Ä—ñ—Ç—å –º–∞–∫—Ä–æ—Å `repeat!` —â–æ –ø–æ–≤—Ç–æ—Ä—é—î –≤–∏—Ä–∞–∑ N —Ä–∞–∑—ñ–≤:

```rust
repeat!(3, println!("Hello"));
// Hello
// Hello
// Hello
```

**–ü—ñ–¥–∫–∞–∑–∫–∞:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä–µ–∫—É—Ä—Å—ñ—é –∑ –ª—ñ—á–∏–ª—å–Ω–∏–∫–æ–º.

### –ó–∞–≤–¥–∞–Ω–Ω—è 2: –ú–∞–∫—Ä–æ—Å —Å—É–º–∏ (3 –±–∞–ª–∏)

–°—Ç–≤–æ—Ä—ñ—Ç—å –º–∞–∫—Ä–æ—Å `sum_all!` —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î —Å—É–º—É –≤—Å—ñ—Ö –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤:

```rust
let total = sum_all!(1, 2, 3, 4, 5);
assert_eq!(total, 15);

let single = sum_all!(42);
assert_eq!(single, 42);
```

### –ó–∞–≤–¥–∞–Ω–Ω—è 3: DSL –¥–ª—è –∞–≥–µ–Ω—Ç–∞ (4 –±–∞–ª–∏)

–°—Ç–≤–æ—Ä—ñ—Ç—å –º–∞–∫—Ä–æ—Å `define_agent!` —â–æ –≥–µ–Ω–µ—Ä—É—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∞–≥–µ–Ω—Ç–∞ –∑ –ø–æ–ª—è–º–∏ —Ç–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º:

```rust
define_agent!(Scout {
    position: (f64, f64),
    battery: u8,
    active: bool,
});

// –ú–∞—î –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏:
// struct Scout { position: (f64, f64), battery: u8, active: bool }
// impl Scout { fn new(position, battery, active) -> Self { ... } }

let scout = Scout::new((10.0, 20.0), 100, true);
```

---

## 45.10 –†–ï–ó–Æ–ú–ï

### –ö–ª—é—á–æ–≤—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó

**–ú–∞–∫—Ä–æ—Å–∏** ‚Äî –º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è: –∫–æ–¥, —â–æ –≥–µ–Ω–µ—Ä—É—î –∫–æ–¥ –ø—ñ–¥ —á–∞—Å –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó.

**macro_rules!** ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ñ –º–∞–∫—Ä–æ—Å–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–∞—Ç—Ç–µ—Ä–Ω-–º–∞—Ç—á–∏–Ω–≥—É.

**–§—Ä–∞–≥–º–µ–Ω—Ç–∏** –∑–∞—Ö–æ–ø–ª—é—é—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏: `expr`, `ident`, `ty`, `tt`, —Ç–æ—â–æ.

**–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è** (`$(...)*`) –æ–±—Ä–æ–±–ª—è—é—Ç—å –∑–º—ñ–Ω–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤.

**–ì—ñ–≥—ñ—î–Ω–∞** –∑–∞—Ö–∏—â–∞—î –≤—ñ–¥ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ —ñ–º–µ–Ω –º—ñ–∂ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –º–∞–∫—Ä–æ—Å–∞ —Ç–∞ –≤–∏–∫–ª–∏–∫–æ–º.

**DSL** ‚Äî –ø—Ä–µ–¥–º–µ—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω—ñ –º–æ–≤–∏ –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ –≤–∏—Ä–∞–∑–Ω–æ—Å—Ç—ñ.

### –ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

| –°–∏—Ç—É–∞—Ü—ñ—è | –ú–∞–∫—Ä–æ—Å? |
|----------|---------|
| –ó–º—ñ–Ω–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ | ‚úÖ –¢–∞–∫ |
| DSL –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ | ‚úÖ –¢–∞–∫ |
| –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è boilerplate | ‚úÖ –¢–∞–∫ |
| –ü—Ä–æ—Å—Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—è | ‚ùå –ù—ñ |
| –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞ | ‚ùå –ù—ñ |
| –†—ñ–∑–Ω–∏—Ü—è —Ç—ñ–ª—å–∫–∏ –≤ —Ç–∏–ø—ñ | ‚ùå –ù—ñ (generics) |

---

## üîó –ó–í'–Ø–ó–û–ö –ó –ù–ê–°–¢–£–ü–ù–ò–ú –†–û–ó–î–Ü–õ–û–ú

–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ñ –º–∞–∫—Ä–æ—Å–∏ –ø–æ—Ç—É–∂–Ω—ñ, –∞–ª–µ –æ–±–º–µ–∂–µ–Ω—ñ: –≤–æ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å –∑ **–ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ —Ç–æ–∫–µ–Ω—ñ–≤**, –Ω–µ –º–æ–∂—É—Ç—å –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∏–ø–∏ —á–∏ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∏–ø—ñ–≤.

**–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ñ –º–∞–∫—Ä–æ—Å–∏** ‚Äî —Ü–µ —Å–ø—Ä–∞–≤–∂–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –Ω–∞ Rust, —â–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º—É—é—Ç—å AST (Abstract Syntax Tree). –í–æ–Ω–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å:

- `#[derive(MyTrait)]` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è impl –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
- `#[my_attribute]` ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è —Ñ—É–Ω–∫—Ü—ñ–π —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä
- `my_macro!()` ‚Äî –¥–æ–≤—ñ–ª—å–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–æ–¥—É

–£ **–†–æ–∑–¥—ñ–ª—ñ 46: –ú–∞–∫—Ä–æ—Å–∏ ‚Äî –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ñ** –≤–∏:
- –ó—Ä–æ–∑—É–º—ñ—î—Ç–µ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–∏—Ö –º–∞–∫—Ä–æ—Å—ñ–≤
- –ù–∞–≤—á–∏—Ç–µ—Å—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `syn` —Ç–∞ `quote`
- –°—Ç–≤–æ—Ä–∏—Ç–µ `#[derive(Agent)]` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó trait'—ñ–≤

---

> **–ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä–æ–∑–¥—ñ–ª:** [–†–æ–∑–¥—ñ–ª 46: –ú–∞–∫—Ä–æ—Å–∏ ‚Äî –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ñ](./46_Procedural_Macros.md)
